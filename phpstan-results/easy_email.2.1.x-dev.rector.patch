diff --git a/src/Service/EmailAttachmentEvaluator.php b/src/Service/EmailAttachmentEvaluator.php
index 3f514d5..f9bdaec 100644
--- a/src/Service/EmailAttachmentEvaluator.php
+++ b/src/Service/EmailAttachmentEvaluator.php
@@ -109,7 +109,7 @@ class EmailAttachmentEvaluator implements EmailAttachmentEvaluatorInterface {
    */
   protected function saveAttachment(EasyEmailInterface $email, $source, $dest_directory) {
     \Drupal::service('file_system')->prepareDirectory($dest_directory, FileSystemInterface::CREATE_DIRECTORY | FileSystemInterface::MODIFY_PERMISSIONS);
-    $file_entity = file_save_data(file_get_contents($source), $dest_directory . '/' . $this->fileSystem->basename($source));
+    $file_entity = \Drupal::service('file.repository')->writeData(file_get_contents($source), $dest_directory . '/' . $this->fileSystem->basename($source));
     $email->addAttachment($file_entity->id());
   }
 
diff --git a/tests/src/Functional/EasyEmailTestBase.php b/tests/src/Functional/EasyEmailTestBase.php
index 980430d..d8af8bb 100644
--- a/tests/src/Functional/EasyEmailTestBase.php
+++ b/tests/src/Functional/EasyEmailTestBase.php
@@ -50,7 +50,7 @@ abstract class EasyEmailTestBase extends BrowserTestBase {
    */
   protected $defaultTheme = 'stark';
 
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->adminUser = $this->drupalCreateUser($this->getAdministratorPermissions());
