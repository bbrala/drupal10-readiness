diff --git a/src/Authentication/Provider/OAuth2DrupalAuthProvider.php b/src/Authentication/Provider/OAuth2DrupalAuthProvider.php
index 3506ffc..b40471a 100644
--- a/src/Authentication/Provider/OAuth2DrupalAuthProvider.php
+++ b/src/Authentication/Provider/OAuth2DrupalAuthProvider.php
@@ -183,16 +183,16 @@ class OAuth2DrupalAuthProvider implements AuthenticationProviderInterface {
    *
    * @todo Doesn't appear to be used.
    *
-   * @param \Symfony\Component\HttpKernel\Event\GetResponseForExceptionEvent $event
+   * @param \Symfony\Component\HttpKernel\Event\ExceptionEvent $event
    *   The exception object.
    *
    * @return bool
    *   Whether the exception s valid or not.
    */
-  public function handleException(GetResponseForExceptionEvent $event) {
-    $exception = $event->getException();
+  public function handleException(\Symfony\Component\HttpKernel\Event\ExceptionEvent $event) {
+    $exception = $event->getThrowable();
     if ($exception instanceof AccessDeniedHttpException) {
-      $event->setException(new UnauthorizedHttpException('Invalid consumer origin.', $exception));
+      $event->setThrowable(new UnauthorizedHttpException('Invalid consumer origin.', $exception));
       return TRUE;
     }
     return FALSE;
diff --git a/src/Form/AuthorizeForm.php b/src/Form/AuthorizeForm.php
index 041c624..3b87607 100644
--- a/src/Form/AuthorizeForm.php
+++ b/src/Form/AuthorizeForm.php
@@ -118,7 +118,7 @@ class AuthorizeForm extends FormBase {
           <img src="' . base_path() . 'core/misc/icons/73b355/check.svg" alt="" width="25" height="25">
         </div>
         <div class="item">
-          <img src="' . ($this->themeConfig->get('logo.path') ? file_create_url($this->themeConfig->get('logo.path')) : base_path() . 'core/misc/logo/drupal-logo.svg') . '" alt="" width="50" height="50">
+          <img src="' . ($this->themeConfig->get('logo.path') ? \Drupal::service('file_url_generator')->generateAbsoluteString($this->themeConfig->get('logo.path')) : base_path() . 'core/misc/logo/drupal-logo.svg') . '" alt="" width="50" height="50">
         </div>
     </div>',
       ];
diff --git a/src/OAuth2Storage.php b/src/OAuth2Storage.php
index 5f5315d..78b46da 100644
--- a/src/OAuth2Storage.php
+++ b/src/OAuth2Storage.php
@@ -1022,7 +1022,7 @@ class OAuth2Storage implements OAuth2StorageInterface {
           $file->getEntityTypeId() === 'file'
           && $file->access('download')
         ) {
-          return Url::fromUri(file_create_url($file->getFileUri()))->toString();
+          return \Drupal::service('file_url_generator')->generate($file->getFileUri())->toString();
         }
       }
     }
diff --git a/src/Utility.php b/src/Utility.php
index c4293b4..a8ca13b 100644
--- a/src/Utility.php
+++ b/src/Utility.php
@@ -116,7 +116,7 @@ class Utility {
    *   - public_key: The generated public key certificate (PEM encoded X.509).
    */
   public static function generateKeys() {
-    $module_path = drupal_get_path('module', 'oauth2_server');
+    $module_path = \Drupal::service('extension.list.module')->getPath('oauth2_server');
     $module_realpath = \Drupal::service('file_system')->realpath($module_path);
     $config = [
       'config' => $module_realpath . DIRECTORY_SEPARATOR . 'oauth2_server.openssl.cnf',
