diff --git a/modules/preview_site_s3/tests/src/Kernel/S3DeployPluginTest.php b/modules/preview_site_s3/tests/src/Kernel/S3DeployPluginTest.php
index a6e9bc0..9ed4fbb 100644
--- a/modules/preview_site_s3/tests/src/Kernel/S3DeployPluginTest.php
+++ b/modules/preview_site_s3/tests/src/Kernel/S3DeployPluginTest.php
@@ -19,6 +19,7 @@ use Prophecy\Argument;
  */
 class S3DeployPluginTest extends PreviewSiteKernelTestBase {
 
+  use \Prophecy\PhpUnit\ProphecyTrait;
   /**
    * {@inheritdoc}
    */
diff --git a/src/Plugin/PreviewSite/Deploy/PublicFiles.php b/src/Plugin/PreviewSite/Deploy/PublicFiles.php
index 5ac5023..1baa3ce 100644
--- a/src/Plugin/PreviewSite/Deploy/PublicFiles.php
+++ b/src/Plugin/PreviewSite/Deploy/PublicFiles.php
@@ -94,7 +94,7 @@ class PublicFiles extends DeployPluginBase {
     $destination = sprintf('public://%s', trim($this->token->replace($this->configuration['naming'], [
       'preview_site_build' => $build,
     ], ['clean' => TRUE]), '/'));
-    return file_create_url($destination);
+    return \Drupal::service('file_url_generator')->generateAbsoluteString($destination);
   }
 
   /**
