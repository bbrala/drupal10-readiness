diff --git a/juicebox/src/JuiceboxFormatter.php b/juicebox/src/JuiceboxFormatter.php
index 8b2b2cb..62c83cf 100644
--- a/juicebox/src/JuiceboxFormatter.php
+++ b/juicebox/src/JuiceboxFormatter.php
@@ -363,23 +363,23 @@ class JuiceboxFormatter implements JuiceboxFormatterInterface, TrustedCallbackIn
     $image_data = [];
     $image_data['juicebox_compatible'] = TRUE;
     // Set the normal, unstyled, url for reference.
-    $image_data['unstyled_src'] = file_create_url($file->getFileUri());
+    $image_data['unstyled_src'] = \Drupal::service('file_url_generator')->generateAbsoluteString($file->getFileUri());
     // Check compatibility if configured and if the library info contains
     // mimetype compatibility information.
     if ($check_compatible && !empty($library['compatible_mimetypes']) && !in_array($mimetype, $library['compatible_mimetypes'])) {
       // If the item is not compatible, find the substitute mimetype icon.
       $image_data['juicebox_compatible'] = FALSE;
-      $icon_dir = drupal_get_path('module', 'juicebox') . '/images/mimetypes';
+      $icon_dir = \Drupal::service('extension.list.module')->getPath('juicebox') . '/images/mimetypes';
       // We only have icons for each major type, so simplify accordingly.
       // file_icon_class() could also be useful here but would require
       // supporting icons for more package types.
       $type_parts = explode('/', $mimetype);
       $icon_path = $icon_dir . '/' . reset($type_parts) . '.png';
       if (file_exists($icon_path)) {
-        $image_data['imageURL'] = file_create_url($icon_path);
+        $image_data['imageURL'] = \Drupal::service('file_url_generator')->generateAbsoluteString($icon_path);
       }
       else {
-        $image_data['imageURL'] = file_create_url($icon_dir . '/general.png');
+        $image_data['imageURL'] = \Drupal::service('file_url_generator')->generateAbsoluteString($icon_dir . '/general.png');
       }
     }
     // If the item is compatible, style it.
diff --git a/juicebox/tests/src/Functional/JuiceboxConfCase.php b/juicebox/tests/src/Functional/JuiceboxConfCase.php
index d52cc56..6c23776 100644
--- a/juicebox/tests/src/Functional/JuiceboxConfCase.php
+++ b/juicebox/tests/src/Functional/JuiceboxConfCase.php
@@ -151,7 +151,7 @@ namespace Drupal\Tests\juicebox\Functional {
       // Get the urls to the main image with and without "large" styling.
       $node = $this->node;
       $uri = File::load($node->{$this->instFieldName}[0]->target_id)->getFileUri();
-      $test_image_url = file_create_url($uri);
+      $test_image_url = \Drupal::service('file_url_generator')->generateAbsoluteString($uri);
       $test_image_url_formatted = \Drupal::entityTypeManager()->getStorage('image_style')->load('juicebox_medium')->buildUrl($uri);
       // Check control case without custom configuration.
       $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
diff --git a/juicebox/tests/src/Functional/JuiceboxFieldFormatterCase.php b/juicebox/tests/src/Functional/JuiceboxFieldFormatterCase.php
index f965805..ed81a3f 100644
--- a/juicebox/tests/src/Functional/JuiceboxFieldFormatterCase.php
+++ b/juicebox/tests/src/Functional/JuiceboxFieldFormatterCase.php
@@ -89,12 +89,12 @@ class JuiceboxFieldFormatterCase extends JuiceboxCaseTestBase {
     $this->assertSession('Your settings have been saved. Gallery configuration changes saved.');
     // Get the urls to the image and thumb derivatives expected.
     $uri = File::load($node->{$this->instFieldName}[0]->target_id)->getFileUri();
-    $test_formatted_image_url = file_create_url($uri);
+    $test_formatted_image_url = \Drupal::service('file_url_generator')->generateAbsoluteString($uri);
     $test_formatted_thumb_url = \Drupal::entityTypeManager()->getStorage('image_style')->load('thumbnail')->buildUrl($uri);
     // Check for correct embed markup as anon user.
     $this->drupalLogout();
     $this->drupalGet('node/' . $node->id());
-    $this->assertSession(Html::escape(file_url_transform_relative($test_formatted_image_url)) . ' Test styled image found in embed code');
+    $this->assertSession(Html::escape(\Drupal::service('file_url_generator')->transformRelative($test_formatted_image_url)) . ' Test styled image found in embed code');
     // Check for correct XML.
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
     $this->assertSession()->responseContains('imageURL="' . Html::escape($test_formatted_image_url));
diff --git a/juicebox/tests/src/Functional/JuiceboxViewsCase.php b/juicebox/tests/src/Functional/JuiceboxViewsCase.php
index b791412..649f067 100644
--- a/juicebox/tests/src/Functional/JuiceboxViewsCase.php
+++ b/juicebox/tests/src/Functional/JuiceboxViewsCase.php
@@ -104,7 +104,7 @@ class JuiceboxViewsCase extends JuiceboxCaseTestBase {
     $this->drupalGet('juicebox-views-test-advanced');
     $this->assertSession()->responseContains(trim(json_encode(['configUrl' => $xml_url]), '{}"'));
     $this->assertSession()->responseContains('juicebox-views-test--page-2');
-    $this->assertSession()->responseContains(Html::escape(file_url_transform_relative($test_image_url)));
+    $this->assertSession()->responseContains(Html::escape(\Drupal::service('file_url_generator')->transformRelative($test_image_url)));
     // Check for correct XML.
     $this->drupalGet($xml_path);
     $this->assertSession()->responseContains('<?xml version="1.0" encoding="UTF-8"?>');
