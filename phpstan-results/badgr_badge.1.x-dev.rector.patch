diff --git a/badgr_badge.install b/badgr_badge.install
index 255ab7f..f088b08 100644
--- a/badgr_badge.install
+++ b/badgr_badge.install
@@ -12,7 +12,7 @@ function badgr_badge_uninstall() {
   $result = \Drupal::entityQuery('node')
       ->condition('type', ['badgr_account','badgr_issuer','badgr_badges'], 'IN')
       ->execute();
-  entity_delete_multiple('node', $result);
+  \Drupal::service('entity_type.manager')->getStorage('node')->delete(\Drupal::service('entity_type.manager')->getStorage('node')->loadMultiple($result));
   $configFactory = \Drupal::configFactory();
   $configNames = [
     'field.field.node.badgr_account.field_badgr_access_token',
diff --git a/src/BadgrHelpers.php b/src/BadgrHelpers.php
index 497d824..7101ba1 100644
--- a/src/BadgrHelpers.php
+++ b/src/BadgrHelpers.php
@@ -151,8 +151,8 @@ class BadgrHelpers {
             if (!empty($value_badges['image'])) {
               $image_file_name = pathinfo($value_badges['image']);
               $image = file_get_contents($value_badges['image']);
-              $file = file_save_data($image, 'public://' . $image_file_name['basename'], FileSystemInterface::EXISTS_RENAME);
-              $file = file_copy($file, 'public://');
+              $file = \Drupal::service('file.repository')->writeData($image, 'public://' . $image_file_name['basename'], FileSystemInterface::EXISTS_RENAME);
+              $file = \Drupal::service('file.repository')->copy($file, 'public://');
               $issuer_content->set('field_badge_image',['target_id' => $file->id()]);
             }
             $issuer_content->save();
@@ -170,7 +170,7 @@ class BadgrHelpers {
             if (!empty($value_badges['image'])) {
               $image_file_name = pathinfo($value_badges['image']);
               $image = file_get_contents($value_badges['image']);
-              $file = file_save_data($image, 'public://' . $image_file_name['basename'], FileSystemInterface::EXISTS_RENAME);
+              $file = \Drupal::service('file.repository')->writeData($image, 'public://' . $image_file_name['basename'], FileSystemInterface::EXISTS_RENAME);
               if (!empty($file) && !empty($file->id())) {
                 $file->setPermanent();
                 $file->save();
@@ -225,7 +225,7 @@ class BadgrHelpers {
           if (!empty($value_issuer['image'])) {
             $image_file_name = pathinfo($value_issuer['image']);
             $image = file_get_contents($value_issuer['image']);
-            $file = file_save_data($image, 'public://' . $image_file_name['basename']);
+            $file = \Drupal::service('file.repository')->writeData($image, 'public://' . $image_file_name['basename']);
             if (!empty($file) && !empty($file->id())) {
             $file->setPermanent();
             $file->save();
@@ -256,7 +256,7 @@ class BadgrHelpers {
         if (!empty($value_issuer['image'])) {
           $image_file_name = pathinfo($value_issuer['image']);
           $image = file_get_contents($value_issuer['image']);
-          $file = file_save_data($image, 'public://' . $image_file_name['basename'], FileSystemInterface::EXISTS_RENAME);
+          $file = \Drupal::service('file.repository')->writeData($image, 'public://' . $image_file_name['basename'], FileSystemInterface::EXISTS_RENAME);
           if (!empty($file) && !empty($file->id())) {
             $file->setPermanent();
             $file->save();
diff --git a/src/Controller/AddToBackpack.php b/src/Controller/AddToBackpack.php
index 59640a6..b681612 100644
--- a/src/Controller/AddToBackpack.php
+++ b/src/Controller/AddToBackpack.php
@@ -79,7 +79,7 @@ class AddToBackpack extends ControllerBase {
       }
 
       if (!$badge->get('field_badge_image')->isEmpty()) {
-        $badge_image = file_create_url($badge->field_badge_image->entity->getFileUri());
+        $badge_image = \Drupal::service('file_url_generator')->generateAbsoluteString($badge->field_badge_image->entity->getFileUri());
       }
 
       if (!$badge->get('field_badge_account')->isEmpty()) {
