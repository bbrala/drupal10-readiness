diff --git a/gutenberg.module b/gutenberg.module
index 696ac9a..e65ce97 100644
--- a/gutenberg.module
+++ b/gutenberg.module
@@ -75,7 +75,7 @@ function gutenberg_theme() {
     $template_hooks = drupal_find_theme_templates(
       $templates,
       '.html.twig',
-      drupal_get_path('module', $module) . '/templates'
+      \Drupal::service('extension.list.module')->getPath($module) . '/templates'
     );
 
     foreach ($definition['dynamic-blocks'] as $block_name => $block_theme_definition) {
diff --git a/src/DataProvider/BaseDataProvider.php b/src/DataProvider/BaseDataProvider.php
index 5142518..2d1e80f 100644
--- a/src/DataProvider/BaseDataProvider.php
+++ b/src/DataProvider/BaseDataProvider.php
@@ -98,7 +98,7 @@ abstract class BaseDataProvider implements DataProviderInterface {
     foreach ($styles as $style) {
       /** @var \Drupal\image\Entity\ImageStyle $style */
       $sizes[$style->getName()] = [
-        'source_url' => file_url_transform_relative($style->buildUrl($uri)),
+        'source_url' => \Drupal::service('file_url_generator')->transformRelative($style->buildUrl($uri)),
       ];
     }
 
diff --git a/src/DataProvider/FileEntityDataProvider.php b/src/DataProvider/FileEntityDataProvider.php
index 92bdeba..ba77d9e 100644
--- a/src/DataProvider/FileEntityDataProvider.php
+++ b/src/DataProvider/FileEntityDataProvider.php
@@ -24,7 +24,7 @@ class FileEntityDataProvider extends BaseDataProvider {
 
     /** @var \Drupal\file\FileInterface $entity */
     $uri = $entity->getFileUri();
-    $source_url = file_url_transform_relative(file_create_url($uri));
+    $source_url = \Drupal::service('file_url_generator')->generateString($uri);
     $image = $this->imageFactory->get($uri);
     $file_data = $this->getFileData($entity->id());
 
@@ -36,7 +36,7 @@ class FileEntityDataProvider extends BaseDataProvider {
       'title' => $file_data['title'] ?? '',
       'filename' => urldecode($entity->getFilename()),
       'url' => $source_url,
-      'link' => file_create_url($source_url),
+      'link' => \Drupal::service('file_url_generator')->generateAbsoluteString($source_url),
       'alt' => $file_data['alt_text'] ?? '',
       'author' => $entity->getOwnerId(),
       'description' => '',
diff --git a/src/DataProvider/MediaEntityDataProvider.php b/src/DataProvider/MediaEntityDataProvider.php
index 89e6c2c..e357b42 100644
--- a/src/DataProvider/MediaEntityDataProvider.php
+++ b/src/DataProvider/MediaEntityDataProvider.php
@@ -24,7 +24,7 @@ class MediaEntityDataProvider extends BaseDataProvider {
 
     /** @var \Drupal\file\FileInterface $entity */
     $uri = $entity->getFileUri();
-    $source_url = file_url_transform_relative(file_create_url($uri));
+    $source_url = \Drupal::service('file_url_generator')->generateString($uri);
     $file_data = $this->getFileData($entity->id());
 
     $result = [
diff --git a/src/Form/BlockSettingsForm.php b/src/Form/BlockSettingsForm.php
index 48218ac..91cbc44 100644
--- a/src/Form/BlockSettingsForm.php
+++ b/src/Form/BlockSettingsForm.php
@@ -101,11 +101,11 @@ class BlockSettingsForm extends FormBase implements BaseFormIdInterface {
   public function buildForm(array $form, FormStateInterface $form_state, $plugin_id = NULL, $config = []) {
     function array_flatten($array = null) {
       $result = array();
-  
+
       if (!is_array($array)) {
           $array = func_get_args();
       }
-  
+
       foreach ($array as $key => $value) {
           if (is_array($value)) {
               $result = array_merge($result, array_flatten($value));
@@ -113,7 +113,7 @@ class BlockSettingsForm extends FormBase implements BaseFormIdInterface {
               $result = array_merge($result, array($key => $value));
           }
       }
-  
+
       return $result;
     }
 
@@ -123,7 +123,7 @@ class BlockSettingsForm extends FormBase implements BaseFormIdInterface {
 
     $plugin_block = $this->blocksRenderer->getBlockFromPluginId($plugin_id, $configuration ?? []);
     $block_form = $plugin_block->blockForm($form, $form_state);
- 
+
     // $form['#attached']['library'][] = 'gutenberg/drupal-block-settings';
 
     $form['#tree'] = TRUE;
