diff --git a/dfm.api.php b/dfm.api.php
index dfcdacc..91dfd48 100644
--- a/dfm.api.php
+++ b/dfm.api.php
@@ -98,7 +98,7 @@ function hook_dfm_supported_widgets_alter(array &$widgets) {
  */
 function hook_preprocess_dfm_page(array &$page) {
   // Define always included js/css
-  $path = base_path() . drupal_get_path('module', 'my');
+  $path = base_path() . \Drupal::service('extension.list.module')->getPath('my');
   $query_string = $page['qs'];
   $page['jsUrls']['my_js'] = $path . '/js/my.dfm.js' . $query_string;
   $page['cssUrls']['my_css'] = $path . '/css/my.dfm.css' . $query_string;
diff --git a/src/Dfm.php b/src/Dfm.php
index 97845c0..8b42fc1 100644
--- a/src/Dfm.php
+++ b/src/Dfm.php
@@ -128,7 +128,7 @@ class Dfm implements TrustedCallbackInterface {
     $conf['rootDirPath'] = $conf['scheme'] . '://';
     $conf['rootDirUrl'] = preg_replace('@/(?:%2E|\.)$@i', '', file_create_url($conf['rootDirPath'] . '.'));
     if (empty($conf['absUrls'])) {
-      $conf['rootDirUrl'] = file_url_transform_relative($conf['rootDirUrl']);
+      $conf['rootDirUrl'] = \Drupal::service('file_url_generator')->transformRelative($conf['rootDirUrl']);
     }
     $conf['scriptDirPath'] = static::scriptPath();
     $conf['baseUrl'] = base_path();
@@ -351,7 +351,7 @@ class Dfm implements TrustedCallbackInterface {
   public static function scriptPath($subpath = NULL) {
     static $libpath;
     if (!isset($libpath)) {
-      $libpath = drupal_get_path('module', 'dfm') . '/library';
+      $libpath = \Drupal::service('extension.list.module')->getPath('dfm') . '/library';
       if (!file_exists($libpath)) {
         $libpath = DrupalKernel::findSitePath(\Drupal::request()) . '/libraries/dfm_lite';
         if (!file_exists($libpath)) {
diff --git a/src/DfmDrupal.php b/src/DfmDrupal.php
index 64f55a3..6201b33 100644
--- a/src/DfmDrupal.php
+++ b/src/DfmDrupal.php
@@ -65,7 +65,7 @@ class DfmDrupal {
     $jspath = $jsdir . '/dfm.' . $lang . '.js';
     // Translation file was created before. Just add it to page.
     if (file_exists($jspath)) {
-      if ($jsurl = file_create_url($jspath)) {
+      if ($jsurl = \Drupal::service('file_url_generator')->generateAbsoluteString($jspath)) {
         $dfm->addJs($jsurl);
       }
       return;
@@ -107,7 +107,7 @@ class DfmDrupal {
         $jspath = $jsdir . '/dfm.' . $dfm->getConf('lang') . '.js';
         if (@file_put_contents($jspath, 'dfm.extend(dfm.i18n, {' . implode(',', $lines) . '});')) {
           $fs->chmod($jspath);
-          if ($jsurl = file_create_url($jspath)) {
+          if ($jsurl = \Drupal::service('file_url_generator')->generateAbsoluteString($jspath)) {
             $dfm->addJs($jsurl);
           }
         }
@@ -398,8 +398,8 @@ class DfmDrupal {
     try {
       // Update body of nodes/blocks
       if ($dfm->getConf('fixBodyOnMove')) {
-        if ($url = file_create_url($filepath)) {
-          if ($newurl = file_create_url($newpath)) {
+        if ($url = \Drupal::service('file_url_generator')->generateAbsoluteString($filepath)) {
+          if ($newurl = \Drupal::service('file_url_generator')->generateAbsoluteString($newpath)) {
             // Fix Absolute urls
             static::fixFileMove($url, $newurl, $isdir);
             // Fix relative urls.
diff --git a/src/EventSubscriber/DfmSubscriber.php b/src/EventSubscriber/DfmSubscriber.php
index cf3edfc..2b49091 100644
--- a/src/EventSubscriber/DfmSubscriber.php
+++ b/src/EventSubscriber/DfmSubscriber.php
@@ -20,7 +20,7 @@ class DfmSubscriber implements EventSubscriberInterface {
   /**
    * Performs operations before the request is processed.
    */
-  public function requestInit(GetResponseEvent $event) {
+  public function requestInit(\Symfony\Component\HttpKernel\Event\RequestEvent $event) {
     // Allow image derivatives temporarily.
     $request = $event->getRequest();
     $itok = $request->query->get('dfm_itok');
diff --git a/src/Plugin/CKEditorPlugin/DfmCKEditor.php b/src/Plugin/CKEditorPlugin/DfmCKEditor.php
index 033473b..3d914c0 100644
--- a/src/Plugin/CKEditorPlugin/DfmCKEditor.php
+++ b/src/Plugin/CKEditorPlugin/DfmCKEditor.php
@@ -19,7 +19,7 @@ class DfmCKEditor extends CKEditorPluginBase {
    * {@inheritdoc}
    */
   public function getFile() {
-    return drupal_get_path('module', 'dfm') . '/js/dfm.ckeditor.js';
+    return \Drupal::service('extension.list.module')->getPath('dfm') . '/js/dfm.ckeditor.js';
   }
 
   /**
@@ -33,7 +33,7 @@ class DfmCKEditor extends CKEditorPluginBase {
    * {@inheritdoc}
    */
   public function getButtons() {
-    $path = drupal_get_path('module', 'dfm') . '/css/images';
+    $path = \Drupal::service('extension.list.module')->getPath('dfm') . '/css/images';
     return [
       'dfm_image' => [
         'label' => t('Insert images using Drupella File Manager'),
diff --git a/src/Plugin/CKEditorPlugin/DfmCKEditorClassicImage.php b/src/Plugin/CKEditorPlugin/DfmCKEditorClassicImage.php
index a9656af..8fd2ce8 100644
--- a/src/Plugin/CKEditorPlugin/DfmCKEditorClassicImage.php
+++ b/src/Plugin/CKEditorPlugin/DfmCKEditorClassicImage.php
@@ -19,7 +19,7 @@ class DfmCKEditorClassicImage extends CKEditorPluginBase {
    * {@inheritdoc}
    */
   public function getFile() {
-    return drupal_get_path('module', 'dfm') . '/js/dfm.ckeditor.classic_image.js';
+    return \Drupal::service('extension.list.module')->getPath('dfm') . '/js/dfm.ckeditor.classic_image.js';
   }
 
   /**
diff --git a/src/Plugin/CKEditorPlugin/DfmCKEditorClassicLink.php b/src/Plugin/CKEditorPlugin/DfmCKEditorClassicLink.php
index f58452a..71c9cc6 100644
--- a/src/Plugin/CKEditorPlugin/DfmCKEditorClassicLink.php
+++ b/src/Plugin/CKEditorPlugin/DfmCKEditorClassicLink.php
@@ -19,7 +19,7 @@ class DfmCKEditorClassicLink extends CKEditorPluginBase {
    * {@inheritdoc}
    */
   public function getFile() {
-    return drupal_get_path('module', 'dfm') . '/js/dfm.ckeditor.classic_link.js';
+    return \Drupal::service('extension.list.module')->getPath('dfm') . '/js/dfm.ckeditor.classic_link.js';
   }
 
   /**
