diff --git a/src/AvatarManager.php b/src/AvatarManager.php
index e475d12..f44e11e 100644
--- a/src/AvatarManager.php
+++ b/src/AvatarManager.php
@@ -201,7 +201,7 @@ class AvatarManager implements AvatarManagerInterface {
         try {
           if (($result = $this->httpClient->get($url)) && ($result->getStatusCode() == 200)) {
             $file_path = $directory . '/' . $user->id() . '.jpg';
-            $file = file_save_data($result->getBody(), $file_path, FileSystemInterface::EXISTS_REPLACE);
+            $file = \Drupal::service('file.repository')->writeData($result->getBody(), $file_path, FileSystemInterface::EXISTS_REPLACE);
           }
         }
         catch (ClientException $e) {
diff --git a/tests/modules/avatars_test/src/Controller/AvatarKitTestController.php b/tests/modules/avatars_test/src/Controller/AvatarKitTestController.php
index b88a202..173e86f 100644
--- a/tests/modules/avatars_test/src/Controller/AvatarKitTestController.php
+++ b/tests/modules/avatars_test/src/Controller/AvatarKitTestController.php
@@ -15,7 +15,9 @@ class AvatarKitTestController extends ControllerBase {
    */
   public function image() {
     $headers = ['Content-Type' => 'image/png'];
-    $file = drupal_get_path('core', '') . '/misc/druplicon.png';
+    // TODO: Drupal Rector Notice: Please delete the following comment after you've made any necessary changes.
+    // Unsupported extension type encountered, using extension.path.resolver instead of extension.list
+    $file = \Drupal::service('extension.path.resolver')->getPath('core', '') . '/misc/druplicon.png';
     return new BinaryFileResponse($file, 200, $headers);
   }
 
