diff --git a/src/LazyImageStyleHelper.php b/src/LazyImageStyleHelper.php
index eeeca51..c411efe 100644
--- a/src/LazyImageStyleHelper.php
+++ b/src/LazyImageStyleHelper.php
@@ -35,7 +35,7 @@ class LazyImageStyleHelper {
   /**
    * The MIME type guesser.
    *
-   * @var \Symfony\Component\HttpFoundation\File\MimeType\MimeTypeGuesserInterface
+   * @var \Symfony\Component\Mime\MimeTypesInterface
    */
   protected $mimeTypeGuesser;
 
@@ -53,7 +53,7 @@ class LazyImageStyleHelper {
    *   The entity type manager.
    * @param \Drupal\Core\Config\ConfigFactoryInterface $config_factory
    *   The config factory.
-   * @param \Symfony\Component\HttpFoundation\File\MimeType\MimeTypeGuesserInterface $mimeTypeGuesser
+   * @param \Symfony\Component\Mime\MimeTypesInterface $mimeTypeGuesser
    *   The MIME type guesser.
    *
    * @throws \Drupal\Component\Plugin\Exception\InvalidPluginDefinitionException
@@ -62,7 +62,7 @@ class LazyImageStyleHelper {
   public function __construct(
     EntityTypeManagerInterface $entity_type_manager,
     ConfigFactoryInterface $config_factory,
-    MimeTypeGuesserInterface $mimeTypeGuesser
+    \Symfony\Component\Mime\MimeTypesInterface $mimeTypeGuesser
   ) {
 
     $this->configFactory = $config_factory;
@@ -87,7 +87,7 @@ class LazyImageStyleHelper {
     }
 
     // Move source uri to data-src attribute.
-    $variables['attributes']['data-srcset'] = file_url_transform_relative($variables['attributes']['src']);
+    $variables['attributes']['data-srcset'] = \Drupal::service('file_url_generator')->transformRelative($variables['attributes']['src']);
 
     $variables['attributes']['srcset'] = $this->getTmpUrl($variables['uri']);
     $variables['attributes']['class'][] = 'lazyload';
@@ -111,7 +111,7 @@ class LazyImageStyleHelper {
     }
 
     // Move source uri to data-src attribute.
-    $variables['image']['#attributes']['data-srcset'] = file_url_transform_relative($variables['image']['#uri']);
+    $variables['image']['#attributes']['data-srcset'] = \Drupal::service('file_url_generator')->transformRelative($variables['image']['#uri']);
 
     $variables['image']['#attributes']['srcset'] = $this->getTmpUrl($variables['uri']);
     $variables['image']['#attributes']['class'][] = 'lazyload';
@@ -139,7 +139,7 @@ class LazyImageStyleHelper {
       $source->setAttribute('data-srcset', $srcset);
     }
 
-    $variables['img_element']['#attributes']['data-srcset'] = file_url_transform_relative($variables['img_element']['#uri']);
+    $variables['img_element']['#attributes']['data-srcset'] = \Drupal::service('file_url_generator')->transformRelative($variables['img_element']['#uri']);
     $variables['img_element']['#attributes']['srcset'] = $this->getTmpUrl($variables['uri']);
     $variables['img_element']['#attributes']['class'][] = 'lazyload';
     $variables['#attached'] = $this->addAttachments(isset($variables['#attached']) ? $variables['#attached'] : []);
diff --git a/src/Plugin/CKEditorPlugin/LazyImageStyle.php b/src/Plugin/CKEditorPlugin/LazyImageStyle.php
index d31889a..194ef24 100644
--- a/src/Plugin/CKEditorPlugin/LazyImageStyle.php
+++ b/src/Plugin/CKEditorPlugin/LazyImageStyle.php
@@ -20,7 +20,7 @@ class LazyImageStyle extends CKEditorPluginBase {
    * {@inheritdoc}
    */
   public function getFile() {
-    return drupal_get_path('module', 'lazy_image_style') . '/assets/js/plugins/lazy-image-style/plugin.js';
+    return \Drupal::service('extension.list.module')->getPath('lazy_image_style') . '/assets/js/plugins/lazy-image-style/plugin.js';
   }
 
   /**
@@ -34,7 +34,7 @@ class LazyImageStyle extends CKEditorPluginBase {
    * {@inheritdoc}
    */
   public function getButtons() {
-    $module_path = drupal_get_path('module', 'lazy_image_style');
+    $module_path = \Drupal::service('extension.list.module')->getPath('lazy_image_style');
     return [
       'lazy-image-style' => [
         'label' => $this->t('Lazy image style'),
