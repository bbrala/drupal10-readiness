diff --git a/mail_safety.api.php b/mail_safety.api.php
index a192e9a..a02a5ea 100644
--- a/mail_safety.api.php
+++ b/mail_safety.api.php
@@ -19,7 +19,7 @@ function hook_mail_safety_pre_insert(array $message) {
   if (!empty($message['params']['attachments'])) {
     // Loop through the attachments and save the files.
     foreach ($message['params']['attachments'] as $key => $attachment) {
-      $file = file_save_data($attachment['content'], 'public://' . time() . '-' . $attachment['filename']);
+      $file = \Drupal::service('file.repository')->writeData($attachment['content'], 'public://' . time() . '-' . $attachment['filename']);
       $message['attachments'][$key] = $file;
     }
     // Remove the attachments from the e-mail.
