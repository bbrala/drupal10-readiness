diff --git a/modules/setka_editor_amp/setka_editor_amp.module b/modules/setka_editor_amp/setka_editor_amp.module
index 7e0a14e..83d640a 100644
--- a/modules/setka_editor_amp/setka_editor_amp.module
+++ b/modules/setka_editor_amp/setka_editor_amp.module
@@ -232,8 +232,8 @@ function setka_editor_amp_styles_download_file($fileUrl) {
   if ($fileData) {
     preg_match('/.*?\/([^\/]+)$/', $fileUrl, $matches);
     if ($matches[1]) {
-      $file = file_save_data($fileData, 'public://setka/' . $matches[1], FileSystemInterface::EXISTS_REPLACE);
-      return $file ? file_create_url($file->getFileUri()) : FALSE;
+      $file = \Drupal::service('file.repository')->writeData($fileData, 'public://setka/' . $matches[1], FileSystemInterface::EXISTS_REPLACE);
+      return $file ? \Drupal::service('file_url_generator')->generateAbsoluteString($file->getFileUri()) : FALSE;
     }
   }
   return FALSE;
@@ -270,7 +270,7 @@ function setka_editor_amp_build_libraries(&$libraries) {
       ];
 
       if (!empty($cachedAmpStyles[$libraryId])) {
-        $cachedAmpStyle = file_url_transform_relative($cachedAmpStyles[$libraryId]);
+        $cachedAmpStyle = \Drupal::service('file_url_generator')->transformRelative($cachedAmpStyles[$libraryId]);
         $libraries[$libraryId]['css'] = [
           'theme' => [
             $cachedAmpStyle => [
diff --git a/setka_editor.module b/setka_editor.module
index 9c1795b..8a48a89 100644
--- a/setka_editor.module
+++ b/setka_editor.module
@@ -327,7 +327,7 @@ function setka_editor_image_item_prepare($imageItem) {
   if ($image instanceof Drupal\Core\Image\Image) {
     // Original image size.
     $original = [
-      'url' => file_create_url($imageItem->uri),
+      'url' => \Drupal::service('file_url_generator')->generateAbsoluteString($imageItem->uri),
       'width' => $image->getWidth(),
       'height' => $image->getHeight(),
     ];
@@ -343,7 +343,7 @@ function setka_editor_image_item_prepare($imageItem) {
         $sizes[] = $size;
       }
     }
-    $imageUrl = file_create_url($imageItem->uri);
+    $imageUrl = \Drupal::service('file_url_generator')->generateAbsoluteString($imageItem->uri);
     $entityImage = [
       'id' => $imageItem->fid,
       'name' => $imageItem->filename,
diff --git a/src/Controller/SetkaEditorApiController.php b/src/Controller/SetkaEditorApiController.php
index ce56ff3..65f9307 100644
--- a/src/Controller/SetkaEditorApiController.php
+++ b/src/Controller/SetkaEditorApiController.php
@@ -397,7 +397,7 @@ class SetkaEditorApiController extends ControllerBase {
         }
         else {
           $fileData = file_get_contents($_FILES['file']['tmp_name']);
-          $file = file_save_data($fileData, 'public://setka/' . $_FILES['file']['name']);
+          $file = \Drupal::service('file.repository')->writeData($fileData, 'public://setka/' . $_FILES['file']['name']);
 
           if ($entityId && $entityType && $entityId !== 'null') {
             $this->fileUsage->add($file, 'setka_editor', $entityType, $entityId);
diff --git a/src/SetkaEditorHelper.php b/src/SetkaEditorHelper.php
index a94dd7e..2c024ba 100644
--- a/src/SetkaEditorHelper.php
+++ b/src/SetkaEditorHelper.php
@@ -183,8 +183,8 @@ class SetkaEditorHelper {
         $filename = $matches[1];
       }
       if ($filename) {
-        $file = file_save_data($fileData, 'public://setka/' . $filename, FileSystemInterface::EXISTS_REPLACE);
-        return $file ? file_create_url($file->getFileUri()) : FALSE;
+        $file = \Drupal::service('file.repository')->writeData($fileData, 'public://setka/' . $filename, FileSystemInterface::EXISTS_REPLACE);
+        return $file ? \Drupal::service('file_url_generator')->generateAbsoluteString($file->getFileUri()) : FALSE;
       }
     }
     return FALSE;
@@ -208,9 +208,9 @@ class SetkaEditorHelper {
       $directoryPath = str_replace('/' . $filename, '', $directoryPath);
       $directoryPath = "public://setka/{$directoryPath}";
       \Drupal::service('file_system')->prepareDirectory($directoryPath, FileSystemInterface::CREATE_DIRECTORY | FileSystemInterface::MODIFY_PERMISSIONS);
-      $file = file_save_data($fileData, "{$directoryPath}/{$filename}", FileSystemInterface::EXISTS_REPLACE);
+      $file = \Drupal::service('file.repository')->writeData($fileData, "{$directoryPath}/{$filename}", FileSystemInterface::EXISTS_REPLACE);
 
-      return $file ? file_create_url($file->getFileUri()) : FALSE;
+      return $file ? \Drupal::service('file_url_generator')->generateAbsoluteString($file->getFileUri()) : FALSE;
     }
 
     return FALSE;
diff --git a/tests/src/Kernel/SetkaEditorApiTest.php b/tests/src/Kernel/SetkaEditorApiTest.php
index 191fc6d..7403ec3 100644
--- a/tests/src/Kernel/SetkaEditorApiTest.php
+++ b/tests/src/Kernel/SetkaEditorApiTest.php
@@ -40,7 +40,7 @@ class SetkaEditorApiTest extends KernelTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->testStyleManagerResponse = [
