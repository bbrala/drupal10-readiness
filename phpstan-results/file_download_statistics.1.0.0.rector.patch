diff --git a/file_download_statistics.module b/file_download_statistics.module
index 189d500..27fd413 100644
--- a/file_download_statistics.module
+++ b/file_download_statistics.module
@@ -76,7 +76,7 @@ function file_download_statistics_preprocess_file_link(array &$variables) {
     // Add the prefix.
     $file_uri = $file->getFileUri();
     $file_uri = str_replace('private://', 'private://download-counter/', $file_uri);
-    $url = file_create_url($file_uri);
+    $url = \Drupal::service('file_url_generator')->generateAbsoluteString($file_uri);
     $mime_type = $file->getMimeType();
     $options['attributes']['type'] = $mime_type . '; length=' . $file->getSize();
     // Use the description as the link text if available.
diff --git a/src/Plugin/Block/FileDownloadStatisticsPopularBlock.php b/src/Plugin/Block/FileDownloadStatisticsPopularBlock.php
index 65ded3c..6c7886b 100644
--- a/src/Plugin/Block/FileDownloadStatisticsPopularBlock.php
+++ b/src/Plugin/Block/FileDownloadStatisticsPopularBlock.php
@@ -207,7 +207,7 @@ class FileDownloadStatisticsPopularBlock extends BlockBase implements ContainerF
       $item = [
         '#type' => 'link',
         '#title' => $file->getFilename(),
-        '#url' => Url::fromUri(file_create_url($file->getFileUri())),
+        '#url' => \Drupal::service('file_url_generator')->generate($file->getFileUri()),
       ];
       $this->renderer->addCacheableDependency($item, $file);
       $items[] = $item;
diff --git a/src/Plugin/Field/FieldFormatter/FileDownloadStatisticsFileUriFormatter.php b/src/Plugin/Field/FieldFormatter/FileDownloadStatisticsFileUriFormatter.php
index 8a6607f..c37f683 100644
--- a/src/Plugin/Field/FieldFormatter/FileDownloadStatisticsFileUriFormatter.php
+++ b/src/Plugin/Field/FieldFormatter/FileDownloadStatisticsFileUriFormatter.php
@@ -34,7 +34,7 @@ class FileDownloadStatisticsFileUriFormatter extends FileUriFormatter {
       // @todo Wrap in file_url_transform_relative(). This is currently
       // impossible. See BaseFieldFileFormatterBase::viewElements(). Fix in
       // https://www.drupal.org/node/2646744.
-      $value = file_create_url($value);
+      $value = \Drupal::service('file_url_generator')->generateAbsoluteString($value);
     }
     return $value;
   }
diff --git a/src/Tests/DownloadStatisticsTestBase.php b/src/Tests/DownloadStatisticsTestBase.php
index af47697..1f275c6 100644
--- a/src/Tests/DownloadStatisticsTestBase.php
+++ b/src/Tests/DownloadStatisticsTestBase.php
@@ -28,7 +28,7 @@ abstract class DownloadStatisticsTestBase extends BrowserTestBase {
    *
    * @throws \Drupal\Core\Entity\EntityStorageException
    */
-  protected function setUp() {
+  protected function setUp(): void {
 
     parent::setUp();
     // Create Basic page node type.
