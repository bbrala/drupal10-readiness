diff --git a/download_statistics.module b/download_statistics.module
index bd06932..5750230 100644
--- a/download_statistics.module
+++ b/download_statistics.module
@@ -76,7 +76,7 @@ function download_statistics_preprocess_file_link(array &$variables) {
     // Add the prefix.
     $file_uri = $file->getFileUri();
     $file_uri = str_replace('private://', 'private://download-count/', $file_uri);
-    $url = file_create_url($file_uri);
+    $url = \Drupal::service('file_url_generator')->generateAbsoluteString($file_uri);
     $mime_type = $file->getMimeType();
     $options['attributes']['type'] = $mime_type . '; length=' . $file->getSize();
     // Use the description as the link text if available.
diff --git a/src/Plugin/Block/DownloadStatisticsPopularBlock.php b/src/Plugin/Block/DownloadStatisticsPopularBlock.php
index 043531e..6f92515 100644
--- a/src/Plugin/Block/DownloadStatisticsPopularBlock.php
+++ b/src/Plugin/Block/DownloadStatisticsPopularBlock.php
@@ -207,7 +207,7 @@ class DownloadStatisticsPopularBlock extends BlockBase implements ContainerFacto
       $item = [
         '#type' => 'link',
         '#title' => $file->getFilename(),
-        '#url' => Url::fromUri(file_create_url($file->getFileUri())),
+        '#url' => \Drupal::service('file_url_generator')->generate($file->getFileUri()),
       ];
       $this->renderer->addCacheableDependency($item, $file);
       $items[] = $item;
diff --git a/src/Plugin/Field/FieldFormatter/DownloadStatisticsFileUriFormatter.php b/src/Plugin/Field/FieldFormatter/DownloadStatisticsFileUriFormatter.php
index 0c01cdd..c229f47 100644
--- a/src/Plugin/Field/FieldFormatter/DownloadStatisticsFileUriFormatter.php
+++ b/src/Plugin/Field/FieldFormatter/DownloadStatisticsFileUriFormatter.php
@@ -34,7 +34,7 @@ class DownloadStatisticsFileUriFormatter extends FileUriFormatter {
       // @todo Wrap in file_url_transform_relative(). This is currently
       // impossible. See BaseFieldFileFormatterBase::viewElements(). Fix in
       // https://www.drupal.org/node/2646744.
-      $value = file_create_url($value);
+      $value = \Drupal::service('file_url_generator')->generateAbsoluteString($value);
     }
     return $value;
   }
diff --git a/src/Tests/DownloadStatisticsTestBase.php b/src/Tests/DownloadStatisticsTestBase.php
index 0a24f4c..24cef87 100644
--- a/src/Tests/DownloadStatisticsTestBase.php
+++ b/src/Tests/DownloadStatisticsTestBase.php
@@ -28,7 +28,7 @@ abstract class DownloadStatisticsTestBase extends BrowserTestBase {
    *
    * @throws \Drupal\Core\Entity\EntityStorageException
    */
-  protected function setUp() {
+  protected function setUp(): void {
 
     parent::setUp();
     // Create Basic page node type.
