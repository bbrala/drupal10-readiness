diff --git a/wisski_adapter_sparql11_pb/src/Plugin/Field/FieldFormatter/WisskiEntityReferenceLabelFormatter.php b/wisski_adapter_sparql11_pb/src/Plugin/Field/FieldFormatter/WisskiEntityReferenceLabelFormatter.php
index c8826895..ce029b76 100755
--- a/wisski_adapter_sparql11_pb/src/Plugin/Field/FieldFormatter/WisskiEntityReferenceLabelFormatter.php
+++ b/wisski_adapter_sparql11_pb/src/Plugin/Field/FieldFormatter/WisskiEntityReferenceLabelFormatter.php
@@ -72,7 +72,7 @@ class WisskiEntityReferenceLabelFormatter extends EntityReferenceLabelFormatter
 
       // for now we take the interface language
       $langcode = \Drupal::service('language_manager')->getCurrentLanguage()->getId();
-      
+
       if(isset($label[$langcode][0]["value"]))
         $label = $label[$langcode][0]["value"];
       else {
@@ -80,8 +80,8 @@ class WisskiEntityReferenceLabelFormatter extends EntityReferenceLabelFormatter
         if(isset($cur_label[0]["value"]))
           $label = $cur_label[0]["value"];
       }
-        
-      
+
+
       // If the link is to be displayed and the entity has a uri, display a
       // link.
       if ($output_as_link ) {
diff --git a/wisski_adapters/dms/src/Plugin/wisski_salz/Engine/DmsEngine.php b/wisski_adapters/dms/src/Plugin/wisski_salz/Engine/DmsEngine.php
index 01402599..c19d7755 100755
--- a/wisski_adapters/dms/src/Plugin/wisski_salz/Engine/DmsEngine.php
+++ b/wisski_adapters/dms/src/Plugin/wisski_salz/Engine/DmsEngine.php
@@ -1066,9 +1066,9 @@ class DmsEngine extends NonWritableEngineBase implements PathbuilderEngineInterf
 #        dpm(serialize($a_ret), "??");
 #        dpm(microtime(), "start");
         $invnr = $a_ret['invnr'];
-        
+
         $invnr = urlencode($invnr);
-        
+
         $uri = "http://objektkatalog.gnm.de/objekt/" . $invnr;
 
         $uriname = AdapterHelper::getDrupalIdForUri($uri,TRUE,$this->adapterId());
diff --git a/wisski_adapters/dms/src/Query/Query.php b/wisski_adapters/dms/src/Query/Query.php
index 96fd6f16..0f042188 100755
--- a/wisski_adapters/dms/src/Query/Query.php
+++ b/wisski_adapters/dms/src/Query/Query.php
@@ -80,7 +80,7 @@ class Query extends WisskiQueryBase {
 #      dpm(serialize($this->condition->conditions()), "condi?");
 
       $num_conds = 0;
-      
+
       $eidcondition = array();
 
       foreach ($this->condition->conditions() as $condition) {
@@ -134,17 +134,17 @@ class Query extends WisskiQueryBase {
           } else {
             $giveback = array_values($eidquery); // array($thing['eid']);
           }
-          
+
           $eidcondition['field'] = $pb->id() . ".inventarnummer";
           $eidcondition['operator'] = "=";
-          
+
           $uris = AdapterHelper::getUrisForDrupalId($condition['value'], $adapterid);
           $invnr = substr($uris, strlen("http://objektkatalog.gnm.de/objekt/"));
 
           $invnr = urldecode($invnr);
-          
+
           $eidcondition['value'] = $invnr;
-          
+
 #          dpm($invnr);
           #$invnr = urlencode($invnr);
 
@@ -163,7 +163,7 @@ class Query extends WisskiQueryBase {
             } else {
 
             }    
-            
+
 #            dpm("bundle?");
             // load the bundles for this id
             $bundleids = $engine->getBundleIdsForEntityId($eid);        
@@ -180,25 +180,25 @@ class Query extends WisskiQueryBase {
 #          return $giveback;
 
         }
-        
+
 #        dpm($giveback);
-        
+
 #        return $giveback;
       }
-      
+
       if($num_conds == 1 && !empty($giveback)) {
         return $giveback;
       }
-      
+
 #      dpm("half");    
       //wisski_tick("field query half");
-      
+
 #      dpm($eidcondition, "eid?");
 
       foreach($this->condition->conditions() as $condition) {
-        
+
         $conditions = $this->condition->conditions();
-        
+
         if(!is_string($condition['field'])) {
           // might be one deeper
           $conditions = $condition['field']->conditions();
@@ -207,12 +207,12 @@ class Query extends WisskiQueryBase {
           $field = $condition['field'];
           $value = $condition['value'];
         }
-        
+
         $field = $condition['field'];
         $value = $condition['value'];
-        
+
 #        dpm($conditions);
-        
+
         // if there is an array in value but it has only one value (comes from delegator!)
         // then we take the value!
 #        if(is_array($value) && count($value) == 1)
diff --git a/wisski_adapters/zotero/src/Query/Query.php b/wisski_adapters/zotero/src/Query/Query.php
index 9bebef1c..e879d0a6 100755
--- a/wisski_adapters/zotero/src/Query/Query.php
+++ b/wisski_adapters/zotero/src/Query/Query.php
@@ -74,7 +74,7 @@ class Query extends WisskiQueryBase {
 
 #          dpm($condition, "I got this");
           foreach ($condition['field']->conditions() as $subcondition) {
-        
+
           $field = $subcondition['field'];
           $value = $subcondition['value'];
   #        dpm($field, "field");
diff --git a/wisski_apus/wisski_ckeditor/src/Plugin/CKEditorPlugin/Annotation.php b/wisski_apus/wisski_ckeditor/src/Plugin/CKEditorPlugin/Annotation.php
index 484fcd87..a1ad6e35 100755
--- a/wisski_apus/wisski_ckeditor/src/Plugin/CKEditorPlugin/Annotation.php
+++ b/wisski_apus/wisski_ckeditor/src/Plugin/CKEditorPlugin/Annotation.php
@@ -49,7 +49,7 @@ class Annotation extends CKEditorPluginBase implements CKEditorPluginConfigurabl
    * {@inheritdoc}
    */
   public function getFile() {
-    return drupal_get_path('module', 'wisski_ckeditor') . '/js/plugins/annotation/plugin.js';
+    return \Drupal::service('extension.list.module')->getPath('wisski_ckeditor') . '/js/plugins/annotation/plugin.js';
   }
 
   /**
@@ -80,11 +80,11 @@ class Annotation extends CKEditorPluginBase implements CKEditorPluginConfigurabl
     return array(
       'wisskiAddAnnotation' => array(
         'label' => t('Add Annotation'),
-        'image' => drupal_get_path('module', 'wisski_ckeditor') . '/js/plugins/annotation/annotation.png',
+        'image' => \Drupal::service('extension.list.module')->getPath('wisski_ckeditor') . '/js/plugins/annotation/annotation.png',
       ),
       'wisskiDeleteAnnotation' => array(
         'label' => t('Delete Annotation'),
-        'image' => drupal_get_path('module', 'wisski_ckeditor') . '/js/plugins/annotation/delete.png',
+        'image' => \Drupal::service('extension.list.module')->getPath('wisski_ckeditor') . '/js/plugins/annotation/delete.png',
       ),
     );
   }
diff --git a/wisski_apus/wisski_ckeditor/src/Plugin/CKEditorPlugin/AnnotationDialog.php b/wisski_apus/wisski_ckeditor/src/Plugin/CKEditorPlugin/AnnotationDialog.php
index bc271118..7e14bb22 100755
--- a/wisski_apus/wisski_ckeditor/src/Plugin/CKEditorPlugin/AnnotationDialog.php
+++ b/wisski_apus/wisski_ckeditor/src/Plugin/CKEditorPlugin/AnnotationDialog.php
@@ -50,7 +50,7 @@ class AnnotationDialog extends CKEditorPluginBase implements CKEditorPluginConfi
    * {@inheritdoc}
    */
   public function getFile() {
-    return drupal_get_path('module', 'wisski_ckeditor') . '/js/plugins/annotationDialog/plugin.js';
+    return \Drupal::service('extension.list.module')->getPath('wisski_ckeditor') . '/js/plugins/annotationDialog/plugin.js';
   }
 
   /**
@@ -82,7 +82,7 @@ class AnnotationDialog extends CKEditorPluginBase implements CKEditorPluginConfi
     return array(
       'ToggleWisskiAnnotationDialog' => array(
         'label' => t('Annotation Sidebar'),
-        'image' => drupal_get_path('module', 'wisski_ckeditor') . '/js/plugins/annotationDialog/annotationDialog.png',
+        'image' => \Drupal::service('extension.list.module')->getPath('wisski_ckeditor') . '/js/plugins/annotationDialog/annotationDialog.png',
       ),
     );
   }
diff --git a/wisski_apus/wisski_ckeditor/src/Plugin/CKEditorPlugin/QuickEntityPicker.php b/wisski_apus/wisski_ckeditor/src/Plugin/CKEditorPlugin/QuickEntityPicker.php
index 45c5235d..09e1100d 100755
--- a/wisski_apus/wisski_ckeditor/src/Plugin/CKEditorPlugin/QuickEntityPicker.php
+++ b/wisski_apus/wisski_ckeditor/src/Plugin/CKEditorPlugin/QuickEntityPicker.php
@@ -65,7 +65,7 @@ class QuickEntityPicker extends CKEditorPluginBase implements CKEditorPluginConf
    * {@inheritdoc}
    */
   public function getFile() {
-    return drupal_get_path('module', 'wisski_ckeditor') . '/js/plugins/entityLinkDialog/plugin.js';
+    return \Drupal::service('extension.list.module')->getPath('wisski_ckeditor') . '/js/plugins/entityLinkDialog/plugin.js';
   }
 
   /**
@@ -96,7 +96,7 @@ class QuickEntityPicker extends CKEditorPluginBase implements CKEditorPluginConf
     return array(
       'EntityPicker' => array(
         'label' => t('WissKI Entity Picker'),
-        'image' => drupal_get_path('module', 'wisski_ckeditor') . '/js/plugins/entityLinkDialog/entityLinkDialog.png',
+        'image' => \Drupal::service('extension.list.module')->getPath('wisski_ckeditor') . '/js/plugins/entityLinkDialog/entityLinkDialog.png',
       ),
     );
   }
diff --git a/wisski_apus/wisski_ckeditor/wisski_ckeditor.module b/wisski_apus/wisski_ckeditor/wisski_ckeditor.module
index 12a12b63..3423d62d 100755
--- a/wisski_apus/wisski_ckeditor/wisski_ckeditor.module
+++ b/wisski_apus/wisski_ckeditor/wisski_ckeditor.module
@@ -37,7 +37,7 @@ function wisski_ckeditor_ckeditor_plugin() {
     'wisski_apus_adapter' => array(
       'name' => 'wisski_apus_adapter',
       'desc' => t('WissKI Annotation Commons: Provides common features and buttons to annotate and link to instances'),
-      'path' => drupal_get_path('module', 'wisski_ckeditor') . '/js/wisski_apus_adapter/',
+      'path' => \Drupal::service('extension.list.module')->getPath('wisski_ckeditor') . '/js/wisski_apus_adapter/',
       'buttons' => array(
         'ToggleSubject' => array(
           'label' => 'Toggle Subject',
diff --git a/wisski_apus/wisski_textanly/src/Plugin/CKEditorPlugin/Analyse.php b/wisski_apus/wisski_textanly/src/Plugin/CKEditorPlugin/Analyse.php
index 3d4cec61..9d38c342 100755
--- a/wisski_apus/wisski_textanly/src/Plugin/CKEditorPlugin/Analyse.php
+++ b/wisski_apus/wisski_textanly/src/Plugin/CKEditorPlugin/Analyse.php
@@ -49,7 +49,7 @@ class Analyse extends CKEditorPluginBase implements CKEditorPluginConfigurableIn
    * {@inheritdoc}
    */
   public function getFile() {
-    return drupal_get_path('module', 'wisski_textanly') . '/js/plugins/analyse/plugin.js';
+    return \Drupal::service('extension.list.module')->getPath('wisski_textanly') . '/js/plugins/analyse/plugin.js';
   }
 
   /**
@@ -77,11 +77,11 @@ class Analyse extends CKEditorPluginBase implements CKEditorPluginConfigurableIn
     return array(
       'wisskiAnalyse' => array(
         'label' => t('Analyse'),
-        'image' => drupal_get_path('module', 'wisski_textanly') . '/js/plugins/analyse/analyse.png',
+        'image' => \Drupal::service('extension.list.module')->getPath('wisski_textanly') . '/js/plugins/analyse/analyse.png',
       ),
       'wisskiAnalysisLog' => array(
         'label' => t('Show Analysis Log'),
-        'image' => drupal_get_path('module', 'wisski_textanly') . '/js/plugins/analyse/delete.png',
+        'image' => \Drupal::service('extension.list.module')->getPath('wisski_textanly') . '/js/plugins/analyse/delete.png',
       ),
     );
   }
diff --git a/wisski_apus/wisski_textanly/teki_anly/wisski_textanly.analyse.datetime.inc b/wisski_apus/wisski_textanly/teki_anly/wisski_textanly.analyse.datetime.inc
index 62640e61..c3be156f 100755
--- a/wisski_apus/wisski_textanly/teki_anly/wisski_textanly.analyse.datetime.inc
+++ b/wisski_apus/wisski_textanly/teki_anly/wisski_textanly.analyse.datetime.inc
@@ -16,7 +16,7 @@ function wisski_textanly_admin_analyse_datetime($op, $ap) {
     case 'edit':
 
       drupal_load('module', 'wisski_pathbuilder');
-      include_once(drupal_get_path('module', 'wisski_pathbuilder') . '/wisski_pathbuilder.inc');
+      include_once(\Drupal::service('extension.list.module')->getPath('wisski_pathbuilder') . '/wisski_pathbuilder.inc');
 
       //for pb_group: display every top group of the import PB section
       $pb_groups = array();
@@ -297,18 +297,18 @@ function _wisski_textanly_analyse_datetime_match_format($text, $format, $spans,
 
 
   for ($i = 1; $i < $l; $i += 2) {
-    
+
     $regex = $format['pattern'][$i-1];
     $span_pattern = $format['pattern'][$i];
 
-    
-    
+
+
     if (preg_match_all("/$regex/us", $text, $matches, PREG_SET_ORDER | PREG_OFFSET_CAPTURE)) {
 
       foreach ($matches as $match) {
-        
+
         $vars = array();
-        
+
         // check the placeholders
         // we go through the already existing spans and look for
         // those already
@@ -316,7 +316,7 @@ function _wisski_textanly_analyse_datetime_match_format($text, $format, $spans,
           foreach ($format['placeholders'] as $var => $info) {
             $match_len = mb_strlen(trim($match[$var][0]));
             $match_pos = mb_strlen(substr($text, 0, $match[$var][1]));
-            
+
             $vars[$var] = array();
             $groups == (array) $info['groups'];
             foreach ($spans as $i => $span) {
@@ -336,7 +336,7 @@ function _wisski_textanly_analyse_datetime_match_format($text, $format, $spans,
             unset($match[$var]);
           }
         }
-        
+
         // workaround: preg returns the offset in bytes, not chars!
         $range = array(mb_strlen(substr($text, 0, $match[0][1])));
         $range[1] = $range[0] + mb_strlen(trim($match[0][0]));
@@ -344,7 +344,7 @@ function _wisski_textanly_analyse_datetime_match_format($text, $format, $spans,
         foreach ($match as $key => $val) {
           if (is_string($key)) $vars[$key] = $val[0];
         }
-        
+
         $my_args = array($settings, $format, $spans, $range, $vars, $args);
         $spans = call_user_func_array($callback, $my_args);
 
diff --git a/wisski_apus/wisski_textanly/teki_anly/wisski_textanly.analyse.regexp.inc b/wisski_apus/wisski_textanly/teki_anly/wisski_textanly.analyse.regexp.inc
index bc19bc00..10bb9746 100755
--- a/wisski_apus/wisski_textanly/teki_anly/wisski_textanly.analyse.regexp.inc
+++ b/wisski_apus/wisski_textanly/teki_anly/wisski_textanly.analyse.regexp.inc
@@ -16,7 +16,7 @@ function wisski_textanly_admin_analyse_regexp($op, $ap) {
     case 'edit':
 
       drupal_load('module', 'wisski_pathbuilder');
-      include_once(drupal_get_path('module', 'wisski_pathbuilder') . '/wisski_pathbuilder.inc');
+      include_once(\Drupal::service('extension.list.module')->getPath('wisski_pathbuilder') . '/wisski_pathbuilder.inc');
 
       //for pb_group: display every top group of the import PB section
       $pb_groups = array();
diff --git a/wisski_apus/wisski_textanly/teki_anly/wisski_textanly.analyse.vocab.inc b/wisski_apus/wisski_textanly/teki_anly/wisski_textanly.analyse.vocab.inc
index bec450ee..d1524e1d 100755
--- a/wisski_apus/wisski_textanly/teki_anly/wisski_textanly.analyse.vocab.inc
+++ b/wisski_apus/wisski_textanly/teki_anly/wisski_textanly.analyse.vocab.inc
@@ -15,7 +15,7 @@ function wisski_textanly_admin_analyse_vocab($op, $ap) {
     case 'edit':
 
       drupal_load('module', 'wisski_pathbuilder');
-      include_once(drupal_get_path('module', 'wisski_pathbuilder') . '/wisski_pathbuilder.inc');
+      include_once(\Drupal::service('extension.list.module')->getPath('wisski_pathbuilder') . '/wisski_pathbuilder.inc');
 
       //for pb_group: display every top group of the import PB section
       $pb_groups = array();
@@ -159,7 +159,7 @@ function wisski_textanly_admin_analyse_vocab($op, $ap) {
 
     case 'submit':
       drupal_load('module', 'wisski_pathbuilder');
-      include_once(drupal_get_path('module', 'wisski_pathbuilder') . '/wisski_pathbuilder.inc');
+      include_once(\Drupal::service('extension.list.module')->getPath('wisski_pathbuilder') . '/wisski_pathbuilder.inc');
       
       //for pb_group: display every top group of the import PB section
       $pb_groups = array();
diff --git a/wisski_apus/wisski_textanly/teki_anly/wisski_textanly.install b/wisski_apus/wisski_textanly/teki_anly/wisski_textanly.install
index 68aec837..cb98b4b8 100755
--- a/wisski_apus/wisski_textanly/teki_anly/wisski_textanly.install
+++ b/wisski_apus/wisski_textanly/teki_anly/wisski_textanly.install
@@ -9,8 +9,8 @@ function wisski_textanly_install() {
   drupal_install_schema('wisski_textanly');
 
   // load person name info file into tables
-  _wisski_textanly_bulk_load(db_prefix_tables('{wisski_textanly_person}'), drupal_get_path('module', 'wisski_textanly') . '/default_personnames.csv');
-  _wisski_textanly_bulk_load(db_prefix_tables('{wisski_textanly_person}'), drupal_get_path('module', 'wisski_textanly') . '/default_persontypes.csv');
+  _wisski_textanly_bulk_load(db_prefix_tables('{wisski_textanly_person}'), \Drupal::service('extension.list.module')->getPath('wisski_textanly') . '/default_personnames.csv');
+  _wisski_textanly_bulk_load(db_prefix_tables('{wisski_textanly_person}'), \Drupal::service('extension.list.module')->getPath('wisski_textanly') . '/default_persontypes.csv');
 
   // set up a default vocab detection step
   $default_vocab = array(
diff --git a/wisski_apus/wisski_textanly/teki_anly/wisski_textanly.module b/wisski_apus/wisski_textanly/teki_anly/wisski_textanly.module
index 512c8c30..f26773cf 100755
--- a/wisski_apus/wisski_textanly/teki_anly/wisski_textanly.module
+++ b/wisski_apus/wisski_textanly/teki_anly/wisski_textanly.module
@@ -411,7 +411,7 @@ function wisski_textanly_wysiwyg_plugin($editor, $version) {
   $plugins = array(
     // sends the text to server and retrieves automatically generated annotations 
     'wisskiTextAnly' => array(
-      'path' => drupal_get_path('module', 'wisski_textanly') . '/tinymce_plugin.js',
+      'path' => \Drupal::service('extension.list.module')->getPath('wisski_textanly') . '/tinymce_plugin.js',
       'buttons' => array(
         'wisskiTextAnlyAuto' => t('Wisski Toggle Periodic Analysis'),
         'wisskiTextAnlyManual' => t('Wisski Analyse (Manual trigger)'),
@@ -473,8 +473,8 @@ function wisski_textanly_test_page() {
     '#value' => '<div><pre id="analyse_log" class="json_dump"></pre></div>',
   );
 
-  drupal_add_js(drupal_get_path('module', 'wisski_textanly') . '/test_page.js', 'module', 'footer');
-  drupal_add_css(drupal_get_path('module', 'wisski_textanly') . '/test_page.css', 'module');
+  drupal_add_js(\Drupal::service('extension.list.module')->getPath('wisski_textanly') . '/test_page.js', 'module', 'footer');
+  drupal_add_css(\Drupal::service('extension.list.module')->getPath('wisski_textanly') . '/test_page.css', 'module');
  
   return $form;
 }
@@ -581,8 +581,8 @@ function wisski_textanly_html_log($ticket) {
     return "no ticket specified";
   }
   
-  drupal_add_js(drupal_get_path('module', 'wisski_textanly') . '/test_page.js', 'module', 'footer');
-  drupal_add_css(drupal_get_path('module', 'wisski_textanly') . '/test_page.css', 'module');
+  drupal_add_js(\Drupal::service('extension.list.module')->getPath('wisski_textanly') . '/test_page.js', 'module', 'footer');
+  drupal_add_css(\Drupal::service('extension.list.module')->getPath('wisski_textanly') . '/test_page.css', 'module');
   
   $script = "WissKI.textanly.getLogs('$ticket');";
   drupal_add_js($script,  'inline', 'footer');
diff --git a/wisski_apus/wisski_textanly/wisski_textanly.analyse.datetime.inc b/wisski_apus/wisski_textanly/wisski_textanly.analyse.datetime.inc
index 21912a9c..30118b47 100755
--- a/wisski_apus/wisski_textanly/wisski_textanly.analyse.datetime.inc
+++ b/wisski_apus/wisski_textanly/wisski_textanly.analyse.datetime.inc
@@ -15,7 +15,7 @@ function wisski_textanly_admin_analyse_datetime($op, $ap) {
     case 'edit':
 
       drupal_load('module', 'wisski_pathbuilder');
-      include_once(drupal_get_path('module', 'wisski_pathbuilder') . '/wisski_pathbuilder.inc');
+      include_once(\Drupal::service('extension.list.module')->getPath('wisski_pathbuilder') . '/wisski_pathbuilder.inc');
 
       //for pb_group: display every top group of the import PB section
       $pb_groups = array();
diff --git a/wisski_apus/wisski_textanly/wisski_textanly.analyse.mw_automaton.inc b/wisski_apus/wisski_textanly/wisski_textanly.analyse.mw_automaton.inc
index 17c381dd..823de0f2 100755
--- a/wisski_apus/wisski_textanly/wisski_textanly.analyse.mw_automaton.inc
+++ b/wisski_apus/wisski_textanly/wisski_textanly.analyse.mw_automaton.inc
@@ -16,7 +16,7 @@ function wisski_textanly_admin_analyse_mw_automaton($op, $ap) {
     case 'edit':
 
       drupal_load('module', 'wisski_pathbuilder');
-      include_once(drupal_get_path('module', 'wisski_pathbuilder') . '/wisski_pathbuilder.inc');
+      include_once(\Drupal::service('extension.list.module')->getPath('wisski_pathbuilder') . '/wisski_pathbuilder.inc');
 
       //for pb_group: display every top group of the import PB section
       $pb_groups = array();
diff --git a/wisski_apus/wisski_textanly/wisski_textanly.analyse.regexp.inc b/wisski_apus/wisski_textanly/wisski_textanly.analyse.regexp.inc
index d7b4015f..e2869064 100755
--- a/wisski_apus/wisski_textanly/wisski_textanly.analyse.regexp.inc
+++ b/wisski_apus/wisski_textanly/wisski_textanly.analyse.regexp.inc
@@ -16,7 +16,7 @@ function wisski_textanly_admin_analyse_regexp($op, $ap) {
     case 'edit':
 
       drupal_load('module', 'wisski_pathbuilder');
-      include_once(drupal_get_path('module', 'wisski_pathbuilder') . '/wisski_pathbuilder.inc');
+      include_once(\Drupal::service('extension.list.module')->getPath('wisski_pathbuilder') . '/wisski_pathbuilder.inc');
 
       //for pb_group: display every top group of the import PB section
       $pb_groups = array();
diff --git a/wisski_apus/wisski_textanly/wisski_textanly.analyse.vocab.inc b/wisski_apus/wisski_textanly/wisski_textanly.analyse.vocab.inc
index 61863e3e..87f04380 100755
--- a/wisski_apus/wisski_textanly/wisski_textanly.analyse.vocab.inc
+++ b/wisski_apus/wisski_textanly/wisski_textanly.analyse.vocab.inc
@@ -15,7 +15,7 @@ function wisski_textanly_admin_analyse_vocab($op, $ap) {
     case 'edit':
 
       drupal_load('module', 'wisski_pathbuilder');
-      include_once(drupal_get_path('module', 'wisski_pathbuilder') . '/wisski_pathbuilder.inc');
+      include_once(\Drupal::service('extension.list.module')->getPath('wisski_pathbuilder') . '/wisski_pathbuilder.inc');
 
       //for pb_group: display every top group of the import PB section
       $pb_groups = array();
@@ -159,7 +159,7 @@ function wisski_textanly_admin_analyse_vocab($op, $ap) {
 
     case 'submit':
       drupal_load('module', 'wisski_pathbuilder');
-      include_once(drupal_get_path('module', 'wisski_pathbuilder') . '/wisski_pathbuilder.inc');
+      include_once(\Drupal::service('extension.list.module')->getPath('wisski_pathbuilder') . '/wisski_pathbuilder.inc');
       
       //for pb_group: display every top group of the import PB section
       $pb_groups = array();
diff --git a/wisski_apus/wisski_textanly/wisski_textanly.install b/wisski_apus/wisski_textanly/wisski_textanly.install
index f25a1184..2af36e00 100755
--- a/wisski_apus/wisski_textanly/wisski_textanly.install
+++ b/wisski_apus/wisski_textanly/wisski_textanly.install
@@ -9,8 +9,8 @@ function wisski_textanly_install() {
   drupal_install_schema('wisski_textanly');
 
   // load personnames file into table
-  _wisski_textanly_bulk_load('wisski_textanly_mw_automaton', drupal_get_path('module', 'wisski_textanly') . '/default_personnames.csv');
-  _wisski_textanly_bulk_load('wisski_textanly_mw_automaton', drupal_get_path('module', 'wisski_textanly') . '/default_persontypes.csv');
+  _wisski_textanly_bulk_load('wisski_textanly_mw_automaton', \Drupal::service('extension.list.module')->getPath('wisski_textanly') . '/default_personnames.csv');
+  _wisski_textanly_bulk_load('wisski_textanly_mw_automaton', \Drupal::service('extension.list.module')->getPath('wisski_textanly') . '/default_persontypes.csv');
 
   // set up a default vocab detection step
   $default_vocab = array(
diff --git a/wisski_apus/wisski_textanly/wisski_textanly.module b/wisski_apus/wisski_textanly/wisski_textanly.module
index ee73ef65..2bf06eb6 100755
--- a/wisski_apus/wisski_textanly/wisski_textanly.module
+++ b/wisski_apus/wisski_textanly/wisski_textanly.module
@@ -424,7 +424,7 @@ function wisski_textanly_wysiwyg_plugin($editor, $version) {
   $plugins = array(
     // sends the text to server and retrieves automatically generated annotations 
     'wisskiTextAnly' => array(
-      'path' => drupal_get_path('module', 'wisski_textanly') . '/tinymce_plugin.js',
+      'path' => \Drupal::service('extension.list.module')->getPath('wisski_textanly') . '/tinymce_plugin.js',
       'buttons' => array(
         'wisskiTextAnlyAuto' => t('Wisski Toggle Periodic Analysis'),
         'wisskiTextAnlyManual' => t('Wisski Analyse (Manual trigger)'),
@@ -522,8 +522,8 @@ function wisski_textanly_test_page() {
     '#value' => '<div><pre id="analyse_log" class="json_dump"></pre></div>',
   );
 
-  drupal_add_js(drupal_get_path('module', 'wisski_textanly') . '/test_page.js', 'module', 'footer');
-  drupal_add_css(drupal_get_path('module', 'wisski_textanly') . '/test_page.css', 'module');
+  drupal_add_js(\Drupal::service('extension.list.module')->getPath('wisski_textanly') . '/test_page.js', 'module', 'footer');
+  drupal_add_css(\Drupal::service('extension.list.module')->getPath('wisski_textanly') . '/test_page.css', 'module');
  
   return $form;
 }
@@ -630,8 +630,8 @@ function wisski_textanly_html_log($ticket) {
     return "no ticket specified";
   }
   
-  drupal_add_js(drupal_get_path('module', 'wisski_textanly') . '/test_page.js', 'module', 'footer');
-  drupal_add_css(drupal_get_path('module', 'wisski_textanly') . '/test_page.css', 'module');
+  drupal_add_js(\Drupal::service('extension.list.module')->getPath('wisski_textanly') . '/test_page.js', 'module', 'footer');
+  drupal_add_css(\Drupal::service('extension.list.module')->getPath('wisski_textanly') . '/test_page.css', 'module');
   
   $script = "WissKI.textanly.getLogs('$ticket');";
   drupal_add_js($script,  'inline', 'footer');
diff --git a/wisski_apus/wisski_triplify/src/Plugin/wisski_pipe/Processor/TriplifyStandard.php b/wisski_apus/wisski_triplify/src/Plugin/wisski_pipe/Processor/TriplifyStandard.php
index 28b10784..b03d8f1b 100755
--- a/wisski_apus/wisski_triplify/src/Plugin/wisski_pipe/Processor/TriplifyStandard.php
+++ b/wisski_apus/wisski_triplify/src/Plugin/wisski_pipe/Processor/TriplifyStandard.php
@@ -667,7 +667,7 @@ class TriplifyStandard extends ProcessorBase {
   */
   function _wisski_texttrip_triplify_standard_relation(&$group_sources, $rel, $target_uri = NULL, $target_class = NULL) {
 
-    include_once(drupal_get_path('module', 'wisski_pathbuilder') . '/wisski_pathbuilder.inc');
+    include_once(\Drupal::service('extension.list.module')->getPath('wisski_pathbuilder') . '/wisski_pathbuilder.inc');
     $path_data = wisski_pathbuilder_getPathData($rel);
     $source = $group_sources[$path_data['group_id']];
 
diff --git a/wisski_core/src/Controller/WisskiEntityListBuilder.php b/wisski_core/src/Controller/WisskiEntityListBuilder.php
index 99e71596..27a72f4a 100755
--- a/wisski_core/src/Controller/WisskiEntityListBuilder.php
+++ b/wisski_core/src/Controller/WisskiEntityListBuilder.php
@@ -255,7 +255,7 @@ class WisskiEntityListBuilder extends EntityListBuilder {
       $query->pager($this->limit);
       $query->range($this->page*$this->limit,$this->limit);
     }
-    
+
     $qgroup = $query->andConditionGroup();
     //dpm($query);
     if (!empty($this->bundle)) {
@@ -397,7 +397,7 @@ $timethis = microtime(TRUE);
 #    dpm("4.1: " . microtime());
     //let the bundle generate the entity title (normally from the title pattern)
     $entity_label = $this->bundle->generateEntityTitle($entity_id);
-    
+
     // add language
     $langcode = \Drupal::service('language_manager')->getCurrentLanguage()->getId();
     if(isset($entity_label[$langcode])) {
@@ -410,7 +410,7 @@ $timethis = microtime(TRUE);
         $entity_label = "WissKI Default Entity Title";
       }
     }
-    
+
 #    dpm($entity_label, "ente?");
 #    dpm("4.2: " . microtime());
     //create a link to the entity's "canonical" route, link templates
diff --git a/wisski_core/src/Controller/WisskiEntityViewForwarder.php b/wisski_core/src/Controller/WisskiEntityViewForwarder.php
index 1d8e6215..f3418dbf 100755
--- a/wisski_core/src/Controller/WisskiEntityViewForwarder.php
+++ b/wisski_core/src/Controller/WisskiEntityViewForwarder.php
@@ -87,11 +87,11 @@ class WisskiEntityViewForwarder extends EntityViewController {
   public function title(WisskiEntity $wisski_individual = NULL) {
     //dpm(serialize($wisski_individual), "??");
 #    $langcode = \Drupal::service('language_manager')->getCurrentLanguage()->getId();
-    
+
 #    $title = $wisski_individual->label();
 
     return $this->entityRepository->getTranslationFromContext($wisski_individual)->label();
-    
+
 #    dpm($title, "tit?");
 #    dpm($langcode, "langcode?");
 #    dpm($entity->getTranslation(
diff --git a/wisski_core/src/Plugin/Search/WisskiEntitySearch.php b/wisski_core/src/Plugin/Search/WisskiEntitySearch.php
index 85816435..97c69ac9 100755
--- a/wisski_core/src/Plugin/Search/WisskiEntitySearch.php
+++ b/wisski_core/src/Plugin/Search/WisskiEntitySearch.php
@@ -410,7 +410,7 @@ class WisskiEntitySearch extends SearchPluginBase {
       '#type' => 'image_button',
       '#title' => 'Export to Excel',
 #      '#value' => $this->t('Export to Excel'),
-      '#src' => drupal_get_path('module', 'wisski_core') . "/images/export_excel.png",
+      '#src' => \Drupal::service('extension.list.module')->getPath('wisski_core') . "/images/export_excel.png",
       '#attributes' => [ 'alt' => t('Export to Excel'), ],
       '#op' => 'wisski_core_excel_export',
 #      '#ajax' => [
diff --git a/wisski_core/src/Plugin/views/filter/FieldNumeric.php b/wisski_core/src/Plugin/views/filter/FieldNumeric.php
index 0cbafadb..19606538 100755
--- a/wisski_core/src/Plugin/views/filter/FieldNumeric.php
+++ b/wisski_core/src/Plugin/views/filter/FieldNumeric.php
@@ -86,7 +86,7 @@ class FieldNumeric extends ViewsNumeric {
     }
   }
 
- 
+
   /**
    * {@inheritdoc}
    */
diff --git a/wisski_core/src/Plugin/views/query/WisskiIndividualQuery.php b/wisski_core/src/Plugin/views/query/WisskiIndividualQuery.php
index d3ae28b3..16ad8203 100755
--- a/wisski_core/src/Plugin/views/query/WisskiIndividualQuery.php
+++ b/wisski_core/src/Plugin/views/query/WisskiIndividualQuery.php
@@ -898,7 +898,7 @@ class WisskiIndividualQuery extends QueryPluginBase
                 // add the title values to the label so it can be rendered correctly...
                 if(isset($values_per_row[$eid]['title']))
                   $pseudo_entity_fields[$eid]['label'] = array($values_per_row[$eid]['title']);
-                
+
                 // By Mark:
                 // we need to wrap the title in array brackets, otherwise we loose some parts
                 // if we have a : or something like that in the characters.
@@ -1090,24 +1090,24 @@ class WisskiIndividualQuery extends QueryPluginBase
         // if it is a wisski field at all
         if(strpos($field, ".") === 0) {
           $viewsdata = \Drupal\views\Views::viewsData()->get('wisski_individual');
-            
+
           // cut away the dot and have a look.
           $viewsdata = $viewsdata[substr($field, 1)];
-          
+
           if(isset($viewsdata['field']) && isset($viewsdata['field']['wisski_field']))  
             $wisski_field = $viewsdata['field']['wisski_field'];
           else // no wisski field?
             $wisski_field = "";
-        
+
           if(!empty($wisski_field))
             $field = $wisski_field;
-            
+
           // in this case we also have to check if the operator
           // is correct in case of entity reference thingies
           //if(is_numeric($value) && $operator == "=") {
           //    $operator = "has_eid";
           //}
-          
+
           if(strpos($field, ".") !== FALSE) {
             // load the relevant path from the cache
             // populate the cache if it doesn't exist
@@ -1139,7 +1139,7 @@ class WisskiIndividualQuery extends QueryPluginBase
                 // this is hopefully a base field like .langcode?
                 $field = $pb_and_path[1]; 
               }
-            
+
             }
           }
 
diff --git a/wisski_core/src/WisskiStorage.php b/wisski_core/src/WisskiStorage.php
index 08c4fe6b..32915a4b 100755
--- a/wisski_core/src/WisskiStorage.php
+++ b/wisski_core/src/WisskiStorage.php
@@ -343,7 +343,7 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
             // the language "en" is added to this variable although there is no english translation for the entity name
             // to avoid this, we have to continue here, so only languages are added which do not come from entity references
             $field_def = $field_defs[$key];
-            
+
             #dpm(serialize($field_def->isTranslatable()), "is it?" . $field_def->getLabel());
             // by MyF: this part does not work as expected; we comment this out since we prefer empty and translated fields
             // instead of only original languages fields
@@ -377,19 +377,19 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
             #    dpm("answer is false");
                 $not_set_languages[$alang] = $alang;
               }
-              
+
               if(count($set_languages) == count($available_languages))
                 break;
-              
+
             }
 
             if(count($set_languages) == count($available_languages))
               break;
           }
-         
+
 #          dpm($available_languages, "available langs");          
 #          dpm($set_languages, "the setted languages");
-          
+
           // clear the titles that are not represented in the data
 #          foreach($set_languages as $slang) {
 #            unset($values[$id]["label"][$slang]);
@@ -409,7 +409,7 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
           // by Mark: I am unsure if this is a correct assumption
           // it might be that we have to fetch it from elsewhere
           // but for now this seems ok.
-          
+
           if(isset($values[$id]["default_langcode"])){
 
             foreach($values[$id]["default_langcode"] as $key => $value) {
@@ -418,8 +418,8 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
                 $orig_lang = $key;
             } 
           }
-         
-          
+
+
           // if the entity has no default langcode (which might be and probably is the default
           // for old wisski instances) we just use the first language
           // that comes up
@@ -430,7 +430,7 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
             } else {
               $orig_lang = current($set_languages);
             }
-            
+
             # dpm($set_languages, "set?");
           }          
 
@@ -440,7 +440,7 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
           // therefore we correct it here for further development
           if(is_array($orig_lang))
             $orig_lang = current($orig_lang);
-          
+
           // by Mark:
           // if the orig_lang is not in the available languages there is something fishy
           // and we will have difficulties because data wont be loaded actively.
@@ -450,13 +450,13 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
 //            dpm($orig_lang, "orig?");
 //            dpm($available_languages, "avail?");
           }
-          
-            
+
+
 #          dpm("my orig lang is: " . serialize($orig_lang));
 
-          
+
 #          dpm(serialize($base_fields), "yay, basefields!");
-          
+
           // MF^2: In any case we process the value array for a certain entity
           // and set the x-default langcode accordingly for all base fields. 
           // Just in case of a translatable base field that really has language tags
@@ -465,7 +465,7 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
           // see below ;)
           // in case of a "normal" field we assume that it is always translatable
           // (which typically holds for wisski entities)
-          
+
           // after that we can iterate through all non-base-fields and these
           // typically have different languages enabled by default due to the
           // setting in the wisski Entity
@@ -475,8 +475,8 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
             // if it is a base field, simply set it to the appropriate langcode
             if(in_array($key, $base_field_names)) {
               $base_field_def = $base_fields[$key];
-             
-              
+
+
               // if this is translatable
               if($base_field_def->isTranslatable()) {
 #		      dpm($val, "val? for $key");
@@ -485,7 +485,7 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
                 if(is_array($val)){
                   $does_it_have_any_language = FALSE;
                   foreach($val as $pot_lang => $some_field_values) {
-                    
+
                     // if this is a language tag
                     /*
                     if(!in_array($pot_lang, $available_languages)) {
@@ -495,34 +495,34 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
                       // translatable base field like array("value" => "smthg")
                       // unfortunately this currently happens 
                       // @TODO: Fix this case!
-                      
+
                       // By Mark: This case also happens if there is a language in the
                       // ts that is not in the drupal... so this check is too weak 
                       // and we should NOT do this!
-                      
-                      
+
+
                       $test[$key][LanguageInterface::LANGCODE_DEFAULT] = $val;
 //                      dpm($available_languages, "avail?");
 //                      dpm($pot_lang, "pot?");
                       break;
                     }
                     */
-                    
+
                     if(in_array($pot_lang, $available_languages) || $pot_lang == "und") {
                       $does_it_have_any_language = TRUE;
                     }
-                    
+
                   }
-                  
+
                   if(!$does_it_have_any_language)
                     $test[$key][LanguageInterface::LANGCODE_DEFAULT] = $val;
                 }
                 #dpm($test);
-    
+
                 // if we have found something, we can savely continue.               
                 if(isset($test[$key][LanguageInterface::LANGCODE_DEFAULT]))
                   continue;
-              
+
                 // if not we do the "normal field handling"
                 // because it is a translatable base field
                 // which has language tags that must be replaced accordingly.
@@ -535,7 +535,7 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
                 continue;
               }
             }
-            
+
             // and now we do the "normal field" handling and the handling for
             // translatable base fields (in fact we do the handling for any 
             // translatable fields)
@@ -545,7 +545,7 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
               // if we dont have anything, continue.
               if(!isset($field_defs[$key]))
                 continue;
-                
+
  #             dpm($val, "val!");
               $field_def = $field_defs[$key];
               if ($field_def->getType() === 'entity_reference') {
@@ -563,17 +563,17 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
                   }
                 }
               }
-              
+
               foreach($val as $field_lang => $field_vals) {
                 // if it is the default language of the entity, we exchange the 
                 // language tag of the original language for x-default
                 #if(gettype($field_lang) != gettype($orig_lang)){
 #                  dpm("Warning: gettype(field_lang) != gettype(orig_lang)");
                 #}
-                
+
                 // check if we have languages that are very odd like und and und is not in the
                 // available languages.
-		
+
 		if($field_lang == "und" && !in_array($field_lang, $available_languages)) {
 		  $curr_lang = \Drupal::service('language_manager')->getCurrentLanguage()->getId();
 		  if(!isset($val[$curr_lang]))
@@ -581,8 +581,8 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
                   else if(!isset($val[$orig_lang]))
                     $field_lang = $orig_lang;
 		}
-		
-		
+
+
 		#dpm(serialize($field_lang));
 		#dpm(serialize($orig_lang));
 		if($field_def->isTranslatable()) {
@@ -590,7 +590,7 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
                     $test[$key][LanguageInterface::LANGCODE_DEFAULT] = $field_vals;
                     $test[$key][$orig_lang] = $field_vals;
                   } else {
-                                  
+
                     // we just trust it for now...                 
                     $test[$key][$field_lang] = $field_vals;
                   }
@@ -607,14 +607,14 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
               }
             }
            #dpm($test, "test22?"); 
-            
+
             // else we just take it as it is.
 //            if(!empty(array_intersect(array_keys($val), $set_languages))) {
 //              $test[$key] = $val;
 //              continue;
 //            }
           } 
-                    
+
             /*
             if(is_array($val)) {
 #              $test[$key] = $val;
@@ -638,10 +638,10 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
           // we still have to set default_langcode and
           // content_translation_source and published(status) probably? 
           // Or have to get it from cache correctly.
-        
-        
-        
-        
+
+
+
+
 #          $test["eid"] = array("x-default" => $test["eid"]);
 #          $test["langcode"] = array("x-default" => "en", "fr" => "fr");
 #          $test["label"] = array("x-default" => "juhu?", "fr" => "oh weh");
@@ -663,17 +663,17 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
 #            dpm($test, "what do we give?");
 
 #          $test["default_langcode"]["x-default"] = array("value" => TRUE);
-          
-          
+
+
 #          $test["eid"] = $test["eid"]["x-default"][0];
-          
+
 #          $entity = $this->create($values[$id]);
 #          dpm($entity);
           // Initialize translations array.
           $translations = array_fill_keys(array_keys($values), []);
 
           $translations[$id] = $set_languages; //array("x-default", "fr", "ar");
-    
+
 #          dpm($this->entityClass, "??");
 #          return;
           // Debug from Node:
@@ -704,9 +704,9 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
           $inter_lang = \Drupal::service('language_manager')->getCurrentLanguage()->getId();
 
 #          $entity = $entity->getTranslation($inter_lang);
-          
+
 #          dpm($entity);
-    
+
 #          $entity = new $this->entityClass($values[$id], "wisski_individual", $values[$id]["bundle"], array_keys($translations[$id]));
           //dpm(serialize($entity), "yay!");
           $entity->enforceIsNew(FALSE);
@@ -1137,9 +1137,9 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
                     if (strpos($preview_image_uri, "public://") !== FALSE) {
                       $preview_image_uri = str_replace("public:/", \Drupal::service('stream_wrapper.public')->baseUrl(), $preview_image_uri);
                     }
-                    
+
                     $preview_id = $this->getFileId($preview_image_uri);
-                    
+
 #                    dpm($preview_id);
                     $new_field_values[$id][$field_name] = array(array("target_id" => intval($preview_id)));
 //                    $new_field_values[$id][$field_name] = array($preview_image_uri);
@@ -1352,7 +1352,7 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
                           #else if(!isset($nfv[$main_property]))
                           #                          dpm($nfv);
                         }
-                      
+
                         // if we found something go for it...
                         if (isset($found_cached_field_value)) {
                           if(is_array($nfv))
@@ -1403,7 +1403,7 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
                       $file_uri = $properties_array['original_target_id'];
 #       	             dpm($file_uri, "got");                    
                       $local_uri = '';
-                        
+
                       $properties_array['target_id'] = $this->getFileId($file_uri,$local_uri, $id);
 /*
                     $properties_array = array(
@@ -1570,7 +1570,7 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
           }
 
 #              dpm(array('data'=>$data,'uri'=>$file_uri,'local'=>$local_file_uri),'Trying to save image');
-          $file = file_save_data($data, $local_file_uri);
+          $file = \Drupal::service('file.repository')->writeData($data, $local_file_uri);
 
           if ($file) {
             $value = $file->id();
@@ -1959,13 +1959,13 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
 
             // this is evil because we take simply the first one.
             //$lc = current($lc);
-            
+
             // go deeper...
             while(is_array($lc))
               $lc = current($lc);              
-            
+
             $langcode = $lc;
-            
+
 #            dpm($lc);
           }
           
@@ -2591,7 +2591,7 @@ class WisskiStorage extends SqlContentEntityStorage implements WisskiStorageInte
     if(empty($preview_uri) || empty($found_preview)) {
       
       $image_style = $this->getPreviewStyle();
-      $output_uri = drupal_get_path('module', 'wisski_core') . "/images/img_nopic.png";
+      $output_uri = \Drupal::service('extension.list.module')->getPath('wisski_core') . "/images/img_nopic.png";
 #      dpm($output_uri, "out");
       $preview_uri = $image_style->buildUri($output_uri);
       
diff --git a/wisski_data_merge/src/Form/WisskiDataMergeForm.php b/wisski_data_merge/src/Form/WisskiDataMergeForm.php
index c5af37df..a8f7ace5 100755
--- a/wisski_data_merge/src/Form/WisskiDataMergeForm.php
+++ b/wisski_data_merge/src/Form/WisskiDataMergeForm.php
@@ -251,29 +251,29 @@ class WisskiDataMergeForm extends FormBase {
 #        $wherefront = "WHERE { ";
         
         foreach($result as $res) {
-        
+
           $pa = $path->getPathArray();
           $palength = count($pa);
-          
+
 #          dpm($pa, "pa?");
-          
+
           #dpm($res, "res");
           #dpm($path->getPathArray(), "pa?");
           #dpm(count($path->getPathArray()), "path");
-          
+
           for($pos = 2; $pos < $palength; $pos += 2) {
             $var = "x" . $pos;
             $inverse = $engine->getInverseProperty($pa[($pos -1)]);
             $filters .= " FILTER( ?x" . $pos . " != <" . $res->$var . "> ) . ";
             $delfront .= "?x" . $pos . " a <" . $pa[$pos] . "> . ";
             $delfront .= "?x" . ($pos-2) . " <" . $pa[($pos -1)] . "> ?x" . $pos . " . ";
-            
+
             if($inverse)
               $delfront .= "?x" . $pos . " <" . $inverse . "> ?x" . ($pos-2) . " . ";
           }
-          
+
           $delfront .= "?x" . ($pos-2) . " <" . $path->getDatatypeProperty() . "> '" . $outvalue . "'";
-          
+
 #          dpm($filters, "fil");
 #          dpm($delfront, "del?");
         }
diff --git a/wisski_duplicate/src/Form/WisskiDuplicateForm.php b/wisski_duplicate/src/Form/WisskiDuplicateForm.php
index bcbc0c90..d857f187 100755
--- a/wisski_duplicate/src/Form/WisskiDuplicateForm.php
+++ b/wisski_duplicate/src/Form/WisskiDuplicateForm.php
@@ -148,18 +148,18 @@ class WisskiDuplicateForm extends FormBase {
 
             $options = array();
             $reses = array();
-            
+
             foreach($result as $res) {
 
               $grp = $res->grp->getValue();
-              
+
               $urls = explode(", ", $grp);
-              
+
               $grp = "";
               foreach($urls as $key => $url) {
                 $grp .= "<a href='" . base_path() . "wisski/get?uri=" . $url . "'>" . $url . "</a>, ";
               }
-              
+
               $grp = substr($grp, 0, -2);
 
               $html = $res->anzahl . "x - '" . $res->out . "' - " . $this->t('Entities: ') . $grp . "";
@@ -167,36 +167,36 @@ class WisskiDuplicateForm extends FormBase {
               $reses[$i] = $res->grp->getValue();
               $i++;
             }
-            
+
             $form['stores']['table'] = array(
               '#type' => 'checkboxes',
               '#options' => $options,
               '#title' => $this->t('What do you want to unify?'),
             );
-            
+
             $form['stores']['tableoptions'] = array(
               '#type' => 'hidden',
               '#value'=> $reses,
             );
-            
+
 /*
             $form['stores']['header'] = array(
               '#type' => 'item',
               '#markup' => '<b>Duplicates:</b><br/>',
             );
-            
+
             $table = "<table><tr><th>" . $this->t('Values') . "</th><th>" . $this->t('Count') . "</th><th>" . $this->t('Uris') . "</th><th>" . $this->t('Unify') . "</th></tr>";
-            
-            
-            
-            
+
+
+
+
             foreach($result as $res) {
               $cb = array(
                 '#type' => 'checkbox',
                 '#name' => 'check_' . $i++,
                 '#title' => $this->t('Unify'),
               );
-              
+
               $rendered = \Drupal::service('renderer')->render($cb);
 #              dpm($rendered, "ren?");
               // $table .= "<tr><td>" . $ont->ont . "</td><td>" . $ont->iri . "</td><td>" . $ont->ver . "</td><td>" . $ont->graph . "</td></tr>";
@@ -204,7 +204,7 @@ class WisskiDuplicateForm extends FormBase {
             }
 
             $table .= "</table>";
-          
+
             $form['stores']['table'] = array(
               '#type' => 'item',
               '#markup' => $table,
@@ -267,11 +267,11 @@ class WisskiDuplicateForm extends FormBase {
       $urls = explode(", ", $url_arr[$key]);
 
       $urls = array_unique($urls);
-      
+
       if(count($urls) >= 2) {
-      
+
 #      dpm($urls, "urls?");
-      
+
         $from_eids = array();
 #    \Drupal::logger('MERGE ')->debug('yay44: @yay', ['@yay' => serialize($urls)]);
         foreach ($urls as $url) {
@@ -290,7 +290,7 @@ class WisskiDuplicateForm extends FormBase {
 
 #      dpm($from_eids, "from?");
         $first = array_shift($from_eids);
-      
+
 #      dpm("I merge " . $first . " with " . serialize($from_eids));
 
         $merger = new Merger();
@@ -298,7 +298,7 @@ class WisskiDuplicateForm extends FormBase {
 
         $this->messenger()->addMessage($this->t('I merged %first with %all and got status %status', ['%first' => $first, '%all' => serialize($from_eids), '%status' => $status ]));
       }
-      
+
       // remove some of the paths that are only duplicates...
 #      $query = 
 #      foreach(
diff --git a/wisski_iip_image/src/Controller/WisskiIIIFController.php b/wisski_iip_image/src/Controller/WisskiIIIFController.php
index cb0039a1..ae4379f9 100755
--- a/wisski_iip_image/src/Controller/WisskiIIIFController.php
+++ b/wisski_iip_image/src/Controller/WisskiIIIFController.php
@@ -52,7 +52,7 @@ class WisskiIIIFController {
       $logo = $base_url . $logo;
     
     if(empty($logo)) 
-      $logo = $base_url . '/' . drupal_get_path('module', 'wisski_core') . "/images/img_nopic.png";
+      $logo = $base_url . '/' . \Drupal::service('extension.list.module')->getPath('wisski_core') . "/images/img_nopic.png";
 
     // Basic example manifest information - this should be replaced with
     // specific details or a database call for dynamic details.
diff --git a/wisski_iip_image/wisski_iip_image.module b/wisski_iip_image/wisski_iip_image.module
index b838488c..496a4209 100755
--- a/wisski_iip_image/wisski_iip_image.module
+++ b/wisski_iip_image/wisski_iip_image.module
@@ -128,6 +128,6 @@ function wisski_iip_image_field_widget_form_alter(&$element, FormStateInterface
 function wisski_iip_image_theme_registry_alter(&$theme_registry) {
 #  dpm($theme_registry);
 #  $theme_registry['colorbox_formatter']['template'] = 'wisskiiip-colorbox-formatter';
-  $theme_registry['colorbox_formatter']['path'] = drupal_get_path('module', 'wisski_iip_image') . '/templates';
+  $theme_registry['colorbox_formatter']['path'] = \Drupal::service('extension.list.module')->getPath('wisski_iip_image') . '/templates';
 }
 
diff --git a/wisski_odbc_import/src/Form/WisskiODBCImportForm.php b/wisski_odbc_import/src/Form/WisskiODBCImportForm.php
index de0c61dc..3a305df8 100755
--- a/wisski_odbc_import/src/Form/WisskiODBCImportForm.php
+++ b/wisski_odbc_import/src/Form/WisskiODBCImportForm.php
@@ -802,7 +802,7 @@ class WisskiODBCImportForm extends FormBase {
             $out = $handler->getReferenceableEntities($fieldvalue);
 #          dpm($out, "out");
             $curr_bundle = current($out);
-            
+
             $curr_eid = NULL;
             foreach($curr_bundle as $key_eid => $val_eid) {
               if($val_eid == $fieldvalue) {
diff --git a/wisski_pathbuilder/src/Form/ExporterForm.php b/wisski_pathbuilder/src/Form/ExporterForm.php
index 93d96429..b1fe192e 100755
--- a/wisski_pathbuilder/src/Form/ExporterForm.php
+++ b/wisski_pathbuilder/src/Form/ExporterForm.php
@@ -109,7 +109,7 @@ class ExporterForm extends FormBase {
     $yaml = Yaml::encode($config_assemblage);
     
     // we must not use yml extension as it is blocked by htaccess
-    $file = file_save_data($yaml, "public://pb_bundle_export.yaml");
+    $file = \Drupal::service('file.repository')->writeData($yaml, "public://pb_bundle_export.yaml");
     $uri = $file->toUrl();
 #    $uri = $file->url();
 #    $link = \Drupal\Core\Link::fromTextAndUrl($uri, \Drupal\Core\Url::fromUri($uri));
diff --git a/wisski_pathbuilder/src/Form/WisskiPathbuilderForm.php b/wisski_pathbuilder/src/Form/WisskiPathbuilderForm.php
index 7aba23c0..757d54ca 100755
--- a/wisski_pathbuilder/src/Form/WisskiPathbuilderForm.php
+++ b/wisski_pathbuilder/src/Form/WisskiPathbuilderForm.php
@@ -484,7 +484,7 @@ class WisskiPathbuilderForm extends EntityForm {
 
     foreach ($files as $file) {
       // $form['export']['export'][] = array('#type' => 'link', '#title' => $file->filename, '#url' => Url::fromUri(file_create_url($file->uri)));
-      $items[] = ['#type' => 'link', '#title' => $file->filename, '#url' => Url::fromUri(file_create_url($file->uri))];
+      $items[] = ['#type' => 'link', '#title' => $file->filename, '#url' => \Drupal::service('file_url_generator')->generate($file->uri)];
     }
 
     $form['export']['export'] = [
diff --git a/wisski_salz/src/Query/QueryPlanner.php b/wisski_salz/src/Query/QueryPlanner.php
index 87209d0d..06a94448 100755
--- a/wisski_salz/src/Query/QueryPlanner.php
+++ b/wisski_salz/src/Query/QueryPlanner.php
@@ -165,7 +165,7 @@ class QueryPlanner {
             if ($pivot == NULL || $pivot['type'] == self::TYPE_EMPTY_PLAN) {
                 $pivot = $right;
             }
-            
+
             $left = $right; // check the next plan
         }
         return $pivot;
