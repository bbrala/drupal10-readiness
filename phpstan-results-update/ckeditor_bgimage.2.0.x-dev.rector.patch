diff --git a/src/Form/EditorFileDialog.php b/src/Form/EditorFileDialog.php
index a8ee9e5..8adba12 100644
--- a/src/Form/EditorFileDialog.php
+++ b/src/Form/EditorFileDialog.php
@@ -189,8 +189,8 @@ class EditorFileDialog extends FormBase implements BaseFormIdInterface {
     if (!empty($fid)) {
       /** @var \Drupal\file\FileInterface */
       $file = $this->fileStorage->load($fid);
-      $file_url = file_create_url($file->getFileUri());
-      $file_url = file_url_transform_relative($file_url);
+      $file_url = \Drupal::service('file_url_generator')->generateAbsoluteString($file->getFileUri());
+      $file_url = \Drupal::service('file_url_generator')->transformRelative($file_url);
       $form_state->setValue(['attributes', 'image'], $file_url);
     }
 
diff --git a/src/Plugin/CKEditorPlugin/Bgimage.php b/src/Plugin/CKEditorPlugin/Bgimage.php
index 59bbef5..41e986c 100644
--- a/src/Plugin/CKEditorPlugin/Bgimage.php
+++ b/src/Plugin/CKEditorPlugin/Bgimage.php
@@ -21,7 +21,7 @@ class Bgimage extends CKEditorPluginBase implements CKEditorPluginConfigurableIn
    * {@inheritdoc}
    */
   public function getFile() {
-    if ($module_path = drupal_get_path('module', 'ckeditor_bgimage')) {
+    if ($module_path = \Drupal::service('extension.list.module')->getPath('ckeditor_bgimage')) {
       return $module_path . '/src/js/bgimage/plugin.js';
     }
   }
@@ -52,7 +52,7 @@ class Bgimage extends CKEditorPluginBase implements CKEditorPluginConfigurableIn
     return [
       'bgimage' => [
         'label' => $this->t('Background Image'),
-        'image' => drupal_get_path('module', 'ckeditor_bgimage') . '/src/js/bgimage/icons/background.png',
+        'image' => \Drupal::service('extension.list.module')->getPath('ckeditor_bgimage') . '/src/js/bgimage/icons/background.png',
       ],
     ];
   }
