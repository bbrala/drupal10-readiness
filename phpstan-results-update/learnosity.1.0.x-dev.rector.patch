diff --git a/src/Controller/LearnosityActivityController.php b/src/Controller/LearnosityActivityController.php
index 86995a8..d297090 100644
--- a/src/Controller/LearnosityActivityController.php
+++ b/src/Controller/LearnosityActivityController.php
@@ -146,7 +146,7 @@ class LearnosityActivityController extends ControllerBase implements ContainerIn
           ]));
         }
         else {
-          $link = $entity->link($date);
+          $link = $entity->toLink($date)->toString();
         }
 
         $row = [];
diff --git a/src/Controller/LearnosityEventController.php b/src/Controller/LearnosityEventController.php
index 7f5d48b..46b1b03 100644
--- a/src/Controller/LearnosityEventController.php
+++ b/src/Controller/LearnosityEventController.php
@@ -94,7 +94,7 @@ class LearnosityEventController extends ControllerBase implements ContainerInjec
     $context = $this->processContext();
 
     $event = new LearnosityEvent($name, $context);
-    $dispatch = $this->eventDispatcher->dispatch('learnosity.' . $name, $event);
+    $dispatch = $this->eventDispatcher->dispatch($event, 'learnosity.' . $name);
 
     // Check to see if any subscribers return a response. If they do then use
     // that. Otherwise default to an empty ajax response.
diff --git a/src/Event/LearnosityEvent.php b/src/Event/LearnosityEvent.php
index 148071e..b8a70fa 100644
--- a/src/Event/LearnosityEvent.php
+++ b/src/Event/LearnosityEvent.php
@@ -2,7 +2,7 @@
 
 namespace Drupal\learnosity\Event;
 
-use Symfony\Component\EventDispatcher\Event;
+use Symfony\Contracts\EventDispatcher\Event;
 use Symfony\Component\HttpFoundation\Response;
 
 /**
diff --git a/src/Form/LearnosityActivityRevisionRevertForm.php b/src/Form/LearnosityActivityRevisionRevertForm.php
index 9bf7166..4347dc6 100644
--- a/src/Form/LearnosityActivityRevisionRevertForm.php
+++ b/src/Form/LearnosityActivityRevisionRevertForm.php
@@ -148,7 +148,7 @@ class LearnosityActivityRevisionRevertForm extends ConfirmFormBase {
   protected function prepareRevertedRevision(LearnosityActivityInterface $revision, FormStateInterface $form_state) {
     $revision->setNewRevision();
     $revision->isDefaultRevision(TRUE);
-    $revision->setRevisionCreationTime(REQUEST_TIME);
+    $revision->setRevisionCreationTime(\Drupal::time()->getRequestTime());
 
     return $revision;
   }
diff --git a/src/Form/LearnosityActivityRevisionRevertTranslationForm.php b/src/Form/LearnosityActivityRevisionRevertTranslationForm.php
index e232549..8352ec3 100644
--- a/src/Form/LearnosityActivityRevisionRevertTranslationForm.php
+++ b/src/Form/LearnosityActivityRevisionRevertTranslationForm.php
@@ -110,7 +110,7 @@ class LearnosityActivityRevisionRevertTranslationForm extends LearnosityActivity
 
     $latest_revision_translation->setNewRevision();
     $latest_revision_translation->isDefaultRevision(TRUE);
-    $revision->setRevisionCreationTime(REQUEST_TIME);
+    $revision->setRevisionCreationTime(\Drupal::time()->getRequestTime());
 
     return $latest_revision_translation;
   }
diff --git a/tests/src/Kernel/LearnosityActivityEditorElementFormTest.php b/tests/src/Kernel/LearnosityActivityEditorElementFormTest.php
index 1b18ac4..7149e8b 100644
--- a/tests/src/Kernel/LearnosityActivityEditorElementFormTest.php
+++ b/tests/src/Kernel/LearnosityActivityEditorElementFormTest.php
@@ -160,7 +160,7 @@ class LearnosityActivityEditorElementFormTest extends LearnosityKernelTestBase i
     // Test the 'activity' element.
     $value = $form_state->getValue('activity_blank');
     // The UUID should match the following pattern.
-    $this->assertRegExp('/[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}/', $value['entity']->getReference());
+    $this->assertMatchesRegularExpression('/[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}/', $value['entity']->getReference());
     $this->assertEquals('learnosity_activity', $value['entity']->bundle());
     $this->assertEquals($this->testUser->id(), $value['entity']->getOwnerId());
 
diff --git a/tests/src/Unit/LearnosityApiEventHandlerTest.php b/tests/src/Unit/LearnosityApiEventHandlerTest.php
index 17908c9..f6b56e6 100644
--- a/tests/src/Unit/LearnosityApiEventHandlerTest.php
+++ b/tests/src/Unit/LearnosityApiEventHandlerTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\learnosity\Unit;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\learnosity\Event\LearnosityAssessmentEvent;
 use Drupal\learnosity\LearnosityApiEventHandler;
 use Drupal\Tests\UnitTestCase;
@@ -14,6 +15,7 @@ use Drupal\Core\Entity\EntityTypeEvents;
  */
 class LearnosityApiEventHandlerTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
    * Test getting subscribed events.
    */
diff --git a/tests/src/Unit/LearnosityEventControllerTest.php b/tests/src/Unit/LearnosityEventControllerTest.php
index 0b1af2c..b2da9be 100644
--- a/tests/src/Unit/LearnosityEventControllerTest.php
+++ b/tests/src/Unit/LearnosityEventControllerTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\learnosity\Unit;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Core\Ajax\AjaxResponse;
 use Drupal\learnosity\Controller\LearnosityEventController;
 use Drupal\Tests\UnitTestCase;
@@ -17,6 +18,7 @@ use Prophecy\Argument;
  */
 class LearnosityEventControllerTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
    * Tests learnosity event controller.
    */
diff --git a/tests/src/Unit/LearnositySdkTest.php b/tests/src/Unit/LearnositySdkTest.php
index 1e7ee26..5d3ac8f 100644
--- a/tests/src/Unit/LearnositySdkTest.php
+++ b/tests/src/Unit/LearnositySdkTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\learnosity\Unit;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\learnosity\LearnositySdk;
 use Drupal\Tests\UnitTestCase;
 use Symfony\Component\DependencyInjection\ContainerInterface;
@@ -17,6 +18,7 @@ use Drupal\Core\Logger\LoggerChannelFactoryInterface;
  */
 class LearnositySdkTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
    * The service container.
    *
