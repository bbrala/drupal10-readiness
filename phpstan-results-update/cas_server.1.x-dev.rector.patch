diff --git a/cas_server.info.yml b/cas_server.info.yml
index e5274f6..702b6c5 100644
--- a/cas_server.info.yml
+++ b/cas_server.info.yml
@@ -1,6 +1,5 @@
 name: CAS Server
 description: 'Provides a CAS Server implementation that runs on Drupal.'
 type: module
-core: 8.x
-core_version_requirement: ^8 || ^9
+core_version_requirement: ^9.1 || ^10
 configure: cas_server.settings
diff --git a/src/Controller/TicketValidationController.php b/src/Controller/TicketValidationController.php
index 2306690..1ecc18a 100644
--- a/src/Controller/TicketValidationController.php
+++ b/src/Controller/TicketValidationController.php
@@ -508,7 +508,7 @@ class TicketValidationController implements ContainerInjectionInterface {
 
     $event = new CASAttributesAlterEvent($account, $ticket);
 
-    $this->eventDispatcher->dispatch(CASAttributesAlterEvent::CAS_ATTRIBUTES_ALTER_EVENT, $event);
+    $this->eventDispatcher->dispatch($event, CASAttributesAlterEvent::CAS_ATTRIBUTES_ALTER_EVENT);
 
     $attributes = $event->getAttributes();
     if ($format == 'xml') {
@@ -561,7 +561,7 @@ class TicketValidationController implements ContainerInjectionInterface {
 
     $account = $this->loadUser($ticket->getUid());
     $event = new CASAttributesAlterEvent($account, $ticket);
-    $this->eventDispatcher->dispatch(CASAttributesAlterEvent::CAS_ATTRIBUTES_ALTER_EVENT, $event);
+    $this->eventDispatcher->dispatch($event, CASAttributesAlterEvent::CAS_ATTRIBUTES_ALTER_EVENT);
 
     if ($format == 'xml') {
       $response_text = "<cas:serviceResponse xmlns:cas='http://www.yale.edu/tp/cas'>
diff --git a/src/Event/CASAttributesAlterEvent.php b/src/Event/CASAttributesAlterEvent.php
index 174209f..d5287bf 100644
--- a/src/Event/CASAttributesAlterEvent.php
+++ b/src/Event/CASAttributesAlterEvent.php
@@ -3,9 +3,9 @@
 namespace Drupal\cas_server\Event;
 
 
+use Symfony\Contracts\EventDispatcher\Event;
 use Drupal\cas_server\Ticket\ServiceTicket;
 use Drupal\user\UserInterface;
-use Symfony\Component\EventDispatcher\Event;
 
 class CASAttributesAlterEvent extends Event {
 
diff --git a/src/Event/CasServerTicketAlterEvent.php b/src/Event/CasServerTicketAlterEvent.php
index 324f5af..18a185e 100644
--- a/src/Event/CasServerTicketAlterEvent.php
+++ b/src/Event/CasServerTicketAlterEvent.php
@@ -3,9 +3,9 @@
 namespace Drupal\cas_server\Event;
 
 
+use Symfony\Contracts\EventDispatcher\Event;
 use Drupal\cas_server\Ticket\Ticket;
 use Drupal\user\UserInterface;
-use Symfony\Component\EventDispatcher\Event;
 
 class CasServerTicketAlterEvent extends Event {
 
diff --git a/src/Tests/ProxyControllerTest.php b/src/Tests/ProxyControllerTest.php
index 5c3b0fe..992fdd9 100644
--- a/src/Tests/ProxyControllerTest.php
+++ b/src/Tests/ProxyControllerTest.php
@@ -16,7 +16,7 @@ class ProxyControllerTest extends BrowserTestBase {
 
   public static $modules = ['cas_server'];
 
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->exampleUser = $this->drupalCreateUser([], 'exampleUserName');
@@ -55,9 +55,9 @@ class ProxyControllerTest extends BrowserTestBase {
     $service = 'https://foo.example.com';
 
     $this->drupalGet('cas/proxy', ['query' => ['pgt' => $pgt->getId(), 'targetService' => $service]]);
-    $this->assertRaw("<cas:proxySuccess>");
-    $this->assertRaw("<cas:proxyTicket>");
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains("<cas:proxySuccess>");
+    $this->assertSession()->responseContains("<cas:proxyTicket>");
+    $this->assertSession()->statusCodeEquals(200);
   }
 
   /**
@@ -66,8 +66,8 @@ class ProxyControllerTest extends BrowserTestBase {
   function testInvalidProxyRequest() {
 
     $this->drupalGet('cas/proxy');
-    $this->assertRaw("<cas:proxyFailure code='INVALID_REQUEST'>");
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains("<cas:proxyFailure code='INVALID_REQUEST'>");
+    $this->assertSession()->statusCodeEquals(200);
 
   }
 
@@ -81,8 +81,8 @@ class ProxyControllerTest extends BrowserTestBase {
     $service = 'https://bar.example.com';
 
     $this->drupalGet('cas/proxy', ['query' => ['pgt' => $pgt->getId(), 'targetService' => $service]]);
-    $this->assertRaw("<cas:proxyFailure code='UNAUTHORIZED_SERVICE'>");
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains("<cas:proxyFailure code='UNAUTHORIZED_SERVICE'>");
+    $this->assertSession()->statusCodeEquals(200);
   }
 
   /**
@@ -96,8 +96,8 @@ class ProxyControllerTest extends BrowserTestBase {
     $service = 'https://foo.example.com';
 
     $this->drupalGet('cas/proxy', ['query' => ['pgt' => $pgt->getId(), 'targetService' => $service]]);
-    $this->assertRaw("<cas:proxyFailure code='INVALID_TICKET'>");
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains("<cas:proxyFailure code='INVALID_TICKET'>");
+    $this->assertSession()->statusCodeEquals(200);
 
   }
 
@@ -112,9 +112,9 @@ class ProxyControllerTest extends BrowserTestBase {
     $service = 'https://foo.example.com';
 
     $this->drupalGet('cas/proxy', ['query' => ['pgt' => $pgt->getId(), 'targetService' => $service]]);
-    $this->assertRaw("<cas:proxyFailure code='INVALID_REQUEST'>");
-    $this->assertText("Ticket not found");
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains("<cas:proxyFailure code='INVALID_REQUEST'>");
+    $this->assertSession()->pageTextContains("Ticket not found");
+    $this->assertSession()->statusCodeEquals(200);
     
   }
 
@@ -128,9 +128,9 @@ class ProxyControllerTest extends BrowserTestBase {
     $service = 'https://foo.example.com';
 
     $this->drupalGet('cas/proxy', ['query' => ['pgt' => $pgt->getId(), 'targetService' => $service]]);
-    $this->assertRaw("<cas:proxyFailure code='INVALID_REQUEST'>");
-    $this->assertNoText("Ticket not found");
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains("<cas:proxyFailure code='INVALID_REQUEST'>");
+    $this->assertSession()->pageTextNotContains("Ticket not found");
+    $this->assertSession()->statusCodeEquals(200);
     
   }
 }
diff --git a/src/Tests/TicketValidationTest.php b/src/Tests/TicketValidationTest.php
index d15d1ec..1a7648a 100644
--- a/src/Tests/TicketValidationTest.php
+++ b/src/Tests/TicketValidationTest.php
@@ -15,7 +15,7 @@ class TicketValidationTest extends BrowserTestBase {
 
   public static $modules = ['cas_server'];
 
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->exampleUser = $this->drupalCreateUser([], 'exampleUserName');
@@ -39,14 +39,14 @@ class TicketValidationTest extends BrowserTestBase {
     // Protocol version 2
     $st = $this->ticketFactory->createServiceTicket($service, FALSE);
     $this->drupalGet('cas/serviceValidate', ['query' => ['pgtUrl' => $mangled_pgt_callback, 'service' => $service, 'ticket' => $st->getId()]]);   
-    $this->assertRaw('<cas:authenticationFailure code="INVALID_PROXY_CALLBACK">');
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains('<cas:authenticationFailure code="INVALID_PROXY_CALLBACK">');
+    $this->assertSession()->statusCodeEquals(200);
 
     // Protocol version 3
     $st = $this->ticketFactory->createServiceTicket($service, FALSE);
     $this->drupalGet('cas/p3/serviceValidate', ['query' => ['pgtUrl' => $mangled_pgt_callback, 'service' => $service, 'ticket' => $st->getId()]]);      
-    $this->assertRaw('<cas:authenticationFailure code="INVALID_PROXY_CALLBACK">');
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains('<cas:authenticationFailure code="INVALID_PROXY_CALLBACK">');
+    $this->assertSession()->statusCodeEquals(200);
 }
 
   /**
@@ -61,23 +61,23 @@ class TicketValidationTest extends BrowserTestBase {
     // Protocol version 1
     $st = $this->ticketFactory->createServiceTicket($service, FALSE);
     $this->drupalGet('cas/validate', ['query' => ['renew' => 'true', 'service' => $service, 'ticket' => $st->getId()]]);
-    $this->assertText('no');
-    $this->assertNoRaw('html');
-    $this->assertResponse(200);
+    $this->assertSession()->pageTextContains('no');
+    $this->assertSession()->responseNotContains('html');
+    $this->assertSession()->statusCodeEquals(200);
     
     // Protocol version 2
     $st = $this->ticketFactory->createServiceTicket($service, FALSE);
     $this->drupalGet('cas/serviceValidate', ['query' => ['renew' => 'true', 'service' => $service, 'ticket' => $st->getId()]]);   
-    $this->assertRaw('<cas:authenticationFailure code="INVALID_TICKET">');
-    $this->assertText('renew');
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains('<cas:authenticationFailure code="INVALID_TICKET">');
+    $this->assertSession()->pageTextContains('renew');
+    $this->assertSession()->statusCodeEquals(200);
 
     // Protocol version 3
     $st = $this->ticketFactory->createServiceTicket($service, FALSE);
     $this->drupalGet('cas/p3/serviceValidate', ['query' => ['renew' => 'true', 'service' => $service, 'ticket' => $st->getId()]]);      
-    $this->assertRaw('<cas:authenticationFailure code="INVALID_TICKET">');
-    $this->assertText('renew');
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains('<cas:authenticationFailure code="INVALID_TICKET">');
+    $this->assertSession()->pageTextContains('renew');
+    $this->assertSession()->statusCodeEquals(200);
 }
 
 
@@ -93,21 +93,21 @@ class TicketValidationTest extends BrowserTestBase {
     // Protocol version 1
     $st = $this->ticketFactory->createServiceTicket($service, FALSE);
     $this->drupalGet('cas/validate', ['query' => ['service' => $service . 'adfasd', 'ticket' => $st->getId()]]);
-    $this->assertText('no');
-    $this->assertNoRaw('html');
-    $this->assertResponse(200);
+    $this->assertSession()->pageTextContains('no');
+    $this->assertSession()->responseNotContains('html');
+    $this->assertSession()->statusCodeEquals(200);
     
     // Protocol version 2
     $st = $this->ticketFactory->createServiceTicket($service, FALSE);
     $this->drupalGet('cas/serviceValidate', ['query' => ['service' => $service . 'adasdf', 'ticket' => $st->getId()]]);   
-    $this->assertRaw('<cas:authenticationFailure code="INVALID_SERVICE">');
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains('<cas:authenticationFailure code="INVALID_SERVICE">');
+    $this->assertSession()->statusCodeEquals(200);
 
     // Protocol version 3
     $st = $this->ticketFactory->createServiceTicket($service, FALSE);
     $this->drupalGet('cas/p3/serviceValidate', ['query' => ['service' => $service . 'adfasdf', 'ticket' => $st->getId()]]);      
-    $this->assertRaw('<cas:authenticationFailure code="INVALID_SERVICE">');
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains('<cas:authenticationFailure code="INVALID_SERVICE">');
+    $this->assertSession()->statusCodeEquals(200);
 }
 
   /**
@@ -122,23 +122,23 @@ class TicketValidationTest extends BrowserTestBase {
     // Protocol version 1
     $st = $this->ticketFactory->createServiceTicket($service, FALSE);
     $this->drupalGet('cas/validate', ['query' => ['service' => $service, 'ticket' => $st->getId()]]);
-    $this->assertText('no');
-    $this->assertNoRaw('html');
-    $this->assertResponse(200);
+    $this->assertSession()->pageTextContains('no');
+    $this->assertSession()->responseNotContains('html');
+    $this->assertSession()->statusCodeEquals(200);
     
     // Protocol version 2
     $st = $this->ticketFactory->createServiceTicket($service, FALSE);
     $this->drupalGet('cas/serviceValidate', ['query' => ['service' => $service, 'ticket' => $st->getId()]]);   
-    $this->assertRaw('<cas:authenticationFailure code="INVALID_TICKET">');
-    $this->assertText('expired');
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains('<cas:authenticationFailure code="INVALID_TICKET">');
+    $this->assertSession()->pageTextContains('expired');
+    $this->assertSession()->statusCodeEquals(200);
 
     // Protocol version 3
     $st = $this->ticketFactory->createServiceTicket($service, FALSE);
     $this->drupalGet('cas/p3/serviceValidate', ['query' => ['service' => $service, 'ticket' => $st->getId()]]);      
-    $this->assertRaw('<cas:authenticationFailure code="INVALID_TICKET">');
-    $this->assertText('expired');
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains('<cas:authenticationFailure code="INVALID_TICKET">');
+    $this->assertSession()->pageTextContains('expired');
+    $this->assertSession()->statusCodeEquals(200);
 }
 
   /**
@@ -154,23 +154,23 @@ class TicketValidationTest extends BrowserTestBase {
     $st = $this->ticketFactory->createServiceTicket($service, FALSE);
     $this->ticketStore->deleteServiceTicket($st);
     $this->drupalGet('cas/validate', ['query' => ['service' => $service, 'ticket' => $st->getId()]]);
-    $this->assertText('no');
-    $this->assertNoRaw('html');
-    $this->assertResponse(200);
+    $this->assertSession()->pageTextContains('no');
+    $this->assertSession()->responseNotContains('html');
+    $this->assertSession()->statusCodeEquals(200);
     
     // Protocol version 2
     $st = $this->ticketFactory->createServiceTicket($service, FALSE);
     $this->ticketStore->deleteServiceTicket($st);
     $this->drupalGet('cas/serviceValidate', ['query' => ['service' => $service, 'ticket' => $st->getId()]]);   
-    $this->assertRaw('<cas:authenticationFailure code="INVALID_TICKET">');
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains('<cas:authenticationFailure code="INVALID_TICKET">');
+    $this->assertSession()->statusCodeEquals(200);
 
     // Protocol version 3
     $st = $this->ticketFactory->createServiceTicket($service, FALSE);
     $this->ticketStore->deleteServiceTicket($st);
     $this->drupalGet('cas/p3/serviceValidate', ['query' => ['service' => $service, 'ticket' => $st->getId()]]);      
-    $this->assertRaw('<cas:authenticationFailure code="INVALID_TICKET">');
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains('<cas:authenticationFailure code="INVALID_TICKET">');
+    $this->assertSession()->statusCodeEquals(200);
 }
 
   /**
@@ -185,16 +185,16 @@ class TicketValidationTest extends BrowserTestBase {
     // Protocol version 2
     $st = $this->ticketFactory->createProxyTicket($service, FALSE, [], 'foo', $this->exampleUser->id(), $this->ticketFactory->getUsernameAttribute($this->exampleUser));
     $this->drupalGet('cas/proxyValidate', ['query' => ['service' => $service, 'ticket' => $st->getId()]]);   
-    $this->assertRaw('<cas:authenticationSuccess>');
-    $this->assertRaw('<cas:user>' . $this->ticketFactory->getUsernameAttribute($this->exampleUser) . '</cas:user>');
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains('<cas:authenticationSuccess>');
+    $this->assertSession()->responseContains('<cas:user>' . $this->ticketFactory->getUsernameAttribute($this->exampleUser) . '</cas:user>');
+    $this->assertSession()->statusCodeEquals(200);
 
     // Protocol version 3
     $st = $this->ticketFactory->createProxyTicket($service, FALSE, [], 'foo', $this->exampleUser->id(), $this->ticketFactory->getUsernameAttribute($this->exampleUser));
     $this->drupalGet('cas/p3/proxyValidate', ['query' => ['service' => $service, 'ticket' => $st->getId()]]);      
-    $this->assertRaw('<cas:authenticationSuccess');
-    $this->assertRaw('<cas:user>' . $this->ticketFactory->getUsernameAttribute($this->exampleUser) . '</cas:user>');
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains('<cas:authenticationSuccess');
+    $this->assertSession()->responseContains('<cas:user>' . $this->ticketFactory->getUsernameAttribute($this->exampleUser) . '</cas:user>');
+    $this->assertSession()->statusCodeEquals(200);
 
   }
 
@@ -210,14 +210,14 @@ class TicketValidationTest extends BrowserTestBase {
     // Protocol version 2
     $st = $this->ticketFactory->createProxyTicket($service, FALSE, [], 'foo', $this->exampleUser->id(), $this->ticketFactory->getUsernameAttribute($this->exampleUser));
     $this->drupalGet('cas/serviceValidate', ['query' => ['service' => $service, 'ticket' => $st->getId()]]);   
-    $this->assertRaw('<cas:authenticationFailure code="INVALID_TICKET_SPEC">');
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains('<cas:authenticationFailure code="INVALID_TICKET_SPEC">');
+    $this->assertSession()->statusCodeEquals(200);
 
     // Protocol version 3
     $st = $this->ticketFactory->createProxyTicket($service, FALSE, [], 'foo', $this->exampleUser->id(), $this->ticketFactory->getUsernameAttribute($this->exampleUser));
     $this->drupalGet('cas/p3/serviceValidate', ['query' => ['service' => $service, 'ticket' => $st->getId()]]);      
-    $this->assertRaw('<cas:authenticationFailure code="INVALID_TICKET_SPEC">');
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains('<cas:authenticationFailure code="INVALID_TICKET_SPEC">');
+    $this->assertSession()->statusCodeEquals(200);
 }
 
   /**
@@ -232,24 +232,24 @@ class TicketValidationTest extends BrowserTestBase {
     // Protocol version 1
     $st = $this->ticketFactory->createServiceTicket($service, FALSE);
     $this->drupalGet('cas/validate', ['query' => ['service' => $service, 'ticket' => $st->getId()]]);
-    $this->assertText('yes');
-    $this->assertText($this->ticketFactory->getUsernameAttribute($this->exampleUser));
-    $this->assertNoRaw('html');
-    $this->assertResponse(200);
+    $this->assertSession()->pageTextContains('yes');
+    $this->assertSession()->pageTextContains($this->ticketFactory->getUsernameAttribute($this->exampleUser));
+    $this->assertSession()->responseNotContains('html');
+    $this->assertSession()->statusCodeEquals(200);
 
     // Protocol version 2
     $st = $this->ticketFactory->createServiceTicket($service, FALSE);
     $this->drupalGet('cas/serviceValidate', ['query' => ['service' => $service, 'ticket' => $st->getId()]]);   
-    $this->assertRaw('<cas:authenticationSuccess>');
-    $this->assertRaw('<cas:user>' . $this->ticketFactory->getUsernameAttribute($this->exampleUser) . '</cas:user>');
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains('<cas:authenticationSuccess>');
+    $this->assertSession()->responseContains('<cas:user>' . $this->ticketFactory->getUsernameAttribute($this->exampleUser) . '</cas:user>');
+    $this->assertSession()->statusCodeEquals(200);
 
     // Protocol version 3
     $st = $this->ticketFactory->createServiceTicket($service, FALSE);
     $this->drupalGet('cas/p3/serviceValidate', ['query' => ['service' => $service, 'ticket' => $st->getId()]]);      
-    $this->assertRaw('<cas:authenticationSuccess>');
-    $this->assertRaw('<cas:user>' . $this->ticketFactory->getUsernameAttribute($this->exampleUser) . '</cas:user>');
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains('<cas:authenticationSuccess>');
+    $this->assertSession()->responseContains('<cas:user>' . $this->ticketFactory->getUsernameAttribute($this->exampleUser) . '</cas:user>');
+    $this->assertSession()->statusCodeEquals(200);
   }
 
   /**
@@ -258,19 +258,19 @@ class TicketValidationTest extends BrowserTestBase {
   function testMissingParameters() {
     // Protocol version 1
     $this->drupalGet('cas/validate');
-    $this->assertText('no');
-    $this->assertNoRaw('html');
-    $this->assertResponse(200);
+    $this->assertSession()->pageTextContains('no');
+    $this->assertSession()->responseNotContains('html');
+    $this->assertSession()->statusCodeEquals(200);
 
     // Protocol version 2
     $this->drupalGet('cas/serviceValidate');
-    $this->assertRaw('<cas:authenticationFailure code="INVALID_REQUEST">');
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains('<cas:authenticationFailure code="INVALID_REQUEST">');
+    $this->assertSession()->statusCodeEquals(200);
     
     // Protocol version 3
     $this->drupalGet('cas/p3/serviceValidate');
-    $this->assertRaw('<cas:authenticationFailure code="INVALID_REQUEST">');
-    $this->assertResponse(200);
+    $this->assertSession()->responseContains('<cas:authenticationFailure code="INVALID_REQUEST">');
+    $this->assertSession()->statusCodeEquals(200);
 
   }
 
diff --git a/src/Tests/UserActionControllerTest.php b/src/Tests/UserActionControllerTest.php
index f4e919f..245dd2f 100644
--- a/src/Tests/UserActionControllerTest.php
+++ b/src/Tests/UserActionControllerTest.php
@@ -18,7 +18,7 @@ class UserActionControllerTest extends BrowserTestBase {
 
   public static $modules = ['cas_server'];
 
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->exampleUser = $this->drupalCreateUser([], 'exampleUserName');
@@ -52,8 +52,8 @@ class UserActionControllerTest extends BrowserTestBase {
 
     $this->drupalGet('cas/logout');
     $this->assertFalse($this->drupalUserIsLoggedIn($this->exampleUser));
-    $this->assertText('You have been logged out');
-    $this->assertEqual($this->cookies['cas_tgc']['value'], 'deleted');
+    $this->assertSession()->pageTextContains('You have been logged out');
+    $this->assertEquals($this->cookies['cas_tgc']['value'], 'deleted');
 
     $tickets = $this->connection->select('cas_server_ticket_store', 'c')
       ->fields('c', array('id'))
@@ -82,8 +82,8 @@ class UserActionControllerTest extends BrowserTestBase {
     $service = Url::fromRoute('cas_server.validate1');
     $service->setAbsolute();
     $this->drupalGet('cas/login', ['query' => ['service' => $service->toString(), 'ticket' => 'foo']]);
-    $this->assertUrl('cas/validate', ['query' => ['ticket' => 'foo']]); 
-    $this->assertEqual($this->redirectCount, 1);
+    $this->assertSession()->addressEquals('cas/validate', ['query' => ['ticket' => 'foo']]); 
+    $this->assertEquals($this->redirectCount, 1);
   }
 
   /**
@@ -91,8 +91,8 @@ class UserActionControllerTest extends BrowserTestBase {
    */
   public function testInvalidServiceMessage() {
     $this->drupalGet('cas/login', ['query' => ['service' => 'https://bar.example.com']]);
-    $this->assertText('You have not requested a valid service');
-    $this->assertResponse(200);
+    $this->assertSession()->pageTextContains('You have not requested a valid service');
+    $this->assertSession()->statusCodeEquals(200);
   }
 
   /**
@@ -101,8 +101,8 @@ class UserActionControllerTest extends BrowserTestBase {
   public function testAlreadyLoggedIn() {
     $this->drupalLogin($this->exampleUser);
     $this->drupalGet('cas/login');
-    $this->assertResponse(200);
-    $this->assertText('You are logged in to CAS single sign on');
+    $this->assertSession()->statusCodeEquals(200);
+    $this->assertSession()->pageTextContains('You are logged in to CAS single sign on');
   }
 
   /**
@@ -110,10 +110,10 @@ class UserActionControllerTest extends BrowserTestBase {
    */
   public function testNoServiceNoSession() {
     $this->drupalGet('cas/login');
-    $this->assertResponse(200);
-    $this->assertFieldByName('username');
-    $this->assertFieldByName('password');
-    $this->assertFieldByName('lt');
+    $this->assertSession()->statusCodeEquals(200);
+    $this->assertSession()->fieldExists('username');
+    $this->assertSession()->fieldExists('password');
+    $this->assertSession()->fieldExists('lt');
   }
 
   /**
@@ -121,11 +121,11 @@ class UserActionControllerTest extends BrowserTestBase {
    */
   public function testServiceNoSession() {
     $this->drupalGet('cas/login', ['query' => ['service' => 'https://foo.example.com']]);
-    $this->assertResponse(200);
-    $this->assertFieldByName('username');
-    $this->assertFieldByName('password');
-    $this->assertFieldByName('lt');
-    $this->assertFieldByName('service', 'https://foo.example.com');
+    $this->assertSession()->statusCodeEquals(200);
+    $this->assertSession()->fieldExists('username');
+    $this->assertSession()->fieldExists('password');
+    $this->assertSession()->fieldExists('lt');
+    $this->assertSession()->fieldValueEquals('service', 'https://foo.example.com');
   }
 
   /**
@@ -143,8 +143,8 @@ class UserActionControllerTest extends BrowserTestBase {
     $service = Url::fromRoute('cas_server.validate1');
     $service->setAbsolute();
     $this->drupalGet('cas/login', ['query' => ['service' => $service->toString(), 'gateway' => 'true']]);
-    $this->assertUrl('cas/validate', []); 
-    $this->assertEqual($this->redirectCount, 1);
+    $this->assertSession()->addressEquals('cas/validate', []); 
+    $this->assertEquals($this->redirectCount, 1);
   }
 
   /**
@@ -164,7 +164,7 @@ class UserActionControllerTest extends BrowserTestBase {
     $service = Url::fromRoute('cas_server.validate1');
     $service->setAbsolute();
     $this->drupalGet('cas/login', ['query' => ['service' => $service->toString()]]);
-    $this->assertEqual($this->redirectCount, 1);
+    $this->assertEquals($this->redirectCount, 1);
     
     $ticket = $this->connection->select('cas_server_ticket_store', 'c')
       ->fields('c', array('id'))
@@ -174,7 +174,7 @@ class UserActionControllerTest extends BrowserTestBase {
       ->fetch();
     $tid = $ticket->id;
 
-    $this->assertUrl('cas/validate', ['query' => ['ticket' => $tid]]);
+    $this->assertSession()->addressEquals('cas/validate', ['query' => ['ticket' => $tid]]);
   }
 
 
diff --git a/src/Tests/UserLoginFormTest.php b/src/Tests/UserLoginFormTest.php
index f658fcf..8517b5e 100644
--- a/src/Tests/UserLoginFormTest.php
+++ b/src/Tests/UserLoginFormTest.php
@@ -18,7 +18,7 @@ class UserLoginFormTest extends BrowserTestBase {
 
   public static $modules = ['cas_server'];
 
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->exampleUser = $this->drupalCreateUser([], 'exampleUserName');
@@ -49,11 +49,11 @@ class UserLoginFormTest extends BrowserTestBase {
       'username' => $this->exampleUser->getAccountName(),
       'password' => $this->exampleUser->pass_raw + 'foadasd',
     ];
-    $this->drupalPostForm(NULL, $edit, t('Submit'));
+    $this->submitForm($edit, t('Submit'));
 
     $this->assertTrue(empty($this->cookies['cas_tgc']));
-    $this->assertResponse(200);
-    $this->assertText('Bad username/password combination given.');
+    $this->assertSession()->statusCodeEquals(200);
+    $this->assertSession()->pageTextContains('Bad username/password combination given.');
 
   }
 
@@ -66,11 +66,11 @@ class UserLoginFormTest extends BrowserTestBase {
       'username' => $this->exampleUser->getAccountName(),
       'password' => $this->exampleUser->pass_raw,
     ];
-    $this->drupalPostForm(NULL, $edit, t('Submit'));
+    $this->submitForm($edit, t('Submit'));
 
     $this->assertTrue(!empty($this->cookies['cas_tgc']));
-    $this->assertResponse(200);
-    $this->assertText('You are logged in to CAS single sign on.');
+    $this->assertSession()->statusCodeEquals(200);
+    $this->assertSession()->pageTextContains('You are logged in to CAS single sign on.');
 
   }
 
@@ -86,11 +86,11 @@ class UserLoginFormTest extends BrowserTestBase {
       'username' => $this->exampleUser->getAccountName(),
       'password' => $this->exampleUser->pass_raw,
     ];
-    $this->drupalPostForm(NULL, $edit, t('Submit'));
+    $this->submitForm($edit, t('Submit'));
 
-    $this->assertResponse(200);
+    $this->assertSession()->statusCodeEquals(200);
     $this->assertTrue(empty($this->cookies['cas_tgc']));
-    $this->assertText('Login ticket invalid. Please try again');
+    $this->assertSession()->pageTextContains('Login ticket invalid. Please try again');
     
   }
 
@@ -106,11 +106,11 @@ class UserLoginFormTest extends BrowserTestBase {
       'username' => $this->exampleUser->getAccountName(),
       'password' => $this->exampleUser->pass_raw,
     ];
-    $this->drupalPostForm(NULL, $edit, t('Submit'));
+    $this->submitForm($edit, t('Submit'));
 
     $this->assertTrue(!empty($this->cookies['cas_tgc']));
-    $this->assertResponse(200);
-    $this->assertEqual($this->redirectCount, 2);
+    $this->assertSession()->statusCodeEquals(200);
+    $this->assertEquals($this->redirectCount, 2);
 
     $ticket = $this->connection->select('cas_server_ticket_store', 'c')
       ->fields('c', array('id'))
@@ -120,7 +120,7 @@ class UserLoginFormTest extends BrowserTestBase {
       ->fetch();
     $tid = $ticket->id;
 
-    $this->assertUrl('cas/validate', ['query' => ['ticket' => $tid]]);
+    $this->assertSession()->addressEquals('cas/validate', ['query' => ['ticket' => $tid]]);
 
   }
 
@@ -139,11 +139,11 @@ class UserLoginFormTest extends BrowserTestBase {
       'username' => $this->exampleUser->getAccountName(),
       'password' => $this->exampleUser->pass_raw,
     ];
-    $this->drupalPostForm(NULL, $edit, t('Submit'));
+    $this->submitForm($edit, t('Submit'));
 
     $this->assertTrue(empty($this->cookies['cas_tgc']));
-    $this->assertResponse(200);
-    $this->assertEqual($this->redirectCount, 2);
+    $this->assertSession()->statusCodeEquals(200);
+    $this->assertEquals($this->redirectCount, 2);
 
     $ticket = $this->connection->select('cas_server_ticket_store', 'c')
       ->fields('c', array('id'))
@@ -153,7 +153,7 @@ class UserLoginFormTest extends BrowserTestBase {
       ->fetch();
     $tid = $ticket->id;
 
-    $this->assertUrl('cas/validate', ['query' => ['ticket' => $tid]]);
+    $this->assertSession()->addressEquals('cas/validate', ['query' => ['ticket' => $tid]]);
 
   }
 }
diff --git a/src/Ticket/TicketFactory.php b/src/Ticket/TicketFactory.php
index f96dccb..b326070 100644
--- a/src/Ticket/TicketFactory.php
+++ b/src/Ticket/TicketFactory.php
@@ -87,7 +87,7 @@ class TicketFactory {
 
     $pgt = new ProxyGrantingTicket($id, $expiration_time, $session, $uid, $name, $proxy_chain);
     $event = new CasServerTicketAlterEvent($pgt);
-    $this->eventDispatcher->dispatch(CasServerTicketAlterEvent::CAS_SERVER_TICKET_ALTER_EVENT, $event);
+    $this->eventDispatcher->dispatch($event, CasServerTicketAlterEvent::CAS_SERVER_TICKET_ALTER_EVENT);
     $this->ticketStore->storeProxyGrantingTicket($pgt);
 
     return $pgt;
@@ -115,7 +115,7 @@ class TicketFactory {
 
     $st = new ServiceTicket($id, $expiration_time, $session, $uid, $name, $service_string, $renew);
     $event = new CasServerTicketAlterEvent($st);
-    $this->eventDispatcher->dispatch(CasServerTicketAlterEvent::CAS_SERVER_TICKET_ALTER_EVENT, $event);
+    $this->eventDispatcher->dispatch($event, CasServerTicketAlterEvent::CAS_SERVER_TICKET_ALTER_EVENT);
     $this->ticketStore->storeServiceTicket($st);
 
     return $st;
@@ -147,7 +147,7 @@ class TicketFactory {
 
     $pt = new ProxyTicket($id, $expiration_time, $session, $uid, $name, $service_string, $renew, $proxy_chain);
     $event = new CasServerTicketAlterEvent($pt);
-    $this->eventDispatcher->dispatch(CasServerTicketAlterEvent::CAS_SERVER_TICKET_ALTER_EVENT, $event);
+    $this->eventDispatcher->dispatch($event, CasServerTicketAlterEvent::CAS_SERVER_TICKET_ALTER_EVENT);
     $this->ticketStore->storeProxyTicket($pt);
 
     return $pt;
@@ -169,7 +169,7 @@ class TicketFactory {
 
     $tgt = new TicketGrantingTicket($id, $expiration_time, $session, $uid, $name);
     $event = new CasServerTicketAlterEvent($tgt);
-    $this->eventDispatcher->dispatch(CasServerTicketAlterEvent::CAS_SERVER_TICKET_ALTER_EVENT, $event);
+    $this->eventDispatcher->dispatch($event, CasServerTicketAlterEvent::CAS_SERVER_TICKET_ALTER_EVENT);
     $this->ticketStore->storeTicketGrantingTicket($tgt);
 
     return $tgt;
diff --git a/tests/src/Kernel/ConfigHelperTest.php b/tests/src/Kernel/ConfigHelperTest.php
index 345a1fb..6427fe2 100644
--- a/tests/src/Kernel/ConfigHelperTest.php
+++ b/tests/src/Kernel/ConfigHelperTest.php
@@ -14,7 +14,7 @@ class ConfigHelperTest extends EntityKernelTestBase {
 
   public static $modules = ['cas_server'];
 
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->installConfig(['cas_server']);
diff --git a/tests/src/Unit/Controller/TicketValidationControllerTest.php b/tests/src/Unit/Controller/TicketValidationControllerTest.php
index df9e997..d7aa95d 100644
--- a/tests/src/Unit/Controller/TicketValidationControllerTest.php
+++ b/tests/src/Unit/Controller/TicketValidationControllerTest.php
@@ -27,20 +27,14 @@ class TicketValidationControllerTest extends UnitTestCase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
-    $this->ticketFactory = $this->getMockBuilder('Drupal\cas_server\Ticket\TicketFactory')
-      ->disableOriginalConstructor()
-      ->getMock();
+    $this->ticketFactory = $this->createMock('Drupal\cas_server\Ticket\TicketFactory');
 
-    $this->pgt = $this->getMockBuilder('Drupal\cas_server\Ticket\ProxyGrantingTicket')
-      ->disableOriginalConstructor()
-      ->getMock();
+    $this->pgt = $this->createMock('Drupal\cas_server\Ticket\ProxyGrantingTicket');
 
-    $this->ticketStore = $this->getMockBuilder('Drupal\cas_server\Ticket\TicketStorageInterface')
-      ->disableOriginalConstructor()
-      ->getMock();
+    $this->ticketStore = $this->createMock('Drupal\cas_server\Ticket\TicketStorageInterface');
 
   }
 
@@ -83,12 +77,8 @@ class TicketValidationControllerTest extends UnitTestCase {
   public function proxyCallbackSuccessDataProvider() {
 
     $urls = ['https://example.com', 'https://example.com/bar?q=foo'];
-    $st = $this->getMockBuilder('Drupal\cas_server\Ticket\ServiceTicket')
-               ->disableOriginalConstructor()
-               ->getMock();
-    $pt = $this->getMockBuilder('Drupal\cas_server\Ticket\ProxyTicket')
-               ->disableOriginalConstructor()
-               ->getMock();
+    $st = $this->createMock('Drupal\cas_server\Ticket\ServiceTicket');
+    $pt = $this->createMock('Drupal\cas_server\Ticket\ProxyTicket');
 
     return [
       [$urls[0], $st],
@@ -115,9 +105,7 @@ class TicketValidationControllerTest extends UnitTestCase {
       ->method('getId')
       ->will($this->returnValue('thisisapgtid'));
 
-    $st = $this->getMockBuilder('Drupal\cas_server\Ticket\ServiceTicket')
-               ->disableOriginalConstructor()
-               ->getMock();
+    $st = $this->createMock('Drupal\cas_server\Ticket\ServiceTicket');
 
     $controller = new TestTicketValidationController($client, $this->ticketFactory, $this->ticketStore);
     $this->assertFalse($controller->callProxyCallback($url, $st));
