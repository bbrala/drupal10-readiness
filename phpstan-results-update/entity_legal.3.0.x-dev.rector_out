modules/contrib/entity_legal/src/Annotation/EntityLegal.php
modules/contrib/entity_legal/entity_legal.api.php
modules/contrib/entity_legal/src/Form/EntityLegalDocumentVersionForm.php
modules/contrib/entity_legal/tests/src/Functional/EntityLegalMethodsTest.php
modules/contrib/entity_legal/entity_legal.install
modules/contrib/entity_legal/src/Controller/EntityLegalController.php
modules/contrib/entity_legal/src/Entity/EntityLegalDocument.php
modules/contrib/entity_legal/src/Plugin/EntityLegal/Message.php
modules/contrib/entity_legal/tests/src/Functional/EntityLegalTestBase.php
modules/contrib/entity_legal/entity_legal.module
modules/contrib/entity_legal/src/Plugin/EntityLegal/Popup.php
modules/contrib/entity_legal/tests/src/Functional/PostUpdateTest.php
modules/contrib/entity_legal/src/Plugin/EntityLegal/ProfileForm.php
modules/contrib/entity_legal/entity_legal.post_update.php
modules/contrib/entity_legal/entity_legal.tokens.inc
modules/contrib/entity_legal/src/Plugin/EntityLegal/ProfileFormEmbedded.php
modules/contrib/entity_legal/tests/src/Functional/RedirectMethodTest.php
modules/contrib/entity_legal/src/Plugin/EntityLegal/Redirect.php
modules/contrib/entity_legal/src/Entity/EntityLegalDocumentAcceptance.php
modules/contrib/entity_legal/src/Plugin/Validation/Constraint/SingleLegalDocumentPublishedVersionConstraint.php
modules/contrib/entity_legal/src/Plugin/Validation/Constraint/SingleLegalDocumentPublishedVersionConstraintValidator.php
modules/contrib/entity_legal/src/Entity/EntityLegalDocumentVersion.php
modules/contrib/entity_legal/src/Plugin/migrate/destination/EntityLegalDocumentVersion.php
modules/contrib/entity_legal/src/Plugin/migrate/source/EntityLegalDocument.php
modules/contrib/entity_legal/src/Plugin/migrate/source/EntityLegalDocumentAcceptance.php
modules/contrib/entity_legal/src/Plugin/migrate/source/EntityLegalDocumentVersion.php
modules/contrib/entity_legal/src/EntityLegalDocumentAcceptanceInterface.php
modules/contrib/entity_legal/src/EntityLegalDocumentAccessControlHandler.php
modules/contrib/entity_legal/tests/src/Functional/UpdateTest.php
modules/contrib/entity_legal/tests/fixtures/update/install_entity_legal.php
modules/contrib/entity_legal/src/EntityLegalDocumentInterface.php
modules/contrib/entity_legal/src/EntityLegalDocumentListBuilder.php
modules/contrib/entity_legal/src/EntityLegalDocumentVersionInterface.php
modules/contrib/entity_legal/src/EntityLegalDocumentVersionViewBuilder.php
modules/contrib/entity_legal/src/EntityLegalPermissions.php
modules/contrib/entity_legal/src/EntityLegalPluginBase.php
modules/contrib/entity_legal/tests/src/FunctionalJavascript/EntityLegalPopupMethodTest.php
modules/contrib/entity_legal/src/EntityLegalPluginInterface.php
modules/contrib/entity_legal/src/EntityLegalPluginManager.php
modules/contrib/entity_legal/src/EventSubscriber/EntityLegalSubscriber.php
modules/contrib/entity_legal/src/Form/EntityLegalDocumentAcceptanceForm.php
modules/contrib/entity_legal/tests/src/Kernel/DocumentDeleteTest.php
modules/contrib/entity_legal/src/Form/EntityLegalDocumentForm.php
modules/contrib/entity_legal/tests/src/Kernel/DocumentTest.php
modules/contrib/entity_legal/tests/src/Kernel/SingleLegalDocumentPublishedVersionConstraintTest.php
modules/contrib/entity_legal/tests/src/Traits/EntityLegalTestTrait.php
modules/contrib/entity_legal/src/Form/EntityLegalDocumentVersionDeleteForm.php
modules/contrib/entity_legal/tests/fixtures/update/legal_documents.php
modules/contrib/entity_legal/tests/fixtures/update/update_8200.php
modules/contrib/entity_legal/tests/modules/entity_legal_test/entity_legal_test.module
modules/contrib/entity_legal/tests/src/Functional/EntityLegalDocumentAcceptanceTest.php
modules/contrib/entity_legal/tests/src/Functional/EntityLegalDocumentTest.php
modules/contrib/entity_legal/tests/src/Functional/EntityLegalDocumentVersionTest.php

5 files with changes
====================

1) modules/contrib/entity_legal/tests/src/Functional/RedirectMethodTest.php:52

    ---------- begin diff ----------
@@ @@
     /** @var \Drupal\user\UserInterface $user */
     $user = \Drupal::entityTypeManager()->getStorage('user')->load($account->id());

-    $this->assertUrl($document_path);
+    $this->assertSession()->addressEquals($document_path);

     $this->drupalGet('');

-    $this->assertUrl($document_path);
+    $this->assertSession()->addressEquals($document_path);

     // Check that users are able to logout even they don't accept the agreement.
     $this->clickLink('Log out');
     // Check that the user has been logged out.
-    $this->assertLink('Log in');
+    $this->assertSession()->linkExists('Log in');

-    $this->drupalPostForm(NULL, [
+    $this->submitForm([
       'name' => $account->getAccountName(),
       'pass' => $account->pass_raw,
     ], 'Log in');

-    $this->assertText('You must accept this agreement before continuing.');
-    $this->assertText('I agree to the document');
+    $this->assertSession()->pageTextContains('You must accept this agreement before continuing.');
+    $this->assertSession()->pageTextContains('I agree to the document');

     // Agree with the terms.
-    $this->drupalPostForm(NULL, ['agree' => TRUE], 'Submit');
+    $this->submitForm(['agree' => TRUE], 'Submit');

     // Refresh the page.
     $this->drupalGet('');

-    $this->assertUrl($user->toUrl()->setAbsolute()->toString());
+    $this->assertSession()->addressEquals($user->toUrl()->setAbsolute()->toString());

     $this->clickLink('Log out');

     // Release a new document version.
     $this->createDocumentVersion($document, TRUE);
+    $this->drupalGet(Url::fromRoute('user.pass'));

-    $this->drupalPostForm(Url::fromRoute('user.pass'), [
+    $this->submitForm([
       'name' => $account->getAccountName(),
     ], 'Submit');
-    $this->assertText('Further instructions have been sent to your email address.');
+    $this->assertSession()->pageTextContains('Further instructions have been sent to your email address.');

     // Click the one-time login link received by mail and login.
     $this->clickMailOneTimeLoginLink();
-    $this->assertText("This is a one-time login for {$account->getAccountName()} and will expire on");
-    $this->drupalPostForm(NULL, [], 'Log in');
+    $this->assertSession()->pageTextContains("This is a one-time login for {$account->getAccountName()} and will expire on");
+    $this->submitForm([], 'Log in');

     // Check that we've landed on the password change user account edit page.
-    $this->assertText('You have just used your one-time login link. It is no longer necessary to use this link to log in. Please change your password.');
-    $this->assertFieldByName('mail');
-    $this->assertText('A valid email address. All emails from the system will be sent to this address. The email address is not made public and will only be used if you wish to receive a new password or wish to receive certain news or notifications by email.');
-    $this->assertFieldByName('pass[pass1]');
-    $this->assertFieldByName('pass[pass2]');
+    $this->assertSession()->pageTextContains('You have just used your one-time login link. It is no longer necessary to use this link to log in. Please change your password.');
+    $this->assertSession()->fieldExists('mail');
+    $this->assertSession()->pageTextContains('A valid email address. All emails from the system will be sent to this address. The email address is not made public and will only be used if you wish to receive a new password or wish to receive certain news or notifications by email.');
+    $this->assertSession()->fieldExists('pass[pass1]');
+    $this->assertSession()->fieldExists('pass[pass2]');

     // Set a new password.
     $new_password = $this->randomString();
     $account->pass_raw = $new_password;
-    $this->drupalPostForm(NULL, [
+    $this->submitForm([
       'pass[pass1]' => $new_password,
       'pass[pass2]' => $new_password,
     ], 'Save');

     // The new password is set but user has to accept the new document version.
-    $this->assertText('The changes have been saved.');
-    $this->assertText('You must accept this agreement before continuing.');
-    $this->assertText('I agree to the document');
+    $this->assertSession()->pageTextContains('The changes have been saved.');
+    $this->assertSession()->pageTextContains('You must accept this agreement before continuing.');
+    $this->assertSession()->pageTextContains('I agree to the document');

     // Agree with the terms.
-    $this->drupalPostForm(NULL, ['agree' => TRUE], 'Submit');
+    $this->submitForm(['agree' => TRUE], 'Submit');

     // Check that we're on the user account edit form page.
-    $this->assertFieldByName('mail');
-    $this->assertFieldByName('pass[pass1]');
-    $this->assertFieldByName('pass[pass2]');
+    $this->assertSession()->fieldExists('mail');
+    $this->assertSession()->fieldExists('pass[pass1]');
+    $this->assertSession()->fieldExists('pass[pass2]');

     // Release a new document version.
     $newest_version = $this->createDocumentVersion($document, TRUE);
@@ @@
       ],
     ]);
     // Check that the approval gate cannot be bypassed.
-    $this->assertText('You must accept this agreement before continuing.');
-    $this->assertText('I agree to the document');
+    $this->assertSession()->pageTextContains('You must accept this agreement before continuing.');
+    $this->assertSession()->pageTextContains('I agree to the document');

     $this->clickLink('Log out');
    ----------- end diff -----------

Applied rules:
 * AssertFieldByNameRector
 * AssertLinkRector
 * AssertTextRector
 * AssertUrlRector
 * UiHelperTraitDrupalPostFormRector
 * ArgumentRemoverRector
 * WrapReturnRector
 * ChangeMethodVisibilityRector


2) modules/contrib/entity_legal/src/Form/EntityLegalDocumentForm.php:178

    ---------- begin diff ----------
@@ @@
           'title' => Link::createFromRoute($version->label(), $route_name, $route_parameters),
           'created' => $version->getFormattedDate('created'),
           'changed' => $version->getFormattedDate('changed'),
-          'operations' => render($operations),
+          'operations' => \Drupal::service('renderer')->render($operations),
         ];
       }
    ----------- end diff -----------

Applied rules:
 * RenderRector
 * ArgumentRemoverRector
 * WrapReturnRector
 * ChangeMethodVisibilityRector


3) modules/contrib/entity_legal/src/EventSubscriber/EntityLegalSubscriber.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\entity_legal\EventSubscriber;

+use Symfony\Component\HttpKernel\Event\RequestEvent;
 use Symfony\Component\EventDispatcher\EventSubscriberInterface;
-use Symfony\Component\HttpKernel\Event\GetResponseEvent;
 use Symfony\Component\HttpKernel\KernelEvents;

 /**
@@ @@
   /**
    * Request event callback.
    *
-   * @param \Symfony\Component\HttpKernel\Event\GetResponseEvent $event
+   * @param \Symfony\Component\HttpKernel\Event\RequestEvent $event
    *   The request event.
    */
-  public function checkRedirect(GetResponseEvent $event) {
+  public function checkRedirect(RequestEvent $event) {
     $context = ['event' => $event];

     // Execute Redirect method plugin.
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * RenameClassRector
 * WrapReturnRector


4) modules/contrib/entity_legal/src/Plugin/EntityLegal/Redirect.php:93

    ---------- begin diff ----------
@@ @@
   public function execute(array &$context = []) {
     /** @var \Drupal\entity_legal\EntityLegalDocumentInterface $document */
     foreach ($this->documents as $document) {
-      /** @var \Symfony\Component\HttpKernel\Event\GetResponseEvent $event */
+      /** @var \Symfony\Component\HttpKernel\Event\RequestEvent $event */
       $event = $context['event'];
       $request = $event->getRequest();
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * RenameClassRector
 * WrapReturnRector
 * ChangeMethodVisibilityRector


5) modules/contrib/entity_legal/src/Form/EntityLegalDocumentVersionForm.php:33

    ---------- begin diff ----------
@@ @@
           $clone = $published_version->createDuplicate();
           // Unset properties that shouldn't be copied over.
           $clone->set('name', NULL);
-          $clone->set('created', REQUEST_TIME);
-          $clone->set('changed', REQUEST_TIME);
+          $clone->set('created', \Drupal::time()->getRequestTime());
+          $clone->set('changed', \Drupal::time()->getRequestTime());
           $clone->set('published', FALSE);
           $this->setEntity($clone);
         }
    ----------- end diff -----------

Applied rules:
 * RequestTimeConstRector
 * ArgumentRemoverRector
 * WrapReturnRector
 * ChangeMethodVisibilityRector


 [OK] 5 files have been changed by Rector                                       

