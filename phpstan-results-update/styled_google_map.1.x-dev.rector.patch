diff --git a/styled_google_map.module b/styled_google_map.module
index 2680bd4..0d82c0b 100755
--- a/styled_google_map.module
+++ b/styled_google_map.module
@@ -92,7 +92,7 @@ function theme_styled_google_map(array $variables) {
   if (!empty($location) && $location['geohash']) {
     // Get the pin file url.
     if (isset($settings['style']['pin']) && !empty($settings['style']['pin'])) {
-      $settings['style']['pin'] = file_create_url($settings['style']['pin']);
+      $settings['style']['pin'] = \Drupal::service('file_url_generator')->generateAbsoluteString($settings['style']['pin']);
     }
     // Sanitize the output of the style settings.
     foreach ($settings['style'] as $id => $setting) {
@@ -119,7 +119,7 @@ function theme_styled_google_map(array $variables) {
         default:
           $popup_field = array();
       }
-      $location['popup'] = render($popup_field);
+      $location['popup'] = \Drupal::service('renderer')->render($popup_field);
     }
     else {
       // Not an entity object.
@@ -151,7 +151,7 @@ function theme_styled_google_map(array $variables) {
     $output['#attached']['library'][] = 'styled_google_map/styled-google-map';
   }
 
-  return render($output);
+  return \Drupal::service('renderer')->render($output);
 }
 
 /**
