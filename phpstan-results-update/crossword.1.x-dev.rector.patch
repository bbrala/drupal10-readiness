diff --git a/modules/crossword_image/src/Plugin/Field/FieldFormatter/CrosswordImageRendered.php b/modules/crossword_image/src/Plugin/Field/FieldFormatter/CrosswordImageRendered.php
index 24ad860..7654022 100644
--- a/modules/crossword_image/src/Plugin/Field/FieldFormatter/CrosswordImageRendered.php
+++ b/modules/crossword_image/src/Plugin/Field/FieldFormatter/CrosswordImageRendered.php
@@ -219,11 +219,11 @@ class CrosswordImageRendered extends ImageFormatter implements ContainerFactoryP
         // context to ensure different file URLs are generated for different
         // sites in a multisite setup, including HTTP and HTTPS versions of the
         // same site. Fix in https://www.drupal.org/node/2646744.
-        $url = Url::fromUri(file_create_url($image_uri));
+        $url = \Drupal::service('file_url_generator')->generate($image_uri);
         $cache_contexts[] = 'url.site';
       }
       elseif (isset($link_file)) {
-        $url = Url::fromUri(file_create_url($file->getFileUri()));
+        $url = \Drupal::service('file_url_generator')->generate($file->getFileUri());
         $cache_contexts[] = 'url.site';
       }
       $cache_tags = Cache::mergeTags($base_cache_tags, $file->getCacheTags(), $image->getCacheTags());
diff --git a/modules/crossword_token/crossword_token.tokens.inc b/modules/crossword_token/crossword_token.tokens.inc
index 231d647..1930bb9 100755
--- a/modules/crossword_token/crossword_token.tokens.inc
+++ b/modules/crossword_token/crossword_token.tokens.inc
@@ -123,7 +123,7 @@ function crossword_token_tokens($type, $tokens, array $data = [], array $options
                 $replacements[$original] = $style->buildUrl($image->getFileUri());
               }
               elseif (!isset($parts[1])) {
-                $replacements[$original] = file_create_url($image->getFileUri());
+                $replacements[$original] = \Drupal::service('file_url_generator')->generateAbsoluteString($image->getFileUri());
               }
             }
           }
diff --git a/tests/src/Functional/CrosswordColorsTest.php b/tests/src/Functional/CrosswordColorsTest.php
index d469ea8..b4c5cb3 100644
--- a/tests/src/Functional/CrosswordColorsTest.php
+++ b/tests/src/Functional/CrosswordColorsTest.php
@@ -25,7 +25,7 @@ class CrosswordColorsTest extends BrowserTestBase {
    * Use form to update config and confirm stylesheet is saved/updated.
    */
   public function testCrosswordColorsForm() {
-    $this->assertFileNotExists('public://crossword-colors.css');
+    $this->assertFileDoesNotExist('public://crossword-colors.css');
     $this->drupalLogin($this->drupalCreateUser(['configure crossword colors']));
 
     // Save config for first time.
@@ -53,7 +53,7 @@ class CrosswordColorsTest extends BrowserTestBase {
    * Load library without ever visiting form.
    */
   public function testCrosswordColorsInstall() {
-    $this->assertFileNotExists('public://crossword-colors.css');
+    $this->assertFileDoesNotExist('public://crossword-colors.css');
     $this->drupalLogin($this->drupalCreateUser(['configure crossword colors']));
     $library = \Drupal::service('library.discovery')->getLibraryByName('crossword', 'crossword.default');
     // The library_info_alter hook should have created the file.
diff --git a/tests/src/Functional/CrosswordContestAccessTest.php b/tests/src/Functional/CrosswordContestAccessTest.php
index 339d13f..203045d 100644
--- a/tests/src/Functional/CrosswordContestAccessTest.php
+++ b/tests/src/Functional/CrosswordContestAccessTest.php
@@ -72,7 +72,7 @@ class CrosswordContestAccessTest extends BrowserTestBase {
   protected function createTestMedia() {
     // First we move a test file to the file system.
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/{$this->testPuzzleFilename}");
-    $file = file_save_data($contents, "public://{$this->testPuzzleFilename}");
+    $file = \Drupal::service('file.repository')->writeData($contents, "public://{$this->testPuzzleFilename}");
     // Now use that file in a new crossword_contests media.
     $media = Media::create(['bundle' => 'crossword_contest']);
     $media->set('name', 'Published Crossword Contest');
diff --git a/tests/src/Functional/CrosswordFieldValidateTest.php b/tests/src/Functional/CrosswordFieldValidateTest.php
index 65099ee..36d5d82 100644
--- a/tests/src/Functional/CrosswordFieldValidateTest.php
+++ b/tests/src/Functional/CrosswordFieldValidateTest.php
@@ -33,22 +33,22 @@ class CrosswordFieldValidateTest extends BrowserTestBase {
     // Not crossword.
     $filename = 'failure.txt';
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/" . $filename);
-    $not_crossword = file_save_data($contents, "public://$filename");
+    $not_crossword = \Drupal::service('file.repository')->writeData($contents, "public://$filename");
 
     // Corrupted txt.
     $filename = 'corrupted_bad_grid.txt';
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/" . $filename);
-    $corrupted_txt = file_save_data($contents, "public://$filename");
+    $corrupted_txt = \Drupal::service('file.repository')->writeData($contents, "public://$filename");
 
     // Ok txt.
     $filename = 'test.txt';
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/" . $filename);
-    $ok_txt = file_save_data($contents, "public://$filename");
+    $ok_txt = \Drupal::service('file.repository')->writeData($contents, "public://$filename");
 
     // Ok puz.
     $filename = 'test.puz';
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/" . $filename);
-    $ok_puz = file_save_data($contents, "public://$filename");
+    $ok_puz = \Drupal::service('file.repository')->writeData($contents, "public://$filename");
 
     // Log in as admin.
     $this->drupalLogin($this->drupalCreateUser([], 'radmin', TRUE));
@@ -86,17 +86,17 @@ class CrosswordFieldValidateTest extends BrowserTestBase {
     // Big file (25x25).
     $filename = '3185956.puz';
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/" . $filename);
-    $big_file = file_save_data($contents, "public://$filename");
+    $big_file = \Drupal::service('file.repository')->writeData($contents, "public://$filename");
 
     // Tiny File (2x2).
     $filename = 'tiny.txt';
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/" . $filename);
-    $tiny_file = file_save_data($contents, "public://$filename");
+    $tiny_file = \Drupal::service('file.repository')->writeData($contents, "public://$filename");
 
     // Ok size (3x3).
     $filename = 'test.txt';
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/" . $filename);
-    $ok_file = file_save_data($contents, "public://$filename");
+    $ok_file = \Drupal::service('file.repository')->writeData($contents, "public://$filename");
 
     // Log in as admin.
     $this->drupalLogin($this->drupalCreateUser([], 'radmin', TRUE));
diff --git a/tests/src/Functional/CrosswordImageRegenerateTest.php b/tests/src/Functional/CrosswordImageRegenerateTest.php
index bcfa75a..5b0bdf3 100644
--- a/tests/src/Functional/CrosswordImageRegenerateTest.php
+++ b/tests/src/Functional/CrosswordImageRegenerateTest.php
@@ -30,7 +30,7 @@ class CrosswordImageRegenerateTest extends BrowserTestBase {
   public function testRegenerate() {
     // Create a crossword file.
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/test.txt");
-    $file = file_save_data($contents, "public://test.txt");
+    $file = \Drupal::service('file.repository')->writeData($contents, "public://test.txt");
 
     // Create a couple crossword images. Don't create solution.
     $crossword_image_service = \Drupal::service('crossword.image_service');
@@ -41,7 +41,7 @@ class CrosswordImageRegenerateTest extends BrowserTestBase {
     // Confirm they exist.
     $this->assertFileExists('public://crossword/1-thumbnail.png');
     $this->assertFileExists('public://crossword/1-numbered_thumbnail.png');
-    $this->assertFileNotExists('public://crossword/1-solution_thumbnail.png');
+    $this->assertFileDoesNotExist('public://crossword/1-solution_thumbnail.png');
     // Put in a delay so updates can be measured..
     sleep(2);
     // Navigate to the regenerate form.
@@ -60,10 +60,10 @@ class CrosswordImageRegenerateTest extends BrowserTestBase {
     $this->assertSession()->pageTextContains('Crossword Image Regeneration is complete');
     // Check file existence (or non-existence).
     $this->assertFileExists('public://crossword/1-thumbnail.png');
-    $this->assertFileNotExists('public://crossword/1-thumbnail_0.png');
+    $this->assertFileDoesNotExist('public://crossword/1-thumbnail_0.png');
     $this->assertFileExists('public://crossword/1-numbered_thumbnail.png');
-    $this->assertFileNotExists('public://crossword/1-numbered_thumbnail_0.png');
-    $this->assertFileNotExists('public://crossword/1-solution_thumbnail.png');
+    $this->assertFileDoesNotExist('public://crossword/1-numbered_thumbnail_0.png');
+    $this->assertFileDoesNotExist('public://crossword/1-solution_thumbnail.png');
     // Check modification times. Only numbered should have been updated.
     $this->assertEquals($thumbnail_time, filemtime('public://crossword/1-thumbnail.png'));
     $this->assertGreaterThan($numbered_time, filemtime('public://crossword/1-numbered_thumbnail.png'));
diff --git a/tests/src/FunctionalJavascript/CrosswordContestTest.php b/tests/src/FunctionalJavascript/CrosswordContestTest.php
index b47060a..43ed014 100644
--- a/tests/src/FunctionalJavascript/CrosswordContestTest.php
+++ b/tests/src/FunctionalJavascript/CrosswordContestTest.php
@@ -97,7 +97,7 @@ class CrosswordContestTest extends WebDriverTestBase {
   protected function createTestNode() {
     // First we move a test file to the file system.
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/{$this->testPuzzleFilename}");
-    $file = file_save_data($contents, "public://{$this->testPuzzleFilename}");
+    $file = \Drupal::service('file.repository')->writeData($contents, "public://{$this->testPuzzleFilename}");
     // Now use that file in a new crossword_contests media.
     $media = Media::create(['bundle' => 'crossword_contest']);
     $media->set('name', 'Test Crossword Contest');
diff --git a/tests/src/FunctionalJavascript/CrosswordFormatterTestBase.php b/tests/src/FunctionalJavascript/CrosswordFormatterTestBase.php
index aa17b38..14fd80e 100644
--- a/tests/src/FunctionalJavascript/CrosswordFormatterTestBase.php
+++ b/tests/src/FunctionalJavascript/CrosswordFormatterTestBase.php
@@ -331,7 +331,7 @@ abstract class CrosswordFormatterTestBase extends WebDriverTestBase {
   protected function createTestNode() {
     // First we move a test file to the file system.
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/{$this->testPuzzleFilename}");
-    $file = file_save_data($contents, "public://{$this->testPuzzleFilename}");
+    $file = \Drupal::service('file.repository')->writeData($contents, "public://{$this->testPuzzleFilename}");
     // Now use that file in a new crossword node.
     $node = Node::create(['type' => 'crossword']);
     $node->set('title', 'Test Crossword Node');
diff --git a/tests/src/FunctionalJavascript/CrosswordStatusTest.php b/tests/src/FunctionalJavascript/CrosswordStatusTest.php
index fe4f51f..ad7c98f 100644
--- a/tests/src/FunctionalJavascript/CrosswordStatusTest.php
+++ b/tests/src/FunctionalJavascript/CrosswordStatusTest.php
@@ -179,7 +179,7 @@ class CrosswordStatusTest extends WebDriverTestBase {
   protected function createTestNode() {
     // First we move a test file to the file system.
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/{$this->testPuzzleFilename}");
-    $file = file_save_data($contents, "public://{$this->testPuzzleFilename}");
+    $file = \Drupal::service('file.repository')->writeData($contents, "public://{$this->testPuzzleFilename}");
     // Now use that file in a new crossword node.
     $node = Node::create(['type' => 'crossword']);
     $node->set('title', 'Test Crossword Node');
diff --git a/tests/src/Kernel/CrosswordDataServiceTest.php b/tests/src/Kernel/CrosswordDataServiceTest.php
index 0ca728b..809616c 100644
--- a/tests/src/Kernel/CrosswordDataServiceTest.php
+++ b/tests/src/Kernel/CrosswordDataServiceTest.php
@@ -36,7 +36,7 @@ class CrosswordDataServiceTest extends KernelTestBase {
    */
   public function testCrosswordDataService() {
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/test.txt");
-    $file = file_save_data($contents, "public://test.txt");
+    $file = \Drupal::service('file.repository')->writeData($contents, "public://test.txt");
     $expected_json = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/test.json");
     $expected_data = json_decode($expected_json, TRUE);
     $expected_data['id'] = $file->id();
@@ -96,7 +96,7 @@ class CrosswordDataServiceTest extends KernelTestBase {
    */
   public function testCrosswordDataServiceXss() {
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/xss.txt");
-    $file = file_save_data($contents, "public://xss.txt");
+    $file = \Drupal::service('file.repository')->writeData($contents, "public://xss.txt");
     $expected_json = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/xss.json");
     $expected_data = json_decode($expected_json, TRUE);
     $expected_data['id'] = $file->id();
@@ -113,7 +113,7 @@ class CrosswordDataServiceTest extends KernelTestBase {
    */
   public function testJsonEncoding() {
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/3102647.puz");
-    $file = file_save_data($contents, "public://3102647.puz");
+    $file = \Drupal::service('file.repository')->writeData($contents, "public://3102647.puz");
 
     $crossword_data_service = \Drupal::service('crossword.data_service');
     $data = $crossword_data_service->getData($file);
@@ -125,7 +125,7 @@ class CrosswordDataServiceTest extends KernelTestBase {
    */
   public function testCorruptedFile() {
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/corrupted_bad_grid.puz");
-    $file = file_save_data($contents, "public://corrupted_bad_grid.puz");
+    $file = \Drupal::service('file.repository')->writeData($contents, "public://corrupted_bad_grid.puz");
 
     $cache_service = \Drupal::service('cache.crossword');
     $this->assertFalse($cache_service->get($file->id()));
diff --git a/tests/src/Kernel/CrosswordFileParserPluginTestBase.php b/tests/src/Kernel/CrosswordFileParserPluginTestBase.php
index fcebd53..ff39af4 100644
--- a/tests/src/Kernel/CrosswordFileParserPluginTestBase.php
+++ b/tests/src/Kernel/CrosswordFileParserPluginTestBase.php
@@ -125,7 +125,7 @@ abstract class CrosswordFileParserPluginTestBase extends KernelTestBase {
    * This does not closely examine the parsed data. It simply checks whether
    * the parsing completes with or without an expected exception.
    *
-   * @dataProvider testExceptionsProvider
+   * @dataProvider exceptionsProvider
    */
   public function testExceptions($filename, $message) {
     $file = $this->getTestFile($filename);
@@ -149,7 +149,7 @@ abstract class CrosswordFileParserPluginTestBase extends KernelTestBase {
    */
   protected function getTestFile($filename) {
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/" . $filename);
-    $file = file_save_data($contents, "public://$filename");
+    $file = \Drupal::service('file.repository')->writeData($contents, "public://$filename");
     return $file;
   }
 
diff --git a/tests/src/Kernel/CrosswordImageServiceTest.php b/tests/src/Kernel/CrosswordImageServiceTest.php
index eeb8ed9..2006572 100644
--- a/tests/src/Kernel/CrosswordImageServiceTest.php
+++ b/tests/src/Kernel/CrosswordImageServiceTest.php
@@ -42,7 +42,7 @@ class CrosswordImageServiceTest extends KernelTestBase {
    */
   public function testCrosswordImageService() {
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/test.txt");
-    $file = file_save_data($contents, "public://test.txt");
+    $file = \Drupal::service('file.repository')->writeData($contents, "public://test.txt");
 
     $crossword_image_manager = \Drupal::service('crossword.manager.image');
     $plugin_ids = array_keys($crossword_image_manager->getCrosswordImageOptionList());
diff --git a/tests/src/Kernel/CrosswordImageTokenTest.php b/tests/src/Kernel/CrosswordImageTokenTest.php
index 674f87d..019c3ec 100644
--- a/tests/src/Kernel/CrosswordImageTokenTest.php
+++ b/tests/src/Kernel/CrosswordImageTokenTest.php
@@ -41,9 +41,9 @@ class CrosswordImageTokenTest extends KernelTestBase {
   public function testCrosswordImageTokens() {
     // Create a test crossword file.
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/test.txt");
-    $file = file_save_data($contents, "public://test.txt");
+    $file = \Drupal::service('file.repository')->writeData($contents, "public://test.txt");
     $expected_uri = \Drupal::service('crossword.image_service')->getImageUri($file, 'thumbnail');
-    $expected_thumbnail_url = file_create_url($expected_uri);
+    $expected_thumbnail_url = \Drupal::service('file_url_generator')->generateAbsoluteString($expected_uri);
     $style = ImageStyle::create(
       [
         'name' => 'test_style',
@@ -62,7 +62,7 @@ class CrosswordImageTokenTest extends KernelTestBase {
     $this->assertTokens('file', ['file' => $file], $tokens);
 
     // Test a file that is not a crossword.
-    $fake_file = file_save_data('Fake!', "public://fake.txt");
+    $fake_file = \Drupal::service('file.repository')->writeData('Fake!', "public://fake.txt");
     $tokens = [
       'crossword_image' => NULL,
       'crossword_image:thumbnail' => NULL,
diff --git a/tests/src/Kernel/CrosswordTokenTest.php b/tests/src/Kernel/CrosswordTokenTest.php
index c827bc5..b083b4d 100644
--- a/tests/src/Kernel/CrosswordTokenTest.php
+++ b/tests/src/Kernel/CrosswordTokenTest.php
@@ -33,7 +33,7 @@ class CrosswordTokenTest extends KernelTestBase {
   public function testCrosswordTokens() {
     // Create a test crossword file.
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/test.txt");
-    $file = file_save_data($contents, "public://test.txt");
+    $file = \Drupal::service('file.repository')->writeData($contents, "public://test.txt");
 
     $tokens = [
       'crossword_title' => 'Test Puzzle',
@@ -46,7 +46,7 @@ class CrosswordTokenTest extends KernelTestBase {
     $this->assertTokens('file', ['file' => $file], $tokens);
 
     // Test a file that is not a crossword.
-    $fake_file = file_save_data('Fake!', "public://fake.txt");
+    $fake_file = \Drupal::service('file.repository')->writeData('Fake!', "public://fake.txt");
     $tokens = [
       'crossword_title' => '',
       'crossword_author' => '',
diff --git a/tests/src/Kernel/Formatter/CrosswordFileDownloadLinkFormatterTest.php b/tests/src/Kernel/Formatter/CrosswordFileDownloadLinkFormatterTest.php
index a258e32..155d86c 100644
--- a/tests/src/Kernel/Formatter/CrosswordFileDownloadLinkFormatterTest.php
+++ b/tests/src/Kernel/Formatter/CrosswordFileDownloadLinkFormatterTest.php
@@ -56,7 +56,7 @@ class CrosswordFileDownloadLinkFormatterTest extends SimpleCrosswordFormatterTes
     $expected_render = [
       '#type' => 'link',
       '#title' => 'Test Puzzle (3x3)',
-      '#url' => Url::fromUri(file_create_url('public://test.txt')),
+      '#url' => \Drupal::service('file_url_generator')->generate('public://test.txt'),
       '#options' => [
         'attributes' => [
           'class' => [
diff --git a/tests/src/Kernel/Formatter/CrosswordImageDownloadLinkFormatterTest.php b/tests/src/Kernel/Formatter/CrosswordImageDownloadLinkFormatterTest.php
index 4f8f896..a0dcba5 100644
--- a/tests/src/Kernel/Formatter/CrosswordImageDownloadLinkFormatterTest.php
+++ b/tests/src/Kernel/Formatter/CrosswordImageDownloadLinkFormatterTest.php
@@ -58,7 +58,7 @@ class CrosswordImageDownloadLinkFormatterTest extends SimpleCrosswordFormatterTe
     $expected_render = [
       '#type' => 'link',
       '#title' => 'Solution (png)',
-      '#url' => Url::fromUri(file_create_url('public://crossword/1-solution_thumbnail.png')),
+      '#url' => \Drupal::service('file_url_generator')->generate('public://crossword/1-solution_thumbnail.png'),
       '#options' => [
         'attributes' => [
           'class' => [
diff --git a/tests/src/Kernel/Formatter/SimpleCrosswordFormatterTestBase.php b/tests/src/Kernel/Formatter/SimpleCrosswordFormatterTestBase.php
index 0b3e3bb..993aaf9 100644
--- a/tests/src/Kernel/Formatter/SimpleCrosswordFormatterTestBase.php
+++ b/tests/src/Kernel/Formatter/SimpleCrosswordFormatterTestBase.php
@@ -82,7 +82,7 @@ abstract class SimpleCrosswordFormatterTestBase extends KernelTestBase {
     // First we move a test file to the file system.
     $contents = file_get_contents(\Drupal::service('extension.list.module')->getPath('crossword') . "/tests/files/test.txt");
 
-    $file = file_save_data($contents, 'public://test.txt');
+    $file = \Drupal::service('file.repository')->writeData($contents, 'public://test.txt');
     $field_storage = FieldStorageConfig::create([
       'field_name' => 'field_crossword',
       'entity_type' => 'entity_test_rev',
diff --git a/tests/src/Unit/FindReferencesTest.php b/tests/src/Unit/FindReferencesTest.php
index a96462f..7ddf9f4 100644
--- a/tests/src/Unit/FindReferencesTest.php
+++ b/tests/src/Unit/FindReferencesTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\crossword\Unit;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\crossword\CrosswordDataService;
 use Drupal\Tests\UnitTestCase;
 
@@ -12,6 +13,7 @@ use Drupal\Tests\UnitTestCase;
  */
 class FindReferencesTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
    * Test findReferences function.
    *
