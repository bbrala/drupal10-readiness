diff --git a/google_analytics.module b/google_analytics.module
index c699a74..822a888 100644
--- a/google_analytics.module
+++ b/google_analytics.module
@@ -534,7 +534,7 @@ function _google_analytics_cache($location, $synchronize = FALSE) {
           // Return the local JS file path.
           // @todo: Remove conditional after dropping support lower than 9.3.
           // @phpstan-ignore-next-line
-          return method_exists('\Drupal\Core\File\FileUrlGenerator', 'generateString') ? \Drupal::service('file_url_generator')->generateString($file_destination) : file_url_transform_relative(file_create_url($file_destination));
+          return method_exists('\Drupal\Core\File\FileUrlGenerator', 'generateString') ? \Drupal::service('file_url_generator')->generateString($file_destination) : \Drupal::service('file_url_generator')->generateString($file_destination);
         }
       }
     }
@@ -546,7 +546,7 @@ function _google_analytics_cache($location, $synchronize = FALSE) {
     // Return the local JS file path.
     // @todo: Remove conditional after dropping support lower than 9.3.
     // @phpstan-ignore-next-line
-    return method_exists('\Drupal\Core\File\FileUrlGenerator', 'generateString') ? \Drupal::service('file_url_generator')->generateString($file_destination) : file_url_transform_relative(file_create_url($file_destination));
+    return method_exists('\Drupal\Core\File\FileUrlGenerator', 'generateString') ? \Drupal::service('file_url_generator')->generateString($file_destination) : \Drupal::service('file_url_generator')->generateString($file_destination);
   }
 }
 
diff --git a/tests/src/Functional/GoogleAnalyticsUninstallTest.php b/tests/src/Functional/GoogleAnalyticsUninstallTest.php
index 47e34e1..9ad120e 100644
--- a/tests/src/Functional/GoogleAnalyticsUninstallTest.php
+++ b/tests/src/Functional/GoogleAnalyticsUninstallTest.php
@@ -26,7 +26,7 @@ class GoogleAnalyticsUninstallTest extends BrowserTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $permissions = [
@@ -64,13 +64,14 @@ class GoogleAnalyticsUninstallTest extends BrowserTestBase {
     // Uninstall the module.
     $edit = [];
     $edit['uninstall[google_analytics]'] = TRUE;
-    $this->drupalPostForm('admin/modules/uninstall', $edit, t('Uninstall'));
+    $this->drupalGet('admin/modules/uninstall');
+    $this->submitForm($edit, t('Uninstall'));
     $this->assertSession()->pageTextNotContains(\Drupal::translation()->translate('Configuration deletions'));
-    $this->drupalPostForm(NULL, NULL, t('Uninstall'));
+    $this->submitForm(NULL, t('Uninstall'));
     $this->assertSession()->pageTextContains(t('The selected modules have been uninstalled.'));
 
     // Test if the directory and all files have been removed.
-    $this->assertDirectoryNotExists($cache_path);
+    $this->assertDirectoryDoesNotExist($cache_path);
   }
 
 }
diff --git a/tests/src/Functional/GoogleAnalyticsUserFieldsTest.php b/tests/src/Functional/GoogleAnalyticsUserFieldsTest.php
index 1ab1284..ee9a614 100644
--- a/tests/src/Functional/GoogleAnalyticsUserFieldsTest.php
+++ b/tests/src/Functional/GoogleAnalyticsUserFieldsTest.php
@@ -26,7 +26,7 @@ class GoogleAnalyticsUserFieldsTest extends BrowserTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $permissions = [
