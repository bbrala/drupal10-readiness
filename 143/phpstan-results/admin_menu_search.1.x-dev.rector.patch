diff --git a/src/ToolbarHandler.php b/src/ToolbarHandler.php
index 9650343..a88b997 100644
--- a/src/ToolbarHandler.php
+++ b/src/ToolbarHandler.php
@@ -113,7 +113,7 @@ class ToolbarHandler implements ContainerInjectionInterface {
    */
   protected function getMenuSearchForm() {
     $form = $this->formBuilder->getForm('Drupal\admin_menu_search\Form\AdminMenuSearchForm');
-    return render($form);
+    return \Drupal::service('renderer')->render($form);
   }
 
 }
diff --git a/tests/src/Unit/AutoCompleteControllerTest.php b/tests/src/Unit/AutoCompleteControllerTest.php
index 4b12954..91cbc29 100644
--- a/tests/src/Unit/AutoCompleteControllerTest.php
+++ b/tests/src/Unit/AutoCompleteControllerTest.php
@@ -15,12 +15,9 @@ class AutoCompleteControllerTest extends UnitTestCase {
   /**
    * Unit test setup.
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
-    $this->controller = $this->getMockBuilder('Drupal\admin_menu_search\Controller\AutoCompleteController')
-      ->setMethods(['getAdminMenuTreeIndex', 'getMenuUrl'])
-      ->disableOriginalConstructor()
-      ->getMock();
+    $this->controller = $this->createMock('Drupal\admin_menu_search\Controller\AutoCompleteController');
     $this->controller->expects($this->any())
       ->method('getMenuUrl')
       ->will($this->returnCallback([$this, 'returnCallbackMenuUrl']));
diff --git a/tests/src/Unit/MenuTreeTest.php b/tests/src/Unit/MenuTreeTest.php
index 24f10fa..b68a3df 100644
--- a/tests/src/Unit/MenuTreeTest.php
+++ b/tests/src/Unit/MenuTreeTest.php
@@ -14,12 +14,9 @@ class MenuTreeTest extends UnitTestCase {
   /**
    * Unit test setup.
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
-    $this->menu_tree = $this->getMockBuilder('Drupal\admin_menu_search\MenuTree')
-      ->setMethods(['getCache', 'setCache', 'getToolbarMenuTree', 't'])
-      ->disableOriginalConstructor()
-      ->getMock();
+    $this->menu_tree = $this->createMock('Drupal\admin_menu_search\MenuTree');
     $this->menu_tree->expects($this->any())
       ->method('getCurrentLanguageId')
       ->willReturn('en');
@@ -63,10 +60,7 @@ class MenuTreeTest extends UnitTestCase {
         'parameters' => [],
       ],
     ];
-    $this->menu_links = $this->getMockBuilder('Drupal\Core\Menu\MenuLinkTreeElement')
-      ->disableOriginalConstructor()
-      ->setMethods(['getPluginDefinition'])
-      ->getMock();
+    $this->menu_links = $this->createMock('Drupal\Core\Menu\MenuLinkTreeElement');
     $this->menu_links->expects($this->at(0))
       ->method('getPluginDefinition')
       ->willReturn([
@@ -127,14 +121,8 @@ class MenuTreeTest extends UnitTestCase {
         'parameters' => [],
       ],
     ];
-    $this->menu_links = $this->getMockBuilder('Drupal\Core\Menu\MenuLinkTreeElement')
-      ->disableOriginalConstructor()
-      ->setMethods(['getPluginDefinition'])
-      ->getMock();
-    $translatable_title = $this->getMockBuilder('Drupal\Core\StringTranslation\TranslatableMarkup')
-      ->disableOriginalConstructor()
-      ->setMethods(['render'])
-      ->getMock();
+    $this->menu_links = $this->createMock('Drupal\Core\Menu\MenuLinkTreeElement');
+    $translatable_title = $this->createMock('Drupal\Core\StringTranslation\TranslatableMarkup');
     $translatable_title->expects($this->at(0))
       ->method('render')
       ->willReturn('Menu One');
@@ -208,10 +196,7 @@ class MenuTreeTest extends UnitTestCase {
         'parameters' => [],
       ],
     ];
-    $this->menu_links = $this->getMockBuilder('Drupal\Core\Menu\MenuLinkTreeElement')
-      ->disableOriginalConstructor()
-      ->setMethods(['getPluginDefinition'])
-      ->getMock();
+    $this->menu_links = $this->createMock('Drupal\Core\Menu\MenuLinkTreeElement');
     $this->menu_links->expects($this->at(0))
       ->method('getPluginDefinition')
       ->willReturn([
@@ -340,10 +325,7 @@ class MenuTreeTest extends UnitTestCase {
    * @covers Drupal\admin_menu_search\MenuTree
    */
   public function testMenuTreeWithoutCache() {
-    $this->menu_tree = $this->getMockBuilder('Drupal\admin_menu_search\MenuTree')
-      ->setMethods(['getCache', 'setCache', 'getToolbarMenuTree', 'buildMenuTreeIndex', 't'])
-      ->disableOriginalConstructor()
-      ->getMock();
+    $this->menu_tree = $this->createMock('Drupal\admin_menu_search\MenuTree');
     $expected_array = [
       [
         'name' => 'menu.one',
diff --git a/tests/src/Unit/ToolbarHandlerTest.php b/tests/src/Unit/ToolbarHandlerTest.php
index 1266c07..d91a95f 100644
--- a/tests/src/Unit/ToolbarHandlerTest.php
+++ b/tests/src/Unit/ToolbarHandlerTest.php
@@ -14,12 +14,9 @@ class ToolbarHandlerTest extends UnitTestCase {
   /**
    * Unit test setup.
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
-    $this->toolbar_handler = $this->getMockBuilder('Drupal\admin_menu_search\ToolbarHandler')
-      ->disableOriginalConstructor()
-      ->setMethods(['checkAccess', 'getMenuSearchForm', 't'])
-      ->getMock();
+    $this->toolbar_handler = $this->createMock('Drupal\admin_menu_search\ToolbarHandler');
     $this->toolbar_handler->expects($this->any())
       ->method('t')
       ->will($this->returnCallback([$this, 'returnCallbackT']));
