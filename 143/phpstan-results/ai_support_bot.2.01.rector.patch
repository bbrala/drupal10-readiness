diff --git a/src/Controller/AIClients.php b/src/Controller/AIClients.php
index a593a32..68bebb6 100644
--- a/src/Controller/AIClients.php
+++ b/src/Controller/AIClients.php
@@ -37,7 +37,7 @@ class AIClients extends ControllerBase
     public function getNewQuestions()
     {
         $uid = $this->currentUser->id();
-        $query = db_select('ai_support_bot_analytics', 'v');
+        $query = \Drupal::database()->select('ai_support_bot_analytics', 'v');
         $query->fields('v');
         $query->condition('v.uid', $uid);
         $results = $query->execute()->fetchAll();
@@ -59,7 +59,7 @@ class AIClients extends ControllerBase
           array('data' => $this->t('Website'), 'field' => 'website'),
         );
 
-        $query = db_select('ai_support_bot_analytics', 'v');
+        $query = \Drupal::database()->select('ai_support_bot_analytics', 'v');
         $query->fields('v', $headers);
         $query->condition('v.uid', $uid);
         // The actual action of sorting the rows is here.
diff --git a/src/Controller/AIClientsAdmin.php b/src/Controller/AIClientsAdmin.php
index 9c61c95..470f306 100644
--- a/src/Controller/AIClientsAdmin.php
+++ b/src/Controller/AIClientsAdmin.php
@@ -38,7 +38,7 @@ class AIClientsAdmin extends ControllerBase
      */
     public function getNewQuestions()
     {
-        $query = db_select('ai_support_bot_new_questions', 'v');
+        $query = \Drupal::database()->select('ai_support_bot_new_questions', 'v');
         $query->fields('v');
         $results = $query->execute()->fetchAll();
         $final = json_decode(json_encode($results), true);
@@ -57,7 +57,7 @@ class AIClientsAdmin extends ControllerBase
           array('data' => $this->t('times_repeated'), 'field' => 'times_repeated', 'sort' => 'desc'),
         );
 
-        $query = db_select('ai_support_bot_new_questions', 'v');
+        $query = \Drupal::database()->select('ai_support_bot_new_questions', 'v');
         $query->fields('v', $headers);
         // The actual action of sorting the rows is here.
         $table_sort = $query->extend('Drupal\Core\Database\Query\TableSortExtender')
diff --git a/src/Controller/AIQAnswers.php b/src/Controller/AIQAnswers.php
index dff7388..ac4471f 100644
--- a/src/Controller/AIQAnswers.php
+++ b/src/Controller/AIQAnswers.php
@@ -74,7 +74,7 @@ class AIQAnswers extends ControllerBase
         $questions = '';
         $result = [];
         $answer = 'no-answer';
-        $query = db_select('ai_support_bot', 'v');
+        $query = \Drupal::database()->select('ai_support_bot', 'v');
         $query->fields('v');
         $betterAnswer = [];
         $results = $query->execute()->fetchAll();
@@ -177,7 +177,7 @@ class AIQAnswers extends ControllerBase
         $answersResult = [];
         $questionContent = [];
         // If ($answer == 'no-answer') {.
-        $query = db_select('node_field_data', 'v');
+        $query = \Drupal::database()->select('node_field_data', 'v');
         $query->fields('v');
         $results = $query->execute()->fetchAll();
         $rm1 = array_rand($randomAnswer1);
@@ -239,7 +239,7 @@ class AIQAnswers extends ControllerBase
             $user = \Drupal::currentUser();
             // Empty the table.
             $values = [];
-            $query = db_select('ai_support_bot_new_questions', 'v');
+            $query = \Drupal::database()->select('ai_support_bot_new_questions', 'v');
             $query->condition('v.question', $question);
             $query->condition('v.answer', $answer);
             $query->fields('v');
diff --git a/src/Controller/AItextToSpeech.php b/src/Controller/AItextToSpeech.php
index e74096c..f96a3ef 100644
--- a/src/Controller/AItextToSpeech.php
+++ b/src/Controller/AItextToSpeech.php
@@ -27,7 +27,7 @@ class AItextToSpeech extends ControllerBase {
       // if (!file_exists($file)) {.
       file_put_contents($file, $data);
     }
-    $path = file_create_url($file);
+    $path = \Drupal::service('file_url_generator')->generateAbsoluteString($file);
     $player = '<audio style="display:none;" autoplay src="' . $path . '" type="audio/mp3" ></audio>';
     return $player;
   }
diff --git a/src/Form/Questions.php b/src/Form/Questions.php
index 83b6626..dd8c32b 100755
--- a/src/Form/Questions.php
+++ b/src/Form/Questions.php
@@ -251,7 +251,7 @@ class Settings extends ConfigFormBase {
     $answers = '';
     $questions = '';
     $result = [];
-    $query = db_select('ai_support_bot', 'v');
+    $query = \Drupal::database()->select('ai_support_bot', 'v');
     $query->fields('v');
     $results = $query->execute()->fetchAll();
     foreach ($results as $key => $value) {
diff --git a/src/Form/Settings.php b/src/Form/Settings.php
index 199756e..82a298e 100755
--- a/src/Form/Settings.php
+++ b/src/Form/Settings.php
@@ -44,7 +44,7 @@ class Settings extends ConfigFormBase
     public function buildForm(array $form, FormStateInterface $form_state, $no_js_use = false)
     {
         $config = $this->config('ai_support_bot.settings');
-        $query = db_select('ai_support_bot', 'v');
+        $query = \Drupal::database()->select('ai_support_bot', 'v');
         $query->fields('v');
         $results = $query->countQuery()->execute()->fetchField();
         $form['questions_fieldset'] = [
@@ -320,7 +320,7 @@ class Settings extends ConfigFormBase
         $questions = '';
         $result = [];
 
-        $query = db_select('ai_support_bot', 'v');
+        $query = \Drupal::database()->select('ai_support_bot', 'v');
         $query->fields('v');
         $results = $query->execute()->fetchAll();
         foreach ($results as $key => $value) {
