diff --git a/modules/samlauth_user_fields/src/Form/SamlauthMappingListForm.php b/modules/samlauth_user_fields/src/Form/SamlauthMappingListForm.php
index 553b4f4..80961a9 100644
--- a/modules/samlauth_user_fields/src/Form/SamlauthMappingListForm.php
+++ b/modules/samlauth_user_fields/src/Form/SamlauthMappingListForm.php
@@ -198,7 +198,7 @@ class SamlauthMappingListForm extends ConfigFormBase {
         $output['table']['#rows'][$id] = [
           $mapping['attribute_name'],
           $user_field,
-          render($operations),
+          \Drupal::service('renderer')->render($operations),
         ];
         if ($linking_enabled) {
           array_splice($output['table']['#rows'][$id], 2, 0, [$mapping['link_user_order'] ?? '']);
diff --git a/src/Event/SamlauthUserLinkEvent.php b/src/Event/SamlauthUserLinkEvent.php
index ea91f1c..0b8b986 100644
--- a/src/Event/SamlauthUserLinkEvent.php
+++ b/src/Event/SamlauthUserLinkEvent.php
@@ -2,8 +2,8 @@
 
 namespace Drupal\samlauth\Event;
 
+use Symfony\Contracts\EventDispatcher\Event;
 use Drupal\user\UserInterface;
-use Symfony\Component\EventDispatcher\Event;
 
 /**
  * Wraps a samlauth user link event for event listeners.
diff --git a/src/Event/SamlauthUserSyncEvent.php b/src/Event/SamlauthUserSyncEvent.php
index 970928e..2c9d7de 100644
--- a/src/Event/SamlauthUserSyncEvent.php
+++ b/src/Event/SamlauthUserSyncEvent.php
@@ -2,8 +2,8 @@
 
 namespace Drupal\samlauth\Event;
 
+use Symfony\Contracts\EventDispatcher\Event;
 use Drupal\user\UserInterface;
-use Symfony\Component\EventDispatcher\Event;
 
 /**
  * Wraps a samlauth user sync event for event listeners.
diff --git a/src/EventSubscriber/AccessDeniedSubscriber.php b/src/EventSubscriber/AccessDeniedSubscriber.php
index 0e99c97..34326f1 100644
--- a/src/EventSubscriber/AccessDeniedSubscriber.php
+++ b/src/EventSubscriber/AccessDeniedSubscriber.php
@@ -2,13 +2,13 @@
 
 namespace Drupal\samlauth\EventSubscriber;
 
+use Symfony\Component\HttpKernel\Event\ExceptionEvent;
 use Drupal\Core\Session\AccountInterface;
 use Drupal\Core\Routing\RouteMatch;
 use Drupal\Core\Url;
 use Symfony\Component\EventDispatcher\EventSubscriberInterface;
 use Symfony\Component\HttpFoundation\RedirectResponse;
 use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\HttpKernel\Event\GetResponseForExceptionEvent;
 use Symfony\Component\HttpKernel\Event\KernelEvent;
 use Symfony\Component\HttpKernel\Exception\AccessDeniedHttpException;
 use Symfony\Component\HttpKernel\Exception\TooManyRequestsHttpException;
@@ -49,11 +49,11 @@ class AccessDeniedSubscriber implements EventSubscriberInterface {
   /**
    * Redirects users when access is denied.
    *
-   * @param \Symfony\Component\HttpKernel\Event\GetResponseForExceptionEvent $event
+   * @param \Symfony\Component\HttpKernel\Event\ExceptionEvent $event
    *   The event to process.
    */
-  public function onException(GetResponseForExceptionEvent $event) {
-    $exception = $event->getException();
+  public function onException(ExceptionEvent $event) {
+    $exception = $event->getThrowable();
     // If our own routes threw a TooManyRequestsHttpException, don't spend time
     // redirecting to another page and rendering that. (Rendering would need to
     // be done from scratch because the page needs to include includes the
diff --git a/src/SamlService.php b/src/SamlService.php
index 5d4f090..e9bd68a 100644
--- a/src/SamlService.php
+++ b/src/SamlService.php
@@ -441,7 +441,7 @@ class SamlService {
       // then by name, then by email.
       if ($config->get('map_users')) {
         $event = new SamlauthUserLinkEvent($this->getAttributes());
-        $this->eventDispatcher->dispatch(SamlauthEvents::USER_LINK, $event);
+        $this->eventDispatcher->dispatch($event, SamlauthEvents::USER_LINK);
         $account = $event->getLinkedAccount();
         if ($account) {
           $this->logger->info('Existing user @name (@uid) was newly matched to SAML login attributes; linking user and logging in.', [
@@ -749,7 +749,7 @@ class SamlService {
   public function synchronizeUserAttributes(UserInterface $account, $skip_save = FALSE, $first_saml_login = FALSE) {
     // Dispatch a user_sync event.
     $event = new SamlauthUserSyncEvent($account, $this->getAttributes(), $first_saml_login);
-    $this->eventDispatcher->dispatch(SamlauthEvents::USER_SYNC, $event);
+    $this->eventDispatcher->dispatch($event, SamlauthEvents::USER_SYNC);
 
     if (!$skip_save && $event->isAccountChanged()) {
       $account->save();
diff --git a/src/Tests/SamlTest.php b/src/Tests/SamlTest.php
index b143885..c3cfbec 100644
--- a/src/Tests/SamlTest.php
+++ b/src/Tests/SamlTest.php
@@ -48,11 +48,11 @@ class SamlTest extends BrowserTestBase {
   /**
    * {@inheritdoc}
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
 
     // Import testshib config.
-    $config = drupal_get_path('module', 'samlauth') . '/test_resources/samlauth.authentication.yml';
+    $config = \Drupal::service('extension.list.module')->getPath('samlauth') . '/test_resources/samlauth.authentication.yml';
     $config = file_get_contents($config);
     $config = Yaml::decode($config);
     \Drupal::configFactory()->getEditable('samlauth.authentication')->setData($config)->save();
@@ -68,12 +68,12 @@ class SamlTest extends BrowserTestBase {
     $web_user = $this->drupalCreateUser(['configure saml']);
     $this->drupalLogin($web_user);
     $this->drupalGet('admin/config/people/saml');
-    $this->assertText('Login / Logout', 'Login / Logout fieldset present');
-    $this->assertText('Service Provider', 'SP fieldset present');
-    $this->assertText('Identity Provider', 'iDP fieldset present');
-    $this->assertText('User Info and Syncing', 'User Info and Syncing fieldset present');
-    $this->assertText('SAML Message Construction', 'SAML Message Construction fieldset present');
-    $this->assertText('SAML Message Validation', 'SAML Message Validation fieldset present');
+    $this->assertSession()->pageTextContains('Login / Logout');
+    $this->assertSession()->pageTextContains('Service Provider');
+    $this->assertSession()->pageTextContains('Identity Provider');
+    $this->assertSession()->pageTextContains('User Info and Syncing');
+    $this->assertSession()->pageTextContains('SAML Message Construction');
+    $this->assertSession()->pageTextContains('SAML Message Validation');
   }
 
   /**
@@ -85,8 +85,8 @@ class SamlTest extends BrowserTestBase {
 
     // Test that we get metadata.
     $this->drupalGet('saml/metadata');
-    $this->assertResponse(200, 'SP metadata is accessible');
-    $this->assertRaw('entityID="samlauth"', 'Entity ID found in the metadata');
+    $this->assertSession()->statusCodeEquals(200, 'SP metadata is accessible');
+    $this->assertSession()->responseContains('entityID="samlauth"');
   }
 
   /**
