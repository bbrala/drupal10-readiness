diff --git a/amp.module b/amp.module
index 69fcde9..667adcb 100644
--- a/amp.module
+++ b/amp.module
@@ -324,7 +324,7 @@ function amp_theme_suggestions_image_alter(array &$suggestions, array $variables
 function amp_theme_registry_alter(&$theme_registry) {
   $theme_registry['amp_image_wrapper'] = $theme_registry['image'];
   $theme_registry['amp_image_wrapper']['template'] = 'amp-image-wrapper';
-  $theme_registry['amp_image_wrapper']['path'] = drupal_get_path('module', 'amp') . '/templates';
+  $theme_registry['amp_image_wrapper']['path'] = \Drupal::service('extension.list.module')->getPath('amp') . '/templates';
 }
 
 /**
diff --git a/src/Asset/AmpCssCollectionRenderer.php b/src/Asset/AmpCssCollectionRenderer.php
index 0c91e1d..77955b7 100644
--- a/src/Asset/AmpCssCollectionRenderer.php
+++ b/src/Asset/AmpCssCollectionRenderer.php
@@ -343,7 +343,7 @@ class AmpCssCollectionRenderer extends CssCollectionRenderer {
       $last = $path;
       $path = preg_replace('`(^|/)(?!\.\./)([^/]+)/\.\./`', '$1', $path);
     }
-    return 'url(' . file_url_transform_relative(file_create_url($path)) . ')';
+    return 'url(' . \Drupal::service('file_url_generator')->generateString($path) . ')';
   }
 
 }
diff --git a/src/EventSubscriber/AmpEventSubscriber.php b/src/EventSubscriber/AmpEventSubscriber.php
index 5913787..2e7b276 100644
--- a/src/EventSubscriber/AmpEventSubscriber.php
+++ b/src/EventSubscriber/AmpEventSubscriber.php
@@ -2,8 +2,8 @@
 
 namespace Drupal\amp\EventSubscriber;
 
+use Symfony\Component\HttpKernel\Event\ViewEvent;
 use Symfony\Component\EventDispatcher\EventSubscriberInterface;
-use Symfony\Component\HttpKernel\Event\GetResponseForControllerResultEvent;
 use Drupal\Core\EventSubscriber\MainContentViewSubscriber;
 use Symfony\Component\HttpKernel\KernelEvents;
 use Drupal\Core\Routing\RouteMatchInterface;
@@ -45,10 +45,10 @@ class AmpEventSubscriber extends ServiceProviderBase implements EventSubscriberI
   /**
    * Alters the wrapper format if this is an AMP request.
    *
-   * @param \Symfony\Component\HttpKernel\Event\GetResponseForControllerResultEvent $event
+   * @param \Symfony\Component\HttpKernel\Event\ViewEvent $event
    *   The event to process.
    */
-  public function onView(GetResponseForControllerResultEvent $event) {
+  public function onView(ViewEvent $event) {
 
     // Don't interfere if this is a request that does not use html or amp
     // wrapper formats.
diff --git a/src/Routing/AmpContext.php b/src/Routing/AmpContext.php
index 72d33a7..114f6b9 100644
--- a/src/Routing/AmpContext.php
+++ b/src/Routing/AmpContext.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\amp\Routing;
 
+use Drupal\node\NodeInterface;
 use Drupal\Core\DependencyInjection\ServiceProviderBase;
 use Drupal\Core\Config\ConfigFactoryInterface;
 use Drupal\Core\Theme\ThemeManager;
@@ -101,7 +102,7 @@ class AmpContext extends ServiceProviderBase {
     }
     // If we have an entity, we can test it.
     $route_entity = $this->routeEntity($routeMatch);
-    if ($entity instanceof \Drupal\node\NodeInterface || $route_entity instanceof \Drupal\node\NodeInterface) {
+    if ($entity instanceof NodeInterface || $route_entity instanceof NodeInterface) {
       $entity_is_amp = $this->entityIsAmp($entity);
       $route_entity_is_amp = $this->entityIsAmp($route_entity);
       return $entity_is_amp || $route_entity_is_amp;
@@ -206,7 +207,7 @@ class AmpContext extends ServiceProviderBase {
    * @return boolean
    */
   public function entityIsAmp($entity) {
-    if ($entity instanceof \Drupal\node\NodeInterface) {
+    if ($entity instanceof NodeInterface) {
       $type = $entity->getType();
       return $this->entityTypeInfo->isAmpEnabledType($type);
     }
diff --git a/src/Service/AMPService.php b/src/Service/AMPService.php
index 4eb5dd3..9ec394e 100644
--- a/src/Service/AMPService.php
+++ b/src/Service/AMPService.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\amp\Service;
 
+use Drupal\Core\Render\Markup;
 use Drupal\amp\AMP\DrupalAMP;
 use Drupal\Core\DependencyInjection\ServiceProviderBase;
 use Drupal\Core\Messenger\MessengerInterface;
@@ -192,7 +193,7 @@ class AMPService extends ServiceProviderBase  {
   public function devMessage($message, $method = 'addMessage') {
     $user = \Drupal::currentUser();
     if ($this->isDevPage() && $user->hasPermission('administer nodes')) {
-      $rendered_message = \Drupal\Core\Render\Markup::create($message);
+      $rendered_message = Markup::create($message);
       $translated_message = new TranslatableMarkup ('@message', array('@message' => $rendered_message));
       if (method_exists($this->messenger, $method)) {
         $this->messenger->$method($translated_message);
diff --git a/tests/src/Functional/AmpFormatterFacebookTest.php b/tests/src/Functional/AmpFormatterFacebookTest.php
index 8ecc9ce..16d96fa 100644
--- a/tests/src/Functional/AmpFormatterFacebookTest.php
+++ b/tests/src/Functional/AmpFormatterFacebookTest.php
@@ -35,7 +35,7 @@ class AmpFormatterFacebookTest extends AmpFormatterTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     // Add field to the test content type.
diff --git a/tests/src/Functional/AmpFormatterImageCarouselTest.php b/tests/src/Functional/AmpFormatterImageCarouselTest.php
index 03eda72..d902a6b 100644
--- a/tests/src/Functional/AmpFormatterImageCarouselTest.php
+++ b/tests/src/Functional/AmpFormatterImageCarouselTest.php
@@ -47,7 +47,7 @@ class AmpFormatterImageCarouselTest extends AmpFormatterTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
 
     parent::setUp();
 
diff --git a/tests/src/Functional/AmpFormatterImageTest.php b/tests/src/Functional/AmpFormatterImageTest.php
index 55da492..3f9ec96 100644
--- a/tests/src/Functional/AmpFormatterImageTest.php
+++ b/tests/src/Functional/AmpFormatterImageTest.php
@@ -43,7 +43,7 @@ class AmpFormatterImageTest extends AmpFormatterTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
 
     parent::setUp();
 
diff --git a/tests/src/Functional/AmpFormatterMediaImageTest.php b/tests/src/Functional/AmpFormatterMediaImageTest.php
index 36424b4..1bdf2a5 100644
--- a/tests/src/Functional/AmpFormatterMediaImageTest.php
+++ b/tests/src/Functional/AmpFormatterMediaImageTest.php
@@ -44,7 +44,7 @@ class AmpFormatterMediaImageTest extends AmpFormatterTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     // Create an image media type.
diff --git a/tests/src/Functional/AmpFormatterTestBase.php b/tests/src/Functional/AmpFormatterTestBase.php
index b42a6da..54c59c5 100644
--- a/tests/src/Functional/AmpFormatterTestBase.php
+++ b/tests/src/Functional/AmpFormatterTestBase.php
@@ -63,7 +63,7 @@ abstract class AmpFormatterTestBase extends AmpTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
     if (empty($this->fieldName)) {
       $this->fieldName = strtolower($this->randomMachineName());
diff --git a/tests/src/Functional/AmpFormatterTwitterTest.php b/tests/src/Functional/AmpFormatterTwitterTest.php
index 5a1ece5..c92fbf0 100644
--- a/tests/src/Functional/AmpFormatterTwitterTest.php
+++ b/tests/src/Functional/AmpFormatterTwitterTest.php
@@ -35,7 +35,7 @@ class AmpFormatterTwitterTest extends AmpFormatterTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     // Add field to the test content type.
diff --git a/tests/src/Functional/AmpFormatterVideoTest.php b/tests/src/Functional/AmpFormatterVideoTest.php
index 0766ea4..db26b08 100644
--- a/tests/src/Functional/AmpFormatterVideoTest.php
+++ b/tests/src/Functional/AmpFormatterVideoTest.php
@@ -45,7 +45,7 @@ class AmpFormatterVideoTest extends AmpFormatterTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
 
     parent::setUp();
 
diff --git a/tests/src/Functional/AmpTestBase.php b/tests/src/Functional/AmpTestBase.php
index c2faea5..366d1f7 100644
--- a/tests/src/Functional/AmpTestBase.php
+++ b/tests/src/Functional/AmpTestBase.php
@@ -105,7 +105,7 @@ abstract class AmpTestBase extends BrowserTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
 
     parent::setUp();
 
diff --git a/tests/src/Functional/BasicTestCaseBase.php b/tests/src/Functional/BasicTestCaseBase.php
index 01fb7a9..0309cec 100644
--- a/tests/src/Functional/BasicTestCaseBase.php
+++ b/tests/src/Functional/BasicTestCaseBase.php
@@ -31,7 +31,7 @@ abstract class BasicTestCaseBase extends BrowserTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     // Make sure to complete the normal setup steps first.
     parent::setUp();
 
@@ -53,7 +53,7 @@ abstract class BasicTestCaseBase extends BrowserTestBase {
     $this->assertSession()->statusCodeEquals(200);
 
     // Confirm that the front page contains the standard text.
-    $this->assertText('Welcome to Drupal');
+    $this->assertSession()->pageTextContains('Welcome to Drupal');
   }
 
 }
