diff --git a/gutenberg.module b/gutenberg.module
index 69e7d45..39ed710 100644
--- a/gutenberg.module
+++ b/gutenberg.module
@@ -833,7 +833,7 @@ function _gutenberg_get_default_theme_settings() {
 
   if (!isset($settings)) {
     $theme_name = \Drupal::config('system.theme')->get('default');
-    $theme_path = drupal_get_path('theme', $theme_name);
+    $theme_path = \Drupal::service('extension.list.theme')->getPath($theme_name);
 
     $file_path = DRUPAL_ROOT . '/' . $theme_path . '/' . $theme_name . '.gutenberg.yml';
     if (file_exists($file_path)) {
diff --git a/src/DataProvider/BaseDataProvider.php b/src/DataProvider/BaseDataProvider.php
index 39a481b..5b32962 100644
--- a/src/DataProvider/BaseDataProvider.php
+++ b/src/DataProvider/BaseDataProvider.php
@@ -92,7 +92,7 @@ abstract class BaseDataProvider implements DataProviderInterface {
     foreach ($styles as $style) {
       /** @var \Drupal\image\Entity\ImageStyle $style */
       $sizes[$style->getName()] = [
-        'source_url' => file_url_transform_relative($style->buildUrl($uri)),
+        'source_url' => \Drupal::service('file_url_generator')->transformRelative($style->buildUrl($uri)),
       ];
     }
 
diff --git a/src/DataProvider/FileEntityDataProvider.php b/src/DataProvider/FileEntityDataProvider.php
index 429eac0..c2206ba 100644
--- a/src/DataProvider/FileEntityDataProvider.php
+++ b/src/DataProvider/FileEntityDataProvider.php
@@ -22,7 +22,7 @@ class FileEntityDataProvider extends BaseDataProvider {
 
     /** @var \Drupal\file\FileInterface $entity */
     $uri = $entity->getFileUri();
-    $source_url = file_url_transform_relative(file_create_url($uri));
+    $source_url = \Drupal::service('file_url_generator')->generateString($uri);
     $image = $this->imageFactory->get($uri);
     $file_data = $this->getFileData($entity->id());
 
diff --git a/src/DataProvider/MediaEntityDataProvider.php b/src/DataProvider/MediaEntityDataProvider.php
index 6336d4a..52d6c57 100644
--- a/src/DataProvider/MediaEntityDataProvider.php
+++ b/src/DataProvider/MediaEntityDataProvider.php
@@ -22,7 +22,7 @@ class MediaEntityDataProvider extends BaseDataProvider {
 
     /** @var \Drupal\file\FileInterface $entity */
     $uri = $entity->getFileUri();
-    $source_url = file_url_transform_relative(file_create_url($uri));
+    $source_url = \Drupal::service('file_url_generator')->generateString($uri);
     $file_data = $this->getFileData($entity->id());
 
     $result = [
diff --git a/src/MediaUploader.php b/src/MediaUploader.php
index f7566ce..baa4d6d 100644
--- a/src/MediaUploader.php
+++ b/src/MediaUploader.php
@@ -45,7 +45,7 @@ class MediaUploader implements MediaUploaderInterface {
     // @todo: find better solution for saving file itself.
     $data = file_get_contents($uploaded_file->getPathname());
     $file_name = $this->getRandomFileName($uploaded_file->getClientOriginalExtension() ?: '');
-    $file = file_save_data($data, "{$directory}/{$file_name}", FileSystemInterface::EXISTS_RENAME);
+    $file = \Drupal::service('file.repository')->writeData($data, "{$directory}/{$file_name}", FileSystemInterface::EXISTS_RENAME);
     $file->setTemporary();
     $file->setFilename($uploaded_file->getClientOriginalName());
 
