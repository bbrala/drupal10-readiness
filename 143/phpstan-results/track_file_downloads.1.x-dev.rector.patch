diff --git a/tests/src/Functional/TrackFileDownloadsFunctionalTest.php b/tests/src/Functional/TrackFileDownloadsFunctionalTest.php
index 2d35b36..9dd1142 100644
--- a/tests/src/Functional/TrackFileDownloadsFunctionalTest.php
+++ b/tests/src/Functional/TrackFileDownloadsFunctionalTest.php
@@ -88,7 +88,7 @@ class TrackFileDownloadsFunctionalTest extends BrowserTestBase {
     /** @var \Drupal\track_file_downloads\Entity\FileTrackerInterface $tracker */
     $tracker = reset($entities);
     $this->assertDownloadCount(0, $tracker->id());
-    $url = Url::fromUri(file_create_url($tracker->getFile()->getFileUri()));
+    $url = \Drupal::service('file_url_generator')->generate($tracker->getFile()->getFileUri());
     $this->drupalGet($url);
     $this->assertDownloadCount(1, $tracker->id());
     $this->grantPermissions(Role::load(RoleInterface::AUTHENTICATED_ID), ['skip file tracking']);
