modules/contrib/photos/photos.install
modules/contrib/photos/photos_access/photos_access.install
modules/contrib/photos/src/Entity/PhotosImage.php
modules/contrib/photos/src/PhotosViewsData.php
modules/contrib/photos/tests/src/Functional/AddPhotosAlbumImageTest.php
modules/contrib/photos/photos_access/photos_access.module
modules/contrib/photos/src/Plugin/Block/PhotosInformation.php
modules/contrib/photos/photos.module
modules/contrib/photos/src/Plugin/Field/FieldFormatter/PhotosAlbumCoverImageFormatter.php
modules/contrib/photos/tests/src/Kernel/CreatePhotosAlbumTest.php
modules/contrib/photos/src/Plugin/Field/FieldFormatter/PhotosAlbumFormatter.php
modules/contrib/photos/tests/src/Unit/PhotosAlbumTest.php
modules/contrib/photos/src/Plugin/Field/FieldFormatter/PhotosImageMediaFieldFormatter.php
modules/contrib/photos/src/Plugin/Filter/PhotosFilter.php
modules/contrib/photos/src/Plugin/Search/PhotosImageSearch.php
modules/contrib/photos/src/Entity/PhotosRouteProvider.php
modules/contrib/photos/src/Form/PhotosAdminSettingsForm.php
modules/contrib/photos/src/Plugin/media/Source/Photos.php
modules/contrib/photos/src/Plugin/migrate/destination/Photos.php
modules/contrib/photos/src/Plugin/migrate/destination/PhotosComment.php
modules/contrib/photos/src/Plugin/migrate/destination/PhotosCount.php
modules/contrib/photos/src/Plugin/migrate/destination/PhotosImage.php
modules/contrib/photos/src/Plugin/migrate/source/Photos.php
modules/contrib/photos/src/Plugin/migrate/source/PhotosComment.php
modules/contrib/photos/src/Plugin/migrate/source/PhotosCount.php
modules/contrib/photos/src/Plugin/migrate/source/PhotosImage.php
modules/contrib/photos/photos_access/src/Controller/DefaultController.php
modules/contrib/photos/src/Plugin/views/field/PhotosImageCover.php
modules/contrib/photos/photos_access/src/Form/PhotosAccessPasswordForm.php
modules/contrib/photos/photos_access/src/Plugin/migrate/destination/PhotosAccess.php
modules/contrib/photos/src/Form/PhotosAdminStructureForm.php
modules/contrib/photos/photos_access/src/Plugin/migrate/destination/PhotosAccessUser.php
modules/contrib/photos/src/Plugin/views/field/PhotosImageSetCover.php
modules/contrib/photos/photos_access/src/Plugin/migrate/source/PhotosAccess.php
modules/contrib/photos/photos_access/src/Plugin/migrate/source/PhotosAccessUser.php
modules/contrib/photos/src/Routing/PhotosRouteSubscriber.php
modules/contrib/photos/photos_access/src/Plugin/views/access/PhotosAccess.php
modules/contrib/photos/src/Form/PhotosDirectoryImportForm.php
modules/contrib/photos/photos_access/tests/src/Functional/PhotosAccessTest.php
modules/contrib/photos/src/Form/PhotosImageAddForm.php
modules/contrib/photos/photos.post_update.php
modules/contrib/photos/src/Form/PhotosImageDeleteForm.php
modules/contrib/photos/src/Form/PhotosImageEditForm.php
modules/contrib/photos/src/Controller/PhotosAlbumController.php
modules/contrib/photos/src/Form/PhotosMediaLibraryForm.php
modules/contrib/photos/src/Form/PhotosUploadForm.php
modules/contrib/photos/src/Controller/PhotosEditController.php
modules/contrib/photos/src/Controller/PhotosImageViewController.php
modules/contrib/photos/src/Controller/PhotosLegacyAlbumViewController.php
modules/contrib/photos/src/PhotosAccessControlHandler.php
modules/contrib/photos/src/PhotosAlbum.php
modules/contrib/photos/src/Controller/PhotosLegacyImageViewController.php
modules/contrib/photos/src/Controller/PhotosRearrangeController.php
modules/contrib/photos/src/Controller/PhotosStatisticsUpdateController.php
modules/contrib/photos/src/PhotosImage.php
modules/contrib/photos/src/PhotosImageInterface.php
modules/contrib/photos/src/PhotosImageListBuilder.php
modules/contrib/photos/src/PhotosImageStorage.php
modules/contrib/photos/src/PhotosImageStorageInterface.php
modules/contrib/photos/src/PhotosImageStorageSchema.php
modules/contrib/photos/src/PhotosUpload.php
modules/contrib/photos/src/PhotosUploadInterface.php

7 files with changes
====================

1) modules/contrib/photos/tests/src/Kernel/CreatePhotosAlbumTest.php:30

    ---------- begin diff ----------
@@ @@
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();

     $this->installConfig(['system']);
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * WrapReturnRector
 * AddReturnTypeDeclarationRector
 * ChangeMethodVisibilityRector


2) modules/contrib/photos/tests/src/Functional/AddPhotosAlbumImageTest.php:41

    ---------- begin diff ----------
@@ @@
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
     // Create user with permissions to edit own photos.
     $this->account = $this->drupalCreateUser([
@@ @@
     $album->save();

     // Get test image file.
-    $testPhotoUri = drupal_get_path('module', 'photos') . '/tests/images/photos-test-picture.jpg';
+    $testPhotoUri = \Drupal::service('extension.list.module')->getPath('photos') . '/tests/images/photos-test-picture.jpg';
     $fileSystem = \Drupal::service('file_system');

     // Post image upload form.
@@ @@

     // Test recent albums content overview.
     $this->drupalGet('photos');
-    $this->assertResponse(200);
-    $this->assertText($albumTitle);
+    $this->assertSession()->statusCodeEquals(200);
+    $this->assertSession()->pageTextContains($albumTitle);

   }
    ----------- end diff -----------

Applied rules:
 * AssertResponseRector
 * AssertTextRector
 * DrupalGetPathRector
 * ArgumentRemoverRector
 * WrapReturnRector
 * AddReturnTypeDeclarationRector
 * ChangeMethodVisibilityRector


3) modules/contrib/photos/photos.module:0

    ---------- begin diff ----------
@@ @@
 <?php

+use Drupal\photos\PhotosImage;
 /**
  * @file
  * Implementation of photos.module.
@@ @@
     // If private create temporary derivative.
     if ($scheme == 'private') {
       // @todo update this, get width and height.
-      $photos_image = new \Drupal\photos\PhotosImage($image['file']->id());
+      $photos_image = new PhotosImage($image['file']->id());
       $url = $photos_image->derivative($uri, $styleName, $scheme);
       // Do not use filename as alt or title with private files.
       $filename = $image['file']->getFilename();
@@ @@
       if (!file_exists($styleUri)) {
         $style->createDerivative($uri, $styleUri);
       }
-      $url = file_create_url($styleUri);
+      $url = \Drupal::service('file_url_generator')->generateAbsoluteString($styleUri);
     }

     // Render image view.
@@ @@
       elseif (!strstr($set['id'], ',')) {
         if ($mat[1] == 'image') {
           $set['style_name'] = $style_name;
-          $photos_image = new \Drupal\photos\PhotosImage($set['id']);
+          $photos_image = new PhotosImage($set['id']);
           $image_view = $photos_image->view();
           $value = \Drupal::service('renderer')->render($image_view);
         }
@@ @@
               foreach ($result as $image) {
                 // @todo use view mode instead?
                 $set['style_name'] = $style_name;
-                $photos_image = new \Drupal\photos\PhotosImage($image->fid);
+                $photos_image = new PhotosImage($image->fid);
                 $image_view = $photos_image->view($style_name);
                 $value .= \Drupal::service('renderer')->render($image_view);
               }
@@ @@
               // @todo get album url.
               $set['href'] = 'node/' . $album->album_id;
               $set['style_name'] = $style_name;
-              $photos_image = new \Drupal\photos\PhotosImage($album->cover_id);
+              $photos_image = new PhotosImage($album->cover_id);
               $image_view = $photos_image->view($style_name, $set);
               $value = \Drupal::service('renderer')->render($image_view);
             }
@@ @@
                 ->orderBy('f.fid', 'DESC');
               $image = $query->execute()->fetchObject();
               $set['style_name'] = $style_name;
-              $photos_image = new \Drupal\photos\PhotosImage($image->fid);
+              $photos_image = new PhotosImage($image->fid);
               $image_view = $photos_image->view();
               $value = \Drupal::service('renderer')->render($image_view);
             }
@@ @@
           ->execute();
         foreach ($result as $image) {
           $set['style_name'] = $style_name;
-          $photos_image = new \Drupal\photos\PhotosImage($image->fid);
+          $photos_image = new PhotosImage($image->fid);
           $image_view = $photos_image->view();
           $value .= \Drupal::service('renderer')->render($image_view);
         }
    ----------- end diff -----------

Applied rules:
 * FileCreateUrlRector
 * ArgumentRemoverRector


4) modules/contrib/photos/photos_access/tests/src/Functional/PhotosAccessTest.php:65

    ---------- begin diff ----------
@@ @@
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();

     // Create admin user and adjust photos admin settings. This user will also
@@ @@
     $storage = $this->container->get('entity_type.manager')->getStorage('node');
     // Create a locked photos node.
     $this->drupalGet('/node/add/photos');
-    $this->assertResponse(200);
+    $this->assertSession()->statusCodeEquals(200);
     $edit = [
       'title[0][value]' => $this->randomMachineName(),
       'privacy[viewid]' => 1,
@@ @@
     $storage = $this->container->get('entity_type.manager')->getStorage('node');
     $this->album = $storage->load(1);
     $this->assertNotNull($this->album->privacy);
-    $this->assertEqual($this->album->privacy['viewid'], 1, 'Album is set to locked.');
+    $this->assertEquals($this->album->privacy['viewid'], 1, 'Album is set to locked.');

     // Get test image file.
     /** @var \Drupal\Core\File\FileSystemInterface $fileSystem */
     $fileSystem = \Drupal::service('file_system');
-    $testImageFile = drupal_get_path('module', 'photos') . '/tests/images/photos-test-picture.jpg';
+    $testImageFile = \Drupal::service('extension.list.module')->getPath('photos') . '/tests/images/photos-test-picture.jpg';
     // Add image to album.
     $edit = [
       'files[images_0]' => $fileSystem->realpath($testImageFile),
     ];
     $this->drupalGet('node/' . $this->album->id() . '/photos');
-    $this->assertResponse(200);
+    $this->assertSession()->statusCodeEquals(200);
     $this->submitForm($edit, 'Confirm upload');
   }

@@ @@

     // Node page should redirect to password required page.
     $this->drupalGet('node/' . $photosImage->getAlbumId());
-    $this->assertResponse(200);
-    $this->assertText('Please enter password');
+    $this->assertSession()->statusCodeEquals(200);
+    $this->assertSession()->pageTextContains('Please enter password');
     // Image page should redirect to password required page.
     $this->drupalGet('photos/' . $photosImage->getAlbumId() . '/' . $photosImage->id());
-    $this->assertResponse(200);
-    $this->assertText('Please enter password');
+    $this->assertSession()->statusCodeEquals(200);
+    $this->assertSession()->pageTextContains('Please enter password');
     // Raw image path should redirect to password required page.
     $this->drupalGet($file->createFileUrl());
-    $this->assertResponse(200);
-    $this->assertText('Please enter password');
+    $this->assertSession()->statusCodeEquals(200);
+    $this->assertSession()->pageTextContains('Please enter password');
     // Album views page should redirect to password required page.
     $this->drupalGet('photos/views-test/' . $photosImage->getAlbumId());
-    $this->assertResponse(200);
-    $this->assertText('Please enter password');
+    $this->assertSession()->statusCodeEquals(200);
+    $this->assertSession()->pageTextContains('Please enter password');
     // Test wrong password.
     $edit = [
       'pass' => 'wrong password',
     ];
     $this->submitForm($edit, 'Submit');
-    $this->assertText('Password required');
+    $this->assertSession()->pageTextContains('Password required');
     // Test correct password.
     $edit = [
       'pass' => 'test',
@@ @@
     ];
     $this->submitForm($edit, 'Submit');
     // Check if album page is visible.
-    $this->assertResponse(200);
-    $this->assertText($this->album->getTitle());
+    $this->assertSession()->statusCodeEquals(200);
+    $this->assertSession()->pageTextContains($this->album->getTitle());
     // Node edit page should be access denied.
     $this->drupalGet('node/' . $photosImage->getAlbumId() . '/edit');
-    $this->assertResponse(403);
+    $this->assertSession()->statusCodeEquals(403);

     // Test role access.
     $edit = [
@@ @@
     $this->drupalGet('node/' . $this->album->id() . '/edit');
     if (isset($edit['privacy[viewid]']) && $edit['privacy[viewid]'] == 4) {
       // Check if role access option is enabled.
-      $this->assertText('Role access');
+      $this->assertSession()->pageTextContains('Role access');
     }
     $this->submitForm($edit, 'Save');
     /** @var \Drupal\Core\Entity\ContentEntityStorageInterface $storage */
@@ @@
     // Update album variable.
     $this->album = $storage->load($this->album->id());
     if (isset($edit['privacy[viewid]'])) {
-      $this->assertEqual($this->album->privacy['viewid'], $edit['privacy[viewid]'], 'Album privacy settings updated successfully.');
+      $this->assertEquals($this->album->privacy['viewid'], $edit['privacy[viewid]'], 'Album privacy settings updated successfully.');
     }
   }

@@ @@
   public function checkAlbumAccess(PhotosImage $photosImage, $viewCode = 200, $editCode = 403, $fileUrl = NULL) {
     if ($fileUrl) {
       $this->drupalGet($fileUrl);
-      $this->assertResponse($viewCode);
+      $this->assertSession()->statusCodeEquals($viewCode);
     }
     // View image page.
     $this->drupalGet('photos/' . $photosImage->getAlbumId() . '/' . $photosImage->id());
-    $this->assertResponse($viewCode);
+    $this->assertSession()->statusCodeEquals($viewCode);
     // Views album page.
     $this->drupalGet('photos/views-test/' . $photosImage->getAlbumId());
-    $this->assertResponse($viewCode);
+    $this->assertSession()->statusCodeEquals($viewCode);
     // View node page.
     $this->drupalGet('node/' . $photosImage->getAlbumId());
-    $this->assertResponse($viewCode);
+    $this->assertSession()->statusCodeEquals($viewCode);
     // Edit node page.
     $this->drupalGet('node/' . $photosImage->getAlbumId() . '/edit');
-    $this->assertResponse($editCode);
+    $this->assertSession()->statusCodeEquals($editCode);
   }

 }
    ----------- end diff -----------

Applied rules:
 * AssertEqualRector
 * AssertResponseRector
 * AssertTextRector
 * DrupalGetPathRector
 * ArgumentRemoverRector
 * WrapReturnRector
 * AddReturnTypeDeclarationRector
 * ChangeMethodVisibilityRector


5) modules/contrib/photos/photos_access/photos_access.module:145

    ---------- begin diff ----------
@@ @@
           $form['privacy']['viewremove'][$u['target_id']] = [
             '#type' => 'checkbox',
             '#default_value' => isset($node->viewremove[$u['target_id']]) ? $node->viewremove[$u['target_id']] : '',
-            '#title' => t('Delete: @name', ['@name' => render($u['username'])]),
+            '#title' => t('Delete: @name', ['@name' => \Drupal::service('renderer')->render($u['username'])]),
             '#prefix' => '<div id="photos-access-remove"' . $classes . '>',
             '#suffix' => '</div>',
           ];
@@ @@
           $form['privacy']['updateremove'][$u['target_id']] = [
             '#type' => 'checkbox',
             '#default_value' => isset($node->updateremove[$u['target_id']]) ? $node->updateremove[$u['target_id']] : '',
-            '#title' => t('Delete: @name', ['@name' => render($u['username'])]),
+            '#title' => t('Delete: @name', ['@name' => \Drupal::service('renderer')->render($u['username'])]),
             '#prefix' => '<div id="photos_access_updateremove" class="photos-access-update-remove">',
             '#suffix' => '</div>',
           ];
@@ @@
           $new_uri = str_replace($old_file_wrapper, $file_wrapper, $file->getFileUri());
           $dirname = $file_system->dirname($new_uri);
           $file_system->prepareDirectory($dirname, FileSystemInterface::CREATE_DIRECTORY);
-          file_move($file, $new_uri);
+          \Drupal::service('file.repository')->move($file, $new_uri);
           // Clear image page cache.
           $cache_tags[] = 'photos:image:' . $fid;
         }
@@ @@
             $new_uri = str_replace($old_file_wrapper, $file_wrapper, $file->getFileUri());
             $dirname = $file_system->dirname($new_uri);
             $file_system->prepareDirectory($dirname, FileSystemInterface::CREATE_DIRECTORY);
-            file_move($file, $new_uri);
+            \Drupal::service('file.repository')->move($file, $new_uri);
           }
         }
       }
    ----------- end diff -----------

Applied rules:
 * FileMoveRector
 * RenderRector
 * ArgumentRemoverRector


6) modules/contrib/photos/src/PhotosUpload.php:332

    ---------- begin diff ----------
@@ @@
           $ext = end($filename_parts);
           if (in_array($ext, $fileType)) {
             $path = $this->fileSystem->createFilename($image['name'], $this->path($scheme));
-            if ($temp_file = file_save_data($zip->getFromIndex($x), $path)) {
+            if ($temp_file = \Drupal::service('file.repository')->writeData($zip->getFromIndex($x), $path)) {
               // Update file values.
               $temp_file->album_id = $params['album_id'];
               $temp_file->nid = $params['nid'];
    ----------- end diff -----------

Applied rules:
 * FileSaveDataRector
 * ArgumentRemoverRector
 * WrapReturnRector


7) modules/contrib/photos/src/PhotosImage.php:150

    ---------- begin diff ----------
@@ @@
     $style->createDerivative($uri, $destination);

     // Return URL.
-    return file_create_url($destination);
+    return \Drupal::service('file_url_generator')->generateAbsoluteString($destination);
   }

   /**
@@ @@
         $image_url = ImageStyle::load($style_name)->buildUrl($uri);
       }
       else {
-        $image_url = file_create_url($uri);
+        $image_url = \Drupal::service('file_url_generator')->generateAbsoluteString($uri);
       }
     }
     else {
    ----------- end diff -----------

Applied rules:
 * FileCreateUrlRector
 * ArgumentRemoverRector
 * WrapReturnRector


 [OK] 7 files have been changed by Rector                                       

