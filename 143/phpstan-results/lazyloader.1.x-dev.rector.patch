diff --git a/lazyloader.module b/lazyloader.module
index 3eb802d..0315d22 100644
--- a/lazyloader.module
+++ b/lazyloader.module
@@ -96,13 +96,13 @@ function lazyloader_preprocess_image(&$vars) {
   }
 
   $vars['attributes']['class'][] = 'lazyload';
-  $vars['attributes']['src'] = file_create_url($image_placeholder_src);
+  $vars['attributes']['src'] = \Drupal::service('file_url_generator')->generateAbsoluteString($image_placeholder_src);
 
   if (isset($responsive_image)) {
     $vars['attributes']['data-srcset'] = $responsive_image->__toString();
   }
   else {
-    $vars['attributes']['data-src'] = file_create_url($uri);
+    $vars['attributes']['data-src'] = \Drupal::service('file_url_generator')->generateAbsoluteString($uri);
   }
 
 }
diff --git a/src/tests/TestBase.php b/src/tests/TestBase.php
index 5af271d..539d15e 100644
--- a/src/tests/TestBase.php
+++ b/src/tests/TestBase.php
@@ -34,7 +34,7 @@ abstract class TestBase extends BrowserTestBase {
   /**
    * {@inheritdoc}
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
 
     $this->createContentType([
diff --git a/tests/src/Kernel/ThemeTest.php b/tests/src/Kernel/ThemeTest.php
index 8f35ca9..3c6bf51 100644
--- a/tests/src/Kernel/ThemeTest.php
+++ b/tests/src/Kernel/ThemeTest.php
@@ -56,7 +56,7 @@ class ThemeTest extends KernelTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->installEntitySchema('node');
@@ -297,7 +297,7 @@ class ThemeTest extends KernelTestBase {
     $renderer = \Drupal::service('renderer');
 
     $image = $this->node->field_images;
-    $path = file_url_transform_relative(file_create_url($image->entity->uri->value));
+    $path = \Drupal::service('file_url_generator')->generateString($image->entity->uri->value);
 
     \Drupal::configFactory()->getEditable('lazyloader.configuration')
       ->set('enabled', TRUE)
