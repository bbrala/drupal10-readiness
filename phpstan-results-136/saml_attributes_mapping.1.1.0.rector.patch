diff --git a/saml_attributes_mapping.module b/saml_attributes_mapping.module
index 19ded12..5be573d 100644
--- a/saml_attributes_mapping.module
+++ b/saml_attributes_mapping.module
@@ -127,7 +127,7 @@ function saml_attributes_mapping_simplesamlphp_auth_user_attributes(UserInterfac
 
             try {
               $data = (string) \Drupal::httpClient()->get($url)->getBody();
-              $user_image = file_save_data($data, $uri, FILE_EXISTS_REPLACE);
+              $user_image = \Drupal::service('file.repository')->writeData($data, $uri, \Drupal\Core\File\FileSystemInterface::EXISTS_REPLACE);
               if ($user_image && $user_image->id()) {
                 $filed_values = [
                   'target_id' => $user_image->id(),
diff --git a/src/Form/AttributesMappingForm.php b/src/Form/AttributesMappingForm.php
index 4eaa301..5b85986 100644
--- a/src/Form/AttributesMappingForm.php
+++ b/src/Form/AttributesMappingForm.php
@@ -89,7 +89,7 @@ class AttributesMappingForm extends ConfigFormBase {
       if (count($attributes) === 1) {
         $add_item = Url::fromRoute('saml_attributes_mapping.settings_attributes');
         $message = $this->t('There are no SAML attributes configured yet.');
-        $form['mapping']['#empty'] = SafeMarkup::format($message . ' ' . $this->l($this->t('Add an item'), $add_item), []);
+        $form['mapping']['#empty'] = new \Drupal\Component\Render\FormattableMarkup($message . ' ' . $this->l($this->t('Add an item'), $add_item), []);
         unset($form['actions']);
       }
       else {
