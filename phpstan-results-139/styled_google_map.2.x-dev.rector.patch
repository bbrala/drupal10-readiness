diff --git a/modules/data/demo.batch.inc b/modules/data/demo.batch.inc
index e9cf1a6..9b311f5 100644
--- a/modules/data/demo.batch.inc
+++ b/modules/data/demo.batch.inc
@@ -1,5 +1,6 @@
 <?php
 
+use Drupal\Core\Entity\EntityStorageException;
 /**
  * Imports real estate data from csv data.
  *
@@ -8,7 +9,7 @@
  */
 function import_real_estate($terms, &$context) {
   // Read real estate data.
-  $demo_file = \Drupal::service('file_system')->realpath(drupal_get_path('module', 'styled_google_map_data') .'/csv/demo.csv');
+  $demo_file = \Drupal::service('file_system')->realpath(\Drupal::service('extension.list.module')->getPath('styled_google_map_data') .'/csv/demo.csv');
   $file = new SplFileObject($demo_file, 'r');
   $file->setFlags(SplFileObject::READ_CSV);
   if (empty($context['sandbox'])) {
@@ -39,7 +40,7 @@ function import_real_estate($terms, &$context) {
     ]);
     try {
       $item->save();
-    } catch (\Drupal\Core\Entity\EntityStorageException $e) {
+    } catch (EntityStorageException $e) {
       \Drupal::logger('real_estate')->error($e->getMessage());
     }
   }
diff --git a/modules/data/styled_google_map_data.install b/modules/data/styled_google_map_data.install
index 795b126..7f8de15 100644
--- a/modules/data/styled_google_map_data.install
+++ b/modules/data/styled_google_map_data.install
@@ -5,10 +5,10 @@
  */
 function styled_google_map_data_install() {
   $files = [];
-  $pins = \Drupal::service('file_system')->scanDirectory(drupal_get_path('module', 'styled_google_map_data') . '/images', '/.png/');
+  $pins = \Drupal::service('file_system')->scanDirectory(\Drupal::service('extension.list.module')->getPath('styled_google_map_data') . '/images', '/.png/');
   foreach (array_keys($pins) as $file_path) {
     $file_content = file_get_contents($file_path);
-    $files[] = file_save_data($file_content);
+    $files[] = \Drupal::service('file.repository')->writeData($file_content);
   }
   // Create property types.
   $property_types = [
@@ -36,7 +36,7 @@ function styled_google_map_data_install() {
     ],
     'finished' => 'demo_real_estate_finished',
     'title' => t('Updating depths for all terms'),
-    'file' => drupal_get_path('module', 'styled_google_map_data') . '/demo.batch.inc',
+    'file' => \Drupal::service('extension.list.module')->getPath('styled_google_map_data') . '/demo.batch.inc',
   ]);
 
   // Processes the batch in cli mode.
@@ -63,7 +63,7 @@ function styled_google_map_data_uninstall() {
     ],
     'finished' => 'demo_real_estate_finished',
     'title' => t('Delete real estate'),
-    'file' => drupal_get_path('module', 'styled_google_map_data'). '/demo.batch.inc',
+    'file' => \Drupal::service('extension.list.module')->getPath('styled_google_map_data'). '/demo.batch.inc',
   ]);
 
   // Processes the batch in cli mode.
diff --git a/src/Plugin/views/style/StyledGoogleMapStyle.php b/src/Plugin/views/style/StyledGoogleMapStyle.php
index 1bb70f6..d89578e 100644
--- a/src/Plugin/views/style/StyledGoogleMapStyle.php
+++ b/src/Plugin/views/style/StyledGoogleMapStyle.php
@@ -829,9 +829,9 @@ class StyledGoogleMapStyle extends StylePluginBase {
           }
 
           if (!empty($this->options['default_pin_source'])) {
-            $location['pin'] = file_create_url($this->options['default_pin_source']);
+            $location['pin'] = \Drupal::service('file_url_generator')->generateAbsoluteString($this->options['default_pin_source']);
             if (!empty($this->options['main']['styled_google_map_view_active_pin'])) {
-              $location['active_pin'] = file_create_url($this->options['main']['styled_google_map_view_active_pin']);
+              $location['active_pin'] = \Drupal::service('file_url_generator')->generateAbsoluteString($this->options['main']['styled_google_map_view_active_pin']);
             }
           }
           // Add pin image url.
@@ -841,7 +841,7 @@ class StyledGoogleMapStyle extends StylePluginBase {
             $fileTargetId = $sourceHandler->render($row);
             if ($fileTargetId instanceof ViewsRenderPipelineMarkup) {
               $image = File::load($fileTargetId->__toString());
-              $location['pin'] = file_create_url($image->getFileUri());
+              $location['pin'] = \Drupal::service('file_url_generator')->generateAbsoluteString($image->getFileUri());
               // Add the active pin image.
               if (!empty($this->options['active_pin_source']) && !empty($sourceHandlerOutput[$this->options['active_pin_source']])) {
                 /** @var \Drupal\views\Plugin\views\field\FieldHandlerInterface $sourceHandler */
@@ -849,18 +849,18 @@ class StyledGoogleMapStyle extends StylePluginBase {
                 $fileTargetId = $sourceHandler->render($row);
                 if ($fileTargetId instanceof ViewsRenderPipelineMarkup) {
                   $image = File::load($fileTargetId->__toString());
-                  $location['active_pin'] = file_create_url($image->getFileUri());
+                  $location['active_pin'] = \Drupal::service('file_url_generator')->generateAbsoluteString($image->getFileUri());
                 }
               }
               elseif (empty($this->options['main']['styled_google_map_view_active_pin'])) {
-                $location['active_pin'] = file_create_url($image->getFileUri());
+                $location['active_pin'] = \Drupal::service('file_url_generator')->generateAbsoluteString($image->getFileUri());
               }
               else {
-                $location['active_pin'] = file_create_url($this->options['main']['styled_google_map_view_active_pin']);
+                $location['active_pin'] = \Drupal::service('file_url_generator')->generateAbsoluteString($this->options['main']['styled_google_map_view_active_pin']);
               }
             }
             elseif (!empty($this->options['default_pin_source'])) {
-              $location['pin'] = file_create_url($this->options['default_pin_source']);
+              $location['pin'] = \Drupal::service('file_url_generator')->generateAbsoluteString($this->options['default_pin_source']);
             }
           }
           // Add marker Label.
@@ -909,14 +909,14 @@ class StyledGoogleMapStyle extends StylePluginBase {
     $cluster = [];
 
     if ($this->options['cluster_settings']['cluster_enabled']) {
-      $cluster_pin_image = file_create_url($this->options['cluster_settings']['pin_image']);
+      $cluster_pin_image = \Drupal::service('file_url_generator')->generateAbsoluteString($this->options['cluster_settings']['pin_image']);
       $cluster = ['pin_image' => $cluster_pin_image] + $this->options['cluster_settings'];
     }
 
     // Spider settings.
     $spider = [];
     if ($this->options['spider_settings']['spider_enabled']) {
-      $spider_pin_image = file_create_url($this->options['spider_settings']['pin_image']);
+      $spider_pin_image = \Drupal::service('file_url_generator')->generateAbsoluteString($this->options['spider_settings']['pin_image']);
       $spider = ['pin_image' => $spider_pin_image] + $this->options['spider_settings'];
     }
     // Heat map settings.
@@ -970,7 +970,7 @@ class StyledGoogleMapStyle extends StylePluginBase {
           'hide_close_button' => $this->options['popup']['styled_google_map_view_hide_close_button'] ? TRUE : FALSE,
           'shadow_style' => $this->options['popup']['styled_google_map_view_shadow_style'],
           'padding' => $this->options['popup']['styled_google_map_view_padding'],
-          'close_button_source' => !empty($this->options['popup']['close_button_source']) ? file_create_url($this->options['popup']['close_button_source']) : FALSE,
+          'close_button_source' => !empty($this->options['popup']['close_button_source']) ? \Drupal::service('file_url_generator')->generateAbsoluteString($this->options['popup']['close_button_source']) : FALSE,
           'border_radius' => $this->options['popup']['styled_google_map_view_border_radius'],
           'border_width' => $this->options['popup']['styled_google_map_view_border_width'],
           'border_color' => $this->options['popup']['styled_google_map_view_border_color'],
diff --git a/styled_google_map.module b/styled_google_map.module
index 0042604..0eaec87 100755
--- a/styled_google_map.module
+++ b/styled_google_map.module
@@ -59,7 +59,7 @@ function styled_google_map_preprocess_styled_google_map(&$variables) {
 
   // Get the pin file url.
   if (isset($settings['style']['pin']) && !empty($settings['style']['pin'])) {
-    $settings['style']['pin'] = file_create_url($settings['style']['pin']);
+    $settings['style']['pin'] = \Drupal::service('file_url_generator')->generateAbsoluteString($settings['style']['pin']);
   }
   // Sanitize the output of the style settings.
   foreach ($settings['style'] as $id => $setting) {
@@ -92,7 +92,7 @@ function styled_google_map_preprocess_styled_google_map(&$variables) {
       default:
         $popup_field = [];
     }
-    $location['popup'] = render($popup_field);
+    $location['popup'] = \Drupal::service('renderer')->render($popup_field);
   }
   else {
     // Not an entity object.
