diff --git a/modules/ctools_block/tests/src/Functional/EntityFieldBlockTest.php b/modules/ctools_block/tests/src/Functional/EntityFieldBlockTest.php
index 96af621c..d4bc7f5e 100644
--- a/modules/ctools_block/tests/src/Functional/EntityFieldBlockTest.php
+++ b/modules/ctools_block/tests/src/Functional/EntityFieldBlockTest.php
@@ -89,8 +89,8 @@ class EntityFieldBlockTest extends BrowserTestBase {
       $url = $this->container->get('file_url_generator')->transformRelative($url);
     }
     else {
-      $url = file_create_url($url); // @phpstan-ignore-line
-      $url = file_url_transform_relative($url); // @phpstan-ignore-line
+      $url = \Drupal::service('file_url_generator')->generateAbsoluteString($url); // @phpstan-ignore-line
+      $url = \Drupal::service('file_url_generator')->transformRelative($url); // @phpstan-ignore-line
     }
     $this->assertSession()->responseContains('src="' . $url . '"');
   }
diff --git a/modules/ctools_entity_mask/tests/src/Functional/DisplayTest.php b/modules/ctools_entity_mask/tests/src/Functional/DisplayTest.php
index b59ed2dd..945eba67 100644
--- a/modules/ctools_entity_mask/tests/src/Functional/DisplayTest.php
+++ b/modules/ctools_entity_mask/tests/src/Functional/DisplayTest.php
@@ -115,8 +115,8 @@ class DisplayTest extends BrowserTestBase {
       $image_url = $this->container->get('file_url_generator')->transformRelative($image_url);
     }
     else {
-      $image_url = file_create_url($image_url); // @phpstan-ignore-line
-      $image_url = file_url_transform_relative($image_url); // @phpstan-ignore-line
+      $image_url = \Drupal::service('file_url_generator')->generateAbsoluteString($image_url); // @phpstan-ignore-line
+      $image_url = \Drupal::service('file_url_generator')->transformRelative($image_url); // @phpstan-ignore-line
     }
     // @todo Use assertStringContainsString() when we rely exclusively on
     // PHPUnit 8.
diff --git a/src/Testing/EntityCreationTrait.php b/src/Testing/EntityCreationTrait.php
index eeb1bed1..d9325ec5 100644
--- a/src/Testing/EntityCreationTrait.php
+++ b/src/Testing/EntityCreationTrait.php
@@ -34,7 +34,7 @@ trait EntityCreationTrait {
     $status = $entity->save();
     \Drupal::service('router.builder')->rebuild();
 
-    if ($this instanceof \PHPUnit_Framework_TestCase) {
+    if ($this instanceof \PHPUnit\Framework\TestCase) {
       // phpcs:ignore
       $this->assertSame(SAVED_NEW, $status, (new FormattableMarkup('Created entity %id of type %type.', ['%id' => $entity->id(), '%type' => $entity_type]))->__toString()); //psp
     }
diff --git a/tests/src/Kernel/BlockDisplayVariantTest.php b/tests/src/Kernel/BlockDisplayVariantTest.php
index d34a6ba7..4c2bc254 100644
--- a/tests/src/Kernel/BlockDisplayVariantTest.php
+++ b/tests/src/Kernel/BlockDisplayVariantTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\ctools\Kernel;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\ctools\Event\BlockVariantEvent;
 use Drupal\ctools\Event\BlockVariantEvents;
 use Drupal\ctools_block_display_test\Plugin\DisplayVariant\BlockDisplayVariant;
@@ -15,6 +16,7 @@ use Symfony\Component\EventDispatcher\EventDispatcherInterface;
  */
 class BlockDisplayVariantTest extends KernelTestBase {
 
+  use ProphecyTrait;
   /**
    * {@inheritdoc}
    */
diff --git a/tests/src/Unit/BlockDisplayVariantTest.php b/tests/src/Unit/BlockDisplayVariantTest.php
index d51cd905..2d4570cc 100644
--- a/tests/src/Unit/BlockDisplayVariantTest.php
+++ b/tests/src/Unit/BlockDisplayVariantTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\ctools\Unit;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Component\Uuid\UuidInterface;
 use Drupal\Core\Block\BlockManager;
 use Drupal\Core\Condition\ConditionManager;
@@ -21,6 +22,7 @@ use Drupal\Tests\UnitTestCase;
  */
 class BlockDisplayVariantTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
    * Tests the submitConfigurationForm() method.
    *
diff --git a/tests/src/Unit/BlockPluginCollectionTest.php b/tests/src/Unit/BlockPluginCollectionTest.php
index 0dda7752..abcae5fb 100644
--- a/tests/src/Unit/BlockPluginCollectionTest.php
+++ b/tests/src/Unit/BlockPluginCollectionTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\ctools\Unit;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Core\Block\BlockManagerInterface;
 use Drupal\Core\Block\BlockPluginInterface;
 use Drupal\ctools\Plugin\BlockPluginCollection;
@@ -16,6 +17,7 @@ use Drupal\Tests\UnitTestCase;
  */
 class BlockPluginCollectionTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
    * Tests the getAllByRegion() method.
    *
diff --git a/tests/src/Unit/BlockVariantTraitTest.php b/tests/src/Unit/BlockVariantTraitTest.php
index f339e41e..09361502 100644
--- a/tests/src/Unit/BlockVariantTraitTest.php
+++ b/tests/src/Unit/BlockVariantTraitTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\ctools\Unit;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Component\Uuid\UuidInterface;
 use Drupal\ctools\Plugin\BlockPluginCollection;
 use Drupal\ctools\Plugin\BlockVariantTrait;
@@ -16,6 +17,7 @@ use Drupal\Tests\UnitTestCase;
  */
 class BlockVariantTraitTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
    * Tests the getRegionAssignments() method.
    *
diff --git a/tests/src/Unit/ContextMapperTest.php b/tests/src/Unit/ContextMapperTest.php
index 9c70bb3e..4c5af07e 100644
--- a/tests/src/Unit/ContextMapperTest.php
+++ b/tests/src/Unit/ContextMapperTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\ctools\Unit;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Core\DependencyInjection\ContainerBuilder;
 use Drupal\Core\Entity\EntityRepositoryInterface;
 use Drupal\Core\Plugin\Context\Context;
@@ -21,6 +22,7 @@ use Drupal\Tests\UnitTestCase;
  */
 class ContextMapperTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
    * The typed data manager.
    *
diff --git a/tests/src/Unit/VariantCollectionTraitTest.php b/tests/src/Unit/VariantCollectionTraitTest.php
index d4ff1a4e..880abf55 100644
--- a/tests/src/Unit/VariantCollectionTraitTest.php
+++ b/tests/src/Unit/VariantCollectionTraitTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\ctools\Unit;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Component\Plugin\PluginManagerInterface;
 use Drupal\Component\Uuid\UuidInterface;
 use Drupal\Core\DependencyInjection\ContainerBuilder;
@@ -19,8 +20,9 @@ use Drupal\Tests\UnitTestCase;
  */
 class VariantCollectionTraitTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
-   * @var \Drupal\Component\Plugin\PluginManagerInterface|\PHPUnit_Framework_MockObject_MockObject
+   * @var \Drupal\Component\Plugin\PluginManagerInterface|\PHPUnit\Framework\MockObject\MockObject
    */
   protected $manager;
 
