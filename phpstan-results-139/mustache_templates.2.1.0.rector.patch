diff --git a/modules/mustache_magic/src/Plugin/mustache/Magic/Javascript.php b/modules/mustache_magic/src/Plugin/mustache/Magic/Javascript.php
index 3134616..6babf6c 100644
--- a/modules/mustache_magic/src/Plugin/mustache/Magic/Javascript.php
+++ b/modules/mustache_magic/src/Plugin/mustache/Magic/Javascript.php
@@ -85,7 +85,7 @@ class Javascript extends Template {
     }
 
     if (!isset($this->templateName)) {
-      return $render($template_content);
+      return \Drupal::service('renderer')->render($template_content);
     }
 
     $renderer = $this->renderer;
diff --git a/modules/mustache_magic/src/Plugin/mustache/Magic/Library.php b/modules/mustache_magic/src/Plugin/mustache/Magic/Library.php
index 499ad7b..aa06baf 100644
--- a/modules/mustache_magic/src/Plugin/mustache/Magic/Library.php
+++ b/modules/mustache_magic/src/Plugin/mustache/Magic/Library.php
@@ -112,7 +112,7 @@ class Library extends MustacheMagic {
         }
       }
     }
-    return $render($template_content);
+    return \Drupal::service('renderer')->render($template_content);
   }
 
 }
diff --git a/modules/mustache_magic/src/Plugin/mustache/Magic/Message.php b/modules/mustache_magic/src/Plugin/mustache/Magic/Message.php
index 99772de..9596a7a 100644
--- a/modules/mustache_magic/src/Plugin/mustache/Magic/Message.php
+++ b/modules/mustache_magic/src/Plugin/mustache/Magic/Message.php
@@ -103,7 +103,7 @@ class Message extends MustacheMagic {
 
     $this->attachLibrary();
     $this->element['#cache']['max-age'] = 0;
-    $rendered = trim($render($template_content));
+    $rendered = trim(\Drupal::service('renderer')->render($template_content));
     if (!empty($rendered)) {
       $this->messenger->addMessage($rendered, static::$messageTypes[$this->messageType]);
     }
diff --git a/modules/mustache_magic/src/Plugin/mustache/Magic/Sync.php b/modules/mustache_magic/src/Plugin/mustache/Magic/Sync.php
index 0b155a2..f161ebe 100644
--- a/modules/mustache_magic/src/Plugin/mustache/Magic/Sync.php
+++ b/modules/mustache_magic/src/Plugin/mustache/Magic/Sync.php
@@ -384,7 +384,7 @@ class Sync extends MustacheMagic {
     $url_exists = !empty($url) && ($url = Mustache::getUrlFromParam($url));
 
     if (!$url_exists) {
-      $build->withPlaceholder(['#markup' => Markup::create($render($template_content))]);
+      $build->withPlaceholder(['#markup' => Markup::create(\Drupal::service('renderer')->render($template_content))]);
     }
     elseif (empty($data)) {
       $build->usingDataFromUrl($url);
diff --git a/src/MustacheHttp.php b/src/MustacheHttp.php
index a8ee35f..090f611 100644
--- a/src/MustacheHttp.php
+++ b/src/MustacheHttp.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\mustache;
 
+use function GuzzleHttp\default_user_agent;
 use Drupal\Core\Cache\BackendChain;
 use Drupal\Core\Cache\CacheBackendInterface;
 use Drupal\Core\Http\ClientFactory;
@@ -114,7 +115,7 @@ class MustacheHttp {
     $this->volatility = (int) $cache_volatility;
     $client_config = [
       'headers' => [
-        'User-Agent' => 'Drupal/' . \Drupal::VERSION . ' (+https://www.drupal.org/) ' . \GuzzleHttp\default_user_agent() . ' Mustache/2',
+        'User-Agent' => 'Drupal/' . \Drupal::VERSION . ' (+https://www.drupal.org/) ' . default_user_agent() . ' Mustache/2',
       ],
     ];
     $this->client = $client_factory->fromOptions($client_config);
diff --git a/src/Plugin/mustache/Magic/Filter.php b/src/Plugin/mustache/Magic/Filter.php
index f5c1b12..4ce9fb3 100644
--- a/src/Plugin/mustache/Magic/Filter.php
+++ b/src/Plugin/mustache/Magic/Filter.php
@@ -104,7 +104,7 @@ class Filter extends MustacheMagic {
     // include that one (and will not forget about it).
     $this->attachLibrary();
 
-    $rendered = $render($template_content);
+    $rendered = \Drupal::service('renderer')->render($template_content);
 
     foreach ($this->keys as $i => $key) {
       if (!isset(static::$available[$key])) {
diff --git a/src/Plugin/mustache/Magic/Translation.php b/src/Plugin/mustache/Magic/Translation.php
index 322709b..0512b50 100644
--- a/src/Plugin/mustache/Magic/Translation.php
+++ b/src/Plugin/mustache/Magic/Translation.php
@@ -139,7 +139,7 @@ class Translation extends MustacheMagic {
 
     if (!$language) {
       // Nothing to do when language does not exist for the given langcode.
-      return $render($template_content);
+      return \Drupal::service('renderer')->render($template_content);
     }
 
     if (isset($this->langcode) && !empty($this->element['#use_sync'])) {
@@ -330,7 +330,7 @@ class Translation extends MustacheMagic {
     }
     else {
       $bubbleable_metadata->addCacheContexts(['languages'])->applyTo($this->element);
-      return $render($translated_content);
+      return \Drupal::service('renderer')->render($translated_content);
     }
   }
 
