diff --git a/includes/UserReferralWrapper.php b/includes/UserReferralWrapper.php
index 8bbefc1..6a8b92d 100644
--- a/includes/UserReferralWrapper.php
+++ b/includes/UserReferralWrapper.php
@@ -23,7 +23,7 @@ class UserReferralWrapper  extends RulesIdentifiableDataWrapper {
    * {@inheritDoc}
    */
   protected function load($uid) {
-    $referral = db_query("SELECT * FROM {user_referral} WHERE `uid` = :uid", array(':uid' => $uid))
+    $referral = \Drupal::database()->query("SELECT * FROM {user_referral} WHERE `uid` = :uid", array(':uid' => $uid))
       ->fetchObject();
     if ($referral) {
       $referral->data = unserialize($referral->data);
diff --git a/user_referral.rules.inc b/user_referral.rules.inc
index c2844ff..135ff91 100644
--- a/user_referral.rules.inc
+++ b/user_referral.rules.inc
@@ -75,7 +75,7 @@ function user_referral_rules_action_info() {
 }
 
 function user_referral_get_referer($account) {
-  $referral = db_query("SELECT * FROM {user_referral} WHERE `uid` = :uid", array(':uid' => $account->uid))
+  $referral = \Drupal::database()->query("SELECT * FROM {user_referral} WHERE `uid` = :uid", array(':uid' => $account->uid))
     ->fetchObject();
   if ($referral) {
     $referral->data = unserialize($referral->data);
