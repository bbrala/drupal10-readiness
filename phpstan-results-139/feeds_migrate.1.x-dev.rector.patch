diff --git a/src/FeedsMigrateExecutable.php b/src/FeedsMigrateExecutable.php
index 1879029..f79cb05 100644
--- a/src/FeedsMigrateExecutable.php
+++ b/src/FeedsMigrateExecutable.php
@@ -454,12 +454,12 @@ class FeedsMigrateExecutable extends MigrateExecutable {
     if ($save) {
       try {
         $this->getEventDispatcher()
-          ->dispatch(MigrateEvents::PRE_ROW_SAVE, new MigratePreRowSaveEvent($this->migration, $this->message, $row));
+          ->dispatch(new MigratePreRowSaveEvent($this->migration, $this->message, $row), MigrateEvents::PRE_ROW_SAVE);
         $destination_ids = $id_map->lookupDestinationIds($this->sourceIdValues);
         $destination_id_values = $destination_ids ? reset($destination_ids) : [];
         $destination_id_values = $destination->import($row, $destination_id_values);
         $this->getEventDispatcher()
-          ->dispatch(MigrateEvents::POST_ROW_SAVE, new MigratePostRowSaveEvent($this->migration, $this->message, $row, $destination_id_values));
+          ->dispatch(new MigratePostRowSaveEvent($this->migration, $this->message, $row, $destination_id_values), MigrateEvents::POST_ROW_SAVE);
         if ($destination_id_values) {
           // We do not save an idMap entry for config.
           if ($destination_id_values !== TRUE) {
diff --git a/tests/src/Functional/FeedsMigrateTestBase.php b/tests/src/Functional/FeedsMigrateTestBase.php
index 771a954..d96d231 100644
--- a/tests/src/Functional/FeedsMigrateTestBase.php
+++ b/tests/src/Functional/FeedsMigrateTestBase.php
@@ -55,7 +55,7 @@ abstract class FeedsMigrateTestBase extends BrowserTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     // Create a content type.
diff --git a/tests/src/Functional/Form/MigrationMappingFormTest.php b/tests/src/Functional/Form/MigrationMappingFormTest.php
index 710c61d..6084802 100644
--- a/tests/src/Functional/Form/MigrationMappingFormTest.php
+++ b/tests/src/Functional/Form/MigrationMappingFormTest.php
@@ -27,7 +27,7 @@ class MigrationMappingFormTest extends FeedsMigrateTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     // Create a migration entity.
@@ -59,10 +59,11 @@ class MigrationMappingFormTest extends FeedsMigrateTestBase {
     $edit = [
       'destination_field' => 'title',
     ];
-    $this->drupalPostForm('/admin/structure/migrate/sources/example_migration/mapping/add', $edit, 'Save');
+    $this->drupalGet('/admin/structure/migrate/sources/example_migration/mapping/add');
+    $this->submitForm($edit, 'Save');
 
     // And then just save without filling in the source.
-    $this->drupalPostForm(NULL, [], 'Save');
+    $this->submitForm([], 'Save');
 
     $this->assertSession()->pageTextNotContains('Migration mapping for field Title has been updated.');
     $this->assertSession()->pageTextContains('Please enter a source or configure a process plugin.');
@@ -76,20 +77,21 @@ class MigrationMappingFormTest extends FeedsMigrateTestBase {
     $edit = [
       'destination_field' => 'title',
     ];
-    $this->drupalPostForm('/admin/structure/migrate/sources/example_migration/mapping/add', $edit, 'Save');
+    $this->drupalGet('/admin/structure/migrate/sources/example_migration/mapping/add');
+    $this->submitForm($edit, 'Save');
 
     // Set a source and add a process plugin for it.
     $edit = [
       'mapping[title][properties][value][source]' => 'source_a',
       'mapping[title][properties][value][process][add][plugin]' => 'default_value',
     ];
-    $this->drupalPostForm(NULL, $edit, 'Add');
+    $this->submitForm($edit, 'Add');
 
     // Set a default value and save.
     $edit = [
       'mapping[title][properties][value][process][plugins][0][configuration][default_value]' => 'Foo',
     ];
-    $this->drupalPostForm(NULL, $edit, 'Save');
+    $this->submitForm($edit, 'Save');
 
     // Check if migration is saved with the expected values.
     $migration = Migration::load('example_migration');
@@ -113,28 +115,29 @@ class MigrationMappingFormTest extends FeedsMigrateTestBase {
     $edit = [
       'destination_field' => 'body',
     ];
-    $this->drupalPostForm('/admin/structure/migrate/sources/example_migration/mapping/add', $edit, 'Save');
+    $this->drupalGet('/admin/structure/migrate/sources/example_migration/mapping/add');
+    $this->submitForm($edit, 'Save');
 
     // Set a source and add a process plugin for the 'value' property.
     $edit = [
       'mapping[body][properties][value][source]' => 'source_a',
       'mapping[body][properties][value][process][add][plugin]' => 'default_value',
     ];
-    $this->drupalPostForm(NULL, $edit, 'edit-mapping-body-properties-value-process-add-button');
+    $this->submitForm($edit, 'edit-mapping-body-properties-value-process-add-button');
 
     // Also add a process plugin for the 'summary' property.
     $edit = [
       'mapping[body][properties][summary][source]' => 'source_b',
       'mapping[body][properties][summary][process][add][plugin]' => 'default_value',
     ];
-    $this->drupalPostForm(NULL, $edit, 'edit-mapping-body-properties-summary-process-add-button');
+    $this->submitForm($edit, 'edit-mapping-body-properties-summary-process-add-button');
 
     // Configure process plugins for both properties and save.
     $edit = [
       'mapping[body][properties][value][process][plugins][0][configuration][default_value]' => 'Foo',
       'mapping[body][properties][summary][process][plugins][0][configuration][default_value]' => 'Bar',
     ];
-    $this->drupalPostForm(NULL, $edit, 'Save');
+    $this->submitForm($edit, 'Save');
 
     // Check if migration is saved with the expected values.
     $migration = Migration::load('example_migration');
@@ -179,7 +182,8 @@ class MigrationMappingFormTest extends FeedsMigrateTestBase {
     $edit = [
       'mapping[body][properties][summary][source]' => '',
     ];
-    $this->drupalPostForm('/admin/structure/migrate/sources/example_migration/mapping/body/edit', $edit, 'Save');
+    $this->drupalGet('/admin/structure/migrate/sources/example_migration/mapping/body/edit');
+    $this->submitForm($edit, 'Save');
 
     // Check if migration is saved with the expected values.
     $migration = $this->reloadEntity($migration);
@@ -198,13 +202,14 @@ class MigrationMappingFormTest extends FeedsMigrateTestBase {
       'destination_field' => '_custom',
       'destination_key' => 'foo',
     ];
-    $this->drupalPostForm('/admin/structure/migrate/sources/example_migration/mapping/add', $edit, 'Save');
+    $this->drupalGet('/admin/structure/migrate/sources/example_migration/mapping/add');
+    $this->submitForm($edit, 'Save');
 
     // And set a source.
     $edit = [
       'mapping[foo][source]' => 'qux',
     ];
-    $this->drupalPostForm(NULL, $edit, 'Save');
+    $this->submitForm($edit, 'Save');
 
     // Check if migration is saved with the expected values.
     $migration = Migration::load('example_migration');
@@ -214,9 +219,10 @@ class MigrationMappingFormTest extends FeedsMigrateTestBase {
     $this->drupalGet('/admin/structure/migrate/sources/example_migration/mapping');
     $this->assertSession()->pageTextContains('foo');
     $this->assertSession()->pageTextContains('qux');
+    $this->drupalGet('/admin/structure/migrate/sources/example_migration/mapping/foo/delete');
 
     // Now remove the mapper.
-    $this->drupalPostForm('/admin/structure/migrate/sources/example_migration/mapping/foo/delete', [], 'Delete');
+    $this->submitForm([], 'Delete');
 
     // And assert that the mapper has been removed.
     $migration = $this->reloadEntity($migration);
diff --git a/tests/src/Functional/ImporterTest.php b/tests/src/Functional/ImporterTest.php
index 7702e06..955b55c 100644
--- a/tests/src/Functional/ImporterTest.php
+++ b/tests/src/Functional/ImporterTest.php
@@ -14,7 +14,7 @@ class ImporterTest extends FeedsMigrateTestBase {
   /**
    * {@inheritdoc}
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
 
     // Copy sample xml file to the expected file directory (i.e. public://).
diff --git a/tests/src/FunctionalJavascript/FeedsMigrateJavascriptTestBase.php b/tests/src/FunctionalJavascript/FeedsMigrateJavascriptTestBase.php
index 99c7672..fba1488 100644
--- a/tests/src/FunctionalJavascript/FeedsMigrateJavascriptTestBase.php
+++ b/tests/src/FunctionalJavascript/FeedsMigrateJavascriptTestBase.php
@@ -43,7 +43,7 @@ abstract class FeedsMigrateJavascriptTestBase extends WebDriverTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     // Create a content type.
diff --git a/tests/src/FunctionalJavascript/Form/MigrationMappingFormTest.php b/tests/src/FunctionalJavascript/Form/MigrationMappingFormTest.php
index 8a8051c..8553992 100644
--- a/tests/src/FunctionalJavascript/Form/MigrationMappingFormTest.php
+++ b/tests/src/FunctionalJavascript/Form/MigrationMappingFormTest.php
@@ -26,7 +26,7 @@ class MigrationMappingFormTest extends FeedsMigrateJavascriptTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     // Create a migration entity.
diff --git a/tests/src/Traits/FeedsCommonTrait.php b/tests/src/Traits/FeedsCommonTrait.php
index 261a6d9..827acd4 100644
--- a/tests/src/Traits/FeedsCommonTrait.php
+++ b/tests/src/Traits/FeedsCommonTrait.php
@@ -131,7 +131,7 @@ trait FeedsCommonTrait {
    *   The absolute path to the Feeds module.
    */
   protected function absolutePath() {
-    return $this->absolute() . '/' . drupal_get_path('module', 'feeds_migrate');
+    return $this->absolute() . '/' . \Drupal::service('extension.list.module')->getPath('feeds_migrate');
   }
 
   /**
@@ -141,7 +141,7 @@ trait FeedsCommonTrait {
    *   The url to the Feeds resources directory.
    */
   protected function resourcesUrl() {
-    return \Drupal::request()->getSchemeAndHttpHost() . '/' . drupal_get_path('module', 'feeds_migrate') . '/tests/resources';
+    return \Drupal::request()->getSchemeAndHttpHost() . '/' . \Drupal::service('extension.list.module')->getPath('feeds_migrate') . '/tests/resources';
   }
 
   /**
diff --git a/tests/src/Unit/Entity/MigrationTest.php b/tests/src/Unit/Entity/MigrationTest.php
index 35cdcd5..b217036 100644
--- a/tests/src/Unit/Entity/MigrationTest.php
+++ b/tests/src/Unit/Entity/MigrationTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\feeds_migrate\Unit\Entity;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Core\Entity\EntityFieldManagerInterface;
 use Drupal\Core\Field\FieldDefinitionInterface;
 use Drupal\feeds_migrate\Entity\Migration;
@@ -13,6 +14,7 @@ use Drupal\Tests\feeds_migrate\Unit\FeedsMigrateUnitTestBase;
  */
 class MigrationTest extends FeedsMigrateUnitTestBase {
 
+  use ProphecyTrait;
   /**
    * Field manager service.
    *
@@ -23,7 +25,7 @@ class MigrationTest extends FeedsMigrateUnitTestBase {
   /**
    * {@inheritdoc}
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
 
     $this->fieldManager = $this->prophesize(EntityFieldManagerInterface::class);
diff --git a/tests/src/Unit/MappingFieldFormBaseTest.php b/tests/src/Unit/MappingFieldFormBaseTest.php
index 09c251b..c2c3017 100644
--- a/tests/src/Unit/MappingFieldFormBaseTest.php
+++ b/tests/src/Unit/MappingFieldFormBaseTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\feeds_migrate\Unit;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Component\Plugin\Exception\PluginException;
 use Drupal\Core\Field\FieldItemInterface;
 use Drupal\Core\Field\FieldTypePluginManagerInterface;
@@ -22,6 +23,7 @@ use Prophecy\Argument;
  */
 class MappingFieldFormBaseTest extends FeedsMigrateUnitTestBase {
 
+  use ProphecyTrait;
   /**
    * The migration.
    *
@@ -46,7 +48,7 @@ class MappingFieldFormBaseTest extends FeedsMigrateUnitTestBase {
   /**
    * {@inheritdoc}
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
 
     $this->migration = $this->prophesize(MigrationInterface::class);
diff --git a/tests/src/Unit/MappingFieldFormManagerTest.php b/tests/src/Unit/MappingFieldFormManagerTest.php
index 3b03203..0c8138d 100644
--- a/tests/src/Unit/MappingFieldFormManagerTest.php
+++ b/tests/src/Unit/MappingFieldFormManagerTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\feeds_migrate\Unit;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Component\Plugin\Exception\PluginNotFoundException;
 use Drupal\Component\Plugin\PluginManagerInterface;
 use Drupal\Core\Cache\CacheBackendInterface;
@@ -22,6 +23,7 @@ use Drupal\feeds_migrate\Plugin\MigrateFormProcessPluginManagerInterface;
  */
 class MappingFieldFormManagerTest extends FeedsMigrateUnitTestBase {
 
+  use ProphecyTrait;
   /**
    * The mapping field form manager to test.
    *
@@ -46,7 +48,7 @@ class MappingFieldFormManagerTest extends FeedsMigrateUnitTestBase {
   /**
    * {@inheritdoc}
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
 
     $namespaces = new \ArrayObject();
diff --git a/tests/src/Unit/Plugin/MigrateFormProcessPluginManagerTest.php b/tests/src/Unit/Plugin/MigrateFormProcessPluginManagerTest.php
index 72162ef..0a21cb7 100644
--- a/tests/src/Unit/Plugin/MigrateFormProcessPluginManagerTest.php
+++ b/tests/src/Unit/Plugin/MigrateFormProcessPluginManagerTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\feeds_migrate\Unit\Plugin;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Component\Plugin\PluginManagerInterface;
 use Drupal\Core\Cache\CacheBackendInterface;
 use Drupal\Core\Extension\ModuleHandlerInterface;
@@ -19,6 +20,7 @@ use Drupal\Tests\feeds_migrate\Unit\FeedsMigrateUnitTestBase;
  */
 class MigrateFormProcessPluginManagerTest extends FeedsMigrateUnitTestBase {
 
+  use ProphecyTrait;
   /**
    * The module handler.
    *
@@ -50,7 +52,7 @@ class MigrateFormProcessPluginManagerTest extends FeedsMigrateUnitTestBase {
   /**
    * {@inheritdoc}
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
 
     $namespaces = new \ArrayObject();
diff --git a/tests/src/Unit/Plugin/feeds_migrate/mapping_field/MappingFieldFormTestBase.php b/tests/src/Unit/Plugin/feeds_migrate/mapping_field/MappingFieldFormTestBase.php
index e6d0996..ee90203 100644
--- a/tests/src/Unit/Plugin/feeds_migrate/mapping_field/MappingFieldFormTestBase.php
+++ b/tests/src/Unit/Plugin/feeds_migrate/mapping_field/MappingFieldFormTestBase.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\feeds_migrate\Unit\Plugin\feeds_migrate\mapping_field;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Core\Field\FieldItemInterface;
 use Drupal\Core\Field\FieldTypePluginManagerInterface;
 use Drupal\Core\Form\FormState;
@@ -16,6 +17,7 @@ use Prophecy\Argument;
  */
 abstract class MappingFieldFormTestBase extends FeedsMigrateUnitTestBase {
 
+  use ProphecyTrait;
   /**
    * The MappingFieldForm plugin under test.
    *
@@ -47,7 +49,7 @@ abstract class MappingFieldFormTestBase extends FeedsMigrateUnitTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->migration = $this->prophesize(MigrationInterface::class);
