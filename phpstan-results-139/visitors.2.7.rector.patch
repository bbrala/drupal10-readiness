diff --git a/src/Controller/Report/Cities.php b/src/Controller/Report/Cities.php
index 04ba762..fb1687d 100644
--- a/src/Controller/Report/Cities.php
+++ b/src/Controller/Report/Cities.php
@@ -149,7 +149,7 @@ class Cities extends ControllerBase {
       $visitors_city_link = $visitors_city_link->toRenderable();
       $rows[] = array(
         ++$i,
-        render($visitors_city_link),
+        \Drupal::service('renderer')->render($visitors_city_link),
         $data->visitors_city,
         $data->count
       );
diff --git a/src/Controller/Report/Countries.php b/src/Controller/Report/Countries.php
index c24766e..88c69c7 100644
--- a/src/Controller/Report/Countries.php
+++ b/src/Controller/Report/Countries.php
@@ -144,7 +144,7 @@ class Countries extends ControllerBase {
       $visitors_country_link = $visitors_country_link->toRenderable();
       $rows[] = array(
         ++$i,
-        render($visitors_country_link),
+        \Drupal::service('renderer')->render($visitors_country_link),
         $data->count
       );
     }
diff --git a/src/Controller/Report/DaysOfMonth.php b/src/Controller/Report/DaysOfMonth.php
index 5b216af..40dd6f5 100644
--- a/src/Controller/Report/DaysOfMonth.php
+++ b/src/Controller/Report/DaysOfMonth.php
@@ -78,7 +78,7 @@ class DaysOfMonth extends ControllerBase {
       'visitors_date_filter_form' => $form,
       'visitors_jqplot' => array(
         '#theme'  => 'visitors_jqplot',
-        '#path'   => drupal_get_path('module', 'visitors'),
+        '#path'   => \Drupal::service('extension.list.module')->getPath('visitors'),
         '#x'      => implode(', ', range(1, 31)),
         '#y'      => implode(', ', $y),
         '#width'  => $config->get('chart_width'),
diff --git a/src/Controller/Report/DaysOfWeek.php b/src/Controller/Report/DaysOfWeek.php
index 713641b..3f0d2e3 100644
--- a/src/Controller/Report/DaysOfWeek.php
+++ b/src/Controller/Report/DaysOfWeek.php
@@ -83,7 +83,7 @@ class DaysOfWeek extends ControllerBase {
       'visitors_date_filter_form' => $form,
       'visitors_jqplot' => array(
         '#theme'  => 'visitors_jqplot',
-        '#path'   => drupal_get_path('module', 'visitors'),
+        '#path'   => \Drupal::service('extension.list.module')->getPath('visitors'),
         '#x'      => implode(', ', $x),
         '#y'      => implode(', ', $y),
         '#width'  => $config->get('chart_width'),
diff --git a/src/Controller/Report/Hits.php b/src/Controller/Report/Hits.php
index 82de012..b53606c 100644
--- a/src/Controller/Report/Hits.php
+++ b/src/Controller/Report/Hits.php
@@ -192,8 +192,8 @@ class Hits extends ControllerBase {
         $data->visitors_id,
         $this->date->format($data->visitors_date_time, 'short'),
               Html::escape($data->visitors_title) . " - ". $data->visitors_url,
-        render($user_profile_link),
-        render($visitors_host_link)
+        \Drupal::service('renderer')->render($user_profile_link),
+        \Drupal::service('renderer')->render($visitors_host_link)
       );
     }
 
diff --git a/src/Controller/Report/Hosts.php b/src/Controller/Report/Hosts.php
index 8e37405..4828a47 100644
--- a/src/Controller/Report/Hosts.php
+++ b/src/Controller/Report/Hosts.php
@@ -157,7 +157,7 @@ class Hosts extends ControllerBase {
         //$whois_enable ? l($ip, 'whois/' . $ip, $attr) : check_plain($ip),
         $ip,
         $data->count,
-        render($visitors_host_link)
+        \Drupal::service('renderer')->render($visitors_host_link)
       );
     }
 
diff --git a/src/Controller/Report/Hours.php b/src/Controller/Report/Hours.php
index 2ed3a20..c7708d7 100644
--- a/src/Controller/Report/Hours.php
+++ b/src/Controller/Report/Hours.php
@@ -78,7 +78,7 @@ class Hours extends ControllerBase {
       'visitors_date_filter_form' => $form,
       'visitors_jqplot' => array(
         '#theme'  => 'visitors_jqplot',
-        '#path'   => drupal_get_path('module', 'visitors'),
+        '#path'   => \Drupal::service('extension.list.module')->getPath('visitors'),
         '#x'      => implode(', ', range(0, 23)),
         '#y'      => implode(', ', $y),
         '#width'  => $config->get('chart_width'),
diff --git a/src/Controller/Report/MonthlyHistory.php b/src/Controller/Report/MonthlyHistory.php
index 39e5bf0..1a8d1a8 100644
--- a/src/Controller/Report/MonthlyHistory.php
+++ b/src/Controller/Report/MonthlyHistory.php
@@ -75,7 +75,7 @@ class MonthlyHistory extends ControllerBase {
       'visitors_date_filter_form' => $form,
       'visitors_jqplot' => array(
         '#theme'  => 'visitors_jqplot',
-        '#path'   => drupal_get_path('module', 'visitors'),
+        '#path'   => \Drupal::service('extension.list.module')->getPath('visitors'),
         '#x'      => implode(', ', $x),
         '#y'      => implode(', ', $y),
         '#width'  => $config->get('chart_width'),
diff --git a/src/EventSubscriber/KernelTerminateSubscriber.php b/src/EventSubscriber/KernelTerminateSubscriber.php
index 0f51294..97e2d27 100644
--- a/src/EventSubscriber/KernelTerminateSubscriber.php
+++ b/src/EventSubscriber/KernelTerminateSubscriber.php
@@ -7,12 +7,12 @@
 
 namespace Drupal\visitors\EventSubscriber;
 
+use Symfony\Component\HttpKernel\Event\TerminateEvent;
 use Drupal;
 use Drupal\Core\Config\ConfigFactoryInterface;
 use Drupal\Core\CronInterface;
 use Drupal\Core\State\StateInterface;
 use Symfony\Component\EventDispatcher\EventSubscriberInterface;
-use Symfony\Component\HttpKernel\Event\PostResponseEvent;
 use Symfony\Component\HttpKernel\KernelEvents;
 use Symfony\Cmf\Component\Routing\RouteObjectInterface;
 use Symfony\Component\HttpFoundation\Request;
@@ -33,10 +33,10 @@ class KernelTerminateSubscriber implements EventSubscriberInterface {
   /**
    * Store visitors data when a request terminates.
    *
-   * @param Symfony\Component\HttpKernel\Event\PostResponseEvent $event
+   * @param \Symfony\Component\HttpKernel\Event\TerminateEvent $event
    *   The Event to process.
    */
-  public function onTerminate(PostResponseEvent $event) {
+  public function onTerminate(TerminateEvent $event) {
     $this->request = $event->getRequest();
 
     $user = \Drupal::currentUser();
