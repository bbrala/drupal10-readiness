diff --git a/gumlet_sf.field.inc b/gumlet_sf.field.inc
index dc324e8..36b1494 100644
--- a/gumlet_sf.field.inc
+++ b/gumlet_sf.field.inc
@@ -64,11 +64,11 @@ function template_preprocess_gumlet_sf_formatter(&$variables)
     if (($entity = $item->entity) && empty($item->uri)) {
         $image_uri = $entity->getFileUri();
         $url = $entity->createFileUrl(false);
-        $urlImage = file_url_transform_relative($url);
+        $urlImage = \Drupal::service('file_url_generator')->transformRelative($url);
     } else {
         $image_uri = $item->uri;
         $url = $entity->createFileUrl(false);
-        $urlImage = file_url_transform_relative($url);
+        $urlImage = \Drupal::service('file_url_generator')->transformRelative($url);
     }
     if (isset($image_style_data) && !empty($image_style_data)) {
         $urlImage .= gumlet_sf_formatter($image_style_data);
diff --git a/src/Plugin/Field/FieldFormatter/GumletSFImageFormatter.php b/src/Plugin/Field/FieldFormatter/GumletSFImageFormatter.php
index b576410..a80b381 100644
--- a/src/Plugin/Field/FieldFormatter/GumletSFImageFormatter.php
+++ b/src/Plugin/Field/FieldFormatter/GumletSFImageFormatter.php
@@ -193,7 +193,7 @@ class GumletSFImageFormatter extends GumletSFImageFormatterBase implements Conta
                 // context to ensure different file URLs are generated for different
                 // sites in a multisite setup, including HTTP and HTTPS versions of the
                 // same site. Fix in https://www.drupal.org/node/2646744.
-                $url = Url::fromUri(file_create_url($image_uri));
+                $url = \Drupal::service('file_url_generator')->generate($image_uri);
                 $cache_contexts[] = 'url.site';
             }
             $cache_tags = Cache::mergeTags($base_cache_tags, $file->getCacheTags());
diff --git a/src/Plugin/Field/FieldFormatter/GumletSFImageUrlFormatter.php b/src/Plugin/Field/FieldFormatter/GumletSFImageUrlFormatter.php
index 9b39c7c..b1b9380 100644
--- a/src/Plugin/Field/FieldFormatter/GumletSFImageUrlFormatter.php
+++ b/src/Plugin/Field/FieldFormatter/GumletSFImageUrlFormatter.php
@@ -70,8 +70,8 @@ class GumletSFImageUrlFormatter extends GumletSFImageFormatter
 
         foreach ($images as $delta => $image) {
             $image_uri = $image->getFileUri();
-            $url = file_create_url($image_uri);
-            $url = file_url_transform_relative($url);
+            $url = \Drupal::service('file_url_generator')->generateAbsoluteString($image_uri);
+            $url = \Drupal::service('file_url_generator')->transformRelative($url);
             if (isset($sf_data) && !empty($sf_data)) {
                 $url .= gumlet_sf_formatter($sf_data);
             }
