diff --git a/advagg_bundler/tests/src/Kernel/Form/SettingsFormTest.php b/advagg_bundler/tests/src/Kernel/Form/SettingsFormTest.php
index 6ab43f1..ee517f6 100644
--- a/advagg_bundler/tests/src/Kernel/Form/SettingsFormTest.php
+++ b/advagg_bundler/tests/src/Kernel/Form/SettingsFormTest.php
@@ -36,7 +36,7 @@ class SettingsFormTest extends KernelTestBase {
    *
    * @covers ::__construct
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->installConfig(static::$modules);
diff --git a/advagg_cdn/tests/src/Kernel/Form/SettingsFormTest.php b/advagg_cdn/tests/src/Kernel/Form/SettingsFormTest.php
index 8c1abeb..e4a63bd 100644
--- a/advagg_cdn/tests/src/Kernel/Form/SettingsFormTest.php
+++ b/advagg_cdn/tests/src/Kernel/Form/SettingsFormTest.php
@@ -36,7 +36,7 @@ class SettingsFormTest extends KernelTestBase {
    *
    * @covers ::__construct
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->installConfig(static::$modules);
diff --git a/advagg_css_minify/tests/src/Kernel/Asset/CssMinifierUnitTest.php b/advagg_css_minify/tests/src/Kernel/Asset/CssMinifierUnitTest.php
index 2518ebe..3b20f36 100644
--- a/advagg_css_minify/tests/src/Kernel/Asset/CssMinifierUnitTest.php
+++ b/advagg_css_minify/tests/src/Kernel/Asset/CssMinifierUnitTest.php
@@ -29,7 +29,7 @@ class CssMinifierUnitTest extends KernelTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
     $this->installConfig('advagg_css_minify');
     $this->optimizer = \Drupal::service('advagg.css_minifier');
diff --git a/advagg_css_minify/tests/src/Kernel/Form/SettingsFormTest.php b/advagg_css_minify/tests/src/Kernel/Form/SettingsFormTest.php
index e3afddf..10be78e 100644
--- a/advagg_css_minify/tests/src/Kernel/Form/SettingsFormTest.php
+++ b/advagg_css_minify/tests/src/Kernel/Form/SettingsFormTest.php
@@ -36,7 +36,7 @@ class SettingsFormTest extends KernelTestBase {
    *
    * @covers ::__construct
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->installConfig(static::$modules);
diff --git a/advagg_ext_minify/tests/src/Kernel/Form/SettingsFormTest.php b/advagg_ext_minify/tests/src/Kernel/Form/SettingsFormTest.php
index 4385e39..8eb94fc 100644
--- a/advagg_ext_minify/tests/src/Kernel/Form/SettingsFormTest.php
+++ b/advagg_ext_minify/tests/src/Kernel/Form/SettingsFormTest.php
@@ -36,7 +36,7 @@ class SettingsFormTest extends KernelTestBase {
    *
    * @covers ::__construct
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->installConfig(static::$modules);
diff --git a/advagg_js_minify/src/Asset/JsMinifier.php b/advagg_js_minify/src/Asset/JsMinifier.php
index 70e4d56..c768b92 100644
--- a/advagg_js_minify/src/Asset/JsMinifier.php
+++ b/advagg_js_minify/src/Asset/JsMinifier.php
@@ -2,6 +2,8 @@
 
 namespace Drupal\advagg_js_minify\Asset;
 
+use JShrink\Minifier;
+use Patchwork\JSqueeze;
 use Drupal\Component\Utility\Unicode;
 use Drupal\advagg\Asset\SingleAssetOptimizerBase;
 use Drupal\Core\Config\ConfigFactoryInterface;
@@ -185,7 +187,7 @@ class JsMinifier extends SingleAssetOptimizerBase {
 
     // Only include jsminplus.inc if the JSMinPlus class doesn't exist.
     if (!class_exists('\JSMinPlus')) {
-      include drupal_get_path('module', 'advagg_js_minify') . '/jsminplus.inc';
+      include \Drupal::service('extension.list.module')->getPath('advagg_js_minify') . '/jsminplus.inc';
       $nesting_level = ini_get('xdebug.max_nesting_level');
       if (!empty($nesting_level) && $nesting_level < 200) {
         ini_set('xdebug.max_nesting_level', 200);
@@ -219,7 +221,7 @@ class JsMinifier extends SingleAssetOptimizerBase {
   public function minifyJspacker(&$contents) {
     // Use Packer on the contents of the aggregated file.
     if (!class_exists('\JavaScriptPacker')) {
-      include drupal_get_path('module', 'advagg_js_minify') . '/jspacker.inc';
+      include \Drupal::service('extension.list.module')->getPath('advagg_js_minify') . '/jspacker.inc';
     }
 
     // Add semicolons to the end of lines if missing.
@@ -241,7 +243,7 @@ class JsMinifier extends SingleAssetOptimizerBase {
 
     // Only include jshrink.inc if the JShrink\Minifier class doesn't exist.
     if (!class_exists('\JShrink\Minifier')) {
-      include drupal_get_path('module', 'advagg_js_minify') . '/jshrink.inc';
+      include \Drupal::service('extension.list.module')->getPath('advagg_js_minify') . '/jshrink.inc';
       $nesting_level = ini_get('xdebug.max_nesting_level');
       if (!empty($nesting_level) && $nesting_level < 200) {
         ini_set('xdebug.max_nesting_level', 200);
@@ -251,7 +253,7 @@ class JsMinifier extends SingleAssetOptimizerBase {
     try {
       // JShrink the contents of the aggregated file.
       // @codingStandardsIgnoreLine
-      $contents = \JShrink\Minifier::minify($contents, ['flaggedComments' => FALSE]);
+      $contents = Minifier::minify($contents, ['flaggedComments' => FALSE]);
 
       // Capture any output from JShrink.
       $error = trim(ob_get_contents());
@@ -278,7 +280,7 @@ class JsMinifier extends SingleAssetOptimizerBase {
 
     // Only include jshrink.inc if the Patchwork\JSqueeze class doesn't exist.
     if (!class_exists('\Patchwork\JSqueeze')) {
-      include drupal_get_path('module', 'advagg_js_minify') . '/jsqueeze.inc';
+      include \Drupal::service('extension.list.module')->getPath('advagg_js_minify') . '/jsqueeze.inc';
       $nesting_level = ini_get('xdebug.max_nesting_level');
       if (!empty($nesting_level) && $nesting_level < 200) {
         ini_set('xdebug.max_nesting_level', 200);
@@ -288,7 +290,7 @@ class JsMinifier extends SingleAssetOptimizerBase {
     try {
       // Minify the contents of the aggregated file.
       // @codingStandardsIgnoreLine
-      $jz = new \Patchwork\JSqueeze();
+      $jz = new JSqueeze();
       $contents = $jz->squeeze(
         $contents,
         TRUE,
diff --git a/advagg_js_minify/tests/src/Kernel/Asset/JsMinifierUnitTest.php b/advagg_js_minify/tests/src/Kernel/Asset/JsMinifierUnitTest.php
index 7162631..73d4a64 100644
--- a/advagg_js_minify/tests/src/Kernel/Asset/JsMinifierUnitTest.php
+++ b/advagg_js_minify/tests/src/Kernel/Asset/JsMinifierUnitTest.php
@@ -29,7 +29,7 @@ class JsMinifierUnitTest extends KernelTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
     $this->installConfig('advagg_js_minify');
     $this->optimizer = \Drupal::service('advagg.js_minifier');
diff --git a/advagg_js_minify/tests/src/Kernel/Form/SettingsFormTest.php b/advagg_js_minify/tests/src/Kernel/Form/SettingsFormTest.php
index db64fed..b9276c5 100644
--- a/advagg_js_minify/tests/src/Kernel/Form/SettingsFormTest.php
+++ b/advagg_js_minify/tests/src/Kernel/Form/SettingsFormTest.php
@@ -36,7 +36,7 @@ class SettingsFormTest extends KernelTestBase {
    *
    * @covers ::__construct
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->installConfig(static::$modules);
diff --git a/advagg_mod/advagg_mod.module b/advagg_mod/advagg_mod.module
index 78ffeef..d2016d0 100644
--- a/advagg_mod/advagg_mod.module
+++ b/advagg_mod/advagg_mod.module
@@ -16,7 +16,7 @@ function advagg_mod_js_alter(&$js) {
   }
   $config = \Drupal::config('advagg_mod.settings');
   // Use the current file system path for advagg_mod.
-  $module_path = drupal_get_path('module', 'advagg_mod');
+  $module_path = \Drupal::service('extension.list.module')->getPath('advagg_mod');
   if (isset($js[$module_path . '/js/loadCSS.js'])) {
     if ($config->get('css_defer_js_code') === 4) {
       $js[$module_path . '/js/loadCSS.js']['type'] = 'external';
diff --git a/advagg_mod/src/Asset/DeferCss.php b/advagg_mod/src/Asset/DeferCss.php
index 592ee8b..1be4156 100644
--- a/advagg_mod/src/Asset/DeferCss.php
+++ b/advagg_mod/src/Asset/DeferCss.php
@@ -64,7 +64,7 @@ class DeferCss {
 
     // Put JS inline if configured.
     if ($this->deferMethod === 0) {
-      $path = drupal_get_path('module', 'advagg_mod') . '/js/loadCSS.js';
+      $path = \Drupal::service('extension.list.module')->getPath('advagg_mod') . '/js/loadCSS.js';
       if (!strpos($content, $path)) {
         $path = Crypt::hashBase64($path . $this->counter);
       }
diff --git a/advagg_mod/src/Asset/DeferJs.php b/advagg_mod/src/Asset/DeferJs.php
index 0010083..c78df7e 100644
--- a/advagg_mod/src/Asset/DeferJs.php
+++ b/advagg_mod/src/Asset/DeferJs.php
@@ -55,7 +55,7 @@ class DeferJs {
 
     // Admin Toolbar 8x fails when deferred.
     if ($this->moduleHandler->moduleExists('admin_toolbar')) {
-      $this->skipList[] = Crypt::hashBase64(drupal_get_path('module', 'admin_toolbar') . '/js/admin_toolbar.js' . $this->counter);
+      $this->skipList[] = Crypt::hashBase64(\Drupal::service('extension.list.module')->getPath('admin_toolbar') . '/js/admin_toolbar.js' . $this->counter);
     }
   }
 
diff --git a/advagg_mod/tests/src/Kernel/Form/SettingsFormTest.php b/advagg_mod/tests/src/Kernel/Form/SettingsFormTest.php
index a7cd64c..d30474f 100644
--- a/advagg_mod/tests/src/Kernel/Form/SettingsFormTest.php
+++ b/advagg_mod/tests/src/Kernel/Form/SettingsFormTest.php
@@ -36,7 +36,7 @@ class SettingsFormTest extends KernelTestBase {
    *
    * @covers ::__construct
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->installConfig(static::$modules);
diff --git a/advagg_old_ie_compatibility/tests/src/Kernel/Form/SettingsFormTest.php b/advagg_old_ie_compatibility/tests/src/Kernel/Form/SettingsFormTest.php
index 60442de..14bf0ae 100644
--- a/advagg_old_ie_compatibility/tests/src/Kernel/Form/SettingsFormTest.php
+++ b/advagg_old_ie_compatibility/tests/src/Kernel/Form/SettingsFormTest.php
@@ -36,7 +36,7 @@ class SettingsFormTest extends KernelTestBase {
    *
    * @covers ::__construct
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->installConfig(static::$modules);
diff --git a/advagg_validator/tests/src/Kernel/Form/CssLintFormTest.php b/advagg_validator/tests/src/Kernel/Form/CssLintFormTest.php
index aee839f..f517459 100644
--- a/advagg_validator/tests/src/Kernel/Form/CssLintFormTest.php
+++ b/advagg_validator/tests/src/Kernel/Form/CssLintFormTest.php
@@ -32,7 +32,7 @@ class CssLintFormTest extends KernelTestBase {
    *
    * @covers ::__construct
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->installConfig(static::$modules);
diff --git a/advagg_validator/tests/src/Kernel/Form/CssW3FormTest.php b/advagg_validator/tests/src/Kernel/Form/CssW3FormTest.php
index 4fe7ad2..e81962a 100644
--- a/advagg_validator/tests/src/Kernel/Form/CssW3FormTest.php
+++ b/advagg_validator/tests/src/Kernel/Form/CssW3FormTest.php
@@ -32,7 +32,7 @@ class CssW3FormTest extends KernelTestBase {
    *
    * @covers ::__construct
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->installConfig(static::$modules);
diff --git a/advagg_validator/tests/src/Kernel/Form/JsHintFormTest.php b/advagg_validator/tests/src/Kernel/Form/JsHintFormTest.php
index 402e67d..570fd97 100644
--- a/advagg_validator/tests/src/Kernel/Form/JsHintFormTest.php
+++ b/advagg_validator/tests/src/Kernel/Form/JsHintFormTest.php
@@ -32,7 +32,7 @@ class JsHintFormTest extends KernelTestBase {
    *
    * @covers ::__construct
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->installConfig(static::$modules);
diff --git a/src/Asset/CssOptimizer.php b/src/Asset/CssOptimizer.php
index a90177a..60defdd 100644
--- a/src/Asset/CssOptimizer.php
+++ b/src/Asset/CssOptimizer.php
@@ -88,7 +88,7 @@ class CssOptimizer extends AssetOptimizer {
       $asset['media'] = 'all';
     }
     $asset_event = new AssetOptimizationEvent($contents, $asset, $data);
-    $this->eventDispatcher->dispatch(AssetOptimizationEvent::CSS, $asset_event);
+    $this->eventDispatcher->dispatch($asset_event, AssetOptimizationEvent::CSS);
     $contents = $asset_event->getContent();
     $asset = $asset_event->getAsset();
 
diff --git a/src/Asset/JsOptimizer.php b/src/Asset/JsOptimizer.php
index 908226b..7c06a9f 100644
--- a/src/Asset/JsOptimizer.php
+++ b/src/Asset/JsOptimizer.php
@@ -123,7 +123,7 @@ class JsOptimizer extends AssetOptimizer {
    */
   protected function optimizeFile(array &$asset, array $data) {
     $asset_event = new AssetOptimizationEvent($data['contents'], $asset, $data);
-    $this->eventDispatcher->dispatch(AssetOptimizationEvent::JS, $asset_event);
+    $this->eventDispatcher->dispatch($asset_event, AssetOptimizationEvent::JS);
     $contents = $asset_event->getContent();
     $asset = $asset_event->getAsset();
 
diff --git a/src/Asset/SingleAssetOptimizerBase.php b/src/Asset/SingleAssetOptimizerBase.php
index 26067ed..ea07500 100644
--- a/src/Asset/SingleAssetOptimizerBase.php
+++ b/src/Asset/SingleAssetOptimizerBase.php
@@ -58,7 +58,7 @@ abstract class SingleAssetOptimizerBase {
    */
   public function addLicense(&$contents, $path) {
     if ($this->config->get('add_license')) {
-      $url = file_create_url($path);
+      $url = \Drupal::service('file_url_generator')->generateAbsoluteString($path);
       $contents = "/* Source and licensing information for the line(s) below can be found at $url. */\n" . $contents . "\n/* Source and licensing information for the above line(s) can be found at $url. */";
     }
   }
diff --git a/tests/src/Functional/AdvaggFunctionalTestBase.php b/tests/src/Functional/AdvaggFunctionalTestBase.php
index cedd239..860ac6f 100644
--- a/tests/src/Functional/AdvaggFunctionalTestBase.php
+++ b/tests/src/Functional/AdvaggFunctionalTestBase.php
@@ -43,7 +43,7 @@ abstract class AdvaggFunctionalTestBase extends BrowserTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
     $this->user = $this->drupalCreateUser([
       'administer site configuration',
diff --git a/tests/src/Kernel/Asset/CssOptimizerUnitTest.php b/tests/src/Kernel/Asset/CssOptimizerUnitTest.php
index a1d07c6..56bf0c3 100644
--- a/tests/src/Kernel/Asset/CssOptimizerUnitTest.php
+++ b/tests/src/Kernel/Asset/CssOptimizerUnitTest.php
@@ -35,7 +35,7 @@ class CssOptimizerUnitTest extends KernelTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
     $this->installConfig('advagg');
     $this->optimizer = \Drupal::service('advagg.optimizer.css');
diff --git a/tests/src/Kernel/Form/InfoFormTest.php b/tests/src/Kernel/Form/InfoFormTest.php
index af8e1a3..e081af9 100644
--- a/tests/src/Kernel/Form/InfoFormTest.php
+++ b/tests/src/Kernel/Form/InfoFormTest.php
@@ -35,7 +35,7 @@ class InfoFormTest extends KernelTestBase {
    *
    * @covers ::__construct
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->installConfig(static::$modules);
diff --git a/tests/src/Kernel/Form/OperationsFormTest.php b/tests/src/Kernel/Form/OperationsFormTest.php
index bf96521..cd4ae1d 100644
--- a/tests/src/Kernel/Form/OperationsFormTest.php
+++ b/tests/src/Kernel/Form/OperationsFormTest.php
@@ -35,7 +35,7 @@ class OperationsFormTest extends KernelTestBase {
    *
    * @covers ::__construct
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->installConfig(static::$modules);
diff --git a/tests/src/Kernel/Form/SettingsFormTest.php b/tests/src/Kernel/Form/SettingsFormTest.php
index a701077..ea308fe 100644
--- a/tests/src/Kernel/Form/SettingsFormTest.php
+++ b/tests/src/Kernel/Form/SettingsFormTest.php
@@ -32,7 +32,7 @@ class SettingsFormTest extends KernelTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->settingsForm = SettingsForm::create($this->container);
