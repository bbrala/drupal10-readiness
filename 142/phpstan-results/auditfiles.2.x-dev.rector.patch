diff --git a/auditfiles.info.yml b/auditfiles.info.yml
index 46f539f..ae2b405 100644
--- a/auditfiles.info.yml
+++ b/auditfiles.info.yml
@@ -1,7 +1,6 @@
 name: Audit Files
 type: module
 description: Allows for comparing and correcting files and file references in the "files" directory, in the database, and in content.
-core : 8.x
-core_version_requirement: ^8 || ^9
+core_version_requirement: ^9.3 || ^10
 package: Media
 configure: auditfiles.auditfiles_configuration
diff --git a/src/AuditFilesBatchProcess.php b/src/AuditFilesBatchProcess.php
index 89ccfaa..7948fc7 100644
--- a/src/AuditFilesBatchProcess.php
+++ b/src/AuditFilesBatchProcess.php
@@ -75,7 +75,7 @@ class AuditFilesBatchProcess {
   public static function auditfilesMakePreg(&$element, $key = '', $makefilepath = FALSE) {
     if ($makefilepath) {
       $realpath = \Drupal::service('file_system')
-        ->realpath(file_build_uri($element));
+        ->realpath(\Drupal::service('stream_wrapper_manager')->normalizeUri(\Drupal::config('system.file')->get('default_scheme') . ('://' . $element)));
       if ($realpath) {
         $element = $realpath;
       }
diff --git a/tests/src/FunctionalJavascript/AuditFilesReferencedNotUsedTest.php b/tests/src/FunctionalJavascript/AuditFilesReferencedNotUsedTest.php
index ae549ab..2c247e2 100644
--- a/tests/src/FunctionalJavascript/AuditFilesReferencedNotUsedTest.php
+++ b/tests/src/FunctionalJavascript/AuditFilesReferencedNotUsedTest.php
@@ -46,7 +46,7 @@ class AuditFilesReferencedNotUsedTest extends WebDriverTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
     // Create user with permissions to manage site configuration and access
     // audit files reports.
