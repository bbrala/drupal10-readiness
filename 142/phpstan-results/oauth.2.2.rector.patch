diff --git a/src/Authentication/Provider/OAuthDrupalProvider.php b/src/Authentication/Provider/OAuthDrupalProvider.php
index 09d93ea..e27f79e 100644
--- a/src/Authentication/Provider/OAuthDrupalProvider.php
+++ b/src/Authentication/Provider/OAuthDrupalProvider.php
@@ -7,12 +7,12 @@
 
 namespace Drupal\oauth\Authentication\Provider;
 
+use Symfony\Component\HttpKernel\Event\ExceptionEvent;
 use Drupal\Core\Authentication\AuthenticationProviderInterface;
 use Drupal\user\Entity\User;
 use Drupal\user\UserDataInterface;
 use Psr\Log\LoggerInterface;
 use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpKernel\Event\GetResponseForExceptionEvent;
 use \OauthProvider;
 use \OauthException;
 /**
@@ -99,7 +99,7 @@ class OAuthDrupalProvider implements AuthenticationProviderInterface {
   /**
    * {@inheritdoc}
    */
-  public function handleException(GetResponseForExceptionEvent $event) {
+  public function handleException(ExceptionEvent $event) {
     return FALSE;
   }
 
diff --git a/src/Form/OAuthAddConsumerForm.php b/src/Form/OAuthAddConsumerForm.php
index eafe607..d7c683b 100644
--- a/src/Form/OAuthAddConsumerForm.php
+++ b/src/Form/OAuthAddConsumerForm.php
@@ -89,8 +89,8 @@ class OAuthAddConsumerForm extends FormBase {
    * {@inheritdoc}
    */
   public function submitForm(array &$form, FormStateInterface $form_state) {
-    $consumer_key = user_password(32);
-    $consumer_secret  = user_password(32);
+    $consumer_key = \Drupal::service('password_generator')->generate(32);
+    $consumer_secret  = \Drupal::service('password_generator')->generate(32);
     $key_hash = sha1($consumer_key);
     $uid = $form_state->getValue('uid');
     $consumer = array(
diff --git a/src/Tests/OAuthTest.php b/src/Tests/OAuthTest.php
index ccf8db1..4e2129e 100644
--- a/src/Tests/OAuthTest.php
+++ b/src/Tests/OAuthTest.php
@@ -36,16 +36,18 @@ class OAuthTest extends BrowserTestBase {
 
     // Check that OAuth menu tab is visible at user profile.
     $this->drupalGet('user/' . $account->id() . '/oauth/consumer');
-    $this->assertResponse(200);
+    $this->assertSession()->statusCodeEquals(200);
+    $this->drupalGet('oauth/consumer/add/' . $account->id());
 
     // Generate a set of consumer keys.
-    $this->drupalPostForm('oauth/consumer/add/' . $account->id(), array(), 'Add');
-    $this->assertText(t('Added a new consumer.'));
+    $this->submitForm(array(), 'Add');
+    $this->assertSession()->pageTextContains(t('Added a new consumer.'));
 
     // Delete the set of consumer keys.
     $user_data = \Drupal::service('user.data')->get('oauth', $account->id());
-    $this->drupalPostForm('oauth/consumer/delete/' . $account->id() . '/' . key($user_data), array(), 'Delete');
-    $this->assertText(t('OAuth consumer deleted.'));
+    $this->drupalGet('oauth/consumer/delete/' . $account->id() . '/' . key($user_data));
+    $this->submitForm(array(), 'Delete');
+    $this->assertSession()->pageTextContains(t('OAuth consumer deleted.'));
 
     $this->drupalLogout();
 
@@ -54,17 +56,19 @@ class OAuthTest extends BrowserTestBase {
     $this->drupalLogin($admin_account);
 
     $this->drupalGet('user/' . $account->id() . '/oauth/consumer');
-    $this->assertResponse(200);
+    $this->assertSession()->statusCodeEquals(200);
+    $this->drupalGet('oauth/consumer/add/' . $account->id());
 
     // Generate a set of consumer keys.
-    $this->drupalPostForm('oauth/consumer/add/' . $account->id(), array(), 'Add');
-    $this->assertText(t('Added a new consumer.'));
+    $this->submitForm(array(), 'Add');
+    $this->assertSession()->pageTextContains(t('Added a new consumer.'));
 
     // Delete the set of consumer keys.
     $user_data = \Drupal::service('user.data')->get('oauth', $account->id());
+    $this->drupalGet('oauth/consumer/delete/' . $account->id() . '/' . key($user_data));
 
-    $this->drupalPostForm('oauth/consumer/delete/' . $account->id() . '/' . key($user_data), array(), 'Delete');
-    $this->assertText(t('OAuth consumer deleted.'));
+    $this->submitForm(array(), 'Delete');
+    $this->assertSession()->pageTextContains(t('OAuth consumer deleted.'));
 
     $this->drupalLogout();
   }
@@ -109,9 +113,10 @@ class OAuthTest extends BrowserTestBase {
     );
     $account = $this->drupalCreateUser($permissions);
     $this->drupalLogin($account);
+    $this->drupalGet('oauth/consumer/add/' . $account->id());
 
     // Generate a set of consumer keys.
-    $this->drupalPostForm('oauth/consumer/add/' . $account->id(), array(), 'Add');
+    $this->submitForm(array(), 'Add');
     // Get the consumer we just generated for the new user.
     $user_data = \Drupal::service('user.data')->get('oauth', $account->id());
     // Now send an authenticated request to read the entity through REST.
@@ -128,7 +133,7 @@ class OAuthTest extends BrowserTestBase {
       )
     );
     $this->verbose('GET request to: ' . $endpoint . '<hr />' . $out);
-    $this->assertResponse('200', 'HTTP response code is 200 for successfully authenticated request.');
+    $this->assertSession()->statusCodeEquals('200', 'HTTP response code is 200 for successfully authenticated request.');
     $this->curlClose();
   }
 
@@ -142,9 +147,10 @@ class OAuthTest extends BrowserTestBase {
 
     // Initiate user session.
     $this->drupalLogin($account);
+    $this->drupalGet('oauth/consumer/add/' . $account->id());
 
     // Generate a set of consumer keys.
-    $this->drupalPostForm('oauth/consumer/add/' . $account->id(), array(), 'Add');
+    $this->submitForm(array(), 'Add');
 
     // Delete the user.
     $uid = $account->id();
