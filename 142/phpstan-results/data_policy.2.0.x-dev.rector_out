modules/contrib/data_policy/data_policy.api.php
modules/contrib/data_policy/modules/data_policy_export/data_policy_export.install
modules/contrib/data_policy/src/DataPolicyModuleInstaller.php
modules/contrib/data_policy/src/Form/InformBlockDeleteForm.php
modules/contrib/data_policy/data_policy.install
modules/contrib/data_policy/modules/data_policy_export/data_policy_export.module
modules/contrib/data_policy/modules/data_policy_export/src/Plugin/Action/ExportDataPolicy.php
modules/contrib/data_policy/src/DataPolicyServiceProvider.php
modules/contrib/data_policy/src/DataPolicyStorage.php
modules/contrib/data_policy/src/Form/InformBlockForm.php
modules/contrib/data_policy/src/DataPolicyStorageInterface.php
modules/contrib/data_policy/src/InformBlockInterface.php
modules/contrib/data_policy/src/DataPolicyTranslationHandler.php
modules/contrib/data_policy/src/Plugin/Block/DataPolicyInformBlock.php
modules/contrib/data_policy/src/Entity/DataPolicy.php
modules/contrib/data_policy/data_policy.module
modules/contrib/data_policy/src/Plugin/views/field/UserConsentDataPolicyRevision.php
modules/contrib/data_policy/modules/data_policy_export/src/Plugin/Annotation/DataPolicyExportPlugin.php
modules/contrib/data_policy/modules/data_policy_export/src/Plugin/DataPolicyExportPluginBase.php
modules/contrib/data_policy/data_policy.page.inc
modules/contrib/data_policy/src/Plugin/views/field/UserConsentState.php
modules/contrib/data_policy/modules/data_policy_export/src/Plugin/DataPolicyExportPluginInterface.php
modules/contrib/data_policy/modules/data_policy_export/src/Plugin/DataPolicyExportPluginManager.php
modules/contrib/data_policy/src/Plugin/views/filter/UserConsentDataPolicyRevision.php
modules/contrib/data_policy/src/Controller/DataPolicy.php
modules/contrib/data_policy/src/Entity/DataPolicyInterface.php
modules/contrib/data_policy/src/Entity/DataPolicyViewsData.php
modules/contrib/data_policy/src/Entity/InformBlock.php
modules/contrib/data_policy/src/Entity/UserConsent.php
modules/contrib/data_policy/src/Plugin/views/filter/UserConsentState.php
modules/contrib/data_policy/src/ProxyClass/DataPolicyModuleInstaller.php
modules/contrib/data_policy/src/Entity/UserConsentInterface.php
modules/contrib/data_policy/src/Entity/UserConsentViewsData.php
modules/contrib/data_policy/src/Form/DataPolicyAddForm.php
modules/contrib/data_policy/src/RedirectSubscriber.php
modules/contrib/data_policy/src/Form/DataPolicyAgreement.php
modules/contrib/data_policy/src/Controller/DataPolicyInformController.php
modules/contrib/data_policy/src/Controller/InformBlockListBuilder.php
modules/contrib/data_policy/src/DataPolicyAccessControlHandler.php
modules/contrib/data_policy/src/DataPolicyConsentManager.php
modules/contrib/data_policy/src/Form/DataPolicyForm.php
modules/contrib/data_policy/src/UserConsentHtmlRouteProvider.php
modules/contrib/data_policy/src/UserConsentListBuilder.php
modules/contrib/data_policy/src/Form/DataPolicyRevisionDeleteForm.php
modules/contrib/data_policy/src/Form/DataPolicyRevisionEdit.php
modules/contrib/data_policy/src/Form/DataPolicyRevisionRevertForm.php
modules/contrib/data_policy/src/DataPolicyConsentManagerInterface.php
modules/contrib/data_policy/src/DataPolicyHtmlRouteProvider.php
modules/contrib/data_policy/src/Form/DataPolicyRevisionRevertTranslationForm.php
modules/contrib/data_policy/src/Form/DataPolicySettingsForm.php
modules/contrib/data_policy/src/DataPolicyInformAccessControlHandler.php
modules/contrib/data_policy/src/DataPolicyListBuilder.php

4 files with changes
====================

1) modules/contrib/data_policy/data_policy.install:129

    ---------- begin diff ----------
@@ @@
 function data_policy_update_8004() {
   $name = 'views.view.data_policy_agreements';

-  $install_source = drupal_get_path('module', 'data_policy') . '/config/install';
+  $install_source = \Drupal::service('extension.list.module')->getPath('data_policy') . '/config/install';
   $source = new FileStorage($install_source);
   $config_storage = \Drupal::service('config.storage');
   $config_storage->write($name, $source->read($name));
    ----------- end diff -----------

Applied rules:
 * DrupalGetPathRector
 * ArgumentRemoverRector


2) modules/contrib/data_policy/data_policy.api.php:0

    ---------- begin diff ----------
@@ @@
 <?php

+use Drupal\Core\Session\AccountProxyInterface;
+use Drupal\Core\Routing\RedirectDestinationInterface;
 /**
  * @file
  * Documentation for Data Policy API.
  */
-
 /**
  * Alter the data policy destination before performing the redirect.
  *
@@ @@
  * @return \Drupal\Core\Routing\RedirectDestinationInterface
  *   An altered data policy destination url.
  */
-function hook_data_policy_destination_alter(\Drupal\Core\Session\AccountProxyInterface $current_user, \Drupal\Core\Routing\RedirectDestinationInterface $destination) {
+function hook_data_policy_destination_alter(AccountProxyInterface $current_user, RedirectDestinationInterface $destination) {
   if ($current_user->isAnonymous()) {
     $destination->set('/user/login');
   }
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector


3) modules/contrib/data_policy/src/RedirectSubscriber.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\data_policy;

+use Symfony\Component\HttpKernel\Event\RequestEvent;
 use Drupal\Core\Config\ConfigFactoryInterface;
 use Drupal\Core\Database\Connection;
 use Drupal\Core\Entity\EntityTypeManagerInterface;
@@ @@
 use Drupal\data_policy\Entity\DataPolicyInterface;
 use Symfony\Component\EventDispatcher\EventSubscriberInterface;
 use Symfony\Component\HttpFoundation\RedirectResponse;
-use Symfony\Component\HttpKernel\Event\GetResponseEvent;
 use Symfony\Component\HttpKernel\KernelEvents;

 /**
@@ @@
   /**
    * This method is called when the KernelEvents::REQUEST event is dispatched.
    *
-   * @param \Symfony\Component\HttpKernel\Event\GetResponseEvent $event
+   * @param \Symfony\Component\HttpKernel\Event\RequestEvent $event
    *   The event.
    */
-  public function checkForRedirection(GetResponseEvent $event): void {
+  public function checkForRedirection(RequestEvent $event): void {
     // Check if a data policy is set.
     if (!$this->dataPolicyConsentManager->isDataPolicy()) {
       return;
@@ @@
   /**
    * Do redirect to the agreement page.
    *
-   * @param \Symfony\Component\HttpKernel\Event\GetResponseEvent $event
+   * @param \Symfony\Component\HttpKernel\Event\RequestEvent $event
    *   The event.
    */
-  private function doRedirect(GetResponseEvent $event): void {
+  private function doRedirect(RequestEvent $event): void {
     // Set the destination that redirects the user after accepting the
     // data policy agreements.
     $destination = $this->getDestination();
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * RenameClassRector
 * WrapReturnRector


4) modules/contrib/data_policy/modules/data_policy_export/src/Plugin/Action/ExportDataPolicy.php:173

    ---------- begin diff ----------
@@ @@
       $name = basename($this->context['sandbox']['results']['file_path']);
       $path = 'private://csv';

-      if ($this->fileSystem->prepareDirectory($path, FileSystemInterface::CREATE_DIRECTORY | FileSystemInterface::MODIFY_PERMISSIONS) && (file_save_data($data, $path . '/' . $name))) {
-        $url = Url::fromUri(file_create_url($path . '/' . $name));
+      if ($this->fileSystem->prepareDirectory($path, FileSystemInterface::CREATE_DIRECTORY | FileSystemInterface::MODIFY_PERMISSIONS) && (\Drupal::service('file.repository')->writeData($data, $path . '/' . $name))) {
+        $url = \Drupal::service('file_url_generator')->generate($path . '/' . $name);
         $link = Link::fromTextAndUrl($this->t('Download file'), $url);

         $this->messenger()->addMessage($this->t('Export is complete. @link', [
    ----------- end diff -----------

Applied rules:
 * FileSaveDataRector
 * FromUriRector
 * ArgumentRemoverRector
 * WrapReturnRector


 [OK] 4 files have been changed by Rector                                       

