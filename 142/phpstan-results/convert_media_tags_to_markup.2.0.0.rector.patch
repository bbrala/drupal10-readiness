diff --git a/convert_media_tags_to_markup.info.yml b/convert_media_tags_to_markup.info.yml
index ec9ec98..13bb0cf 100644
--- a/convert_media_tags_to_markup.info.yml
+++ b/convert_media_tags_to_markup.info.yml
@@ -1,8 +1,7 @@
 name: Convert Media Tags to Markup
 type: module
 description: 'Converts media tags to markup.'
-core: 8.x
-core_version_requirement: ^8 || ^9
+core_version_requirement: ^9.3 || ^10
 php: '7.x'
 
 # Information added by Drupal.org packaging script on 2020-12-03
diff --git a/src/ConvertMediaTagsToMarkup/App.php b/src/ConvertMediaTagsToMarkup/App.php
index 08da596..065bd66 100644
--- a/src/ConvertMediaTagsToMarkup/App.php
+++ b/src/ConvertMediaTagsToMarkup/App.php
@@ -74,7 +74,7 @@ class App {
 
       $file = $this->fileLoad($tag_info['fid']);
       $uri = $file->getFileUri();
-      $filepath = file_url_transform_relative(file_create_url($uri));
+      $filepath = \Drupal::service('file_url_generator')->generateString($uri);
       $alt = empty($tag_info['attributes']['alt']) ? '' : $tag_info['attributes']['alt'];
       $title = $alt;
       $height = empty($tag_info['attributes']['height']) ? '' : 'height="' . $tag_info['attributes']['height'] . '"';
diff --git a/test/Component/Plugin/Filter/ConvertLegacyMediaTagsToMarkupTest.php b/test/Component/Plugin/Filter/ConvertLegacyMediaTagsToMarkupTest.php
index 787ee44..341c976 100644
--- a/test/Component/Plugin/Filter/ConvertLegacyMediaTagsToMarkupTest.php
+++ b/test/Component/Plugin/Filter/ConvertLegacyMediaTagsToMarkupTest.php
@@ -14,11 +14,7 @@ class ConvertLegacyMediaTagsToMarkupTest extends TestCase {
    * Smoke test.
    */
   public function testSmoke() {
-    $object = $this->getMockBuilder(ConvertLegacyMediaTagsToMarkup::class)
-      // NULL = no methods are mocked; otherwise list the methods here.
-      ->setMethods(NULL)
-      ->disableOriginalConstructor()
-      ->getMock();
+    $object = $this->createMock(ConvertLegacyMediaTagsToMarkup::class);
 
     $this->assertTrue(is_object($object));
   }
