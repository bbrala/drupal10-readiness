diff --git a/src/RectorProcessor.php b/src/RectorProcessor.php
index 7aae3df..470a9cf 100644
--- a/src/RectorProcessor.php
+++ b/src/RectorProcessor.php
@@ -112,7 +112,7 @@ class RectorProcessor {
       return FALSE;
     }
 
-    $module_path = DRUPAL_ROOT . '/' . drupal_get_path('module', 'upgrade_rector');
+    $module_path = DRUPAL_ROOT . '/' . \Drupal::service('extension.list.module')->getPath('upgrade_rector');
     $config = file_get_contents($module_path . '/rector-config-template.php');
     $config = str_replace('$vendor_dir', "'" . $vendor_path . "'", $config);
     // Replace backslash for Windows compatibility.
diff --git a/tests/modules/upgrade_rector_test_error/upgrade_rector_test_error.module b/tests/modules/upgrade_rector_test_error/upgrade_rector_test_error.module
index 2fa72c4..feae8fa 100644
--- a/tests/modules/upgrade_rector_test_error/upgrade_rector_test_error.module
+++ b/tests/modules/upgrade_rector_test_error/upgrade_rector_test_error.module
@@ -1,10 +1,11 @@
 <?php
 
+use Drupal\Core\Url;
 /**
  * Sample code to test ourselves for now.
  */
 function upgrade_rector_test_sample() {
   $foo = LOCALE_PLURAL_DELIMITER;
-  drupal_set_message('Sample message');
-  $url = Drupal::url('<front');
+  \Drupal::messenger()->addStatus('Sample message');
+  $url = Url::fromRoute('<front')->toString();
 }
diff --git a/tests/src/Functional/UpgradeRectorUiTest.php b/tests/src/Functional/UpgradeRectorUiTest.php
index a157dc1..a22e881 100644
--- a/tests/src/Functional/UpgradeRectorUiTest.php
+++ b/tests/src/Functional/UpgradeRectorUiTest.php
@@ -50,7 +50,8 @@ class UpgradeRectorUiTest extends BrowserTestBase {
     $edit = [
       'custom[data][project]' => 'upgrade_rector_test_error',
     ];
-    $this->drupalPostForm('admin/reports/upgrade-rector', $edit, 'Run rector');
+    $this->drupalGet('admin/reports/upgrade-rector');
+    $this->submitForm($edit, 'Run rector');
 
     $page = $this->getSession()->getPage();
     $assert_session = $this->assertSession();
