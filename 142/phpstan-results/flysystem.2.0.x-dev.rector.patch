diff --git a/flysystem.info.yml b/flysystem.info.yml
index 2bcc572..11595b8 100644
--- a/flysystem.info.yml
+++ b/flysystem.info.yml
@@ -2,4 +2,4 @@ name: Flysystem
 description: 'Provides access to various filesystem backends using Flysystem.'
 package: Flysystem
 type: module
-core_version_requirement: ^8.8 || ^9
+core_version_requirement: ^9.3 || ^10
diff --git a/src/Asset/CssOptimizer.php b/src/Asset/CssOptimizer.php
index 1e16e36..087a895 100644
--- a/src/Asset/CssOptimizer.php
+++ b/src/Asset/CssOptimizer.php
@@ -24,7 +24,7 @@ class CssOptimizer extends DrupalCssOptimizer {
     }
 
     // file_url_transform_relative() was removed here.
-    return 'url(' . file_create_url($path) . ')';
+    return 'url(' . \Drupal::service('file_url_generator')->generateAbsoluteString($path) . ')';
   }
 
 }
diff --git a/src/Event/EnsureEvent.php b/src/Event/EnsureEvent.php
index 304b9ba..82b66ae 100644
--- a/src/Event/EnsureEvent.php
+++ b/src/Event/EnsureEvent.php
@@ -2,7 +2,7 @@
 
 namespace Drupal\flysystem\Event;
 
-use Symfony\Component\EventDispatcher\Event;
+use Symfony\Contracts\EventDispatcher\Event;
 
 /**
  * The event fired for every result from an ensure() call.
diff --git a/src/FlysystemFactory.php b/src/FlysystemFactory.php
index 41fb8c8..73366d8 100644
--- a/src/FlysystemFactory.php
+++ b/src/FlysystemFactory.php
@@ -189,7 +189,7 @@ class FlysystemFactory {
           $error['context']
         );
 
-        $this->eventDispatcher->dispatch(FlysystemEvents::ENSURE, $event);
+        $this->eventDispatcher->dispatch($event, FlysystemEvents::ENSURE);
 
         $errors[$scheme][] = $error;
       }
diff --git a/tests/src/Kernel/CollectionOptimizerTest.php b/tests/src/Kernel/CollectionOptimizerTest.php
index a6dd6fc..b6aa0e7 100644
--- a/tests/src/Kernel/CollectionOptimizerTest.php
+++ b/tests/src/Kernel/CollectionOptimizerTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\flysystem\Kernel;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Core\Asset\AssetCollectionGrouperInterface;
 use Drupal\Core\Asset\CssOptimizer;
 use Drupal\Core\Asset\JsOptimizer;
@@ -20,10 +21,11 @@ use org\bovigo\vfs\vfsStream;
  */
 class CollectionOptimizerTest extends KernelTestBase {
 
+  use ProphecyTrait;
   /**
    * {@inheritdoc}
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
     $this->cleanUp();
   }
@@ -31,7 +33,7 @@ class CollectionOptimizerTest extends KernelTestBase {
   /**
    * {@inheritdoc}
    */
-  public function tearDown() {
+  public function tearDown(): void {
     $this->cleanUp();
     parent::tearDown();
   }
@@ -68,7 +70,7 @@ class CollectionOptimizerTest extends KernelTestBase {
 
     foreach ($this->jsFilesUnderTest() as $js_file => $expired) {
       if ($expired === TRUE) {
-        $this->assertFileNotExists($js_file);
+        $this->assertFileDoesNotExist($js_file);
         continue;
       }
       $this->assertFileExists($js_file);
@@ -108,7 +110,7 @@ class CollectionOptimizerTest extends KernelTestBase {
 
     foreach ($this->cssFilesUnderTest() as $css_file => $expired) {
       if ($expired === TRUE) {
-        $this->assertFileNotExists($css_file);
+        $this->assertFileDoesNotExist($css_file);
         continue;
       }
       $this->assertFileExists($css_file);
diff --git a/tests/src/Unit/EventSubscriber/EnsureSubscriberTest.php b/tests/src/Unit/EventSubscriber/EnsureSubscriberTest.php
index 156a003..35cf185 100644
--- a/tests/src/Unit/EventSubscriber/EnsureSubscriberTest.php
+++ b/tests/src/Unit/EventSubscriber/EnsureSubscriberTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\flysystem\Unit\EventSubscriber;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Tests\UnitTestCase;
 use Drupal\flysystem\EventSubscriber\EnsureSubscriber;
 use Drupal\flysystem\Event\EnsureEvent;
@@ -17,6 +18,7 @@ use Symfony\Component\EventDispatcher\EventDispatcherInterface;
  */
 class EnsureSubscriberTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
    * Tests that the event subscriber logs ensure() calls.
    */
diff --git a/tests/src/Unit/Flysystem/Adapter/CacheItemBackendTest.php b/tests/src/Unit/Flysystem/Adapter/CacheItemBackendTest.php
index dbf423d..a4d84ea 100644
--- a/tests/src/Unit/Flysystem/Adapter/CacheItemBackendTest.php
+++ b/tests/src/Unit/Flysystem/Adapter/CacheItemBackendTest.php
@@ -32,7 +32,7 @@ class CacheItemBackendTest extends UnitTestCase {
   /**
    * {@inheritdoc}
    */
-  public function setup() {
+  public function setup(): void {
     $this->cacheBackend = new MemoryBackend('foo');
     $this->cacheItemBackend = new CacheItemBackend('test-scheme', $this->cacheBackend);
   }
diff --git a/tests/src/Unit/Flysystem/Adapter/DrupalCacheAdapterTest.php b/tests/src/Unit/Flysystem/Adapter/DrupalCacheAdapterTest.php
index e655a5b..79c71c0 100644
--- a/tests/src/Unit/Flysystem/Adapter/DrupalCacheAdapterTest.php
+++ b/tests/src/Unit/Flysystem/Adapter/DrupalCacheAdapterTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\flysystem\Unit\Flysystem\Adapter;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Core\Cache\MemoryBackend;
 use Drupal\Tests\UnitTestCase;
 use Drupal\flysystem\Flysystem\Adapter\CacheItemBackend;
@@ -32,11 +33,12 @@ class DrupalCacheAdapterTest extends UnitTestCase {
    * @var string
    */
   const FILE = 'test.txt';
+  use ProphecyTrait;
 
   /**
    * The wrapped Flysytem adaper.
    *
-   * @var \League\Flysystem\AdapterInterface|\PHPUnit_Framework_MockObject_MockObject
+   * @var \League\Flysystem\AdapterInterface|\PHPUnit\Framework\MockObject\MockObject
    */
   protected $adapter;
 
@@ -57,7 +59,7 @@ class DrupalCacheAdapterTest extends UnitTestCase {
   /**
    * {@inheritdoc}
    */
-  public function setup() {
+  public function setup(): void {
     $this->cacheItemBackend = new CacheItemBackend(static::SCHEME, new MemoryBackend('foo'));
     $this->adapter = $this->prophesize(AdapterInterface::class);
     $this->cacheAdapter = new DrupalCacheAdapter(static::SCHEME, $this->adapter->reveal(), $this->cacheItemBackend);
diff --git a/tests/src/Unit/Flysystem/FtpTest.php b/tests/src/Unit/Flysystem/FtpTest.php
index 0e657a7..2f28bf7 100644
--- a/tests/src/Unit/Flysystem/FtpTest.php
+++ b/tests/src/Unit/Flysystem/FtpTest.php
@@ -17,7 +17,7 @@ namespace Drupal\Tests\flysystem\Unit\Flysystem {
     /**
      * {@inheritdoc}
      */
-    public function setUp() {
+    public function setUp(): void {
       parent::setUp();
       if (!defined('FTP_BINARY')) {
         $this->markTestSkipped('The FTP_BINARY constant is not defined.');
diff --git a/tests/src/Unit/Flysystem/LocalTest.php b/tests/src/Unit/Flysystem/LocalTest.php
index fbc75fa..a603d5c 100644
--- a/tests/src/Unit/Flysystem/LocalTest.php
+++ b/tests/src/Unit/Flysystem/LocalTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\flysystem\Unit\Flysystem;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Core\DependencyInjection\ContainerBuilder;
 use Drupal\Core\Logger\RfcLogLevel;
 use Drupal\Core\Routing\UrlGeneratorInterface;
@@ -18,10 +19,11 @@ use Prophecy\Argument;
  */
 class LocalTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
    * {@inheritdoc}
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
     $GLOBALS['base_url'] = 'http://example.com';
 
@@ -42,7 +44,7 @@ class LocalTest extends UnitTestCase {
   /**
    * {@inheritdoc}
    */
-  public function tearDown() {
+  public function tearDown(): void {
     (new LocalAdapter('foo'))->deleteDir('');
     @rmdir('foo');
 
diff --git a/tests/src/Unit/FlysystemBridgeTest.php b/tests/src/Unit/FlysystemBridgeTest.php
index ce3704e..6ee4279 100644
--- a/tests/src/Unit/FlysystemBridgeTest.php
+++ b/tests/src/Unit/FlysystemBridgeTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\flysystem\Unit;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Core\StreamWrapper\StreamWrapperInterface;
 use Drupal\Tests\UnitTestCase;
 use Drupal\flysystem\FlysystemBridge;
@@ -17,6 +18,7 @@ use Symfony\Component\DependencyInjection\ContainerBuilder;
  */
 class FlysystemBridgeTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
    * @var \Drupal\flysystem\FlysystemBridge
    */
@@ -30,7 +32,7 @@ class FlysystemBridgeTest extends UnitTestCase {
   /**
    * {@inheritdoc}
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
     $this->bridge = new FlysystemBridge();
     $this->bridge->setStringTranslation($this->getStringTranslationStub());
diff --git a/tests/src/Unit/FlysystemFactoryTest.php b/tests/src/Unit/FlysystemFactoryTest.php
index c9b99c9..dd4984b 100644
--- a/tests/src/Unit/FlysystemFactoryTest.php
+++ b/tests/src/Unit/FlysystemFactoryTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\flysystem\Unit;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Component\Plugin\PluginManagerInterface;
 use Drupal\Core\Cache\NullBackend;
 use Drupal\Core\File\FileSystemInterface as CoreFileSystemInterface;
@@ -25,6 +26,7 @@ use Symfony\Component\EventDispatcher\EventDispatcherInterface;
  */
 class FlysystemFactoryTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
    * @var \Drupal\Core\Cache\CacheBackendInterface
    */
@@ -53,7 +55,7 @@ class FlysystemFactoryTest extends UnitTestCase {
   /**
    * {@inheritdoc}
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
 
     $this->cache = new NullBackend('bin');
diff --git a/tests/src/Unit/FlysystemServiceProviderTest.php b/tests/src/Unit/FlysystemServiceProviderTest.php
index c0c2fde..7e7cd7d 100644
--- a/tests/src/Unit/FlysystemServiceProviderTest.php
+++ b/tests/src/Unit/FlysystemServiceProviderTest.php
@@ -33,7 +33,7 @@ class FlysystemServiceProviderTest extends UnitTestCase {
   /**
    * {@inheritdoc}
    */
-  public function setUp() {
+  public function setUp(): void {
     $this->container = new ContainerBuilder();
   }
 
diff --git a/tests/src/Unit/Form/ConfigFormTest.php b/tests/src/Unit/Form/ConfigFormTest.php
index 502e74d..9a3d17d 100644
--- a/tests/src/Unit/Form/ConfigFormTest.php
+++ b/tests/src/Unit/Form/ConfigFormTest.php
@@ -2,6 +2,8 @@
 
 namespace Drupal\Tests\flysystem\Unit\Form {
 
+  use Prophecy\PhpUnit\ProphecyTrait;
+  use Drupal\Core\Messenger\MessengerInterface;
   use function Drupal\flysystem\Form\batch_set;
   use Drupal\Core\Form\FormState;
   use Drupal\Core\Logger\LoggerChannelFactoryInterface;
@@ -21,6 +23,7 @@ namespace Drupal\Tests\flysystem\Unit\Form {
    */
   class ConfigFormTest extends UnitTestCase {
 
+    use ProphecyTrait;
     /**
      * The Flysystem factory prophecy.
      *
@@ -38,7 +41,7 @@ namespace Drupal\Tests\flysystem\Unit\Form {
     /**
      * {@inheritdoc}
      */
-    public function setUp() {
+    public function setUp(): void {
       parent::setUp();
 
       $this->factory = $this->prophesize(FlysystemFactory::class);
@@ -49,7 +52,7 @@ namespace Drupal\Tests\flysystem\Unit\Form {
 
       $this->form = new ConfigForm($this->factory->reveal());
       $this->form->setStringTranslation($this->getStringTranslationStub());
-      $messenger = $this->prophesize(\Drupal\Core\Messenger\MessengerInterface::class);
+      $messenger = $this->prophesize(MessengerInterface::class);
 
       $container = new ContainerBuilder();
       $container->set('string_translation', $this->getStringTranslationStub());
diff --git a/tests/src/Unit/InstallFunctionsTest.php b/tests/src/Unit/InstallFunctionsTest.php
index 7e046bc..5712de8 100644
--- a/tests/src/Unit/InstallFunctionsTest.php
+++ b/tests/src/Unit/InstallFunctionsTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\flysystem\Unit;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Core\Logger\RfcLogLevel;
 use Drupal\Core\Site\Settings;
 use Drupal\Tests\UnitTestCase;
@@ -16,6 +17,7 @@ use Twistor\FlysystemStreamWrapper;
  */
 class InstallFunctionsTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
    * The Flysystem factory prophecy object.
    *
@@ -26,7 +28,7 @@ class InstallFunctionsTest extends UnitTestCase {
   /**
    * {@inheritdoc}
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
 
     if (!defined('REQUIREMENT_ERROR')) {
diff --git a/tests/src/Unit/Logger/ConvertTest.php b/tests/src/Unit/Logger/ConvertTest.php
index 9dbd346..8198eb3 100644
--- a/tests/src/Unit/Logger/ConvertTest.php
+++ b/tests/src/Unit/Logger/ConvertTest.php
@@ -15,7 +15,7 @@ class ConvertTest extends UnitTestCase {
   /**
    * {@inheritdoc}
    */
-  public function setUp() {
+  public function setUp(): void {
     $consts = [
       'REQUIREMENT_INFO' => -1,
       'REQUIREMENT_OK' => 0,
diff --git a/tests/src/Unit/ModuleFunctionsTest.php b/tests/src/Unit/ModuleFunctionsTest.php
index 614e510..fec34ee 100644
--- a/tests/src/Unit/ModuleFunctionsTest.php
+++ b/tests/src/Unit/ModuleFunctionsTest.php
@@ -2,12 +2,13 @@
 
 namespace Drupal\Tests\flysystem\Unit;
 
+use Prophecy\PhpUnit\ProphecyTrait;
+use Symfony\Component\Mime\MimeTypesInterface;
 use Drupal\Core\StreamWrapper\StreamWrapperManagerInterface;
 use Drupal\Tests\UnitTestCase;
 use Drupal\flysystem\FlysystemFactory;
 use Prophecy\Argument;
 use Symfony\Component\DependencyInjection\ContainerBuilder;
-use Symfony\Component\HttpFoundation\File\MimeType\MimeTypeGuesserInterface;
 use org\bovigo\vfs\vfsStream;
 
 /**
@@ -17,6 +18,7 @@ use org\bovigo\vfs\vfsStream;
  */
 class ModuleFunctionsTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
    * The Flysystem factory prophecy object.
    *
@@ -27,7 +29,7 @@ class ModuleFunctionsTest extends UnitTestCase {
   /**
    * {@inheritdoc}
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
     vfsStream::setup('module_file');
 
@@ -42,7 +44,7 @@ class ModuleFunctionsTest extends UnitTestCase {
       return $scheme;
     });
 
-    $guesser = $this->prophesize(MimeTypeGuesserInterface::class);
+    $guesser = $this->prophesize(MimeTypesInterface::class);
     $guesser->guess(Argument::type('string'))->willReturn('txt/flysystem');
 
     $container = new ContainerBuilder();
diff --git a/tests/src/Unit/PathProcessor/LocalPathProcessorTest.php b/tests/src/Unit/PathProcessor/LocalPathProcessorTest.php
index a601bf1..84e09a4 100644
--- a/tests/src/Unit/PathProcessor/LocalPathProcessorTest.php
+++ b/tests/src/Unit/PathProcessor/LocalPathProcessorTest.php
@@ -21,7 +21,7 @@ class LocalPathProcessorTest extends UnitTestCase {
   /**
    * {@inheritdoc}
    */
-  public function setUp() {
+  public function setUp(): void {
     new Settings(
       [
         'flysystem' => [
diff --git a/tests/src/Unit/Plugin/FlysystemUrlTraitTest.php b/tests/src/Unit/Plugin/FlysystemUrlTraitTest.php
index 15c2b66..8fc9bdb 100644
--- a/tests/src/Unit/Plugin/FlysystemUrlTraitTest.php
+++ b/tests/src/Unit/Plugin/FlysystemUrlTraitTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\flysystem\Unit\Plugin;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Core\DependencyInjection\ContainerBuilder;
 use Drupal\Core\Routing\UrlGenerator;
 use Drupal\Tests\UnitTestCase;
@@ -13,6 +14,7 @@ use Drupal\flysystem\Plugin\FlysystemUrlTrait;
  */
 class FlysystemUrlTraitTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
    * @covers ::getExternalUrl
    * @covers ::getScheme
diff --git a/tests/src/Unit/Plugin/ImageStyleGenerationTraitTest.php b/tests/src/Unit/Plugin/ImageStyleGenerationTraitTest.php
index 20b4623..ae8d9fb 100644
--- a/tests/src/Unit/Plugin/ImageStyleGenerationTraitTest.php
+++ b/tests/src/Unit/Plugin/ImageStyleGenerationTraitTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\flysystem\Unit\Plugin;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Core\DependencyInjection\ContainerBuilder;
 use Drupal\Core\Entity\EntityStorageInterface;
 use Drupal\Core\Entity\EntityTypeManagerInterface;
@@ -20,6 +21,7 @@ use org\bovigo\vfs\vfsStream;
  */
 class ImageStyleGenerationTraitTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
    * @covers ::generateImageStyle
    */
diff --git a/tests/src/Unit/Routing/FlysystemRoutesTest.php b/tests/src/Unit/Routing/FlysystemRoutesTest.php
index 1212658..8c9392a 100644
--- a/tests/src/Unit/Routing/FlysystemRoutesTest.php
+++ b/tests/src/Unit/Routing/FlysystemRoutesTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\flysystem\Unit\Routing;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Core\DependencyInjection\ContainerBuilder;
 use Drupal\Core\Extension\ModuleHandlerInterface;
 use Drupal\Core\Site\Settings;
@@ -17,6 +18,7 @@ use Drupal\flysystem\Routing\FlysystemRoutes;
  */
 class FlysystemRoutesTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
    * @var \Drupal\flysystem\FlysystemFactory
    */
@@ -35,7 +37,7 @@ class FlysystemRoutesTest extends UnitTestCase {
   /**
    * {@inheritdoc}
    */
-  public function setUp() {
+  public function setUp(): void {
     $container = new ContainerBuilder();
 
     $stream_wrapper = $this->prophesize(LocalStream::class);
