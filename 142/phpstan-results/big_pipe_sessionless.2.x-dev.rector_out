modules/contrib/big_pipe_sessionless/src/BigPipeSessionlessServiceProvider.php
modules/contrib/big_pipe_sessionless/src/EventSubscriber/HtmlResponseBigPipeSessionlessSubscriber.php
modules/contrib/big_pipe_sessionless/src/PageCache/ResponsePolicy/DenyBigPipeSessionlessResponses.php
modules/contrib/big_pipe_sessionless/src/Render/BigPipeSessionless.php
modules/contrib/big_pipe_sessionless/src/Render/Placeholder/BigPipeSessionlessStrategy.php
modules/contrib/big_pipe_sessionless/src/StackMiddleware/BigPipeSessionlessPageCache.php
modules/contrib/big_pipe_sessionless/tests/modules/big_pipe_sessionless_test/src/BigPipeSessionlessTestController.php
modules/contrib/big_pipe_sessionless/tests/src/Functional/BigPipeSessionlessRegressionTest.php
modules/contrib/big_pipe_sessionless/tests/src/Functional/BigPipeSessionlessTest.php
modules/contrib/big_pipe_sessionless/tests/src/Unit/Render/Placeholder/BigPipeSessionlessStrategyTest.php

2 files with changes
====================

1) modules/contrib/big_pipe_sessionless/tests/src/Unit/Render/Placeholder/BigPipeSessionlessStrategyTest.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\Tests\big_pipe_sessionless\Unit\Render\Placeholder;

+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\big_pipe_test\BigPipePlaceholderTestCases;
 use Drupal\big_pipe_sessionless\Render\Placeholder\BigPipeSessionlessStrategy;
 use Drupal\Core\Routing\RouteMatchInterface;
@@ @@
  */
 class BigPipeSessionlessStrategyTest extends UnitTestCase {

+  use ProphecyTrait;
   /**
    * @covers ::processPlaceholders
    *
    ----------- end diff -----------

Applied rules:
 * AddProphecyTraitRector (https://github.com/sebastianbergmann/phpunit/issues/4142)
 * ArgumentRemoverRector
 * WrapReturnRector
 * ChangeMethodVisibilityRector


2) modules/contrib/big_pipe_sessionless/tests/src/Functional/BigPipeSessionlessTest.php:57

    ---------- begin diff ----------
@@ @@
     ];

     foreach ($cases as $case => $expectations) {
-      $this->pass("No-session test case: $case");
-
       // Simulate production.
       $this->config('system.logging')->set('error_level', ERROR_REPORTING_HIDE)->save();
       $this->config('system.performance')->set('cache.page.max_age', $expectations['configured max-age'])->save();
@@ @@

       $this->assertSessionCookieExists(FALSE);
       $this->assertBigPipeNoJsCookieExists(FALSE);
-
-      $this->pass('First request: Page Cache miss, streamed response by BigPipe');
       $this->drupalGet(Url::fromRoute('big_pipe_sessionless_test'));
       $this->assertNull($this->drupalGetHeader('X-Drupal-Cache'), 'No X-Drupal-Cache header.');
       $this->assertBigPipeResponseHeadersPresent();
       $this->assertSession()->responseHeaderNotContains('X-Drupal-Cache-Tags', 'cache_tag_set_in_lazy_builder');
-      $this->assertRaw('<a href="' . base_path() . 'big_pipe_sessionless_test" data-drupal-link-system-path="big_pipe_sessionless_test" class="is-active">This should be marked active</a>');
-      $this->assertRaw('<a href="' . base_path() . '" data-drupal-link-system-path="&lt;front&gt;">This should be marked inactive</a>');
+      $this->assertSession()->responseContains('<a href="' . base_path() . 'big_pipe_sessionless_test" data-drupal-link-system-path="big_pipe_sessionless_test" class="is-active">This should be marked active</a>');
+      $this->assertSession()->responseContains('<a href="' . base_path() . '" data-drupal-link-system-path="&lt;front&gt;">This should be marked inactive</a>');

       $cases = $this->getTestCases();
       $this->assertBigPipeNoJsPlaceholders([
@@ @@
         $cases['exception__lazy_builder']->bigPipePlaceholderId => NULL,
         $cases['exception__embedded_response']->bigPipePlaceholderId => NULL,
       ]);
-
-      $this->pass('Verifying there are no BigPipe placeholders & replacements.');
-      $this->assertEqual('<none>', $this->drupalGetHeader('BigPipe-Test-Placeholders'));
-      $this->pass('Verifying BigPipe start/stop signals are absent.');
+      $this->assertEquals('<none>', $this->drupalGetHeader('BigPipe-Test-Placeholders'));
       // BigPipe start signal absent.
-      $this->assertNoRaw(BigPipe::START_SIGNAL);
+      $this->assertSession()->responseNotContains(BigPipe::START_SIGNAL);
       // BigPipe stop signal absent.
-      $this->assertNoRaw(BigPipe::STOP_SIGNAL);
-
-      $this->pass('Verifying BigPipe assets are absent.');
+      $this->assertSession()->responseNotContains(BigPipe::STOP_SIGNAL);
       $this->assertTrue(empty($this->getDrupalSettings()), 'drupalSettings and BigPipe asset library absent.');
       // Closing body tag present.
-      $this->assertRaw('</body>');
-
-      $this->pass('Repeat request: Page Cache hit, BigPipe not involved');
+      $this->assertSession()->responseContains('</body>');
       $this->drupalGet(Url::fromRoute('big_pipe_sessionless_test'));
-      $this->assertIdentical('HIT', $this->drupalGetHeader('X-Drupal-Cache'), 'Page cache hit.');
-      $this->assertIdentical($expectations['page cache hit cache control'], $this->drupalGetHeader('Cache-Control'));
+      $this->assertSame('HIT', $this->drupalGetHeader('X-Drupal-Cache'), 'Page cache hit.');
+      $this->assertSame($expectations['page cache hit cache control'], $this->drupalGetHeader('Cache-Control'));
       $this->assertNull($this->drupalGetHeader('Surrogate-Control'), 'No Surrogate-Control header.');
       $this->assertNull($this->drupalGetHeader('X-Accel-Buffering'), 'No X-Accel-Buffering header.');
-      $this->assertCacheTag('cache_tag_set_in_lazy_builder');
-      $this->assertRaw('<a href="' . base_path() . 'big_pipe_sessionless_test" data-drupal-link-system-path="big_pipe_sessionless_test" class="is-active">This should be marked active</a>');
-      $this->assertRaw('<a href="' . base_path() . '" data-drupal-link-system-path="&lt;front&gt;">This should be marked inactive</a>');
+      $this->assertSession()->responseHeaderContains('X-Drupal-Cache-Tags', 'cache_tag_set_in_lazy_builder');
+      $this->assertSession()->responseContains('<a href="' . base_path() . 'big_pipe_sessionless_test" data-drupal-link-system-path="big_pipe_sessionless_test" class="is-active">This should be marked active</a>');
+      $this->assertSession()->responseContains('<a href="' . base_path() . '" data-drupal-link-system-path="&lt;front&gt;">This should be marked inactive</a>');

       // Clear the Page Cache. Note that we use a cache tag that exists on this
       // response, despite it being absent from both the Page Cache miss
@@ @@
       // (because it is identical to the original Page Cache miss response,
       // minus the streaming).
       Cache::invalidateTags(['cache_tag_set_in_lazy_builder']);
-
-      // Simulate development.
-      $this->pass('Verifying BigPipe provides useful error output when an error occurs while rendering a placeholder if verbose error logging is enabled.');
       $this->config('system.logging')->set('error_level', ERROR_REPORTING_DISPLAY_VERBOSE)->save();
       $this->drupalGet(Url::fromRoute('big_pipe_sessionless_test'));
       // The 'edge_case__html_exception' case throws an exception.
-      $this->assertRaw('The website encountered an unexpected error. Please try again later');
-      $this->assertRaw('You are not allowed to say llamas are not cool!');
+      $this->assertSession()->responseContains('The website encountered an unexpected error. Please try again later');
+      $this->assertSession()->responseContains('You are not allowed to say llamas are not cool!');
       // Closing body tag absent: error occurred before then.
-      $this->assertNoRaw('</body>');
+      $this->assertSession()->responseNotContains('</body>');
       // The exception is expected. Do not interpret it as a test failure.
       unlink(\Drupal::root() . '/' . $this->siteDirectory . '/error.log');
    ----------- end diff -----------

Applied rules:
 * AssertCacheTagRector
 * AssertEqualRector
 * AssertIdenticalRector
 * AssertNoRawRector
 * AssertRawRector
 * PassRector
 * ArgumentRemoverRector
 * WrapReturnRector
 * ChangeMethodVisibilityRector


 [OK] 2 files have been changed by Rector                                       

