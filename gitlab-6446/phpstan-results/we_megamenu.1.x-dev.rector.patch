diff --git a/src/Controller/WeMegaMenuAdminController.php b/src/Controller/WeMegaMenuAdminController.php
index 301f0ba..4697ca4 100644
--- a/src/Controller/WeMegaMenuAdminController.php
+++ b/src/Controller/WeMegaMenuAdminController.php
@@ -102,7 +102,7 @@ class WeMegaMenuAdminController extends ControllerBase {
   public function resetConfigWeMegaMenu() {
     if (isset($_POST['action']) && $_POST['action'] == 'reset' && isset($_POST['menu_name']) && isset($_POST['theme'])) {
       $theme_array = WeMegaMenuBuilder::renderWeMegaMenuBlock($_POST['menu_name'], $_POST['theme']);
-      $markup = render($theme_array);
+      $markup = \Drupal::service('renderer')->render($theme_array);
       echo $markup;
       we_megamenu_flush_render_cache();
       exit;
@@ -115,7 +115,7 @@ class WeMegaMenuAdminController extends ControllerBase {
       $result = $query->execute();
       WeMegaMenuBuilder::initMegamenu($_POST['menu_name'], $_POST['theme']);
       $theme_array = WeMegaMenuBuilder::renderWeMegaMenuBlock($_POST['menu_name'], $_POST['theme']);
-      $markup = render($theme_array);
+      $markup = \Drupal::service('renderer')->render($theme_array);
       echo $markup;
       we_megamenu_flush_render_cache();
       exit;
diff --git a/src/WeMegaMenuBuilder.php b/src/WeMegaMenuBuilder.php
index eb5a2bc..6cf5975 100644
--- a/src/WeMegaMenuBuilder.php
+++ b/src/WeMegaMenuBuilder.php
@@ -255,7 +255,7 @@ class WeMegaMenuBuilder {
         $html .= '<div class="type-of-block">';
         $html .= '<div class="block-inner">';
         $html .= $title_enable ? '<h2>' . $title . '</h2>' : '';
-        $html .= render($block_content);
+        $html .= \Drupal::service('renderer')->render($block_content);
         $html .= '</div>';
         $html .= '</div>';
       }
diff --git a/we_megamenu.install b/we_megamenu.install
index 307f364..b4ad153 100644
--- a/we_megamenu.install
+++ b/we_megamenu.install
@@ -1,5 +1,6 @@
 <?php
 
+use Drupal\Core\Database\Database;
 /**
  * @file
  * Create table we_megamenu().
@@ -37,6 +38,6 @@ function we_megamenu_schema() {
  */
 function we_megamenu_update_8101() {
   $sql = 'ALTER TABLE `we_megamenu` CHANGE `data_config` `data_config` LONGTEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL';
-  \Drupal\Core\Database\Database::getConnection()
+  Database::getConnection()
     ->query($sql);
-}
\ No newline at end of file
+}
