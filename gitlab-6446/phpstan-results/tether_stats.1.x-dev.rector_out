modules/contrib/tether_stats/src/Annotation/TetherStatsChartRenderer.php
modules/contrib/tether_stats/src/Entity/TetherStatsDerivative.php
modules/contrib/tether_stats/src/Tests/TetherStatsTestBase.php
modules/contrib/tether_stats/tests/src/Unit/TetherStatsRequestFilterTest.php
modules/contrib/tether_stats/src/Chart/TetherStatsChart.php
modules/contrib/tether_stats/src/Chart/TetherStatsChartIteratorInterface.php
modules/contrib/tether_stats/src/Chart/TetherStatsChartSchema.php
modules/contrib/tether_stats/src/Chart/TetherStatsChartableItemCollectionInterface.php
modules/contrib/tether_stats/src/Chart/TetherStatsChartableItemCollectionTrait.php
modules/contrib/tether_stats/src/Chart/TetherStatsComboChart.php
modules/contrib/tether_stats/tether_stats.api.php
modules/contrib/tether_stats/src/Event/TetherStatsRequestToElementEvent.php
modules/contrib/tether_stats/tether_stats.install
modules/contrib/tether_stats/src/EventSubscriber/TetherStatsRequestSubscriber.php
modules/contrib/tether_stats/src/Chart/TetherStatsComboChartSchema.php
modules/contrib/tether_stats/src/Chart/TetherStatsComboChartSchemaInterface.php
modules/contrib/tether_stats/src/Chart/TetherStatsPieChart.php
modules/contrib/tether_stats/src/TetherStatsAnalytics.php
modules/contrib/tether_stats/src/TetherStatsAnalyticsStorage.php
modules/contrib/tether_stats/src/Chart/TetherStatsPieChartSchema.php
modules/contrib/tether_stats/src/EventSubscriber/TetherStatsRequestToElementSubscriber.php
modules/contrib/tether_stats/src/Chart/TetherStatsSteppedChart.php
modules/contrib/tether_stats/tether_stats.module
modules/contrib/tether_stats/src/Chart/TetherStatsSteppedChartSchema.php
modules/contrib/tether_stats/src/Exception/TetherStatsDerivativeDisabledException.php
modules/contrib/tether_stats/src/Exception/TetherStatsDerivativeInvalidException.php
modules/contrib/tether_stats/src/Exception/TetherStatsDerivativeNotFoundException.php
modules/contrib/tether_stats/src/Exception/TetherStatsEntityInvalidException.php
modules/contrib/tether_stats/src/Exception/TetherStatsIncompleteIdentitySetException.php
modules/contrib/tether_stats/src/Exception/TetherStatsInvalidDateIntervalException.php
modules/contrib/tether_stats/src/Form/TetherStatsDerivativeDeleteForm.php
modules/contrib/tether_stats/src/Form/TetherStatsDerivativeDisableForm.php
modules/contrib/tether_stats/src/Form/TetherStatsDerivativeEnableForm.php
modules/contrib/tether_stats/src/Form/TetherStatsDerivativeForm.php
modules/contrib/tether_stats/src/Chart/TetherStatsSteppedChartSchemaInterface.php
modules/contrib/tether_stats/src/Controller/TetherStatsAutocompleteController.php
modules/contrib/tether_stats/src/TetherStatsAnalyticsStorageInterface.php
modules/contrib/tether_stats/src/TetherStatsChartRendererInterface.php
modules/contrib/tether_stats/src/TetherStatsChartRendererPluginManager.php
modules/contrib/tether_stats/src/TetherStatsDerivativeInterface.php
modules/contrib/tether_stats/src/Form/TetherStatsElementFinderForm.php
modules/contrib/tether_stats/src/TetherStatsDerivativeListBuilder.php
modules/contrib/tether_stats/src/Controller/TetherStatsChartController.php
modules/contrib/tether_stats/src/TetherStatsElement.php
modules/contrib/tether_stats/src/TetherStatsElementInterface.php
modules/contrib/tether_stats/src/TetherStatsEvents.php
modules/contrib/tether_stats/src/TetherStatsIdentitySet.php
modules/contrib/tether_stats/src/Controller/TetherStatsOverviewController.php
modules/contrib/tether_stats/src/TetherStatsIdentitySetInterface.php
modules/contrib/tether_stats/src/TetherStatsManager.php
modules/contrib/tether_stats/src/Form/TetherStatsSettingsForm.php
modules/contrib/tether_stats/src/Controller/TetherStatsTrackController.php
modules/contrib/tether_stats/src/TetherStatsManagerInterface.php
modules/contrib/tether_stats/src/TetherStatsRequestFilter.php
modules/contrib/tether_stats/src/TetherStatsRequestFilterInterface.php
modules/contrib/tether_stats/src/TetherStatsStorage.php
modules/contrib/tether_stats/src/Plugin/tether_stats/Chart/TetherStatsChartRendererGoogle.php
modules/contrib/tether_stats/src/TetherStatsStorageInterface.php
modules/contrib/tether_stats/src/Tests/TetherStatsAnalyticsStorageTest.php
modules/contrib/tether_stats/src/Tests/TetherStatsIdentitySetTest.php
modules/contrib/tether_stats/src/Tests/TetherStatsStorageTest.php

11 files with changes
=====================

1) modules/contrib/tether_stats/src/Controller/TetherStatsTrackController.php:114

    ---------- begin diff ----------
@@ @@
    * @return \Symfony\Component\HttpFoundation\JsonResponse
    *   The JSON response
    */
-  public function track($event_time = REQUEST_TIME) {
+  public function track($event_time = \Drupal::time()->getRequestTime()) {

     $response_json = [];
    ----------- end diff -----------

Applied rules:
 * RequestTimeConstRector
 * ArgumentRemoverRector
 * WrapReturnRector


2) modules/contrib/tether_stats/src/Controller/TetherStatsOverviewController.php:61

    ---------- begin diff ----------
@@ @@
       ];

       $finish_date = new \DateTime();
-      $finish_date->setTimestamp(REQUEST_TIME);
+      $finish_date->setTimestamp(\Drupal::time()->getRequestTime());

       // Borrow a stepped chart method to normalize the current time to
       // the start of the current day.
@@ @@
           }

           $finish_date = new \DateTime();
-          $finish_date->setTimestamp(REQUEST_TIME);
+          $finish_date->setTimestamp(\Drupal::time()->getRequestTime());

           // Borrow a stepped chart method to normalize the current time to
           // the start of the current day.
    ----------- end diff -----------

Applied rules:
 * RequestTimeConstRector
 * ArgumentRemoverRector
 * WrapReturnRector


3) modules/contrib/tether_stats/src/TetherStatsStorage.php:96

    ---------- begin diff ----------
@@ @@
       if (empty($element_values)) {

         $fields = $identity_set->getIdentityParams();
-        $fields['created'] = REQUEST_TIME;
-        $fields['changed'] = REQUEST_TIME;
+        $fields['created'] = \Drupal::time()->getRequestTime();
+        $fields['changed'] = \Drupal::time()->getRequestTime();
         $fields['last_activity'] = 0;
         $fields['count'] = 0;

@@ @@
         $element_values = $fields;
         $element_values['elid'] = $elid;
       }
-      elseif ((REQUEST_TIME - $element_values['changed']) >= $config->get('advanced.element_ttl')) {
+      elseif ((\Drupal::time()->getRequestTime() - $element_values['changed']) >= $config->get('advanced.element_ttl')) {

         $fields = $identity_set->getIdentityParams();
-        $fields['changed'] = REQUEST_TIME;
+        $fields['changed'] = \Drupal::time()->getRequestTime();

         // Elements may sometimes need to be updated as entity urls may change.
         // The time to live setting will determine how long an element remains
    ----------- end diff -----------

Applied rules:
 * RequestTimeConstRector
 * ArgumentRemoverRector
 * WrapReturnRector


4) modules/contrib/tether_stats/src/Tests/TetherStatsTestBase.php:32

    ---------- begin diff ----------
@@ @@
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();

     $permissions = [
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * WrapReturnRector
 * AddReturnTypeDeclarationRector
 * ChangeMethodVisibilityRector


5) modules/contrib/tether_stats/src/Tests/TetherStatsStorageTest.php:85

    ---------- begin diff ----------
@@ @@
     $set = $this->getRandomIdentitySet();
     $set->set('derivative', 'derivative-simple');
     $element = $this->getStorage()->createElementFromIdentitySet($set);
-    $this->assert(isset($element), 'Successfully created an element with a derivative.');
+    $this->assertTrue(isset($element), 'Successfully created an element with a derivative.');

     // Test derivative usage.
     $num_elements = mt_rand(1, 5);
@@ @@

     $count = $this->getStorage()->getDerivativeUsageCount('derivative-simple');

-    $this->assertEqual($count, $num_elements, "Derivative usage count {$count} was counted correctly.");
+    $this->assertEquals($count, $num_elements, "Derivative usage count {$count} was counted correctly.");

   }

@@ @@

     $this->assertTrue(!empty($activity), 'An activity was recorded successfully.');

-    $this->assertEqual($activity->type, TetherStatsAnalytics::ACTIVITY_HIT, 'Type field same in recorded activity.');
-    $this->assertEqual($activity->uid, 1, 'Uid field same in recorded activity.');
-    $this->assertEqual($activity->referrer, 'referrer', 'Referrer field same in recorded activity.');
-    $this->assertEqual($activity->ip_address, '127.0.0.1', 'IP address field same in recorded activity.');
-    $this->assertEqual($activity->sid, $fake_sid, 'Session Id field same in recorded activity.');
-    $this->assertEqual($activity->browser, 'browser A', 'Browser field same in recorded activity.');
-    $this->assertEqual($activity->created, $time->getTimestamp(), 'Created field same in recorded activity.');
+    $this->assertEquals($activity->type, TetherStatsAnalytics::ACTIVITY_HIT, 'Type field same in recorded activity.');
+    $this->assertEquals($activity->uid, 1, 'Uid field same in recorded activity.');
+    $this->assertEquals($activity->referrer, 'referrer', 'Referrer field same in recorded activity.');
+    $this->assertEquals($activity->ip_address, '127.0.0.1', 'IP address field same in recorded activity.');
+    $this->assertEquals($activity->sid, $fake_sid, 'Session Id field same in recorded activity.');
+    $this->assertEquals($activity->browser, 'browser A', 'Browser field same in recorded activity.');
+    $this->assertEquals($activity->created, $time->getTimestamp(), 'Created field same in recorded activity.');

-    $this->assertEqual($activity->hour, $hour->getTimestamp(), 'Hour field correct in recorded activity.');
-    $this->assertEqual($activity->day, $day->getTimestamp(), 'Day field correct in recorded activity.');
-    $this->assertEqual($activity->month, $month->getTimestamp(), 'Month field correct in recorded activity.');
-    $this->assertEqual($activity->year, $year->getTimestamp(), 'Year field correct in recorded activity.');
+    $this->assertEquals($activity->hour, $hour->getTimestamp(), 'Hour field correct in recorded activity.');
+    $this->assertEquals($activity->day, $day->getTimestamp(), 'Day field correct in recorded activity.');
+    $this->assertEquals($activity->month, $month->getTimestamp(), 'Month field correct in recorded activity.');
+    $this->assertEquals($activity->year, $year->getTimestamp(), 'Year field correct in recorded activity.');

     // Track second activity.
     $this->getStorage()->trackActivity($source_element->getId(), TetherStatsAnalytics::ACTIVITY_HIT, $time->getTimestamp(), '127.0.0.1', $fake_sid, 'browser B', 'referrer', 1);
    ----------- end diff -----------

Applied rules:
 * AssertEqualRector
 * AssertRector
 * ArgumentRemoverRector
 * WrapReturnRector
 * ChangeMethodVisibilityRector


6) modules/contrib/tether_stats/src/Tests/TetherStatsIdentitySetTest.php:25

    ---------- begin diff ----------
@@ @@
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();

     // Create test page.
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * WrapReturnRector
 * AddReturnTypeDeclarationRector
 * ChangeMethodVisibilityRector


7) modules/contrib/tether_stats/src/Tests/TetherStatsAnalyticsStorageTest.php:63

    ---------- begin diff ----------
@@ @@
     // Extract the top elements within the active range  and test if
     // they line up with what they should be.
     $extracted_top_elements = $this->getAnalyticsStorage()->getTopElementsForActivity(TetherStatsAnalytics::ACTIVITY_HIT, $start, $finish, count($top_element_elids));
-    $this->assertEqual($top_element_elids, $extracted_top_elements, 'Top Elements For Hit Activity Retrieved Successfully.');
+    $this->assertEquals($top_element_elids, $extracted_top_elements, 'Top Elements For Hit Activity Retrieved Successfully.');
   }

   /**
@@ @@

     // Test element mining method.
     $count = $this->getAnalyticsStorage()->getElementActivityCount($element->getId(), TetherStatsAnalytics::ACTIVITY_HIT, $start, $finish);
-    $this->assertEqual($element_count, $count, 'getElementActivityCount Retrieved Correct Counts.');
+    $this->assertEquals($element_count, $count, 'getElementActivityCount Retrieved Correct Counts.');

     // Test all mining method.
     $all_count = $this->getAnalyticsStorage()->getAllActivityCount(TetherStatsAnalytics::ACTIVITY_HIT, $start, $finish);
-    $this->assertEqual($element_count + $other_count, $all_count, 'getAllActivityCount Retrieved Correct Counts.');
+    $this->assertEquals($element_count + $other_count, $all_count, 'getAllActivityCount Retrieved Correct Counts.');

     // Test the chronologically sequenced variant.
     $counts = $this->getAnalyticsStorage()->getAllActivityCount(TetherStatsAnalytics::ACTIVITY_HIT, $start, $finish, TetherStatsAnalytics::STEP_HOUR);
     $total_count = array_sum($counts);

-    $this->assertEqual($total_count, $all_count, 'getAllActivityCount Produced the Right Sum of Sequenced Results.');
+    $this->assertEquals($total_count, $all_count, 'getAllActivityCount Produced the Right Sum of Sequenced Results.');
   }

   /**
@@ @@
     foreach ($referrer_samples as $inx => $referrer) {

       $total_count = $this->getAnalyticsStorage()->getHitActivityWithReferrerCount($referrer_searches[$inx], $start, $finish);
-      $this->assertEqual($referrer_counts[$inx], $total_count, "getHitActivityWithReferrerCount Retrieved Correct Counts for {$referrer_searches[$inx]} search.");
+      $this->assertEquals($referrer_counts[$inx], $total_count, "getHitActivityWithReferrerCount Retrieved Correct Counts for {$referrer_searches[$inx]} search.");
     }

     // Generate element specific activity.
@@ @@
     foreach ($referrer_samples as $inx => $referrer) {

       $total_count = $this->getAnalyticsStorage()->getElementHitActivityWithReferrerCount($elid, $referrer_searches[$inx], $start, $finish);
-      $this->assertEqual($referrer_counts[$inx], $total_count, "getElementHitActivityWithReferrerCount Retrieved Correct Counts for {$referrer_searches[$inx]} search.");
+      $this->assertEquals($referrer_counts[$inx], $total_count, "getElementHitActivityWithReferrerCount Retrieved Correct Counts for {$referrer_searches[$inx]} search.");
     }
   }

@@ @@
     foreach ($browser_searches as $inx => $search) {

       $total_count = $this->getAnalyticsStorage()->getHitActivityWithBrowserCount($search, $start, $finish);
-      $this->assertEqual($browser_counts[$inx], $total_count, "getHitActivityWithBrowserCount Retrieved Correct Counts for {$search} search.");
+      $this->assertEquals($browser_counts[$inx], $total_count, "getHitActivityWithBrowserCount Retrieved Correct Counts for {$search} search.");
     }

     // Generate element specific activity.
@@ @@
     foreach ($browser_searches as $inx => $search) {

       $total_count = $this->getAnalyticsStorage()->getElementHitActivityWithBrowserCount($elid, $search, $start, $finish);
-      $this->assertEqual($browser_counts[$inx], $total_count, "getElementHitActivityWithBrowserCount Retrieved Correct Counts for {$search} search.");
+      $this->assertEquals($browser_counts[$inx], $total_count, "getElementHitActivityWithBrowserCount Retrieved Correct Counts for {$search} search.");
     }
   }

@@ @@

     // See if the database count matches.
     $count = $this->getAnalyticsStorage()->getElementImpressedOnElementCount($impressed_element->getId(), $source_element->getId(), $start, $finish);
-    $this->assertEqual($count, $impression_count, 'Method getElementImpressedOnElementCount produced correct count.');
+    $this->assertEquals($count, $impression_count, 'Method getElementImpressedOnElementCount produced correct count.');

     $total_element_impressions += $impression_count;

@@ @@

     // See if the database count matches.
     $count = $this->getAnalyticsStorage()->getAllElementsImpressedOnElementCount($source_element->getId(), $start, $finish);
-    $this->assertEqual($count, $impression_count + $second_impression_count, 'Method getAllElementsImpressedOnElementCount produced correct count.');
+    $this->assertEquals($count, $impression_count + $second_impression_count, 'Method getAllElementsImpressedOnElementCount produced correct count.');

     // Test the getElementImpressedOnNodeBundleCount method.
     $source_element = NULL;
@@ @@

     // See if the database count matches.
     $count = $this->getAnalyticsStorage()->getElementImpressedOnNodeBundleCount($impressed_element->getId(), $bundle, $start, $finish);
-    $this->assertEqual($count, $impression_count, 'Method getElementImpressedOnNodeBundleCount produced correct count.');
+    $this->assertEquals($count, $impression_count, 'Method getElementImpressedOnNodeBundleCount produced correct count.');

     $total_element_impressions += $impression_count;

@@ @@

     // See if the database count matches.
     $count = $this->getAnalyticsStorage()->getElementImpressedOnBaseUrlCount($impressed_element->getId(), $base_url, $start, $finish);
-    $this->assertEqual($count, $impression_count, 'Method getElementImpressedOnBaseUrlCount produced correct count.');
+    $this->assertEquals($count, $impression_count, 'Method getElementImpressedOnBaseUrlCount produced correct count.');

     $total_element_impressions += $impression_count;

@@ @@
     // See if the impressed element total impressed count matches,
     // now that it's been impressed several times above.
     $count = $this->getAnalyticsStorage()->getElementImpressedAnywhereCount($impressed_element->getId(), $start, $finish);
-    $this->assertEqual($count, $total_element_impressions, 'Method getElementImpressedAnywhereCount produced correct count.');
+    $this->assertEquals($count, $total_element_impressions, 'Method getElementImpressedAnywhereCount produced correct count.');

   }
    ----------- end diff -----------

Applied rules:
 * AssertEqualRector
 * ArgumentRemoverRector
 * WrapReturnRector
 * ChangeMethodVisibilityRector


8) modules/contrib/tether_stats/src/Plugin/tether_stats/Chart/TetherStatsChartRendererGoogle.php:87

    ---------- begin diff ----------
@@ @@
       $start = $chart->getDateStart();
       $next = $schema->nextDateTime($start);
       $current_time = new \DateTime();
-      $current_time->setTimestamp(REQUEST_TIME);
+      $current_time->setTimestamp(\Drupal::time()->getRequestTime());

       $iterate = [
         'start' => $start,
    ----------- end diff -----------

Applied rules:
 * RequestTimeConstRector
 * ArgumentRemoverRector
 * WrapReturnRector
 * ChangeMethodVisibilityRector


9) modules/contrib/tether_stats/src/Form/TetherStatsSettingsForm.php:262

    ---------- begin diff ----------
@@ @@
     // provide a lower boundary when iterating chart data.
     if ($form_state->getValue('active') && $config->get('advanced.first_activation_time') == 0 && $form_state->getValue('first_activation_time') == 0) {

-      $form_state->setValue('first_activation_time', REQUEST_TIME);
+      $form_state->setValue('first_activation_time', \Drupal::time()->getRequestTime());
     }

     if ($form_state->getValue('use_alternate_database')) {
    ----------- end diff -----------

Applied rules:
 * RequestTimeConstRector
 * ArgumentRemoverRector
 * WrapReturnRector
 * ChangeMethodVisibilityRector


10) modules/contrib/tether_stats/src/EventSubscriber/TetherStatsRequestSubscriber.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\tether_stats\EventSubscriber;

+use Symfony\Component\HttpKernel\Event\RequestEvent;
 use Drupal\tether_stats\TetherStatsRequestFilterInterface;
 use Symfony\Component\EventDispatcher\EventSubscriberInterface;
 use Symfony\Component\HttpKernel\KernelEvents;
-use Symfony\Component\HttpKernel\Event\GetResponseEvent;
 use Drupal\Core\Routing\CurrentRouteMatch;
 use Symfony\Component\EventDispatcher\EventDispatcherInterface;
 use Drupal\Core\Config\ImmutableConfig;
@@ @@
    *
    * No response will be added to the GetResponseEvent.
    *
-   * @param \Symfony\Component\HttpKernel\Event\GetResponseEvent $event
+   * @param \Symfony\Component\HttpKernel\Event\RequestEvent $event
    *   The get response event.
    */
-  public function onRequest(GetResponseEvent $event) {
+  public function onRequest(RequestEvent $event) {

     $config = $this->manager->getSettings();
     $request_uri = $event->getRequest()->getRequestUri();
@@ @@
         // set for the current request.
         $element_event = new TetherStatsRequestToElementEvent($this->routeMatch, $request_uri);

-        $this->dispatcher->dispatch(TetherStatsEvents::REQUEST_TO_ELEMENT, $element_event);
+        $this->dispatcher->dispatch($element_event, TetherStatsEvents::REQUEST_TO_ELEMENT);

         if ($element_event->hasIdentityset()) {
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * RenameClassRector
 * MakeDispatchFirstArgumentEventRector
 * WrapReturnRector


11) modules/contrib/tether_stats/src/Event/TetherStatsRequestToElementEvent.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\tether_stats\Event;

-use Symfony\Component\EventDispatcher\Event;
+use Symfony\Contracts\EventDispatcher\Event;
 use Drupal\Core\Routing\RouteMatchInterface;
 use Drupal\tether_stats\TetherStatsIdentitySetInterface;
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * RenameClassRector
 * WrapReturnRector
 * ChangeMethodVisibilityRector


 [OK] 11 files have been changed by Rector                                      

