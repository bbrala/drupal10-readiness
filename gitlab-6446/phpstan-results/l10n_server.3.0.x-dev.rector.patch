diff --git a/l10n_community/tests/src/Functional/L10nServerTest.php b/l10n_community/tests/src/Functional/L10nServerTest.php
index d006fd5..919a637 100644
--- a/l10n_community/tests/src/Functional/L10nServerTest.php
+++ b/l10n_community/tests/src/Functional/L10nServerTest.php
@@ -882,24 +882,22 @@ class L10nServerTest extends BrowserTestBase {
     $tar = new Archive_Tar($package_file, 'gz');
 
     // Add the files as strings, so we can control their placement/name.
-    $tar->addString('potx_test_' . $api_version . '.module', file_get_contents(drupal_get_path('module', 'potx') . '/tests/potx_test_' . $api_version . '.module'));
+    $tar->addString('potx_test_' . $api_version . '.module', file_get_contents(\Drupal::service('extension.list.module')->getPath('potx') . '/tests/potx_test_' . $api_version . '.module'));
     // Add .info file tailored to the module filename (although this is not
     // important for potx, just to be clear about identification).
-    $tar->addString('potx_test_' . $api_version . '.info', file_get_contents(drupal_get_path('module', 'potx') . '/tests/potx_test_6.info'));
+    $tar->addString('potx_test_' . $api_version . '.info', file_get_contents(\Drupal::service('extension.list.module')->getPath('potx') . '/tests/potx_test_6.info'));
     $num_files = 2;
     if ($include_js
         && $api_version > 5) {
       // Add .js file regardless of api version. Although Drupal 5 parsing
       // should not pick this up, this packaging allows us to test for that
       // exactly.
-      $tar->addString('potx_test_' . $api_version . '.js', file_get_contents(drupal_get_path('module', 'potx') . '/tests/potx_test.js'));
+      $tar->addString('potx_test_' . $api_version . '.js', file_get_contents(\Drupal::service('extension.list.module')->getPath('potx') . '/tests/potx_test.js'));
       $num_files = 3;
     }
 
     $this->assertTrue(file_exists($package_file), t('Test package created.'));
     $this->assertTrue(filesize($package_file) > 0, t('Test package contains data.'));
-    $this->pass('Temporary file at ' . $package_file);
-    $this->pass('List of package files: ' . var_export($tar->listContent(), TRUE));
 
     // Login as admin and get this package parsed.
     $this->drupalLogin($this->userAdmin);
diff --git a/l10n_packager/src/L10nExporter.php b/l10n_packager/src/L10nExporter.php
index 3831eff..1d4a337 100644
--- a/l10n_packager/src/L10nExporter.php
+++ b/l10n_packager/src/L10nExporter.php
@@ -52,7 +52,7 @@ class L10nExporter {
   function export($uri, $release = NULL, $language = NULL, $template = TRUE, $compact = FALSE, $installer = FALSE, $suggestions = FALSE) {
     $project = $this->getProjects(array('uri' => $uri));
 
-    $query = db_select('l10n_server_file', 'f');
+    $query = \Drupal::database()->select('l10n_server_file', 'f');
     $query->innerJoin('l10n_server_line', 'l', 'f.fid = l.fid');
     $query->innerJoin('l10n_server_string', 's', 'l.sid = s.sid');
     $query
@@ -155,14 +155,14 @@ class L10nExporter {
         $message = t('There are no strings in any releases of %project to export.', array('%project' => $project->title));
       }
       // Message to the user.
-      drupal_set_message($message);
+      \Drupal::messenger()->addStatus($message);
       // Message to watchdog for possible automated packaging.
       watchdog('l10n_community', $message);
       return NULL;
     }
 
     // Generate a 'unique' temporary filename for this package.
-    $tempfile = tempnam(file_directory_temp(), 'l10n_community-' . $uri);
+    $tempfile = tempnam(\Drupal::service('file_system')->getTempDirectory(), 'l10n_community-' . $uri);
 
     if (!$compact) {
       if (count($po_data['revisions']) == 1) {
@@ -244,7 +244,7 @@ class L10nExporter {
   function getProjects($options = array()) {
     static $projects = array();
 
-    $select = db_select('l10n_server_project', 'p')->fields('p');
+    $select = \Drupal::database()->select('l10n_server_project', 'p')->fields('p');
 
     // Consider returning all projects or just published ones.
     if (empty($options['all'])) {
@@ -282,7 +282,7 @@ class L10nExporter {
         return $projects[$options['uri']];
       }
       // Not found in cache, so query and cache before returning.
-      $result = db_query("SELECT * FROM {l10n_server_project} WHERE uri = :uri", array(':uri' => $options['uri']));
+      $result = \Drupal::database()->query("SELECT * FROM {l10n_server_project} WHERE uri = :uri", array(':uri' => $options['uri']));
       if ($project = $result->fetchObject()) {
         $projects[$options['uri']] = $project;
         return $project;
@@ -316,7 +316,7 @@ class L10nExporter {
     if ($parsed_only) {
       $query .= 'AND r.last_parsed > 0 ';
     }
-    $result = db_query($query, array(':uri' => $uri));
+    $result = \Drupal::database()->query($query, array(':uri' => $uri));
     $releases = $result->fetchAllAssoc('rid');
     uasort($releases, '_l10n_server_version_compare');
     return $releases;
@@ -447,7 +447,7 @@ class L10nExporter {
    */
   function getProjectInitials() {
     // Grab the unique initials of all active projects
-    $result = db_query('SELECT DISTINCT(SUBSTR(title, 1, 1)) AS initial FROM {l10n_server_project} WHERE status = :status ORDER BY initial ASC', array(':status' => 1));
+    $result = \Drupal::database()->query('SELECT DISTINCT(SUBSTR(title, 1, 1)) AS initial FROM {l10n_server_project} WHERE status = :status ORDER BY initial ASC', array(':status' => 1));
 
     // Create an array of elements, all non-letters are grouped in '#'.
     $initials = array();
diff --git a/l10n_packager/src/L10nPackager.php b/l10n_packager/src/L10nPackager.php
index 447d684..ac09262 100644
--- a/l10n_packager/src/L10nPackager.php
+++ b/l10n_packager/src/L10nPackager.php
@@ -404,7 +404,7 @@ class L10nPackager {
    */
   public function package($release, $language, $file = NULL, $timestamp = NULL) {
 
-    $timestamp = $timestamp ? $timestamp : REQUEST_TIME;
+    $timestamp = $timestamp ? $timestamp : \Drupal::time()->getRequestTime();
     $variables = array(
       '%release' => l10n_packager_release_name($release),
       '%language' => $language->name,
@@ -440,8 +440,8 @@ class L10nPackager {
       $file->filename = basename($file_path);
       $file->filemime = $mime_type;
       $file->uri = $file_path;
-      file_unmanaged_move($export_name, $file->uri, FILE_EXISTS_REPLACE);
-      $file->filesize = filesize(drupal_realpath($file->uri));
+      file_unmanaged_move($export_name, $file->uri, FileSystemInterface::EXISTS_REPLACE);
+      $file->filesize = filesize(\Drupal::service('file_system')->realpath($file->uri));
       $file->sid_count = $sid_count;
       // Create actual symlink to latest
       l10n_packager_create_latest_symlink($file_path, $release, $language);
@@ -467,9 +467,9 @@ class L10nPackager {
     $basepath = $currentpath = l10n_packager_directory();
     $finalpath = $basepath . '/' . $directory;
     $parts = explode('/', $directory);
-    $htaccess_path = drupal_realpath($basepath) . '/.htaccess';
+    $htaccess_path = \Drupal::service('file_system')->realpath($basepath) . '/.htaccess';
     if (!is_dir($basepath)) {
-      file_prepare_directory($basepath, FILE_CREATE_DIRECTORY);
+      \Drupal::service('file_system')->prepareDirectory($basepath, FileSystemInterface::CREATE_DIRECTORY);
     }
     if (!file_exists($htaccess_path)) {
       $htaccess_lines = "\n\n<FilesMatch \"\.(po)$\">\n\tForceType \"text/plain; charset=utf-8\"\n\tAllow from ALL\n</FilesMatch>\n";
@@ -480,7 +480,7 @@ class L10nPackager {
     }
     while (is_dir($currentpath) && !is_dir($finalpath) && ($more = array_shift($parts))) {
       $currentpath .= '/' . $more;
-      file_prepare_directory($currentpath, FILE_CREATE_DIRECTORY);
+      \Drupal::service('file_system')->prepareDirectory($currentpath, FileSystemInterface::CREATE_DIRECTORY);
     }
     return $basepath . '/' . $path;
   }
