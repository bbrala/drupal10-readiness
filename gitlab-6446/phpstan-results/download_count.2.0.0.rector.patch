diff --git a/src/Controller/DownloadCountController.php b/src/Controller/DownloadCountController.php
index f51d68a..b296262 100644
--- a/src/Controller/DownloadCountController.php
+++ b/src/Controller/DownloadCountController.php
@@ -240,7 +240,7 @@ class DownloadCountController extends ControllerBase implements ContainerInjecti
       '#empty' => $this->t('No files have been downloaded.'),
     ];
 
-    $output .= render($table);
+    $output .= \Drupal::service('renderer')->render($table);
 
     $output .= '<div id="download-count-total-bottom">' . $this->t('Total Downloads:') . ' ' . number_format($total_downloads) . '</div>';
     if ($items_per_page > 0) {
@@ -251,7 +251,7 @@ class DownloadCountController extends ControllerBase implements ContainerInjecti
         '#route_name' => 'download_count.reports',
         'attributes' => ['tags' => []],
       ];
-      $output .= render($pager);
+      $output .= \Drupal::service('renderer')->render($pager);
     }
     if (!empty($page_footer['value'])) {
       $output .= '<div id="download-count-footer">' . Html::escape($page_footer['value'], $page_footer['format']) . '</div>';
@@ -355,7 +355,7 @@ class DownloadCountController extends ControllerBase implements ContainerInjecti
     $query->range(0, $config->get('download_count_details_daily_limit'));
     $result = $query->execute();
     $daily = $this->downloadCountDetailsTable($result, 'Daily', 'Day');
-    $output .= render($daily['output']);
+    $output .= \Drupal::service('renderer')->render($daily['output']);
     if ($sparkline_type != 'none') {
       $values['daily'] = implode(',', array_reverse($daily['values']));
       $output .= '<div class="download-count-sparkline-daily">' . $this->t('Rendering Sparkline...') . '</div>';
@@ -367,7 +367,7 @@ class DownloadCountController extends ControllerBase implements ContainerInjecti
     $query->range(0, $config->get('download_count_details_weekly_limit'));
     $result = $query->execute();
     $weekly = $this->downloadCountDetailsTable($result, 'Weekly', 'Week');
-    $output .= render($weekly['output']);
+    $output .= \Drupal::service('renderer')->render($weekly['output']);
     if ($sparkline_type != 'none') {
       $values['weekly'] = implode(',', array_reverse($weekly['values']));
       $output .= '<div class="download-count-sparkline-weekly">' . $this->t('Rendering Sparkline...') . '</div>';
@@ -378,7 +378,7 @@ class DownloadCountController extends ControllerBase implements ContainerInjecti
     $query->range(0, $config->get('download_count_details_monthly_limit'));
     $result = $query->execute();
     $monthly = $this->downloadCountDetailsTable($result, 'Monthly', 'Month');
-    $output .= render($monthly['output']);
+    $output .= \Drupal::service('renderer')->render($monthly['output']);
     if ($sparkline_type != 'none') {
       $values['monthly'] = implode(',', array_reverse($monthly['values']));
       $output .= '<div class="download-count-sparkline-monthly">' . $this->t('Rendering Sparkline...') . '</div>';
@@ -389,7 +389,7 @@ class DownloadCountController extends ControllerBase implements ContainerInjecti
     $query->range(0, $config->get('download_count_details_yearly_limit'));
     $result = $query->execute();
     $yearly = $this->downloadCountDetailsTable($result, 'Yearly', 'Year');
-    $output .= render($yearly['output']);
+    $output .= \Drupal::service('renderer')->render($yearly['output']);
     if ($sparkline_type != 'none') {
       $values['yearly'] = implode(',', array_reverse($yearly['values']));
       $output .= '<div class="download-count-sparkline-yearly">' . $this->t('Rendering Sparkline...') . '</div>';
diff --git a/src/Plugin/Field/FieldFormatter/FieldDownloadCount.php b/src/Plugin/Field/FieldFormatter/FieldDownloadCount.php
index e4aa23d..f9fbe65 100644
--- a/src/Plugin/Field/FieldFormatter/FieldDownloadCount.php
+++ b/src/Plugin/Field/FieldFormatter/FieldDownloadCount.php
@@ -45,7 +45,7 @@ class FieldDownloadCount extends GenericFileFormatter {
         $file->download = $download;
       }
 
-      $url = file_create_url($file->getFileUri());
+      $url = \Drupal::service('file_url_generator')->generateAbsoluteString($file->getFileUri());
 
       $options = [
         'attributes' => [
