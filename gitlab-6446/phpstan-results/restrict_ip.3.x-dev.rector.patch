diff --git a/restrict_ip.module b/restrict_ip.module
index 3960140..6c80f32 100644
--- a/restrict_ip.module
+++ b/restrict_ip.module
@@ -111,7 +111,7 @@ function restrict_ip_js_alter(&$javascript, AttachedAssetsInterface $assets)
 		$whitelisted_js_keys = [
 			'core/assets/vendor/jquery/jquery.min.js',
 			'core/assets/vendor/jquery/jquery.js',
-			drupal_get_path('module', 'restrict_ip') . '/js/mail_fix.js',
+			\Drupal::service('extension.list.module')->getPath('restrict_ip') . '/js/mail_fix.js',
 		];
 
 		$whitelisted_js_keys += Drupal::service('module_handler')->invokeAll('restrict_ip_whitelisted_js_keys');
diff --git a/src/EventSubscriber/RestrictIpEventSubscriber.php b/src/EventSubscriber/RestrictIpEventSubscriber.php
index 30750bf..cd37434 100644
--- a/src/EventSubscriber/RestrictIpEventSubscriber.php
+++ b/src/EventSubscriber/RestrictIpEventSubscriber.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\restrict_ip\EventSubscriber;
 
+use Symfony\Component\HttpKernel\Event\RequestEvent;
 use Drupal\Core\Config\ConfigFactoryInterface;
 use Drupal\Core\Extension\ModuleHandlerInterface;
 use Drupal\Core\Logger\LoggerChannelFactoryInterface;
@@ -10,7 +11,6 @@ use Drupal\Core\Url;
 use Drupal\restrict_ip\Service\RestrictIpServiceInterface;
 use Symfony\Component\EventDispatcher\EventSubscriberInterface;
 use Symfony\Component\HttpFoundation\RedirectResponse;
-use Symfony\Component\HttpKernel\Event\GetResponseEvent;
 use Symfony\Component\HttpKernel\KernelEvents;
 
 class RestrictIpEventSubscriber implements EventSubscriberInterface
@@ -85,7 +85,7 @@ class RestrictIpEventSubscriber implements EventSubscriberInterface
 		return $events;
 	}
 
-	public function checkIpRestricted(GetResponseEvent $event)
+	public function checkIpRestricted(RequestEvent $event)
 	{
 		unset($_SESSION['restrict_ip']);
 
diff --git a/tests/src/Unit/Service/RestrictIpServiceTest.php b/tests/src/Unit/Service/RestrictIpServiceTest.php
index bbed4c1..bd1a32f 100644
--- a/tests/src/Unit/Service/RestrictIpServiceTest.php
+++ b/tests/src/Unit/Service/RestrictIpServiceTest.php
@@ -22,27 +22,17 @@ class RestrictIpServiceTest extends UnitTestCase
 	/**
 	 * {@inheritdoc}
 	 */
-	public function setUp()
+	public function setUp(): void
 	{
-		$this->currentUser = $this->getMockBuilder('Drupal\Core\Session\AccountProxyInterface')
-			->disableOriginalConstructor()
-			->getMock();
+		$this->currentUser = $this->createMock('Drupal\Core\Session\AccountProxyInterface');
 
-		$this->currentPathStack = $this->getMockBuilder('Drupal\Core\Path\CurrentPathStack')
-			->disableOriginalConstructor()
-			->getMock();
+		$this->currentPathStack = $this->createMock('Drupal\Core\Path\CurrentPathStack');
 
-		$this->requestStack = $this->getMockBuilder('Symfony\Component\HttpFoundation\RequestStack')
-			->disableOriginalConstructor()
-			->getMock();
+		$this->requestStack = $this->createMock('Symfony\Component\HttpFoundation\RequestStack');
 
-		$this->request = $this->getMockBuilder('Symfony\Component\HttpFoundation\Request')
-			->disableOriginalConstructor()
-			->getMock();
+		$this->request = $this->createMock('Symfony\Component\HttpFoundation\Request');
 
-		$this->mapper = $this->getMockBuilder('Drupal\restrict_ip\Mapper\RestrictIpMapper')
-			->disableOriginalConstructor()
-			->getMock();
+		$this->mapper = $this->createMock('Drupal\restrict_ip\Mapper\RestrictIpMapper');
 
 		$this->mapper->expects($this->any())
 			->method('getWhitelistedPaths')
@@ -52,9 +42,7 @@ class RestrictIpServiceTest extends UnitTestCase
 			->method('getBlacklistedPaths')
 			->willReturn(['/node/1']);
 
-		$this->pathMatcher = $this->getMockbuilder('Drupal\Core\Path\PathMatcherInterface')
-			->disableOriginalConstructor()
-			->getMock();
+		$this->pathMatcher = $this->createMock('Drupal\Core\Path\PathMatcherInterface');
 	}
 
 	/**
@@ -244,9 +232,7 @@ class RestrictIpServiceTest extends UnitTestCase
 			'white_black_list' => 0,
 		]);
 
-		$mapper = $this->getMockBuilder('Drupal\restrict_ip\Mapper\RestrictIpMapper')
-			->disableOriginalConstructor()
-			->getMock();
+		$mapper = $this->createMock('Drupal\restrict_ip\Mapper\RestrictIpMapper');
 
 		$mapper->expects($this->any())
 			->method('getWhitelistedIpAddresses')
