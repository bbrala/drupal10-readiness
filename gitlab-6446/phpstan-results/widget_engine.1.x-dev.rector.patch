diff --git a/src/Controller/WidgetPreviewController.php b/src/Controller/WidgetPreviewController.php
index 744df79..101468f 100644
--- a/src/Controller/WidgetPreviewController.php
+++ b/src/Controller/WidgetPreviewController.php
@@ -53,7 +53,7 @@ class WidgetPreviewController extends ControllerBase {
         // Prepare directory.
         $directory = "public://widget_engine_preview/{$widget->getType()}/";
         \Drupal::service('file_system')->prepareDirectory($directory, FileSystemInterface::CREATE_DIRECTORY | FileSystemInterface::MODIFY_PERMISSIONS);
-        $file = file_save_data($data, $directory . $file_name, FileSystemInterface::EXISTS_REPLACE);
+        $file = \Drupal::service('file.repository')->writeData($data, $directory . $file_name, FileSystemInterface::EXISTS_REPLACE);
 
         try {
           $widget->set('widget_preview', ['target_id' => $file->id()]);
@@ -108,7 +108,7 @@ class WidgetPreviewController extends ControllerBase {
     $output = [
       '#type' => 'html_tag',
       '#tag' => 'div',
-      '#value' => render($progress_bar),
+      '#value' => \Drupal::service('renderer')->render($progress_bar),
       '#attributes' => [
         'id' => 'widget-generate-preview',
         'class' => 'widget-generate-preview',
diff --git a/tests/src/FunctionalJavascript/WidgetReferenceIEFComplexTest.php b/tests/src/FunctionalJavascript/WidgetReferenceIEFComplexTest.php
index c287bf1..01c486e 100644
--- a/tests/src/FunctionalJavascript/WidgetReferenceIEFComplexTest.php
+++ b/tests/src/FunctionalJavascript/WidgetReferenceIEFComplexTest.php
@@ -103,7 +103,7 @@ class WidgetReferenceIEFComplexTest extends WebDriverTestBase {
       'widgets[form][inline_entity_form][body][0][value]' => $body,
     ];
 
-    $this->drupalPostForm(NULL, $edit, 'Create widget');
+    $this->submitForm($edit, 'Create widget');
     $this->assertSession()->assertWaitOnAjaxRequest();
 
     $title = $this->randomString();
@@ -111,7 +111,7 @@ class WidgetReferenceIEFComplexTest extends WebDriverTestBase {
     $node_edit = [
       'title[0][value]' => $title,
     ];
-    $this->drupalPostForm(NULL, $node_edit, 'edit-submit');
+    $this->submitForm($node_edit, 'edit-submit');
     $this->assertSession()->pageTextContains($name);
     $this->assertSession()->pageTextContains($body);
     $this->assertSession()->pageTextContains($title);
@@ -131,7 +131,7 @@ class WidgetReferenceIEFComplexTest extends WebDriverTestBase {
       'name[0][value]' => $name,
       'body[0][value]' => $body,
     ];
-    $this->drupalPostForm(NULL, $edit, 'edit-submit');
+    $this->submitForm($edit, 'edit-submit');
 
     $this->drupalGet('/admin/content/widgets');
     $this->assertSession()->assertWaitOnAjaxRequest();
@@ -155,7 +155,7 @@ class WidgetReferenceIEFComplexTest extends WebDriverTestBase {
       'title[0][value]' => $title,
     ];
 
-    $this->drupalPostForm(NULL, $node_edit, 'edit-submit');
+    $this->submitForm($node_edit, 'edit-submit');
     $this->assertSession()->pageTextContains($name);
     $this->assertSession()->pageTextContains($body);
     $this->assertSession()->pageTextContains($title);
