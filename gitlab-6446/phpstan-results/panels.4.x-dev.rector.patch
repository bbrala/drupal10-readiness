diff --git a/panels.module b/panels.module
index b73df34..9bf02d2 100644
--- a/panels.module
+++ b/panels.module
@@ -51,10 +51,10 @@ function panels_layout_alter(&$definitions) {
       continue;
     }
     if (in_array($layout_name, $core_layouts) && empty($definitions[$layout_name]->getIcon())) {
-      $definitions[$layout_name]->setIconPath(drupal_get_path('module', 'panels') . '/layouts/'.$layout_name.'/'.$layout_name.'.png');
+      $definitions[$layout_name]->setIconPath(\Drupal::service('extension.list.module')->getPath('panels') . '/layouts/'.$layout_name.'/'.$layout_name.'.png');
     }
     if (empty($definitions[$layout_name]->getIcon())) {
-      $definitions[$layout_name]->setIconPath(drupal_get_path('module', 'panels') . '/layouts/no-layout-preview.png');
+      $definitions[$layout_name]->setIconPath(\Drupal::service('extension.list.module')->getPath('panels') . '/layouts/no-layout-preview.png');
     }
   }
 }
diff --git a/panels_ipe/src/Controller/PanelsIPEPageController.php b/panels_ipe/src/Controller/PanelsIPEPageController.php
index 48788fc..f0c0e4c 100644
--- a/panels_ipe/src/Controller/PanelsIPEPageController.php
+++ b/panels_ipe/src/Controller/PanelsIPEPageController.php
@@ -172,7 +172,7 @@ class PanelsIPEPageController extends ControllerBase {
     $base_path = base_path();
     $data = [];
     foreach ($layouts as $id => $layout) {
-      $icon = $layout->getIconPath() ?: drupal_get_path('module', 'panels') . '/layouts/no-layout-preview.png';
+      $icon = $layout->getIconPath() ?: \Drupal::service('extension.list.module')->getPath('panels') . '/layouts/no-layout-preview.png';
       $data[] = [
         'id' => $id,
         'label' => $layout->getLabel(),
diff --git a/panels_ipe/tests/src/FunctionalJavascript/PageManagerIntegrationTest.php b/panels_ipe/tests/src/FunctionalJavascript/PageManagerIntegrationTest.php
index bddba88..599e7a7 100644
--- a/panels_ipe/tests/src/FunctionalJavascript/PageManagerIntegrationTest.php
+++ b/panels_ipe/tests/src/FunctionalJavascript/PageManagerIntegrationTest.php
@@ -38,7 +38,7 @@ class PageManagerIntegrationTest extends PanelsIPETestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     // Create a user with appropriate permissions to use Panels IPE.
diff --git a/panels_ipe/tests/src/Unit/RemoveBlockRequestHandlerTest.php b/panels_ipe/tests/src/Unit/RemoveBlockRequestHandlerTest.php
index 8d8e966..88c702a 100644
--- a/panels_ipe/tests/src/Unit/RemoveBlockRequestHandlerTest.php
+++ b/panels_ipe/tests/src/Unit/RemoveBlockRequestHandlerTest.php
@@ -12,7 +12,7 @@ use Symfony\Component\HttpFoundation\JsonResponse;
  */
 class RemoveBlockRequestHandlerTest extends RequestHandlerTestBase {
 
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
     $this->sut = new RemoveBlockRequestHandler($this->moduleHandler, $this->panelsStore, $this->tempStore);
   }
diff --git a/panels_ipe/tests/src/Unit/RequestHandlerTestBase.php b/panels_ipe/tests/src/Unit/RequestHandlerTestBase.php
index 547eb3c..73ded63 100644
--- a/panels_ipe/tests/src/Unit/RequestHandlerTestBase.php
+++ b/panels_ipe/tests/src/Unit/RequestHandlerTestBase.php
@@ -7,7 +7,6 @@ use Drupal\panels\Plugin\DisplayVariant\PanelsDisplayVariant;
 use Drupal\panels\Storage\PanelsStorageManagerInterface;
 use Drupal\Core\TempStore\SharedTempStore;
 use PHPUnit\Framework\TestCase;
-use PHPUnit_Framework_MockObject_MockObject;
 use Symfony\Component\HttpFoundation\JsonResponse;
 use Symfony\Component\HttpFoundation\Request;
 
@@ -21,35 +20,31 @@ abstract class RequestHandlerTestBase extends TestCase {
   protected $sut;
 
   /**
-   * @var PHPUnit_Framework_MockObject_MockObject */
+   * @var \PHPUnit\Framework\MockObject\MockObject */
   protected $moduleHandler;
 
   /**
-   * @var PHPUnit_Framework_MockObject_MockObject */
+   * @var \PHPUnit\Framework\MockObject\MockObject */
   protected $panelsStore;
 
   /**
-   * @var PHPUnit_Framework_MockObject_MockObject */
+   * @var \PHPUnit\Framework\MockObject\MockObject */
   protected $tempStore;
 
   /**
-   * @var PHPUnit_Framework_MockObject_MockObject */
+   * @var \PHPUnit\Framework\MockObject\MockObject */
   protected $panelsDisplay;
 
   /**
    *
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
     $this->moduleHandler = $this->getMockForAbstractClass(ModuleHandlerInterface::class);
     $this->panelsStore = $this->getMockForAbstractClass(PanelsStorageManagerInterface::class);
-    $this->tempStore = $this->getMockBuilder(SharedTempStore::class)
-      ->disableOriginalConstructor()
-      ->getMock();
+    $this->tempStore = $this->createMock(SharedTempStore::class);
 
-    $this->panelsDisplay = $this->getMockBuilder(PanelsDisplayVariant::class)
-      ->disableOriginalConstructor()
-      ->getMock();
+    $this->panelsDisplay = $this->createMock(PanelsDisplayVariant::class);
   }
 
   protected function createRequest($content = NULL) {
diff --git a/panels_ipe/tests/src/Unit/UpdateLayoutRequestHandlerTest.php b/panels_ipe/tests/src/Unit/UpdateLayoutRequestHandlerTest.php
index 499a75d..0007a13 100644
--- a/panels_ipe/tests/src/Unit/UpdateLayoutRequestHandlerTest.php
+++ b/panels_ipe/tests/src/Unit/UpdateLayoutRequestHandlerTest.php
@@ -14,7 +14,7 @@ use Symfony\Component\HttpFoundation\JsonResponse;
  */
 class UpdateLayoutRequestHandlerTest extends RequestHandlerTestBase {
 
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
     $this->sut = new UpdateLayoutRequestHandler($this->moduleHandler, $this->panelsStore, $this->tempStore);
   }
@@ -34,9 +34,7 @@ class UpdateLayoutRequestHandlerTest extends RequestHandlerTestBase {
   }
 
   private function setPanelsDisplayExpectations() {
-    $block = $this->getMockBuilder(BlockBase::class)
-      ->disableOriginalConstructor()
-      ->getMock();
+    $block = $this->createMock(BlockBase::class);
     $block->expects($this->exactly(4))->method('setConfigurationValue');
     $block->expects($this->exactly(2))
       ->method('getConfiguration')
diff --git a/src/PanelsVariantEvent.php b/src/PanelsVariantEvent.php
index 104f803..2361849 100644
--- a/src/PanelsVariantEvent.php
+++ b/src/PanelsVariantEvent.php
@@ -2,8 +2,8 @@
 
 namespace Drupal\panels;
 
+use Symfony\Contracts\EventDispatcher\Event;
 use Drupal\panels\Plugin\DisplayVariant\PanelsDisplayVariant;
-use Symfony\Component\EventDispatcher\Event;
 
 /**
  * Event object for events relating to Panels display variants.
diff --git a/src/Storage/PanelsStorageManager.php b/src/Storage/PanelsStorageManager.php
index 8ddaa71..c307a34 100644
--- a/src/Storage/PanelsStorageManager.php
+++ b/src/Storage/PanelsStorageManager.php
@@ -98,10 +98,10 @@ class PanelsStorageManager extends DefaultPluginManager implements PanelsStorage
     // Allow event subscribers to react to the variant being saved.
     $event = new PanelsVariantEvent($panels_display);
 
-    $this->eventDispatcher->dispatch(PanelsEvents::VARIANT_PRE_SAVE, $event);
+    $this->eventDispatcher->dispatch($event, PanelsEvents::VARIANT_PRE_SAVE);
     $storage = $this->getStorage($panels_display->getStorageType());
     $storage->save($panels_display);
-    $this->eventDispatcher->dispatch(PanelsEvents::VARIANT_POST_SAVE, $event);
+    $this->eventDispatcher->dispatch($event, PanelsEvents::VARIANT_POST_SAVE);
   }
 
   /**
diff --git a/tests/src/Functional/PageManagerPanelsStorageIntegrationTest.php b/tests/src/Functional/PageManagerPanelsStorageIntegrationTest.php
index 08a6374..4e5dc9b 100644
--- a/tests/src/Functional/PageManagerPanelsStorageIntegrationTest.php
+++ b/tests/src/Functional/PageManagerPanelsStorageIntegrationTest.php
@@ -25,7 +25,7 @@ class PageManagerPanelsStorageIntegrationTest extends BrowserTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->drupalPlaceBlock('local_tasks_block');
@@ -51,20 +51,20 @@ class PageManagerPanelsStorageIntegrationTest extends BrowserTestBase {
       'path' => 'testing',
       'variant_plugin_id' => 'panels_variant',
     ];
-    $this->drupalPostForm(NULL, $edit, 'Next');
+    $this->submitForm($edit, 'Next');
 
     // Add a Panels variant which uses the IPE.
     $edit = [
       // This option won't be present at all if our integration isn't working!
       'variant_settings[builder]' => 'ipe',
     ];
-    $this->drupalPostForm(NULL, $edit, 'Next');
+    $this->submitForm($edit, 'Next');
 
     // Choose a layout.
     $edit = [
       'layout' => 'layout_twocol',
     ];
-    $this->drupalPostForm(NULL, $edit, 'Next');
+    $this->submitForm($edit, 'Next');
 
     // In Drupal 8.8 and later, the layout may have settings of its own. If
     // that's the case, submit the layout settings form without any changes.
@@ -74,7 +74,7 @@ class PageManagerPanelsStorageIntegrationTest extends BrowserTestBase {
     }
 
     // Finish without adding any blocks.
-    $this->drupalPostForm(NULL, [], 'Finish');
+    $this->submitForm([], 'Finish');
 
     /** @var \Drupal\page_manager\PageVariantInterface $page_variant */
     $page_variant = PageVariant::load('foo-panels_variant-0');
@@ -82,8 +82,8 @@ class PageManagerPanelsStorageIntegrationTest extends BrowserTestBase {
     $panels_display = $page_variant->getVariantPlugin();
 
     // Make sure the storage type and id were set to the right value.
-    $this->assertEqual($panels_display->getStorageType(), 'page_manager');
-    $this->assertEqual($panels_display->getStorageId(), 'foo-panels_variant-0');
+    $this->assertEquals($panels_display->getStorageType(), 'page_manager');
+    $this->assertEquals($panels_display->getStorageId(), 'foo-panels_variant-0');
   }
 
 }
diff --git a/tests/src/Functional/PanelsConfigSchemaTest.php b/tests/src/Functional/PanelsConfigSchemaTest.php
index 263dd03..48298af 100644
--- a/tests/src/Functional/PanelsConfigSchemaTest.php
+++ b/tests/src/Functional/PanelsConfigSchemaTest.php
@@ -29,7 +29,7 @@ class PanelsConfigSchemaTest extends BrowserTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->panelsManager = \Drupal::service('panels.display_manager');
@@ -55,7 +55,7 @@ class PanelsConfigSchemaTest extends BrowserTestBase {
     // This will throw an exception if it doesn't validate.
     $new_panels_display = $this->panelsManager->importDisplay($config, TRUE);
 
-    $this->assertEqual($panels_display->getConfiguration(), $new_panels_display->getConfiguration());
+    $this->assertEquals($panels_display->getConfiguration(), $new_panels_display->getConfiguration());
   }
 
 }
diff --git a/tests/src/Functional/PanelsTest.php b/tests/src/Functional/PanelsTest.php
index e43efb5..ca8fe57 100644
--- a/tests/src/Functional/PanelsTest.php
+++ b/tests/src/Functional/PanelsTest.php
@@ -30,7 +30,7 @@ class PanelsTest extends BrowserTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->drupalPlaceBlock('local_tasks_block');
@@ -56,26 +56,26 @@ class PanelsTest extends BrowserTestBase {
       'path' => 'testing',
       'variant_plugin_id' => 'panels_variant',
     ];
-    $this->drupalPostForm(NULL, $edit, 'Next');
+    $this->submitForm($edit, 'Next');
 
     // Add variant with a layout that has settings.
     $edit = [
       'page_variant_label' => 'Default',
     ];
-    $this->drupalPostForm(NULL, $edit, 'Next');
+    $this->submitForm($edit, 'Next');
 
     // Choose a layout.
     $edit = [
       'layout' => 'layout_example_test',
     ];
-    $this->drupalPostForm(NULL, $edit, 'Next');
+    $this->submitForm($edit, 'Next');
 
     // Update the layout's settings.
-    $this->assertFieldByName('layout_settings_wrapper[layout_settings][setting_1]', 'Default');
+    $this->assertSession()->fieldValueEquals('layout_settings_wrapper[layout_settings][setting_1]', 'Default');
     $edit = [
       'layout_settings_wrapper[layout_settings][setting_1]' => 'Abracadabra',
     ];
-    $this->drupalPostForm(NULL, $edit, 'Next');
+    $this->submitForm($edit, 'Next');
 
     // Add a block.
     $this->clickLink('Add new block');
@@ -83,16 +83,16 @@ class PanelsTest extends BrowserTestBase {
     $edit = [
       'region' => 'top',
     ];
-    $this->drupalPostForm(NULL, $edit, 'Add block');
+    $this->submitForm($edit, 'Add block');
 
     // Finish the page add wizard.
-    $this->drupalPostForm(NULL, [], 'Finish');
+    $this->submitForm([], 'Finish');
 
     // View the page and make sure the setting is present.
     $this->drupalGet('testing');
-    $this->assertText('Blah:');
-    $this->assertText('Abracadabra');
-    $this->assertText('Powered by Drupal');
+    $this->assertSession()->pageTextContains('Blah:');
+    $this->assertSession()->pageTextContains('Abracadabra');
+    $this->assertSession()->pageTextContains('Powered by Drupal');
   }
 
   /**
@@ -112,19 +112,19 @@ class PanelsTest extends BrowserTestBase {
       'path' => 'testing',
       'variant_plugin_id' => 'panels_variant',
     ];
-    $this->drupalPostForm(NULL, $edit, 'Next');
+    $this->submitForm($edit, 'Next');
 
     // Use default variant settings.
     $edit = [
       'page_variant_label' => 'Default',
     ];
-    $this->drupalPostForm(NULL, $edit, 'Next');
+    $this->submitForm($edit, 'Next');
 
     // Choose a simple layout.
     $edit = [
       'layout' => 'layout_onecol',
     ];
-    $this->drupalPostForm(NULL, $edit, 'Next');
+    $this->submitForm($edit, 'Next');
 
     // In Drupal 8.8 and later, the layout may have settings of its own. If
     // that's the case, submit the layout settings form without any changes.
@@ -137,13 +137,13 @@ class PanelsTest extends BrowserTestBase {
     $edit = [
       'page_title' => '[user:name]',
     ];
-    $this->drupalPostForm(NULL, $edit, 'Finish');
+    $this->submitForm($edit, 'Finish');
 
     // View the page and make sure the page title is valid.
     $this->drupalGet('testing');
     // We expect "'" to be escaped only once, which is why we're doing a raw
     // assertion here.
-    $this->assertRaw('<h1 class="page-title">My User&#039;s Name</h1>');
+    $this->assertSession()->responseContains('<h1 class="page-title">My User&#039;s Name</h1>');
   }
 
 }
diff --git a/tests/src/Unit/PanelsDisplayVariantTest.php b/tests/src/Unit/PanelsDisplayVariantTest.php
index d41ab27..0de374e 100644
--- a/tests/src/Unit/PanelsDisplayVariantTest.php
+++ b/tests/src/Unit/PanelsDisplayVariantTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\panels\Unit;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Component\Uuid\UuidInterface;
 use Drupal\Core\Block\BlockManager;
 use Drupal\Core\Condition\ConditionManager;
@@ -24,6 +25,7 @@ use Prophecy\Argument;
  */
 class PanelsDisplayVariantTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
    * @var \Drupal\Core\Session\AccountInterface
    */
@@ -79,7 +81,7 @@ class PanelsDisplayVariantTest extends UnitTestCase {
    */
   protected $variant;
 
-  public function setUp() {
+  public function setUp(): void {
     $this->account = $this->prophesize(AccountInterface::class);
     $this->contextHandler = $this->prophesize(ContextHandlerInterface::class);
     $this->uuidGenerator = $this->prophesize(UuidInterface::class);
diff --git a/tests/src/Unit/PanelsStorageTest.php b/tests/src/Unit/PanelsStorageTest.php
index c84163d..1f54a43 100644
--- a/tests/src/Unit/PanelsStorageTest.php
+++ b/tests/src/Unit/PanelsStorageTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\panels\Unit;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Core\Access\AccessResult;
 use Drupal\Core\Entity\EntityStorageInterface;
 use Drupal\Core\Entity\EntityTypeManagerInterface;
@@ -22,6 +23,7 @@ use Prophecy\Argument;
  */
 class PanelsStorageTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
    * @var \Drupal\panels\Plugin\DisplayVariant\PanelsDisplayVariant|\Prophecy\Prophecy\ProphecyInterface
    */
@@ -50,7 +52,7 @@ class PanelsStorageTest extends UnitTestCase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->panelsDisplay = $this->prophesize(PanelsDisplayVariant::class);
diff --git a/tests/src/Unit/StandardDisplayBuilderTest.php b/tests/src/Unit/StandardDisplayBuilderTest.php
index 4f703f1..85c1e6f 100644
--- a/tests/src/Unit/StandardDisplayBuilderTest.php
+++ b/tests/src/Unit/StandardDisplayBuilderTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\panels\Unit;
 
+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Core\Block\BlockPluginInterface;
 use Drupal\Core\Extension\ModuleHandlerInterface;
 use Drupal\Core\Plugin\Context\ContextHandlerInterface;
@@ -17,6 +18,7 @@ use Prophecy\Argument;
  */
 class StandardDisplayBuilderTest extends UnitTestCase {
 
+  use ProphecyTrait;
   /**
    * @var \Drupal\panels\Plugin\DisplayBuilder\StandardDisplayBuilder
    */
@@ -25,7 +27,7 @@ class StandardDisplayBuilderTest extends UnitTestCase {
   /**
    * {@inheritdoc}
    */
-  public function setUp() {
+  public function setUp(): void {
     $context_handler = $this->prophesize(ContextHandlerInterface::class)
       ->reveal();
     $account = $this->prophesize(AccountInterface::class)
