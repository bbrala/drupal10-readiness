modules/contrib/seckit/seckit.install
modules/contrib/seckit/seckit.module
modules/contrib/seckit/src/Controller/SeckitExportController.php
modules/contrib/seckit/src/EventSubscriber/SecKitEventSubscriber.php
modules/contrib/seckit/src/Form/SecKitSettingsForm.php
modules/contrib/seckit/src/SeckitInterface.php
modules/contrib/seckit/tests/src/Functional/SecKitTestCaseTest.php

2 files with changes
====================

1) modules/contrib/seckit/tests/src/Functional/SecKitTestCaseTest.php:48

    ---------- begin diff ----------
@@ @@
   /**
    * {@inheritdoc}
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
     $this->admin = $this->drupalCreateUser(['administer seckit']);
     $this->drupalLogin($this->admin);
@@ @@
    */
   public function testDisabledCsp() {
     $form['seckit_xss[csp][checkbox]'] = FALSE;
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->assertSession()->responseHeaderEquals('Content-Security-Policy', NULL);
     $this->assertSession()->responseHeaderEquals('X-Content-Security-Policy', NULL);
     $this->assertSession()->responseHeaderEquals('X-WebKit-CSP', NULL);
@@ @@
       'seckit_xss[csp][report-uri]' => $this->reportPath,
       'seckit_xss[csp][upgrade-req]' => TRUE,
     ];
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $expected = 'default-src *; script-src *; object-src *; style-src *; img-src *; media-src *; frame-src *; frame-ancestors *; child-src *; font-src *; connect-src *; report-uri ' . base_path() . $this->reportPath . '; upgrade-insecure-requests';
     $this->assertSession()->responseHeaderEquals('Content-Security-Policy', $expected);
     $this->assertSession()->responseHeaderEquals('X-Content-Security-Policy', $expected);
@@ @@
       'seckit_xss[csp][report-uri]' => $this->reportPath,
       'seckit_xss[csp][upgrade-req]' => TRUE,
     ];
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $expected = 'default-src *; script-src *; object-src *; style-src *; img-src *; media-src *; frame-src *; frame-ancestors *; child-src *; font-src *; connect-src *; report-uri ' . base_path() . $this->reportPath . '; upgrade-insecure-requests';
     $this->assertSession()->responseHeaderEquals('Content-Security-Policy', $expected);
     $this->assertSession()->responseHeaderEquals('X-Content-Security-Policy', NULL);
@@ @@
       'seckit_xss[csp][report-uri]' => $this->reportPath,
       'seckit_xss[csp][upgrade-req]' => TRUE,
     ];
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $expected = 'default-src *; script-src *; object-src *; style-src *; img-src *; media-src *; frame-src *; frame-ancestors *; child-src *; font-src *; connect-src *; report-uri ' . base_path() . $this->reportPath . '; upgrade-insecure-requests';
     $this->assertSession()->responseHeaderEquals('Content-Security-Policy', $expected);
     $this->assertSession()->responseHeaderEquals('X-Content-Security-Policy', $expected);
@@ @@
       'seckit_xss[csp][report-uri]' => $this->reportPath,
       'seckit_xss[csp][upgrade-req]' => TRUE,
     ];
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $expected = 'default-src *; script-src *; object-src *; style-src *; img-src *; media-src *; frame-src *; frame-ancestors *; child-src *; font-src *; connect-src *; report-uri ' . base_path() . $this->reportPath . '; upgrade-insecure-requests';
     $this->assertSession()->responseHeaderEquals('Content-Security-Policy', $expected);
     $this->assertSession()->responseHeaderEquals('X-Content-Security-Policy', NULL);
@@ @@
       'seckit_xss[csp][report-uri]'  => $this->reportPath,
       'seckit_xss[csp][policy-uri]'  => 'http://mysite.com/csp.xml',
     ];
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $expected = 'policy-uri http://mysite.com/csp.xml';
-    $this->assertEqual($expected, $this->drupalGetHeader('Content-Security-Policy'), t('Content-Security-Policy has only policy-uri.'));
-    $this->assertEqual($expected, $this->drupalGetHeader('X-Content-Security-Policy'), t('X-Content-Security-Policy has only policy-uri.'));
-    $this->assertEqual($expected, $this->drupalGetHeader('X-WebKit-CSP'), t('X-WebKit-CSP has only policy-uri.'));
+    $this->assertEquals($expected, $this->drupalGetHeader('Content-Security-Policy'), t('Content-Security-Policy has only policy-uri.'));
+    $this->assertEquals($expected, $this->drupalGetHeader('X-Content-Security-Policy'), t('X-Content-Security-Policy has only policy-uri.'));
+    $this->assertEquals($expected, $this->drupalGetHeader('X-WebKit-CSP'), t('X-WebKit-CSP has only policy-uri.'));
   }

   /**
@@ @@
       'seckit_xss[csp][upgrade-req]' => FALSE,
       'seckit_xss[csp][policy-uri]' => '',
     ];
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $expected = "default-src self; report-uri " . base_path() . $this->reportPath;
     $this->assertSession()->responseHeaderEquals('Content-Security-Policy', $expected);
     $this->assertSession()->responseHeaderEquals('X-Content-Security-Policy', $expected);
@@ @@
     $form['seckit_xss[csp][vendor-prefix][x]'] = TRUE;
     $form['seckit_xss[csp][vendor-prefix][webkit]'] = TRUE;
     $form['seckit_xss[csp][report-only]'] = TRUE;
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->assertSession()->responseHeaderContains('Content-Security-Policy-Report-Only', 'report-uri');
     $this->assertSession()->responseHeaderContains('X-Content-Security-Policy-Report-Only', 'report-uri');
     $this->assertSession()->responseHeaderContains('X-WebKit-CSP-Report-Only', 'report-uri');
@@ @@
       $form['seckit_xss[csp][vendor-prefix][webkit]'] = TRUE;
       $form['seckit_xss[csp][default-src]'] = 'self';
       $form['seckit_xss[csp][report-uri]'] = $report_uri['uri'];
-      $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+      $this->drupalGet('admin/config/system/seckit');
+      $this->submitForm($form, t('Save configuration'));
       if ($report_uri['valid']) {
         $base_path = ($report_uri['absolute']) ? '' : base_path();
         $expected = 'default-src self; report-uri ' . $base_path . $report_uri['uri'];
@@ @@
    */
   public function testXxssProtectionIsDisabled() {
     $form['seckit_xss[x_xss][select]'] = SeckitInterface::X_XSS_DISABLE;
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->assertSession()->responseHeaderEquals('X-XSS-Protection', NULL);
   }

@@ @@
    */
   public function testXxssProtectionIs0() {
     $form['seckit_xss[x_xss][select]'] = SeckitInterface::X_XSS_0;
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->assertSession()->responseHeaderEquals('X-XSS-Protection', '0');
   }

@@ @@
    */
   public function testXxssProtectionIs1() {
     $form['seckit_xss[x_xss][select]'] = SeckitInterface::X_XSS_1;
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->assertSession()->responseHeaderEquals('X-XSS-Protection', '1');
   }

@@ @@
    */
   public function testXxssProtectionIs1Block() {
     $form['seckit_xss[x_xss][select]'] = SeckitInterface::X_XSS_1_BLOCK;
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->assertSession()->responseHeaderEquals('X-XSS-Protection', '1; mode=block');
   }

@@ @@
    */
   public function testOriginAllowsSite() {
     $form['seckit_csrf[origin]'] = TRUE;
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->originHeader = \Drupal::request()->getSchemeAndHttpHost();
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->assertSession()->statusCodeEquals(200);
   }

@@ @@
       'seckit_csrf[origin]' => TRUE,
       'seckit_csrf[origin_whitelist]' => 'http://www.example.com',
     ];
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->originHeader = 'http://www.example.com';
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->assertSession()->statusCodeEquals(200);
   }

@@ @@
       'seckit_csrf[origin]' => TRUE,
       'seckit_csrf[origin_whitelist]' => 'http://www.example.com, https://www.example.com, https://example.com:8080',
     ];
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->originHeader = 'http://www.example.com';
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->assertSession()->statusCodeEquals(200);
   }

@@ @@
    */
   public function testOriginDeny() {
     $form['seckit_csrf[origin]'] = TRUE;
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->originHeader = 'http://www.example.com';
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
-    $this->assertEqual([], $_POST, t('POST is empty.'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
+    $this->assertEquals([], $_POST, t('POST is empty.'));
     $this->assertSession()->statusCodeEquals(403);
   }

@@ @@
    */
   public function testXframeOptionsIsDisabled() {
     $form['seckit_clickjacking[x_frame]'] = SeckitInterface::X_FRAME_DISABLE;
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->assertSession()->responseHeaderEquals('X-Frame-Options', NULL);
   }

@@ @@
    */
   public function testXframeOptionsIsSameOrigin() {
     $form['seckit_clickjacking[x_frame]'] = SeckitInterface::X_FRAME_SAMEORIGIN;
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->assertSession()->responseHeaderEquals('X-Frame-Options', 'SAMEORIGIN');
   }

@@ @@
    */
   public function testXframeOptionsIsDeny() {
     $form['seckit_clickjacking[x_frame]'] = SeckitInterface::X_FRAME_DENY;
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->assertSession()->responseHeaderEquals('X-Frame-Options', 'DENY');
   }

@@ @@
   public function testXframeOptionsIsAllowFrom() {
     $form['seckit_clickjacking[x_frame]'] = SeckitInterface::X_FRAME_ALLOW_FROM;
     $form['seckit_clickjacking[x_frame_allow_from]'] = 'http://www.google.com';
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->assertSession()->responseHeaderEquals('X-Frame-Options', 'ALLOW-FROM http://www.google.com');
   }

@@ @@
   public function testJsCssNoscript() {
     $form['seckit_clickjacking[js_css_noscript]'] = TRUE;
     $form['seckit_clickjacking[noscript_message]'] = 'Sorry, your JavaScript is disabled.';
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $config = \Drupal::config('seckit.settings');
     $noscript_message = $config->get('seckit_clickjacking.noscript_message');
     // @TODO this was duplicated from the Event subscriber, move to function
@@ @@
     $noscript_message = $noscript_message ?
         $noscript_message :
         $config->get('seckit_clickjacking.noscript_message');
-    $path = base_path() . drupal_get_path('module', 'seckit');
+    $path = base_path() . \Drupal::service('extension.list.module')->getPath('seckit');
     $code = <<< EOT
         <script type="text/javascript" src="$path/js/seckit.document_write.js"></script>
         <link type="text/css" rel="stylesheet" id="seckit-clickjacking-no-body" media="all" href="$path/css/seckit.no_body.css" />
@@ @@
    */
   public function testDisabledHsts() {
     $form['seckit_ssl[hsts]'] = FALSE;
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->assertSession()->responseHeaderEquals('Strict-Transport-Security', NULL);
   }

@@ @@
       'seckit_ssl[hsts_max_age]' => 1000,
       'seckit_ssl[hsts_subdomains]' => 1,
     ];
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $expected = 'max-age=1000; includeSubDomains';
     $this->assertSession()->responseHeaderEquals('Strict-Transport-Security', $expected);
   }
@@ @@
    */
   public function testDisabledFromOrigin() {
     $form['seckit_various[from_origin]'] = FALSE;
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->assertSession()->responseHeaderEquals('From-Origin', NULL);
   }

@@ @@
       'seckit_various[from_origin]' => TRUE,
       'seckit_various[from_origin_destination]' => 'same',
     ];
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->assertSession()->responseHeaderEquals('From-Origin', 'same');
   }

@@ @@
    */
   public function testDisabledReferrerPolicy() {
     $form['seckit_various[referrer_policy]'] = FALSE;
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->assertSession()->responseHeaderEquals('Referrer-Policy', NULL);
   }

@@ @@
       'seckit_various[referrer_policy]' => TRUE,
       'seckit_various[referrer_policy_policy]' => 'no-referrer-when-downgrade',
     ];
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->assertSession()->responseHeaderEquals('Referrer-Policy', 'no-referrer-when-downgrade');
   }

@@ @@
    */
   public function testDisabledExpectCt() {
     $form['seckit_ct[expect_ct]'] = FALSE;
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->assertSession()->responseHeaderEquals('Expect-CT', NULL);
   }

@@ @@
       'seckit_ct[enforce]' => TRUE,
       'seckit_ct[report_uri]' => 'https://www.example.com/report',
     ];
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $expected = 'max-age=86400, enforce, report-uri="https://www.example.com/report"';
     $this->assertSession()->responseHeaderEquals('Expect-CT', $expected);
   }
@@ @@
    */
   public function testDisabledFeaturePolicy() {
     $form['seckit_fp[feature_policy]'] = FALSE;
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $this->assertSession()->responseHeaderEquals('Feature-Policy', NULL);
   }

@@ @@
       'seckit_fp[feature_policy]' => TRUE,
       'seckit_fp[feature_policy_policy]' => "accelerometer 'none'; camera 'none'; geolocation 'none'; gyroscope 'none'; magnetometer 'none'; microphone 'none'; payment 'none'; usb 'none'",
     ];
-    $this->drupalPostForm('admin/config/system/seckit', $form, t('Save configuration'));
+    $this->drupalGet('admin/config/system/seckit');
+    $this->submitForm($form, t('Save configuration'));
     $expected = "accelerometer 'none'; camera 'none'; geolocation 'none'; gyroscope 'none'; magnetometer 'none'; microphone 'none'; payment 'none'; usb 'none'";
     $this->assertSession()->responseHeaderEquals('Feature-Policy', $expected);
   }
    ----------- end diff -----------

Applied rules:
 * AssertEqualRector
 * DrupalGetPathRector
 * UiHelperTraitDrupalPostFormRector
 * ArgumentRemoverRector
 * WrapReturnRector
 * AddReturnTypeDeclarationRector
 * ChangeMethodVisibilityRector


2) modules/contrib/seckit/src/EventSubscriber/SecKitEventSubscriber.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\seckit\EventSubscriber;

+use Symfony\Component\HttpKernel\Event\RequestEvent;
+use Symfony\Component\HttpKernel\Event\ResponseEvent;
 use Drupal\Component\Utility\Xss;
 use Drupal\Component\Utility\UrlHelper;
 use Drupal\Core\Config\ConfigFactoryInterface;
@@ @@
 use Drupal\seckit\SeckitInterface;
 use Psr\Log\LoggerInterface;
 use Symfony\Component\HttpKernel\KernelEvents;
-use Symfony\Component\HttpKernel\Event\GetResponseEvent;
-use Symfony\Component\HttpKernel\Event\FilterResponseEvent;
 use Symfony\Component\EventDispatcher\EventSubscriberInterface;
 use Symfony\Component\HttpFoundation\Response;

@@ @@
   /**
    * Executes actions on the request event.
    *
-   * @param \Symfony\Component\HttpKernel\Event\GetResponseEvent $event
+   * @param \Symfony\Component\HttpKernel\Event\RequestEvent $event
    *   Event Response Object.
    */
-  public function onKernelRequest(GetResponseEvent $event) {
+  public function onKernelRequest(RequestEvent $event) {
     $this->request = $event->getRequest();

     // Execute necessary functions.
@@ @@
   /**
    * Executes actions on the response event.
    *
-   * @param \Symfony\Component\HttpKernel\Event\FilterResponseEvent $event
+   * @param \Symfony\Component\HttpKernel\Event\ResponseEvent $event
    *   Filter Response Event object.
    */
-  public function onKernelResponse(FilterResponseEvent $event) {
+  public function onKernelResponse(ResponseEvent $event) {
     $this->response = $event->getResponse();

     // Execute necessary functions.
@@ @@
         $this->config->get('seckit_clickjacking.noscript_message');

     $message = Xss::filter($noscript_message);
-    $path = base_path() . drupal_get_path('module', 'seckit');
+    $path = base_path() . \Drupal::service('extension.list.module')->getPath('seckit');
     return <<< EOT
         <script type="text/javascript" src="$path/js/seckit.document_write.js"></script>
         <link type="text/css" rel="stylesheet" id="seckit-clickjacking-no-body" media="all" href="$path/css/seckit.no_body.css" />
    ----------- end diff -----------

Applied rules:
 * DrupalGetPathRector
 * ArgumentRemoverRector
 * RenameClassRector
 * WrapReturnRector


 [OK] 2 files have been changed by Rector                                       

