modules/contrib/l10n_server/connectors/l10n_drupal/src/Plugin/l10n_server/Connector/Drupal.php
modules/contrib/l10n_server/l10n_packager/l10n_packager.module
modules/contrib/l10n_server/l10n_packager/src/Form/L10nPackagerFileForm.php
modules/contrib/l10n_server/l10n_server/l10n_server.module
modules/contrib/l10n_server/l10n_server/src/ConnectorParseHandlerResult.php
modules/contrib/l10n_server/l10n_server/src/Entity/L10nServerStatusFlagInterface.php
modules/contrib/l10n_server/l10n_server/src/Entity/Storage/L10nServerProjectStorageSchema.php
modules/contrib/l10n_server/l10n_server/src/Form/L10nServerTranslationHistoryForm.php
modules/contrib/l10n_server/l10n_server/src/SourceInterface.php
modules/contrib/l10n_server/l10n_server/src/SourceManager.php
modules/contrib/l10n_server/l10n_server/src/Entity/L10nServerString.php
modules/contrib/l10n_server/l10n_server/src/ConnectorParseHandlerResultInterface.php
modules/contrib/l10n_server/l10n_server/src/ConnectorPluginBase.php
modules/contrib/l10n_server/l10n_packager/src/Commands/L10nPackagerCommands.php
modules/contrib/l10n_server/l10n_server/src/SourcePluginBase.php
modules/contrib/l10n_server/connectors/l10n_drupal_rest/src/ParserService.php
modules/contrib/l10n_server/l10n_server/src/Entity/Storage/L10nServerReleaseStorage.php
modules/contrib/l10n_server/l10n_server/src/L10nHelper.php
modules/contrib/l10n_server/l10n_packager/src/Form/L10nPackagerForm.php
modules/contrib/l10n_server/l10n_packager/src/Entity/L10nPackagerFile.php
modules/contrib/l10n_server/l10n_server/src/ConnectorScanHandlerInterface.php
modules/contrib/l10n_server/l10n_server/src/ConnectorScanHandlerResult.php
modules/contrib/l10n_server/l10n_server/src/Annotation/Connector.php
modules/contrib/l10n_server/l10n_server/src/Entity/L10nServerStringInterface.php
modules/contrib/l10n_server/l10n_server/src/ConnectorScanHandlerResultInterface.php
modules/contrib/l10n_server/l10n_server/src/Entity/L10nServerTranslation.php
modules/contrib/l10n_server/l10n_server/src/ConnectorUploadHandlerInterface.php
modules/contrib/l10n_server/l10n_server/src/Entity/Storage/L10nServerReleaseStorageSchema.php
modules/contrib/l10n_server/l10n_server/src/Entity/AccessControlHandler/L10nServerProjectAccessControlHandler.php
modules/contrib/l10n_server/l10n_server/src/Annotation/Source.php
modules/contrib/l10n_server/l10n_server/src/Commands/L10nServerCommands.php
modules/contrib/l10n_server/l10n_server/src/Entity/Storage/L10nServerStatusFlagStorageSchema.php
modules/contrib/l10n_server/l10n_server/src/Entity/Storage/L10nServerStringStorageSchema.php
modules/contrib/l10n_server/l10n_server/src/Entity/AccessControlHandler/L10nServerReleaseAccessControlHandler.php
modules/contrib/l10n_server/l10n_server/src/Entity/Storage/L10nServerTranslationHistoryStorageSchema.php
modules/contrib/l10n_server/l10n_server/src/Entity/L10nServerError.php
modules/contrib/l10n_server/l10n_server/src/Entity/Storage/L10nServerTranslationStorageSchema.php
modules/contrib/l10n_server/l10n_server/src/Form/ConnectorBatchConfirmFormBase.php
modules/contrib/l10n_server/l10n_packager/src/Entity/L10nPackagerFileInterface.php
modules/contrib/l10n_server/l10n_packager/src/Entity/L10nPackagerRelease.php
modules/contrib/l10n_server/l10n_packager/src/Form/L10nPackagerReleaseForm.php
modules/contrib/l10n_server/l10n_server/src/Form/ConnectorBatchConfirmParseForm.php
modules/contrib/l10n_server/l10n_packager/src/Form/L10nPackagerSettingsForm.php
modules/contrib/l10n_server/l10n_packager/src/Entity/L10nPackagerReleaseInterface.php
modules/contrib/l10n_server/l10n_packager/src/Entity/ListBuilder/L10nPackagerFileListBuilder.php
modules/contrib/l10n_server/l10n_server/src/Entity/L10nServerErrorInterface.php
modules/contrib/l10n_server/l10n_server/src/Entity/L10nServerFile.php
modules/contrib/l10n_server/l10n_server/src/ParamConverter/L10nServerConnectorParamConverter.php
modules/contrib/l10n_server/l10n_server/src/Plugin/Derivative/ConnectorSources.php
modules/contrib/l10n_server/l10n_server/src/Entity/L10nServerTranslationHistory.php
modules/contrib/l10n_server/l10n_server/src/Form/ConnectorBatchConfirmScanForm.php
modules/contrib/l10n_server/connectors/l10n_drupal_rest/src/Plugin/l10n_server/Connector/DrupalRest.php
modules/contrib/l10n_server/l10n_packager/src/Entity/ListBuilder/L10nPackagerReleaseListBuilder.php
modules/contrib/l10n_server/l10n_server/src/Plugin/DevelGenerate/L10nServerDevelGenerateBase.php
modules/contrib/l10n_server/l10n_packager/src/L10nExporter.php
modules/contrib/l10n_server/l10n_server/src/Form/ConnectorConfiguration.php
modules/contrib/l10n_server/l10n_server/src/Entity/L10nServerFileInterface.php
modules/contrib/l10n_server/l10n_packager/src/Entity/Schema/L10nPackagerFileStorageSchema.php
modules/contrib/l10n_server/l10n_server/src/Entity/L10nServerLine.php
modules/contrib/l10n_server/l10n_server/src/Entity/L10nServerTranslationHistoryInterface.php
modules/contrib/l10n_server/l10n_server/src/Entity/L10nServerTranslationInterface.php
modules/contrib/l10n_server/l10n_server/src/Entity/ListBuilder/L10nServerErrorListBuilder.php
modules/contrib/l10n_server/l10n_packager/src/Entity/Storage/L10nPackagerReleaseStorage.php
modules/contrib/l10n_server/connectors/l10n_drupal_rest/src/ScannerService.php
modules/contrib/l10n_server/l10n_server/src/Plugin/DevelGenerate/L10nServerStatusFlagDevelGenerate.php
modules/contrib/l10n_server/l10n_server/src/Entity/ListBuilder/L10nServerFileListBuilder.php
modules/contrib/l10n_server/l10n_server/src/ConfigurableConnectorInterface.php
modules/contrib/l10n_server/l10n_server/src/ConfigurableConnectorPluginBase.php
modules/contrib/l10n_server/l10n_server/src/Plugin/DevelGenerate/L10nServerTranslationDevelGenerate.php
modules/contrib/l10n_server/l10n_server/src/Form/L10nServerErrorForm.php
modules/contrib/l10n_server/l10n_server/src/Entity/ListBuilder/L10nServerLineListBuilder.php
modules/contrib/l10n_server/l10n_server/src/Entity/L10nServerLineInterface.php
modules/contrib/l10n_server/l10n_server/src/Entity/L10nServerProject.php
modules/contrib/l10n_server/l10n_server/src/ConfigurableSourceInterface.php
modules/contrib/l10n_server/l10n_server/src/Entity/ListBuilder/L10nServerProjectListBuilder.php
modules/contrib/l10n_server/l10n_server/src/ConfigurableSourcePluginBase.php
modules/contrib/l10n_server/l10n_server/src/Form/L10nServerFileForm.php
modules/contrib/l10n_server/l10n_server/src/Form/L10nServerLineForm.php
modules/contrib/l10n_server/l10n_server/src/Plugin/DevelGenerate/L10nServerTranslationHistoryDevelGenerate.php
modules/contrib/l10n_server/l10n_server/src/ConnectorInterface.php
modules/contrib/l10n_server/l10n_server/src/ConnectorManager.php
modules/contrib/l10n_server/l10n_server/src/Form/L10nServerProjectForm.php
modules/contrib/l10n_server/l10n_server/src/Plugin/DevelGenerate/LanguageDevelGenerate.php
modules/contrib/l10n_server/l10n_server/src/Form/L10nServerReleaseForm.php
modules/contrib/l10n_server/l10n_server/src/Entity/ListBuilder/L10nServerReleaseListBuilder.php
modules/contrib/l10n_server/l10n_server/src/ConnectorManagerInterface.php
modules/contrib/l10n_server/l10n_server/src/ConnectorParseHandlerInterface.php
modules/contrib/l10n_server/l10n_server/src/Form/L10nServerSettingsForm.php
modules/contrib/l10n_server/connectors/l10n_gettext/src/Plugin/l10n_server/Connector/Gettext.php
modules/contrib/l10n_server/l10n_community/src/L10nStatistics.php
modules/contrib/l10n_server/l10n_server/src/Entity/L10nServerProjectInterface.php
modules/contrib/l10n_server/l10n_server/src/Plugin/QueueWorker/ParserQueue.php
modules/contrib/l10n_server/l10n_server/src/Entity/L10nServerRelease.php
modules/contrib/l10n_server/l10n_server/src/Entity/ListBuilder/L10nServerStatusFlagListBuilder.php
modules/contrib/l10n_server/l10n_server/src/Form/L10nServerStatusFlagForm.php
modules/contrib/l10n_server/l10n_server/src/Plugin/l10n_server/Source/FileSystem.php
modules/contrib/l10n_server/l10n_server/src/Entity/ListBuilder/L10nServerStringListBuilder.php
modules/contrib/l10n_server/l10n_server/src/Form/L10nServerStringForm.php
modules/contrib/l10n_server/l10n_server/src/Plugin/l10n_server/Source/RestApi.php
modules/contrib/l10n_server/l10n_server/src/Entity/ListBuilder/L10nServerTranslationHistoryListBuilder.php
modules/contrib/l10n_server/l10n_server/src/Form/L10nServerTranslationForm.php
modules/contrib/l10n_server/l10n_server/src/Plugin/l10n_server/Source/Upload.php
modules/contrib/l10n_server/l10n_server/src/Routing/L10nServerErrorHtmlRouteProvider.php
modules/contrib/l10n_server/l10n_community/src/Plugin/Block/FrontStatisticsBlock.php
modules/contrib/l10n_server/l10n_server/src/Entity/ListBuilder/L10nServerTranslationListBuilder.php
modules/contrib/l10n_server/l10n_server/src/Routing/L10nServerFileHtmlRouteProvider.php
modules/contrib/l10n_server/l10n_server/src/Routing/L10nServerLineHtmlRouteProvider.php
modules/contrib/l10n_server/l10n_server/src/Routing/L10nServerStatusFlagHtmlRouteProvider.php
modules/contrib/l10n_server/l10n_server/src/Routing/L10nServerStringHtmlRouteProvider.php
modules/contrib/l10n_server/l10n_server/src/Routing/L10nServerTranslationHistoryHtmlRouteProvider.php
modules/contrib/l10n_server/l10n_server/src/Routing/L10nServerTranslationHtmlRouteProvider.php
modules/contrib/l10n_server/l10n_community/src/Plugin/Block/LanguageStatisticsBlock.php
modules/contrib/l10n_server/l10n_packager/src/L10nPackager.php
modules/contrib/l10n_server/l10n_server/src/Entity/Storage/L10nRefreshStorageInterface.php
modules/contrib/l10n_server/l10n_server/src/Entity/Storage/L10nServerErrorStorageSchema.php
modules/contrib/l10n_server/l10n_community/src/Plugin/Block/ProjectStatisticsBlock.php
modules/contrib/l10n_server/l10n_server/src/Entity/Storage/L10nServerFileStorageSchema.php
modules/contrib/l10n_server/l10n_community/src/Plugin/Block/TopContributorsBlock.php
modules/contrib/l10n_server/l10n_server/src/Entity/Storage/L10nServerLineStorageSchema.php
modules/contrib/l10n_server/l10n_community/tests/src/Functional/L10nServerTest.php
modules/contrib/l10n_server/l10n_server/src/Entity/L10nServerReleaseInterface.php
modules/contrib/l10n_server/l10n_server/src/Entity/L10nServerStatusFlag.php
modules/contrib/l10n_server/l10n_packager/src/Plugin/Block/TranslationDownloadBlock.php
modules/contrib/l10n_server/l10n_packager/src/Plugin/QueueWorker/PackagerQueue.php
modules/contrib/l10n_server/l10n_packager/src/Routing/L10nPackagerFileHtmlRouteProvider.php
modules/contrib/l10n_server/l10n_packager/src/Routing/L10nPackagerReleaseHtmlRouteProvider.php

3 files with changes
====================

1) modules/contrib/l10n_server/l10n_packager/src/L10nPackager.php:403

    ---------- begin diff ----------
@@ @@
    */
   public function package($release, $language, $file = NULL, $timestamp = NULL) {

-    $timestamp = $timestamp ? $timestamp : REQUEST_TIME;
+    $timestamp = $timestamp ? $timestamp : \Drupal::time()->getRequestTime();
     $variables = array(
       '%release' => l10n_packager_release_name($release),
       '%language' => $language->name,
@@ @@
       $file->filename = basename($file_path);
       $file->filemime = $mime_type;
       $file->uri = $file_path;
-      file_unmanaged_move($export_name, $file->uri, FILE_EXISTS_REPLACE);
-      $file->filesize = filesize(drupal_realpath($file->uri));
+      file_unmanaged_move($export_name, $file->uri, FileSystemInterface::EXISTS_REPLACE);
+      $file->filesize = filesize(\Drupal::service('file_system')->realpath($file->uri));
       $file->sid_count = $sid_count;
       // Create actual symlink to latest
       l10n_packager_create_latest_symlink($file_path, $release, $language);
@@ @@
     $basepath = $currentpath = l10n_packager_directory();
     $finalpath = $basepath . '/' . $directory;
     $parts = explode('/', $directory);
-    $htaccess_path = drupal_realpath($basepath) . '/.htaccess';
+    $htaccess_path = \Drupal::service('file_system')->realpath($basepath) . '/.htaccess';
     if (!is_dir($basepath)) {
-      file_prepare_directory($basepath, FILE_CREATE_DIRECTORY);
+      \Drupal::service('file_system')->prepareDirectory($basepath, FileSystemInterface::CREATE_DIRECTORY);
     }
     if (!file_exists($htaccess_path)) {
       $htaccess_lines = "\n\n<FilesMatch \"\.(po)$\">\n\tForceType \"text/plain; charset=utf-8\"\n\tAllow from ALL\n</FilesMatch>\n";
@@ @@
     }
     while (is_dir($currentpath) && !is_dir($finalpath) && ($more = array_shift($parts))) {
       $currentpath .= '/' . $more;
-      file_prepare_directory($currentpath, FILE_CREATE_DIRECTORY);
+      \Drupal::service('file_system')->prepareDirectory($currentpath, FileSystemInterface::CREATE_DIRECTORY);
     }
     return $basepath . '/' . $path;
   }
    ----------- end diff -----------

Applied rules:
 * DrupalRealpathRector
 * FileCreateDirectoryRector
 * FileExistsReplaceRector
 * FilePrepareDirectoryRector
 * RequestTimeConstRector
 * ArgumentRemoverRector
 * WrapReturnRector


2) modules/contrib/l10n_server/l10n_packager/src/L10nExporter.php:51

    ---------- begin diff ----------
@@ @@
   function export($uri, $release = NULL, $language = NULL, $template = TRUE, $compact = FALSE, $installer = FALSE, $suggestions = FALSE) {
     $project = $this->getProjects(array('uri' => $uri));

-    $query = db_select('l10n_server_file', 'f');
+    $query = \Drupal::database()->select('l10n_server_file', 'f');
     $query->innerJoin('l10n_server_line', 'l', 'f.fid = l.fid');
     $query->innerJoin('l10n_server_string', 's', 'l.sid = s.sid');
     $query
@@ @@
         $message = t('There are no strings in any releases of %project to export.', array('%project' => $project->title));
       }
       // Message to the user.
-      drupal_set_message($message);
+      \Drupal::messenger()->addStatus($message);
       // Message to watchdog for possible automated packaging.
       watchdog('l10n_community', $message);
       return NULL;
@@ @@
     }

     // Generate a 'unique' temporary filename for this package.
-    $tempfile = tempnam(file_directory_temp(), 'l10n_community-' . $uri);
+    $tempfile = tempnam(\Drupal::service('file_system')->getTempDirectory(), 'l10n_community-' . $uri);

     if (!$compact) {
       if (count($po_data['revisions']) == 1) {
@@ @@
   function getProjects($options = array()) {
     static $projects = array();

-    $select = db_select('l10n_server_project', 'p')->fields('p');
+    $select = \Drupal::database()->select('l10n_server_project', 'p')->fields('p');

     // Consider returning all projects or just published ones.
     if (empty($options['all'])) {
@@ @@
         return $projects[$options['uri']];
       }
       // Not found in cache, so query and cache before returning.
-      $result = db_query("SELECT * FROM {l10n_server_project} WHERE uri = :uri", array(':uri' => $options['uri']));
+      $result = \Drupal::database()->query("SELECT * FROM {l10n_server_project} WHERE uri = :uri", array(':uri' => $options['uri']));
       if ($project = $result->fetchObject()) {
         $projects[$options['uri']] = $project;
         return $project;
@@ @@
     if ($parsed_only) {
       $query .= 'AND r.last_parsed > 0 ';
     }
-    $result = db_query($query, array(':uri' => $uri));
+    $result = \Drupal::database()->query($query, array(':uri' => $uri));
     $releases = $result->fetchAllAssoc('rid');
     uasort($releases, '_l10n_server_version_compare');
     return $releases;
@@ @@
    */
   function getProjectInitials() {
     // Grab the unique initials of all active projects
-    $result = db_query('SELECT DISTINCT(SUBSTR(title, 1, 1)) AS initial FROM {l10n_server_project} WHERE status = :status ORDER BY initial ASC', array(':status' => 1));
+    $result = \Drupal::database()->query('SELECT DISTINCT(SUBSTR(title, 1, 1)) AS initial FROM {l10n_server_project} WHERE status = :status ORDER BY initial ASC', array(':status' => 1));

     // Create an array of elements, all non-letters are grouped in '#'.
     $initials = array();
    ----------- end diff -----------

Applied rules:
 * DBQueryRector
 * DBSelectRector
 * DrupalSetMessageRector
 * FileDirectoryTempRector
 * ArgumentRemoverRector
 * WrapReturnRector


3) modules/contrib/l10n_server/l10n_community/tests/src/Functional/L10nServerTest.php:881

    ---------- begin diff ----------
@@ @@
     $tar = new Archive_Tar($package_file, 'gz');

     // Add the files as strings, so we can control their placement/name.
-    $tar->addString('potx_test_' . $api_version . '.module', file_get_contents(drupal_get_path('module', 'potx') . '/tests/potx_test_' . $api_version . '.module'));
+    $tar->addString('potx_test_' . $api_version . '.module', file_get_contents(\Drupal::service('extension.list.module')->getPath('potx') . '/tests/potx_test_' . $api_version . '.module'));
     // Add .info file tailored to the module filename (although this is not
     // important for potx, just to be clear about identification).
-    $tar->addString('potx_test_' . $api_version . '.info', file_get_contents(drupal_get_path('module', 'potx') . '/tests/potx_test_6.info'));
+    $tar->addString('potx_test_' . $api_version . '.info', file_get_contents(\Drupal::service('extension.list.module')->getPath('potx') . '/tests/potx_test_6.info'));
     $num_files = 2;
     if ($include_js
         && $api_version > 5) {
@@ @@
       // Add .js file regardless of api version. Although Drupal 5 parsing
       // should not pick this up, this packaging allows us to test for that
       // exactly.
-      $tar->addString('potx_test_' . $api_version . '.js', file_get_contents(drupal_get_path('module', 'potx') . '/tests/potx_test.js'));
+      $tar->addString('potx_test_' . $api_version . '.js', file_get_contents(\Drupal::service('extension.list.module')->getPath('potx') . '/tests/potx_test.js'));
       $num_files = 3;
     }

     $this->assertTrue(file_exists($package_file), t('Test package created.'));
     $this->assertTrue(filesize($package_file) > 0, t('Test package contains data.'));
-    $this->pass('Temporary file at ' . $package_file);
-    $this->pass('List of package files: ' . var_export($tar->listContent(), TRUE));

     // Login as admin and get this package parsed.
     $this->drupalLogin($this->userAdmin);
    ----------- end diff -----------

Applied rules:
 * DrupalGetPathRector
 * PassRector
 * ArgumentRemoverRector
 * WrapReturnRector
 * ChangeMethodVisibilityRector


 [OK] 3 files have been changed by Rector                                       

