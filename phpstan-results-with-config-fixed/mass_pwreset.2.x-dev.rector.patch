diff --git a/mass_pwreset.batch.inc b/mass_pwreset.batch.inc
index dd03baf..21b6192 100644
--- a/mass_pwreset.batch.inc
+++ b/mass_pwreset.batch.inc
@@ -27,7 +27,7 @@ function mass_pwreset_batch_process($data, &$context) {
   // Reset user password.
   if (isset($data['uids'][$i])) {
     $user = User::load($data['uids'][$i]);
-    $user->setPassword(user_password(40));
+    $user->setPassword(\Drupal::service('password_generator')->generate(40));
     $user->save();
 
     // Update status message.
diff --git a/mass_pwreset.info.yml b/mass_pwreset.info.yml
index 6a01da4..7758ffb 100644
--- a/mass_pwreset.info.yml
+++ b/mass_pwreset.info.yml
@@ -2,5 +2,5 @@ name: Mass Password Reset
 description: Reset all user accounts!
 package: Authentication
 type: module
-core_version_requirement: ^8.8 || ^9
+core_version_requirement: ^9.3 || ^10
 configure: TODO
diff --git a/mass_pwreset.module b/mass_pwreset.module
index 1cd909b..417919d 100644
--- a/mass_pwreset.module
+++ b/mass_pwreset.module
@@ -23,7 +23,7 @@ function mass_pwreset_multiple_reset(array $data) {
     'init_message' => t('Multiple password reset in progress.'),
     'progress_message' => t('Password reset batch in progress.'),
     'error_message' => t('There was an error in the password reset batch.'),
-    'file' => drupal_get_path('module', 'mass_pwreset') . '/mass_pwreset.batch.inc',
+    'file' => \Drupal::service('extension.list.module')->getPath('mass_pwreset') . '/mass_pwreset.batch.inc',
   ];
   // Set batch via form submit handler.
   batch_set($batch);
