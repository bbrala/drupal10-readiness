diff --git a/yp/src/Controller/YpController.php b/yp/src/Controller/YpController.php
index 93e316d..be7f404 100644
--- a/yp/src/Controller/YpController.php
+++ b/yp/src/Controller/YpController.php
@@ -51,7 +51,7 @@ class YpController extends ControllerBase {
       throw new AccessDeniedHttpException();
     }
     $this->response = new Response();
-    $this->fields['last_touch'] = REQUEST_TIME;
+    $this->fields['last_touch'] = \Drupal::time()->getRequestTime();
     $this->sid = is_string($request->get('sid')) ? (int) $request->get('sid') : NULL;
     $this->request = $request;
     $this->$action();
diff --git a/yp/tests/src/Functional/YpTest.php b/yp/tests/src/Functional/YpTest.php
index 828b983..8c92bdd 100644
--- a/yp/tests/src/Functional/YpTest.php
+++ b/yp/tests/src/Functional/YpTest.php
@@ -23,6 +23,7 @@ class YpTest extends BrowserTestBase {
 
   /**
    * Functional tests for yp.
+   * @doesNotPerformAssertions
    */
   public function testYp(): void {
   }
diff --git a/yp/yp.module b/yp/yp.module
index 7677fb8..2e7d1f5 100644
--- a/yp/yp.module
+++ b/yp/yp.module
@@ -9,5 +9,5 @@
  * Cleanup stale YP entries (not touched within past five minutes).
  */
 function yp_cron(): void {
-  \Drupal::database()->delete('yp_stream')->condition('last_touch', strval(REQUEST_TIME - 300), '<')->execute();
+  \Drupal::database()->delete('yp_stream')->condition('last_touch', strval(\Drupal::time()->getRequestTime() - 300), '<')->execute();
 }
diff --git a/yplog/tests/src/Functional/YpLogTest.php b/yplog/tests/src/Functional/YpLogTest.php
index a971a83..473b943 100644
--- a/yplog/tests/src/Functional/YpLogTest.php
+++ b/yplog/tests/src/Functional/YpLogTest.php
@@ -23,6 +23,7 @@ class YpLogTest extends BrowserTestBase {
 
   /**
    * Functional tests for yplog.
+   * @doesNotPerformAssertions
    */
   public function testYpLog(): void {
   }
diff --git a/yplog/yplog.module b/yplog/yplog.module
index a932290..95312a7 100644
--- a/yplog/yplog.module
+++ b/yplog/yplog.module
@@ -11,6 +11,6 @@
 function yplog_cron(): void {
   // In the event that multiple streams have the same listen URL, they will be
   // summed together.
-  \Drupal::database()->delete('yp_log')->condition('timestamp', strval(REQUEST_TIME - (60 * 60 * 24 * 30)), '<')->execute();
-  \Drupal::database()->query('INSERT INTO {yp_log} (listen_url, listeners, timestamp) SELECT listen_url, SUM(listeners), :timestamp FROM {yp_stream} GROUP BY listen_url', [':timestamp' => REQUEST_TIME]);
+  \Drupal::database()->delete('yp_log')->condition('timestamp', strval(\Drupal::time()->getRequestTime() - (60 * 60 * 24 * 30)), '<')->execute();
+  \Drupal::database()->query('INSERT INTO {yp_log} (listen_url, listeners, timestamp) SELECT listen_url, SUM(listeners), :timestamp FROM {yp_stream} GROUP BY listen_url', [':timestamp' => \Drupal::time()->getRequestTime()]);
 }
