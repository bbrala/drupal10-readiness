diff --git a/src/Plugin/KeyType/AuthenticationKeyType.php b/src/Plugin/KeyType/AuthenticationKeyType.php
index 3d8a01b..42dfeb7 100644
--- a/src/Plugin/KeyType/AuthenticationKeyType.php
+++ b/src/Plugin/KeyType/AuthenticationKeyType.php
@@ -25,7 +25,7 @@ class AuthenticationKeyType extends KeyTypeBase {
    */
   public static function generateKeyValue(array $configuration) {
     // Generate a random 16-character password.
-    return user_password(16);
+    return \Drupal::service('password_generator')->generate(16);
   }
 
   /**
diff --git a/tests/src/Functional/KeyAdminTest.php b/tests/src/Functional/KeyAdminTest.php
index 9800fc0..603b986 100644
--- a/tests/src/Functional/KeyAdminTest.php
+++ b/tests/src/Functional/KeyAdminTest.php
@@ -35,7 +35,7 @@ class KeyAdminTest extends BrowserTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->adminUser = $this->drupalCreateUser(['administer keys']);
@@ -65,7 +65,7 @@ class KeyAdminTest extends BrowserTestBase {
       'id' => 'testing_key',
       'label' => 'Testing Key',
     ];
-    $this->drupalPostForm(NULL, $edit, 'Save');
+    $this->submitForm($edit, 'Save');
 
     // Go to the Key list page.
     $this->drupalGet('admin/config/system/keys');
@@ -77,6 +77,7 @@ class KeyAdminTest extends BrowserTestBase {
 
   /**
    * Tests key routes for an authorized user.
+   * @doesNotPerformAssertions
    */
   public function testAdminUserRoutes() {
     $this->createTestKey('key_foo');
diff --git a/tests/src/Functional/KeyInputTest.php b/tests/src/Functional/KeyInputTest.php
index 1c1cbd2..c4429d0 100644
--- a/tests/src/Functional/KeyInputTest.php
+++ b/tests/src/Functional/KeyInputTest.php
@@ -35,7 +35,7 @@ class KeyInputTest extends BrowserTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->adminUser = $this->drupalCreateUser(['administer keys']);
@@ -57,7 +57,7 @@ class KeyInputTest extends BrowserTestBase {
       'key_type' => 'authentication',
       'key_input_settings[key_value]' => str_pad('', 4000, 'z'),
     ];
-    $this->drupalPostForm(NULL, $edit, 'Save');
+    $this->submitForm($edit, 'Save');
     $this->assertSession()->pageTextContains(sprintf('The key %s has been added.', $edit['label']));
 
     // Go to the Key page.
diff --git a/tests/src/Functional/KeyNonAdminAccessTest.php b/tests/src/Functional/KeyNonAdminAccessTest.php
index 752a0f5..f8d9a77 100644
--- a/tests/src/Functional/KeyNonAdminAccessTest.php
+++ b/tests/src/Functional/KeyNonAdminAccessTest.php
@@ -35,7 +35,7 @@ class KeyNonAdminAccessTest extends BrowserTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
     $this->createTestKey('key_foo');
     $this->createTestKeyConfigOverride('test_override', 'key_foo');
diff --git a/tests/src/Functional/KeyOverrideAdminTest.php b/tests/src/Functional/KeyOverrideAdminTest.php
index a7cb6b8..ce84e6b 100644
--- a/tests/src/Functional/KeyOverrideAdminTest.php
+++ b/tests/src/Functional/KeyOverrideAdminTest.php
@@ -23,7 +23,7 @@ class KeyOverrideAdminTest extends BrowserTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
     $this->createTestKey('key_foo');
     $this->createTestKeyConfigOverride('test_override', 'key_foo');
diff --git a/tests/src/Unit/Entity/KeyEntityTest.php b/tests/src/Unit/Entity/KeyEntityTest.php
index 6c2d768..e1d984d 100644
--- a/tests/src/Unit/Entity/KeyEntityTest.php
+++ b/tests/src/Unit/Entity/KeyEntityTest.php
@@ -79,7 +79,7 @@ class KeyEntityTest extends KeyTestBase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $definition = [
@@ -90,9 +90,7 @@ class KeyEntityTest extends KeyTestBase {
     $plugin = new AuthenticationKeyType($this->key_type_settings, 'authentication', $definition);
 
     // Mock the KeyTypeManager service.
-    $this->keyTypeManager = $this->getMockBuilder('\Drupal\key\Plugin\KeyPluginManager')
-      ->disableOriginalConstructor()
-      ->getMock();
+    $this->keyTypeManager = $this->createMock('\Drupal\key\Plugin\KeyPluginManager');
 
     $this->keyTypeManager->expects($this->any())
       ->method('getDefinitions')
@@ -114,9 +112,7 @@ class KeyEntityTest extends KeyTestBase {
     $plugin = new ConfigKeyProvider($this->key_provider_settings, 'config', $definition);
 
     // Mock the KeyProviderManager service.
-    $this->keyProviderManager = $this->getMockBuilder('\Drupal\key\Plugin\KeyPluginManager')
-      ->disableOriginalConstructor()
-      ->getMock();
+    $this->keyProviderManager = $this->createMock('\Drupal\key\Plugin\KeyPluginManager');
 
     $this->keyProviderManager->expects($this->any())
       ->method('getDefinitions')
@@ -142,9 +138,7 @@ class KeyEntityTest extends KeyTestBase {
     $plugin = new NoneKeyInput($this->key_input_settings, 'none', $definition);
 
     // Mock the KeyInputManager service.
-    $this->keyInputManager = $this->getMockBuilder('\Drupal\key\Plugin\KeyPluginManager')
-      ->disableOriginalConstructor()
-      ->getMock();
+    $this->keyInputManager = $this->createMock('\Drupal\key\Plugin\KeyPluginManager');
 
     $this->keyInputManager->expects($this->any())
       ->method('getDefinitions')
diff --git a/tests/src/Unit/KeyTestBase.php b/tests/src/Unit/KeyTestBase.php
index 8594217..06a16bb 100644
--- a/tests/src/Unit/KeyTestBase.php
+++ b/tests/src/Unit/KeyTestBase.php
@@ -45,24 +45,18 @@ abstract class KeyTestBase extends UnitTestCase {
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     // Mock the Config object, but methods will be mocked in the test class.
-    $this->config = $this->getMockBuilder('\Drupal\Core\Config\ImmutableConfig')
-      ->disableOriginalConstructor()
-      ->getMock();
+    $this->config = $this->createMock('\Drupal\Core\Config\ImmutableConfig');
 
     // Mock ConfigEntityStorage object, but methods will be mocked in the test
     // class.
-    $this->configStorage = $this->getMockBuilder('\Drupal\Core\Config\Entity\ConfigEntityStorage')
-      ->disableOriginalConstructor()
-      ->getMock();
+    $this->configStorage = $this->createMock('\Drupal\Core\Config\Entity\ConfigEntityStorage');
 
     // Mock EntityTypeManager service.
-    $this->entityTypeManager = $this->getMockBuilder('\Drupal\Core\Entity\EntityTypeManager')
-      ->disableOriginalConstructor()
-      ->getMock();
+    $this->entityTypeManager = $this->createMock('\Drupal\Core\Entity\EntityTypeManager');
     $this->entityTypeManager->expects($this->any())
       ->method('getStorage')
       ->with('key')
