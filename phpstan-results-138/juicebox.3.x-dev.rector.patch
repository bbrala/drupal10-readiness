diff --git a/src/JuiceboxFormatter.php b/src/JuiceboxFormatter.php
index 0653a67..2884534 100644
--- a/src/JuiceboxFormatter.php
+++ b/src/JuiceboxFormatter.php
@@ -359,23 +359,23 @@ class JuiceboxFormatter implements JuiceboxFormatterInterface, TrustedCallbackIn
     $image_data = [];
     $image_data['juicebox_compatible'] = TRUE;
     // Set the normal, unstyled, url for reference.
-    $image_data['unstyled_src'] = file_create_url($file->getFileUri());
+    $image_data['unstyled_src'] = \Drupal::service('file_url_generator')->generateAbsoluteString($file->getFileUri());
     // Check compatibility if configured and if the library info contains
     // mimetype compatibitly information.
     if ($check_compatible && !empty($library['compatible_mimetypes']) && !in_array($mimetype, $library['compatible_mimetypes'])) {
       // If the item is not compatible, find the substitute mimetype icon.
       $image_data['juicebox_compatible'] = FALSE;
-      $icon_dir = drupal_get_path('module', 'juicebox') . '/images/mimetypes';
+      $icon_dir = \Drupal::service('extension.list.module')->getPath('juicebox') . '/images/mimetypes';
       // We only have icons for each major type, so simplify accordingly.
       // file_icon_class() could also be useful here but would require
       // supporting icons for more package types.
       $type_parts = explode('/', $mimetype);
       $icon_path = $icon_dir . '/' . reset($type_parts) . '.png';
       if (file_exists($icon_path)) {
-        $image_data['imageURL'] = file_create_url($icon_path);
+        $image_data['imageURL'] = \Drupal::service('file_url_generator')->generateAbsoluteString($icon_path);
       }
       else {
-        $image_data['imageURL'] = file_create_url($icon_dir . '/general.png');
+        $image_data['imageURL'] = \Drupal::service('file_url_generator')->generateAbsoluteString($icon_dir . '/general.png');
       }
     }
     // If the item is compatible, style it.
diff --git a/tests/src/Functional/JuiceboxCaseTestBase.php b/tests/src/Functional/JuiceboxCaseTestBase.php
index 03802bd..2a40295 100644
--- a/tests/src/Functional/JuiceboxCaseTestBase.php
+++ b/tests/src/Functional/JuiceboxCaseTestBase.php
@@ -72,7 +72,7 @@ abstract class JuiceboxCaseTestBase extends BrowserTestBase {
       'settings' => $field_storage_settings,
       'cardinality' => FieldStorageDefinitionInterface::CARDINALITY_UNLIMITED,
     ];
-    entity_create('field_storage_config', $field_storage)->save();
+    \Drupal::service('entity_type.manager')->getStorage('field_storage_config')->create($field_storage)->save();
     // Prep a field instance.
     $field_settings = [];
     if ($this->instFieldType == 'image') {
@@ -93,9 +93,9 @@ abstract class JuiceboxCaseTestBase extends BrowserTestBase {
       'required' => FALSE,
       'settings' => $field_settings,
     ];
-    entity_create('field_config', $field)->save();
+    \Drupal::service('entity_type.manager')->getStorage('field_config')->create($field)->save();
     // Setup widget.
-    entity_get_form_display('node', $this->instBundle, 'default')
+    \Drupal::service('entity_display.repository')->getFormDisplay('node', $this->instBundle, 'default')
       ->setComponent($this->instFieldName, [
         'type' => 'file_generic',
         'settings' => [],
@@ -111,7 +111,7 @@ abstract class JuiceboxCaseTestBase extends BrowserTestBase {
    * Helper to activate a Juicebox field formatter on a field.
    */
   protected function activateJuiceboxFieldFormatter() {
-    entity_get_display('node', $this->instBundle, 'default')
+    \Drupal::service('entity_display.repository')->getViewDisplay('node', $this->instBundle, 'default')
       ->setComponent($this->instFieldName, [
         'type' => 'juicebox_formatter',
         'settings' => [],
diff --git a/tests/src/Functional/JuiceboxConfCase.php b/tests/src/Functional/JuiceboxConfCase.php
index 037a81e..e699e06 100644
--- a/tests/src/Functional/JuiceboxConfCase.php
+++ b/tests/src/Functional/JuiceboxConfCase.php
@@ -22,7 +22,7 @@ class JuiceboxConfCase extends JuiceboxCaseTestBase {
   /**
    * Define setup tasks.
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
     // Create and login user.
     $this->webUser = $this->drupalCreateUser([
@@ -55,13 +55,13 @@ class JuiceboxConfCase extends JuiceboxCaseTestBase {
     // also prime the cache in order to test cache tag invalidation once the
     // settings are altered.
     $this->drupalGet('node/' . $node->id());
-    $this->assertRaw(trim(json_encode([
+    $this->assertSession()->responseContains(trim(json_encode([
       'gallerywidth' => '100%',
       'galleryheight' => '100%',
       'backgroundcolor' => '#222222',
-    ]), '{}'), 'Expected default configuration options found in Drupal.settings.');
+    ]), '{}'));
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertRaw('<juicebox gallerywidth="100%" galleryheight="100%" backgroundcolor="#222222" textcolor="rgba(255,255,255,1)" thumbframecolor="rgba(255,255,255,.5)" showopenbutton="TRUE" showexpandbutton="TRUE" showthumbsbutton="TRUE" usethumbdots="FALSE" usefullscreenexpand="FALSE">', 'Expected default configuration options set in XML.');
+    $this->assertSession()->responseContains('<juicebox gallerywidth="100%" galleryheight="100%" backgroundcolor="#222222" textcolor="rgba(255,255,255,1)" thumbframecolor="rgba(255,255,255,.5)" showopenbutton="TRUE" showexpandbutton="TRUE" showthumbsbutton="TRUE" usethumbdots="FALSE" usefullscreenexpand="FALSE">');
     // Alter settings to contain custom values.
     $this->drupalLogin($this->webUser);
     $this->drupalGet('admin/structure/types/manage/' . $this->instBundle . '/display');
@@ -79,19 +79,22 @@ class JuiceboxConfCase extends JuiceboxCaseTestBase {
       'fields[' . $this->instFieldName . '][settings_edit_form][settings][jlib_useFullscreenExpand]' => TRUE,
     ];
     $this->submitForm($edit, 'Save');
-    $this->assertText($this->t('Your settings have been saved.'), 'Gallery configuration changes saved.');
+    // TODO: Drupal Rector Notice: Please delete the following comment after you've made any necessary changes.
+    // Verify the assertion: pageTextContains() for HTML responses, responseContains() for non-HTML responses.
+    // The passed text should be HTML decoded, exactly as a human sees it in the browser.
+    $this->assertSession()->pageTextContains($this->t('Your settings have been saved.'));
     // Now check the resulting XML again as an anon user.
     $this->drupalLogout();
     // Check for correct embed markup.
     $this->drupalGet('node/' . $node->id());
-    $this->assertRaw(trim(json_encode([
+    $this->assertSession()->responseContains(trim(json_encode([
       'gallerywidth' => '50%',
       'galleryheight' => '200px',
       'backgroundcolor' => 'red',
-    ]), '{}'), 'Expected custom Lite configuration options found in Drupal.settings.');
+    ]), '{}'));
     // Check for correct XML.
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertRaw('<juicebox gallerywidth="50%" galleryheight="200px" backgroundcolor="red" textcolor="green" thumbframecolor="blue" showopenbutton="FALSE" showexpandbutton="FALSE" showthumbsbutton="FALSE" usethumbdots="TRUE" usefullscreenexpand="TRUE">', 'Expected custom Lite configuration options set in XML.');
+    $this->assertSession()->responseContains('<juicebox gallerywidth="50%" galleryheight="200px" backgroundcolor="red" textcolor="green" thumbframecolor="blue" showopenbutton="FALSE" showexpandbutton="FALSE" showthumbsbutton="FALSE" usethumbdots="TRUE" usefullscreenexpand="TRUE">');
   }
 
   /**
@@ -102,9 +105,9 @@ class JuiceboxConfCase extends JuiceboxCaseTestBase {
     // Do a set of control requests as an anon user that will also prime any
     // caches.
     $this->drupalGet('node/' . $node->id());
-    $this->assertResponse(200, 'Control request of test node was successful.');
+    $this->assertSession()->statusCodeEquals(200, 'Control request of test node was successful.');
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertResponse(200, 'Control request of XML was successful.');
+    $this->assertSession()->statusCodeEquals(200, 'Control request of XML was successful.');
     // Set new manual options and also add a manual customization that's
     // intended to override a custom Lite option.
     $this->drupalLogin($this->webUser);
@@ -115,18 +118,21 @@ class JuiceboxConfCase extends JuiceboxCaseTestBase {
       'fields[' . $this->instFieldName . '][settings_edit_form][settings][manual_config]' => "sHoWoPeNbUtToN=\"FALSE\"\nshowexpandbutton=\"TRUE\"\ngallerywidth=\"50%\"\nmyCustomSetting=\"boomsauce\"",
     ];
     $this->submitForm($edit, 'Save');
-    $this->assertText($this->t('Your settings have been saved.'), 'Gallery configuration changes saved.');
+    // TODO: Drupal Rector Notice: Please delete the following comment after you've made any necessary changes.
+    // Verify the assertion: pageTextContains() for HTML responses, responseContains() for non-HTML responses.
+    // The passed text should be HTML decoded, exactly as a human sees it in the browser.
+    $this->assertSession()->pageTextContains($this->t('Your settings have been saved.'));
     $this->drupalLogout();
     // Check for correct embed markup.
     $this->drupalGet('node/' . $node->id());
-    $this->assertRaw(trim(json_encode([
+    $this->assertSession()->responseContains(trim(json_encode([
       'gallerywidth' => '50%',
       'galleryheight' => '100%',
       'backgroundcolor' => '#222222',
-    ]), '{}'), 'Expected custom configuration options found in Drupal.settings.');
+    ]), '{}'));
     // Check for correct XML.
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertRaw('<juicebox gallerywidth="50%" galleryheight="100%" backgroundcolor="#222222" textcolor="rgba(255,255,255,1)" thumbframecolor="rgba(255,255,255,.5)" showopenbutton="FALSE" showexpandbutton="TRUE" showthumbsbutton="TRUE" usethumbdots="FALSE" usefullscreenexpand="FALSE" mycustomsetting="boomsauce">', 'Expected custom Pro configuration options set in XML.');
+    $this->assertSession()->responseContains('<juicebox gallerywidth="50%" galleryheight="100%" backgroundcolor="#222222" textcolor="rgba(255,255,255,1)" thumbframecolor="rgba(255,255,255,.5)" showopenbutton="FALSE" showexpandbutton="TRUE" showthumbsbutton="TRUE" usethumbdots="FALSE" usefullscreenexpand="FALSE" mycustomsetting="boomsauce">');
   }
 
   /**
@@ -136,12 +142,12 @@ class JuiceboxConfCase extends JuiceboxCaseTestBase {
     $node = $this->node;
     // Get the urls to the main image with and without "large" styling.
     $uri = File::load($node->{$this->instFieldName}[0]->target_id)->getFileUri();
-    $test_image_url = file_create_url($uri);
-    $test_image_url_formatted = entity_load('image_style', 'juicebox_medium')->buildUrl($uri);
+    $test_image_url = \Drupal::service('file_url_generator')->generateAbsoluteString($uri);
+    $test_image_url_formatted = \Drupal::service('entity_type.manager')->getStorage('image_style')->load('juicebox_medium')->buildUrl($uri);
     // Check control case without custom configuration.
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertRaw('linkTarget="_blank"', 'Default linkTarget setting found.');
-    $this->assertRaw('linkURL="' . $test_image_url, 'Test unstyled image found in XML');
+    $this->assertSession()->responseContains('linkTarget="_blank"');
+    $this->assertSession()->responseContains('linkURL="' . $test_image_url);
     // Set new advanced options.
     $this->drupalLogin($this->webUser);
     $this->drupalGet('admin/structure/types/manage/' . $this->instBundle . '/display');
@@ -153,15 +159,18 @@ class JuiceboxConfCase extends JuiceboxCaseTestBase {
       'fields[' . $this->instFieldName . '][settings_edit_form][settings][custom_parent_classes]' => 'my-custom-wrapper',
     ];
     $this->submitForm($edit, 'Save');
-    $this->assertText($this->t('Your settings have been saved.'), 'Gallery configuration changes saved.');
+    // TODO: Drupal Rector Notice: Please delete the following comment after you've made any necessary changes.
+    // Verify the assertion: pageTextContains() for HTML responses, responseContains() for non-HTML responses.
+    // The passed text should be HTML decoded, exactly as a human sees it in the browser.
+    $this->assertSession()->pageTextContains($this->t('Your settings have been saved.'));
     $this->drupalLogout();
     // Check case with custom configuration.
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertRaw('linkTarget="_self"', 'Updated linkTarget setting found in XML.');
-    $this->assertRaw('linkURL="' . Html::escape($test_image_url_formatted), 'Test styled image found in XML for linkURL.');
+    $this->assertSession()->responseContains('linkTarget="_self"');
+    $this->assertSession()->responseContains('linkURL="' . Html::escape($test_image_url_formatted));
     // Also check for custom class in embed code.
     $this->drupalGet('node/' . $node->id());
-    $this->assertRaw('class="juicebox-parent my-custom-wrapper"', 'Custom class found in embed code.');
+    $this->assertSession()->responseContains('class="juicebox-parent my-custom-wrapper"');
   }
 
 }
diff --git a/tests/src/Functional/JuiceboxConfGlobalCase.php b/tests/src/Functional/JuiceboxConfGlobalCase.php
index 59013c4..ca1c9e4 100644
--- a/tests/src/Functional/JuiceboxConfGlobalCase.php
+++ b/tests/src/Functional/JuiceboxConfGlobalCase.php
@@ -23,7 +23,7 @@ class JuiceboxConfGlobalCase extends JuiceboxCaseTestBase {
   /**
    * Define setup tasks.
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
     // Create and login user.
     // @todo Reactivate translation perms when issue #2573975 is resolved.
@@ -61,7 +61,7 @@ class JuiceboxConfGlobalCase extends JuiceboxCaseTestBase {
     // Do a control request of the XML as an anon user that will also prime any
     // caches.
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertResponse(200, 'Control request of XML was successful.');
+    $this->assertSession()->statusCodeEquals(200, 'Control request of XML was successful.');
     // Enable optional global settings.
     $this->drupalLogin($this->webUser);
     $edit = [
@@ -69,13 +69,16 @@ class JuiceboxConfGlobalCase extends JuiceboxCaseTestBase {
     ];
     $this->drupalGet('admin/config/media/juicebox');
     $this->submitForm($edit, 'Save configuration');
-    $this->assertText($this->t('The Juicebox configuration options have been saved'), 'Custom global options saved.');
+    // TODO: Drupal Rector Notice: Please delete the following comment after you've made any necessary changes.
+    // Verify the assertion: pageTextContains() for HTML responses, responseContains() for non-HTML responses.
+    // The passed text should be HTML decoded, exactly as a human sees it in the browser.
+    $this->assertSession()->pageTextContains($this->t('The Juicebox configuration options have been saved'));
     // Now check the resulting XML again as an anon user.
     $this->drupalLogout();
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
     // Check the the XML now returns an 'Access-Control-Allow-Origin' header
     // for CORS support.
-    $this->assertEqual($this->drupalGetHeader('Access-Control-Allow-Origin'), '*', 'Expected CORS header found.');
+    $this->assertEquals($this->drupalGetHeader('Access-Control-Allow-Origin'), '*', 'Expected CORS header found.');
   }
 
   /**
@@ -88,7 +91,7 @@ class JuiceboxConfGlobalCase extends JuiceboxCaseTestBase {
     // Do a control request of the XML as an anon user that will also prime any
     // caches.
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertResponse(200, 'Control request of XML was successful.');
+    $this->assertSession()->statusCodeEquals(200, 'Control request of XML was successful.');
     // We want to be able to set translations.
     $this->drupalLogin($this->webUser);
     $edit = [
@@ -103,7 +106,10 @@ class JuiceboxConfGlobalCase extends JuiceboxCaseTestBase {
     ];
     $this->drupalGet('admin/config/media/juicebox');
     $this->submitForm($edit, 'Save configuration');
-    $this->assertText($this->t('The Juicebox configuration options have been saved'), 'Custom global options saved.');
+    // TODO: Drupal Rector Notice: Please delete the following comment after you've made any necessary changes.
+    // Verify the assertion: pageTextContains() for HTML responses, responseContains() for non-HTML responses.
+    // The passed text should be HTML decoded, exactly as a human sees it in the browser.
+    $this->assertSession()->pageTextContains($this->t('The Juicebox configuration options have been saved'));
     // We need to set a translation for our languagelist string. There is
     // probably a good way to do this directly in code, but for now it's fairly
     // easy to just brute-force it via the UI. First we need to visit the
@@ -118,18 +124,21 @@ class JuiceboxConfGlobalCase extends JuiceboxCaseTestBase {
     $this->drupalGet('admin/config/media/juicebox');
     $this->submitForm($edit, 'Filter');
     $matches = [];
-    $this->assertTrue(preg_match('/name="strings\[([0-9]+)\]\[translations\]\[0\]"/', $this->getRawContent(), $matches), 'Languagelist base string is available for translation.');
+    $this->assertTrue(preg_match('/name="strings\[([0-9]+)\]\[translations\]\[0\]"/', $this->getSession()->getPage()->getContent(), $matches), 'Languagelist base string is available for translation.');
     $edit = [
       'strings[' . $matches[1] . '][translations][0]' => 'Translated|Lang|List',
     ];
     $this->submitForm($edit, 'Save translations');
-    $this->assertText($this->t('The strings have been saved'), 'Languagelist translation saved.');
+    // TODO: Drupal Rector Notice: Please delete the following comment after you've made any necessary changes.
+    // Verify the assertion: pageTextContains() for HTML responses, responseContains() for non-HTML responses.
+    // The passed text should be HTML decoded, exactly as a human sees it in the browser.
+    $this->assertSession()->pageTextContains($this->t('The strings have been saved'));
     // Now check the resulting XML again as an anon user.
     $this->drupalLogout();
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
     // Check that the languagelist configuration option was both included and
     // translated in the XML.
-    $this->assertRaw('languagelist="Translated|Lang|List"', 'Translated languagelist value found in XML.');
+    $this->assertSession()->responseContains('languagelist="Translated|Lang|List"');
   }
 
   /**
@@ -140,7 +149,7 @@ class JuiceboxConfGlobalCase extends JuiceboxCaseTestBase {
     // Do a control request of the XML as an anon user that will also prime any
     // caches.
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertResponse(200, 'Control request of XML was successful.');
+    $this->assertSession()->statusCodeEquals(200, 'Control request of XML was successful.');
     // Customize one of our global multi-size settings from the default for a
     // true end-to-end test.
     $this->drupalLogin($this->webUser);
@@ -149,7 +158,10 @@ class JuiceboxConfGlobalCase extends JuiceboxCaseTestBase {
     ];
     $this->drupalGet('admin/config/media/juicebox');
     $this->submitForm($edit, 'Save configuration');
-    $this->assertText($this->t('The Juicebox configuration options have been saved'), 'Custom global options saved.');
+    // TODO: Drupal Rector Notice: Please delete the following comment after you've made any necessary changes.
+    // Verify the assertion: pageTextContains() for HTML responses, responseContains() for non-HTML responses.
+    // The passed text should be HTML decoded, exactly as a human sees it in the browser.
+    $this->assertSession()->pageTextContains($this->t('The Juicebox configuration options have been saved'));
     // Alter field formatter specific settings to use multi-size style.
     $this->drupalGet('admin/structure/types/manage/' . $this->instBundle . '/display');
     $this->submitForm([], $this->instFieldName . '_settings_edit', 'entity-view-display-edit-form');
@@ -157,19 +169,22 @@ class JuiceboxConfGlobalCase extends JuiceboxCaseTestBase {
       'fields[' . $this->instFieldName . '][settings_edit_form][settings][image_style]' => 'juicebox_multisize',
     ];
     $this->submitForm($edit, 'Save');
-    $this->assertText($this->t('Your settings have been saved.'), 'Gallery configuration changes saved.');
+    // TODO: Drupal Rector Notice: Please delete the following comment after you've made any necessary changes.
+    // Verify the assertion: pageTextContains() for HTML responses, responseContains() for non-HTML responses.
+    // The passed text should be HTML decoded, exactly as a human sees it in the browser.
+    $this->assertSession()->pageTextContains($this->t('Your settings have been saved.'));
     // Calculate the multi-size styles that should be found in the XML.
     $uri = File::load($node->{$this->instFieldName}[0]->target_id)->getFileUri();
-    $formatted_image_small = entity_load('image_style', 'juicebox_small')->buildUrl($uri);
-    $formatted_image_medium = entity_load('image_style', 'juicebox_medium')->buildUrl($uri);
-    $formatted_image_large = entity_load('image_style', 'large')->buildUrl($uri);
+    $formatted_image_small = \Drupal::service('entity_type.manager')->getStorage('image_style')->load('juicebox_small')->buildUrl($uri);
+    $formatted_image_medium = \Drupal::service('entity_type.manager')->getStorage('image_style')->load('juicebox_medium')->buildUrl($uri);
+    $formatted_image_large = \Drupal::service('entity_type.manager')->getStorage('image_style')->load('large')->buildUrl($uri);
     // Now check the resulting XML again as an anon user.
     $this->drupalLogout();
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
     // Check that the expected images are found in the XML.
-    $this->assertRaw('smallImageURL="' . Html::escape($formatted_image_small), 'Test small image found in XML.');
-    $this->assertRaw('imageURL="' . Html::escape($formatted_image_medium), 'Test medium image found in XML.');
-    $this->assertRaw('largeImageURL="' . Html::escape($formatted_image_large), 'Test large image found in XML.');
+    $this->assertSession()->responseContains('smallImageURL="' . Html::escape($formatted_image_small));
+    $this->assertSession()->responseContains('imageURL="' . Html::escape($formatted_image_medium));
+    $this->assertSession()->responseContains('largeImageURL="' . Html::escape($formatted_image_large));
   }
 
 }
diff --git a/tests/src/Functional/JuiceboxFieldFormatterCase.php b/tests/src/Functional/JuiceboxFieldFormatterCase.php
index e29e415..a813f2d 100644
--- a/tests/src/Functional/JuiceboxFieldFormatterCase.php
+++ b/tests/src/Functional/JuiceboxFieldFormatterCase.php
@@ -32,7 +32,7 @@ class JuiceboxFieldFormatterCase extends JuiceboxCaseTestBase {
   /**
    * Define setup tasks.
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
     // Create and login user.
     $this->webUser = $this->drupalCreateUser([
@@ -66,9 +66,9 @@ class JuiceboxFieldFormatterCase extends JuiceboxCaseTestBase {
     // Do a set of control requests as an anon user that will also prime any
     // caches.
     $this->drupalGet('node/' . $node->id());
-    $this->assertResponse(200, 'Control request of test node was successful.');
+    $this->assertSession()->statusCodeEquals(200, 'Control request of test node was successful.');
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertResponse(200, 'Control request of XML was successful.');
+    $this->assertSession()->statusCodeEquals(200, 'Control request of XML was successful.');
     // Alter field formatter specific settings to contain custom values.
     $this->drupalLogin($this->webUser);
     $this->drupalGet('admin/structure/types/manage/' . $this->instBundle . '/display');
@@ -80,24 +80,27 @@ class JuiceboxFieldFormatterCase extends JuiceboxCaseTestBase {
       'fields[' . $this->instFieldName . '][settings_edit_form][settings][title_source]' => 'title',
     ];
     $this->submitForm($edit, 'Save');
-    $this->assertText($this->t('Your settings have been saved.'), 'Gallery configuration changes saved.');
+    // TODO: Drupal Rector Notice: Please delete the following comment after you've made any necessary changes.
+    // Verify the assertion: pageTextContains() for HTML responses, responseContains() for non-HTML responses.
+    // The passed text should be HTML decoded, exactly as a human sees it in the browser.
+    $this->assertSession()->pageTextContains($this->t('Your settings have been saved.'));
     // Get the urls to the image and thumb derivatives expected.
     $uri = File::load($node->{$this->instFieldName}[0]->target_id)->getFileUri();
-    $test_formatted_image_url = file_create_url($uri);
-    $test_formatted_thumb_url = entity_load('image_style', 'thumbnail')->buildUrl($uri);
+    $test_formatted_image_url = \Drupal::service('file_url_generator')->generateAbsoluteString($uri);
+    $test_formatted_thumb_url = \Drupal::service('entity_type.manager')->getStorage('image_style')->load('thumbnail')->buildUrl($uri);
     // Check for correct embed markup as anon user.
     $this->drupalLogout();
     $this->drupalGet('node/' . $node->id());
-    $this->assertRaw(Html::escape(file_url_transform_relative($test_formatted_image_url)), 'Test styled image found in embed code');
+    $this->assertSession()->responseContains(Html::escape(\Drupal::service('file_url_generator')->transformRelative($test_formatted_image_url)));
     // Check for correct XML.
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertRaw('imageURL="' . Html::escape($test_formatted_image_url), 'Test styled image found in XML.');
-    $this->assertRaw('thumbURL="' . Html::escape($test_formatted_thumb_url), 'Test styled thumbnail found in XML.');
+    $this->assertSession()->responseContains('imageURL="' . Html::escape($test_formatted_image_url));
+    $this->assertSession()->responseContains('thumbURL="' . Html::escape($test_formatted_thumb_url));
     // Note the intended title and caption text does not contain any block-level
     // tags as long as the global title and caption output filter is working.
     // So this acts as a test for that feature as well.
-    $this->assertRaw('<title><![CDATA[Some title text for field ' . $this->instFieldName . ' on node ' . $node->id() . ']]></title>', 'Image title text found in XML');
-    $this->assertRaw('<caption><![CDATA[Some alt text for field ' . $this->instFieldName . ' on node ' . $node->id() . ' &lt;strong&gt;with formatting&lt;/strong&gt;]]></caption>', 'Image caption text found in XML');
+    $this->assertSession()->responseContains('<title><![CDATA[Some title text for field ' . $this->instFieldName . ' on node ' . $node->id() . ']]></title>');
+    $this->assertSession()->responseContains('<caption><![CDATA[Some alt text for field ' . $this->instFieldName . ' on node ' . $node->id() . ' &lt;strong&gt;with formatting&lt;/strong&gt;]]></caption>');
     // Now that we have title and caption data set, also ensure this text can
     // be found in search results. First we update the search index by marking
     // our test node as dirty and running cron.
@@ -107,10 +110,13 @@ class JuiceboxFieldFormatterCase extends JuiceboxCaseTestBase {
     $this->cronRun();
     $this->drupalGet('search');
     $this->submitForm(['keys' => '"Some title text"'], 'Search');
-    $this->assertText('Test Juicebox Gallery Node', 'Juicebox node found in search for title text.');
+    // TODO: Drupal Rector Notice: Please delete the following comment after you've made any necessary changes.
+    // Verify the assertion: pageTextContains() for HTML responses, responseContains() for non-HTML responses.
+    // The passed text should be HTML decoded, exactly as a human sees it in the browser.
+    $this->assertSession()->pageTextContains('Test Juicebox Gallery Node');
     // The Juicebox javascript should have been excluded from the search results
     // page.
-    $this->assertNoRaw('"configUrl":"', 'Juicebox Drupal.settings vars not included on search result page.');
+    $this->assertSession()->responseNotContains('"configUrl":"');
   }
 
   /**
@@ -120,9 +126,9 @@ class JuiceboxFieldFormatterCase extends JuiceboxCaseTestBase {
     $node = $this->node;
     // The node and XML should be initially accessible (control test).
     $this->drupalGet('node/' . $node->id());
-    $this->assertResponse(200, 'Access allowed for published node.');
+    $this->assertSession()->statusCodeEquals(200, 'Access allowed for published node.');
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertRaw('<?xml version="1.0" encoding="UTF-8"', 'XML access allowed to published node (valid XML detected).');
+    $this->assertSession()->responseContains('<?xml version="1.0" encoding="UTF-8"');
     // Now unpublish the node as a way of making it inaccessible to
     // non-privileged users. There are unlimited ways that access can be
     // restricted, such as other perm settings, contrb module controls for
@@ -133,9 +139,9 @@ class JuiceboxFieldFormatterCase extends JuiceboxCaseTestBase {
     $node->save();
     // Re-check access.
     $this->drupalGet('node/' . $node->id());
-    $this->assertResponse(403, 'Access blocked for unpublished node.');
+    $this->assertSession()->statusCodeEquals(403, 'Access blocked for unpublished node.');
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertResponse(403, 'XML access blocked for unpublished node.');
+    $this->assertSession()->statusCodeEquals(403, 'XML access blocked for unpublished node.');
   }
 
 }
diff --git a/tests/src/Functional/JuiceboxFileCase.php b/tests/src/Functional/JuiceboxFileCase.php
index b893fba..dce3487 100644
--- a/tests/src/Functional/JuiceboxFileCase.php
+++ b/tests/src/Functional/JuiceboxFileCase.php
@@ -36,7 +36,7 @@ class JuiceboxFileCase extends JuiceboxCaseTestBase {
   /**
    * Define setup tasks.
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
     // Create and login user.
     $this->webUser = $this->drupalCreateUser([
@@ -64,28 +64,28 @@ class JuiceboxFileCase extends JuiceboxCaseTestBase {
     $this->createNodeWithFile();
     $node = $this->node;
     $xml_path = 'juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full';
-    $xml_url = \Drupal::url('juicebox.xml_field', [
+    $xml_url = \Drupal\Core\Url::fromRoute('juicebox.xml_field', [
       'entityType' => 'node',
       'entityId' => $node->id(),
       'fieldName' => $this->instFieldName,
       'displayName' => 'full',
-    ]);
+    ])->toString();
     // Get the urls to the test image and thumb derivative used by default.
     $uri = File::load($node->{$this->instFieldName}[0]->target_id)->getFileUri();
-    $test_image_url = entity_load('image_style', 'juicebox_medium')->buildUrl($uri);
-    $test_thumb_url = entity_load('image_style', 'juicebox_square_thumb')->buildUrl($uri);
+    $test_image_url = \Drupal::service('entity_type.manager')->getStorage('image_style')->load('juicebox_medium')->buildUrl($uri);
+    $test_thumb_url = \Drupal::service('entity_type.manager')->getStorage('image_style')->load('juicebox_square_thumb')->buildUrl($uri);
     // Check for correct embed markup as anon user.
     $this->drupalLogout();
     $this->drupalGet('node/' . $node->id());
-    $this->assertRaw(trim(json_encode(['configUrl' => $xml_url]), '{}"'), 'Gallery setting found in Drupal.settings.');
-    $this->assertRaw('id="node--' . $node->id() . '--' . str_replace('_', '-', $this->instFieldName) . '--full"', 'Embed code wrapper found.');
-    $this->assertRaw(Html::escape(file_url_transform_relative($test_image_url)), 'Test image found in embed code');
+    $this->assertSession()->responseContains(trim(json_encode(['configUrl' => $xml_url]), '{}"'));
+    $this->assertSession()->responseContains('id="node--' . $node->id() . '--' . str_replace('_', '-', $this->instFieldName) . '--full"');
+    $this->assertSession()->responseContains(Html::escape(\Drupal::service('file_url_generator')->transformRelative($test_image_url)));
     // Check for correct XML.
     $this->drupalGet($xml_path);
-    $this->assertRaw('<?xml version="1.0" encoding="UTF-8"?>', 'Valid XML detected.');
-    $this->assertRaw('imageURL="' . Html::escape($test_image_url), 'Test image found in XML.');
-    $this->assertRaw('thumbURL="' . Html::escape($test_thumb_url), 'Test thumbnail found in XML.');
-    $this->assertRaw('<juicebox gallerywidth="100%" galleryheight="100%" backgroundcolor="#222222" textcolor="rgba(255,255,255,1)" thumbframecolor="rgba(255,255,255,.5)" showopenbutton="TRUE" showexpandbutton="TRUE" showthumbsbutton="TRUE" usethumbdots="FALSE" usefullscreenexpand="FALSE">', 'Expected default configuration options set in XML.');
+    $this->assertSession()->responseContains('<?xml version="1.0" encoding="UTF-8"?>');
+    $this->assertSession()->responseContains('imageURL="' . Html::escape($test_image_url));
+    $this->assertSession()->responseContains('thumbURL="' . Html::escape($test_thumb_url));
+    $this->assertSession()->responseContains('<juicebox gallerywidth="100%" galleryheight="100%" backgroundcolor="#222222" textcolor="rgba(255,255,255,1)" thumbframecolor="rgba(255,255,255,.5)" showopenbutton="TRUE" showexpandbutton="TRUE" showthumbsbutton="TRUE" usethumbdots="FALSE" usefullscreenexpand="FALSE">');
   }
 
   /**
@@ -100,7 +100,7 @@ class JuiceboxFileCase extends JuiceboxCaseTestBase {
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
     // With the default settings we expect an "application-octet-stream.png"
     // value for both the image and the thumbnail.
-    $this->assertPattern('|imageURL=.*text.png.*thumbURL=.*text.png|', 'Non-image mimetype placeholder found for image and thumbnail.');
+    $this->assertSession()->responseMatches('|imageURL=.*text.png.*thumbURL=.*text.png|', 'Non-image mimetype placeholder found for image and thumbnail.');
     // Change the file handling option to "skip".
     $this->drupalLogin($this->webUser);
     $this->drupalGet('admin/structure/types/manage/' . $this->instBundle . '/display');
@@ -110,12 +110,15 @@ class JuiceboxFileCase extends JuiceboxCaseTestBase {
     ];
     $this->submitForm($edit, 'Save');
     $savemsg = $this->t('Gallery configuration changes saved.');
-    $this->assertText($savemsg);
+    // TODO: Drupal Rector Notice: Please delete the following comment after you've made any necessary changes.
+    // Verify the assertion: pageTextContains() for HTML responses, responseContains() for non-HTML responses.
+    // The passed text should be HTML decoded, exactly as a human sees it in the browser.
+    $this->assertSession()->pageTextContains($savemsg);
     // Re-check the XML. This time no image should appear at all.
     $this->drupalLogout();
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertRaw('<?xml version="1.0" encoding="UTF-8"?>', 'Valid XML detected.');
-    $this->assertNoRaw('<image', 'Non-image items was skipped.');
+    $this->assertSession()->responseContains('<?xml version="1.0" encoding="UTF-8"?>');
+    $this->assertSession()->responseNotContains('<image');
     // @todo , Check other incompatible_file_action combinations.
   }
 
diff --git a/tests/src/Functional/JuiceboxSubRequestCase.php b/tests/src/Functional/JuiceboxSubRequestCase.php
index 038aacf..31af6f0 100644
--- a/tests/src/Functional/JuiceboxSubRequestCase.php
+++ b/tests/src/Functional/JuiceboxSubRequestCase.php
@@ -62,7 +62,7 @@ class JuiceboxSubRequestCase extends JuiceboxCaseTestBase {
   /**
    * Define setup tasks.
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
     // Create and login user.
     $this->webUser = $this->drupalCreateUser([
@@ -88,21 +88,21 @@ class JuiceboxSubRequestCase extends JuiceboxCaseTestBase {
   public function testSubRequestDependent() {
     $node = $this->node;
     $xml_path = 'juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/_custom';
-    $xml_url = \Drupal::url('juicebox.xml_field', [
+    $xml_url = \Drupal\Core\Url::fromRoute('juicebox.xml_field', [
       'entityType' => 'node',
       'entityId' => $node->id(),
       'fieldName' => $this->instFieldName,
       'displayName' => '_custom',
-    ]);
+    ])->toString();
     // Get the urls to the test image and thumb derivative used by default.
     $uri = File::load($node->{$this->instFieldName}[0]->target_id)->getFileUri();
-    $test_image_url = entity_load('image_style', 'juicebox_medium')->buildUrl($uri);
-    $test_thumb_url = entity_load('image_style', 'juicebox_square_thumb')->buildUrl($uri);
+    $test_image_url = \Drupal::service('entity_type.manager')->getStorage('image_style')->load('juicebox_medium')->buildUrl($uri);
+    $test_thumb_url = \Drupal::service('entity_type.manager')->getStorage('image_style')->load('juicebox_square_thumb')->buildUrl($uri);
     // Check for correct embed markup. This will also prime the cache.
     $content = $this->drupalGet('juicebox_test_row_formatter');
-    $this->assertRaw(trim(json_encode(['configUrl' => $xml_url]), '{}"'), 'Gallery setting found in Drupal.settings.');
-    $this->assertRaw('id="node--' . $node->id() . '--' . str_replace('_', '-', $this->instFieldName) . '---custom"', 'Embed code wrapper found.');
-    $this->assertRaw(Html::escape($test_image_url), 'Test image found in embed code');
+    $this->assertSession()->responseContains(trim(json_encode(['configUrl' => $xml_url]), '{}"'));
+    $this->assertSession()->responseContains('id="node--' . $node->id() . '--' . str_replace('_', '-', $this->instFieldName) . '---custom"');
+    $this->assertSession()->responseContains(Html::escape($test_image_url));
     // Extract the xml-source values from the XML.
     $matches = [];
     // In the pattern below we have to use four (yeah, FOUR) backslashes to
@@ -120,10 +120,10 @@ class JuiceboxSubRequestCase extends JuiceboxCaseTestBase {
         'xml-source-id' => $matches[2],
       ],
     ]);
-    $this->assertRaw('<?xml version="1.0" encoding="UTF-8"?>', 'Valid XML detected.');
-    $this->assertRaw('imageURL="' . Html::escape($test_image_url), 'Test image found in XML.' . $test_image_url);
-    $this->assertRaw('thumbURL="' . Html::escape($test_thumb_url), 'Test thumbnail found in XML.' . $test_thumb_url);
-    $this->assertRaw('backgroundcolor="green"', 'Custom background setting from pseudo field instance config found in XML.');
+    $this->assertSession()->responseContains('<?xml version="1.0" encoding="UTF-8"?>');
+    $this->assertSession()->responseContains('imageURL="' . Html::escape($test_image_url));
+    $this->assertSession()->responseContains('thumbURL="' . Html::escape($test_thumb_url));
+    $this->assertSession()->responseContains('backgroundcolor="green"');
   }
 
 }
diff --git a/tests/src/Functional/JuiceboxViewsCase.php b/tests/src/Functional/JuiceboxViewsCase.php
index 995b6ea..8b21d47 100644
--- a/tests/src/Functional/JuiceboxViewsCase.php
+++ b/tests/src/Functional/JuiceboxViewsCase.php
@@ -50,7 +50,7 @@ class JuiceboxViewsCase extends JuiceboxCaseTestBase {
   /**
    * Define setup tasks.
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
 
     // Create and login user.
@@ -84,27 +84,26 @@ class JuiceboxViewsCase extends JuiceboxCaseTestBase {
     $this->drupalLogin($this->webUser);
     $node = $this->node;
     $xml_path = 'juicebox/xml/viewsstyle/juicebox_views_test/page_2';
-    $xml_url = \Drupal::url('juicebox.xml_viewsstyle',
-     ['viewName' => 'juicebox_views_test', 'displayName' => 'page_2']);
+    $xml_url = \Drupal\Core\Url::fromRoute('juicebox.xml_viewsstyle', ['viewName' => 'juicebox_views_test', 'displayName' => 'page_2'])->toString();
     // Get the urls to the test image and thumb derivative used by default.
     $uri = File::load($node->{$this->instFieldName}[0]->target_id)->getFileUri();
-    $test_image_url = entity_load('image_style', 'juicebox_medium')->buildUrl($uri);
-    $test_thumb_url = entity_load('image_style', 'juicebox_square_thumb')->buildUrl($uri);
+    $test_image_url = \Drupal::service('entity_type.manager')->getStorage('image_style')->load('juicebox_medium')->buildUrl($uri);
+    $test_thumb_url = \Drupal::service('entity_type.manager')->getStorage('image_style')->load('juicebox_square_thumb')->buildUrl($uri);
     // Check for correct embed markup.
     $this->drupalGet('juicebox-views-test-advanced');
-    $this->assertRaw(trim(json_encode(['configUrl' => $xml_url]), '{}"'), 'Gallery setting found in Drupal.settings.');
-    $this->assertRaw('juicebox-views-test--page-2', 'Embed code wrapper found.');
-    $this->assertRaw(Html::escape(file_url_transform_relative($test_image_url)), 'Test image found in embed code');
+    $this->assertSession()->responseContains(trim(json_encode(['configUrl' => $xml_url]), '{}"'));
+    $this->assertSession()->responseContains('juicebox-views-test--page-2');
+    $this->assertSession()->responseContains(Html::escape(\Drupal::service('file_url_generator')->transformRelative($test_image_url)));
     // Check for correct XML.
     $this->drupalGet($xml_path);
-    $this->assertRaw('<?xml version="1.0" encoding="UTF-8"?>', 'Valid XML detected.');
-    $this->assertRaw('imageURL="' . Html::escape($test_image_url), 'Test image found in XML.');
-    $this->assertRaw('thumbURL="' . Html::escape($test_thumb_url), 'Test thumbnail found in XML.');
+    $this->assertSession()->responseContains('<?xml version="1.0" encoding="UTF-8"?>');
+    $this->assertSession()->responseContains('imageURL="' . Html::escape($test_image_url));
+    $this->assertSession()->responseContains('thumbURL="' . Html::escape($test_thumb_url));
     // Logout and test that XML access is restricted. Note that this test view
     // is setup to limit view access only to admins.
     $this->drupalLogout();
     $this->drupalGet('juicebox/xml/viewsstyle/juicebox_views_test/page_2');
-    $this->assertResponse(403, 'XML access blocked for access-restricted view.');
+    $this->assertSession()->statusCodeEquals(403, 'XML access blocked for access-restricted view.');
   }
 
 }
