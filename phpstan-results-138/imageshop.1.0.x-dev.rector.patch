diff --git a/imageshop.info.yml b/imageshop.info.yml
index 3a6550f..661f004 100644
--- a/imageshop.info.yml
+++ b/imageshop.info.yml
@@ -1,5 +1,5 @@
 name: Imageshop
-core_version_requirement: ^8.8 || ^9
+core_version_requirement: ^9.3 || ^10
 type: module
 dependencies:
   - drupal:image
diff --git a/src/Element/ImageShopElement.php b/src/Element/ImageShopElement.php
index e074827..7d19ef4 100644
--- a/src/Element/ImageShopElement.php
+++ b/src/Element/ImageShopElement.php
@@ -176,7 +176,7 @@ class ImageShopElement extends ManagedFile {
     }
     $file_system->prepareDirectory($dir, FileSystemInterface::CREATE_DIRECTORY);
     $filename = sprintf('%s/%s.%s', $dir, $filename, $extension);
-    $file = file_save_data($data, $filename);
+    $file = \Drupal::service('file.repository')->writeData($data, $filename);
     if (!$file) {
       return FALSE;
     }
diff --git a/tests/src/Functional/ElementTest.php b/tests/src/Functional/ElementTest.php
index 63465ff..7ee93e9 100644
--- a/tests/src/Functional/ElementTest.php
+++ b/tests/src/Functional/ElementTest.php
@@ -44,7 +44,8 @@ class ElementTest extends FileFieldTestBase {
     $this->drupalGet('/node/add/article');
     $files = $this->container->get('entity_type.manager')->getStorage('file')->loadByProperties([]);
     $this->assertEmpty($files);
-    $this->drupalPostForm('/node/add/article', [
+    $this->drupalGet('/node/add/article');
+    $this->submitForm([
       'my_imageshop_field[0][url]' => Url::fromUserInput('/core/misc/druplicon.png')->setOption('absolute', TRUE)->toString(),
     ], 'Upload');
     $files = $this->container->get('entity_type.manager')->getStorage('file')->loadByProperties([]);
