diff --git a/block_generation.module b/block_generation.module
index e15b4b0..2177e72 100644
--- a/block_generation.module
+++ b/block_generation.module
@@ -134,12 +134,12 @@ function block_generation_theme_registry_alter(&$theme_registry) {
 
             // Possible file path of the template name containing the bundle name.
             $template_name = 'block--block-generation--' . strtr($bundle, '_', '-');
-            $file_path = $app_root . '/' . drupal_get_path('module', $block_generation_module) . '/templates/' . $template_name . '.html.twig';
+            $file_path = $app_root . '/' . \Drupal::service('extension.list.module')->getPath($block_generation_module) . '/templates/' . $template_name . '.html.twig';
             // If file exists then make registry changes.
             if (file_exists($file_path)) {
               // Add possible preprocesses, template with template path.
               $block_generation_theme_registry['block__block_generation__' . $bundle] = [
-                'path' => drupal_get_path('module', $block_generation_module) . '/templates',
+                'path' => \Drupal::service('extension.list.module')->getPath($block_generation_module) . '/templates',
                 'preprocess functions' => [
                   'template_preprocess',
                   'template_preprocess_block__block_generation',
@@ -147,7 +147,7 @@ function block_generation_theme_registry_alter(&$theme_registry) {
                 ],
                 'render element' => 'elements',
                 'template' => $template_name,
-                'theme path' => drupal_get_path('module', $block_generation_module),
+                'theme path' => \Drupal::service('extension.list.module')->getPath($block_generation_module),
                 'type' => 'module',
               ];
             }
@@ -157,12 +157,12 @@ function block_generation_theme_registry_alter(&$theme_registry) {
             foreach ($view_modes as $view_mode_name => $view_mode_definition) {
               // Possible file path of the template name containing the bundle name and view mode name.
               $template_name = 'block--block-generation--' . strtr($bundle, '_', '-') . '--' . strtr($view_mode_name, '_', '-');
-              $file_path = $app_root . '/' . drupal_get_path('module', $block_generation_module) . '/templates/' . $template_name . '.html.twig';
+              $file_path = $app_root . '/' . \Drupal::service('extension.list.module')->getPath($block_generation_module) . '/templates/' . $template_name . '.html.twig';
               // If file exists then make registry changes.
               if (file_exists($file_path)) {
                 // Add possible preprocesses, template with template path.
                 $block_generation_theme_registry['block__block_generation__' . $bundle . '__' . $view_mode_name] = [
-                  'path' => drupal_get_path('module', $block_generation_module) . '/templates',
+                  'path' => \Drupal::service('extension.list.module')->getPath($block_generation_module) . '/templates',
                   'preprocess functions' => [
                     'template_preprocess',
                     'template_preprocess_block__block_generation',
@@ -171,7 +171,7 @@ function block_generation_theme_registry_alter(&$theme_registry) {
                   ],
                   'render element' => 'elements',
                   'template' => $template_name,
-                  'theme path' => drupal_get_path('module', $block_generation_module),
+                  'theme path' => \Drupal::service('extension.list.module')->getPath($block_generation_module),
                   'type' => 'module',
                 ];
               }
@@ -182,12 +182,12 @@ function block_generation_theme_registry_alter(&$theme_registry) {
             foreach ($fields as $fieldName => $fieldDefinition) {
               // Possible file path of the template name containing the field name.
               $template_name = 'field--block-generation--' . strtr($fieldName, '_', '-');
-              $file_path = $app_root . '/' . drupal_get_path('module', $block_generation_module) . '/templates/' . $template_name . '.html.twig';
+              $file_path = $app_root . '/' . \Drupal::service('extension.list.module')->getPath($block_generation_module) . '/templates/' . $template_name . '.html.twig';
               // If file exists then make registry changes.
               if (file_exists($file_path)) {
                 // Add possible preprocesses, template with template path.
                 $block_generation_theme_registry['field__block_generation__' . $fieldName] = [
-                  'path' => drupal_get_path('module', $block_generation_module) . '/templates',
+                  'path' => \Drupal::service('extension.list.module')->getPath($block_generation_module) . '/templates',
                   'preprocess functions' => [
                     'template_preprocess',
                     'template_preprocess_field',
@@ -196,19 +196,19 @@ function block_generation_theme_registry_alter(&$theme_registry) {
                   ],
                   'render element' => 'element',
                   'template' => $template_name,
-                  'theme path' => drupal_get_path('module', $block_generation_module),
+                  'theme path' => \Drupal::service('extension.list.module')->getPath($block_generation_module),
                   'type' => 'module',
                 ];
               }
 
               // Possible file path of the template name containing the field name.
               $template_name = 'field--block-generation--' . strtr($bundle, '_', '-') . '--' . strtr($fieldName, '_', '-');
-              $file_path = $app_root . '/' . drupal_get_path('module', $block_generation_module) . '/templates/' . $template_name . '.html.twig';
+              $file_path = $app_root . '/' . \Drupal::service('extension.list.module')->getPath($block_generation_module) . '/templates/' . $template_name . '.html.twig';
               // If file exists then make registry changes.
               if (file_exists($file_path)) {
                 // Add possible preprocesses, template with template path.
                 $block_generation_theme_registry['field__block_generation__' . $bundle . '__' . $fieldName] = [
-                  'path' => drupal_get_path('module', $block_generation_module) . '/templates',
+                  'path' => \Drupal::service('extension.list.module')->getPath($block_generation_module) . '/templates',
                   'preprocess functions' => [
                     'template_preprocess',
                     'template_preprocess_field',
@@ -218,7 +218,7 @@ function block_generation_theme_registry_alter(&$theme_registry) {
                   ],
                   'render element' => 'element',
                   'template' => $template_name,
-                  'theme path' => drupal_get_path('module', $block_generation_module),
+                  'theme path' => \Drupal::service('extension.list.module')->getPath($block_generation_module),
                   'type' => 'module',
                 ];
               }
diff --git a/src/Plugin/BlockGenerationEffect/BackgroundImage.php b/src/Plugin/BlockGenerationEffect/BackgroundImage.php
index d14c70d..ea120ce 100644
--- a/src/Plugin/BlockGenerationEffect/BackgroundImage.php
+++ b/src/Plugin/BlockGenerationEffect/BackgroundImage.php
@@ -136,7 +136,7 @@ class BackgroundImage extends BlockGenerationEffectBase {
 
     // Apply effect.
     if ($file = \Drupal::service('entity_type.manager')->getStorage('file')->load($this->configuration['fid'])) {
-      $file_url = file_url_transform_relative(file_create_url($file->getFileUri()));
+      $file_url = \Drupal::service('file_url_generator')->generateString($file->getFileUri());
 
       // Background image.
       if ($file_url) {
diff --git a/src/Plugin/BlockGenerationEffect/BackgroundMedia.php b/src/Plugin/BlockGenerationEffect/BackgroundMedia.php
index 2511404..845c722 100644
--- a/src/Plugin/BlockGenerationEffect/BackgroundMedia.php
+++ b/src/Plugin/BlockGenerationEffect/BackgroundMedia.php
@@ -140,7 +140,7 @@ class BackgroundMedia extends BlockGenerationEffectBase {
         $file_url = $image_style->buildUrl($file_uri);
       }
       else {
-        $file_url = file_url_transform_relative(file_create_url($file_uri));
+        $file_url = \Drupal::service('file_url_generator')->generateString($file_uri);
       }
 
       // Background image.
