modules/contrib/differential_serve/differential_serve.module
modules/contrib/differential_serve/src/Asset/DifferentialServeJsCollectionRenderer.php
modules/contrib/differential_serve/src/JsGroups.php
modules/contrib/differential_serve/tests/src/Kernel/AssetMangleTest.php

2 files with changes
====================

1) modules/contrib/differential_serve/tests/src/Kernel/AssetMangleTest.php:55

    ---------- begin diff ----------
@@ @@

     $script = reset($elements);
     $this->assertTrue(isset($script->attributes()['nomodule']), 'Has "nomodule" attribute set.');
-    $this->assertRegExp('`window\._ESM||window\._dsLoad\(".+differential_serve_test/js/asset.legacy.js\b[^"]*"\)`', (string) $script, 'Script loaded inline.');
+    $this->assertMatchesRegularExpression('`window\._ESM||window\._dsLoad\(".+differential_serve_test/js/asset.legacy.js\b[^"]*"\)`', (string) $script, 'Script loaded inline.');

     $elements = $this->cssSelect('body > script[src*="differential_serve/js/loader.js?"]');
     $this->assertCount(1, $elements, 'Legacy loader script loaded.');
    ----------- end diff -----------

Applied rules:
 * ExceptionAnnotationRector
 * RemoveDataProviderTestPrefixRector
 * ArgumentRemoverRector
 * RenameAnnotationRector
 * PseudoNamespaceToNamespaceRector
 * RenameMethodRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


2) modules/contrib/differential_serve/src/Asset/DifferentialServeJsCollectionRenderer.php:11

    ---------- begin diff ----------
@@ @@
   /**
    * The JS asset collection renderer service.
    *
-   * @var \Drupal\Core\Asset\AssetCollectionRendererInterface
+   * @var AssetCollectionRendererInterface
    */
   protected $inner;

@@ @@
   /**
    * Constructs a DifferentialServeJsCollectionRenderer object.
    *
-   * @param \Drupal\Core\Asset\AssetCollectionRendererInterface $js_collection_renderer
+   * @param AssetCollectionRendererInterface $js_collection_renderer
    *   The JS asset collection renderer service.
    */
   public function __construct(AssetCollectionRendererInterface $js_collection_renderer) {
@@ @@
     $elements = $this->inner->render($js_assets);

     foreach (array_filter($js_assets, [get_class($this), 'isDifferentiallyServed']) as $js_asset) {
-      $src = file_url_transform_relative(file_create_url($js_asset['data']));
+      $src = \Drupal::service('file_url_generator')->generateString($js_asset['data']);

       foreach ($elements as $key => $element) {
         if (isset($element['#attributes']['src']) && strpos($element['#attributes']['src'], $src) === 0) {
    ----------- end diff -----------

Applied rules:
 * FileUrlTransformRelativeRector
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector


 [OK] 2 files have been changed by Rector                                       

