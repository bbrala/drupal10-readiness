diff --git a/src/Asset/CssCollectionRenderer.php b/src/Asset/CssCollectionRenderer.php
index fe2e674..e28703c 100644
--- a/src/Asset/CssCollectionRenderer.php
+++ b/src/Asset/CssCollectionRenderer.php
@@ -57,23 +57,23 @@ class CssCollectionRenderer implements AssetCollectionRendererInterface {
   /**
    * The state key/value store.
    *
-   * @var \Drupal\Core\State\StateInterface
+   * @var StateInterface
    */
   protected $state;
 
   /**
    * The decorated CssCollectionRenderer.
    *
-   * @var \Drupal\Core\Asset\AssetCollectionRendererInterface
+   * @var AssetCollectionRendererInterface
    */
   protected $originalCssCollectionRenderer;
 
   /**
    * Constructs a CssCollectionRenderer.
    *
-   * @param \Drupal\Core\State\StateInterface $state
+   * @param StateInterface $state
    *   The state key/value store.
-   * @param \Drupal\Core\Asset\AssetCollectionRendererInterface $cssCollectionRenderer
+   * @param AssetCollectionRendererInterface $cssCollectionRenderer
    *   The decorated CssCollectionRenderer.
    */
   public function __construct(StateInterface $state, AssetCollectionRendererInterface $cssCollectionRenderer) {
@@ -141,7 +141,7 @@ class CssCollectionRenderer implements AssetCollectionRendererInterface {
           // LINK tag.
           if (!$css_asset['preprocess']) {
             $element = $link_element_defaults;
-            $element['#attributes']['href'] = file_url_transform_relative(file_create_url($css_asset['data'])) . $query_string_separator . $query_string;
+            $element['#attributes']['href'] = \Drupal::service('file_url_generator')->generateString($css_asset['data']) . $query_string_separator . $query_string;
             $element['#attributes']['media'] = $css_asset['media'];
             $element['#browsers'] = $css_asset['browsers'];
             $elements[] = $element;
@@ -161,7 +161,7 @@ class CssCollectionRenderer implements AssetCollectionRendererInterface {
               // control browser-caching. IE7 does not support a media type on
               // the @import statement, so we instead specify the media for
               // the group on the STYLE tag.
-              $import[] = '@import url("' . Html::escape(file_url_transform_relative(file_create_url($next_css_asset['data'])) . '?' . $query_string) . '");';
+              $import[] = '@import url("' . Html::escape(\Drupal::service('file_url_generator')->generateString($next_css_asset['data']) . '?' . $query_string) . '");';
               // Move the outer for loop skip the next item, since we
               // processed it here.
               $i = $j;
diff --git a/src/EventSubscriber/CspSubscriber.php b/src/EventSubscriber/CspSubscriber.php
index 8a1a0b9..c8aa6f9 100644
--- a/src/EventSubscriber/CspSubscriber.php
+++ b/src/EventSubscriber/CspSubscriber.php
@@ -17,14 +17,14 @@ class CspSubscriber implements EventSubscriberInterface {
   /**
    * The Config Factory Service.
    *
-   * @var \Drupal\Core\Config\ConfigFactoryInterface
+   * @var ConfigFactoryInterface
    */
   private $configFactory;
 
   /**
    * The State service.
    *
-   * @var \Drupal\Core\State\StateInterface
+   * @var StateInterface
    */
   private $state;
 
@@ -43,9 +43,9 @@ class CspSubscriber implements EventSubscriberInterface {
   /**
    * Ie9CspSubscriber constructor.
    *
-   * @param \Drupal\Core\Config\ConfigFactoryInterface $configFactory
+   * @param ConfigFactoryInterface $configFactory
    *   The Config Factory service.
-   * @param \Drupal\Core\State\StateInterface $state
+   * @param StateInterface $state
    *   The State service.
    */
   public function __construct(ConfigFactoryInterface $configFactory, StateInterface $state) {
diff --git a/tests/src/Unit/EventSubscriber/CspSubscriberTest.php b/tests/src/Unit/EventSubscriber/CspSubscriberTest.php
index 8588bc0..ef339c5 100644
--- a/tests/src/Unit/EventSubscriber/CspSubscriberTest.php
+++ b/tests/src/Unit/EventSubscriber/CspSubscriberTest.php
@@ -2,6 +2,8 @@
 
 namespace Drupal\Tests\ie9\Unit\EventSubscriber;
 
+use PHPUnit\Framework\MockObject\MockObject;
+use Drupal\Core\Config\ConfigFactoryInterface;
 use Drupal\Core\Render\HtmlResponse;
 use Drupal\Core\State\StateInterface;
 use Drupal\csp\Csp;
@@ -22,33 +24,30 @@ class CspSubscriberTest extends UnitTestCase {
   /**
    * The State service.
    *
-   * @var \Drupal\Core\State\StateInterface|\PHPUnit\Framework\MockObject\MockObject
+   * @var StateInterface|MockObject
    */
   private $state;
 
   /**
    * The response object.
    *
-   * @var \Drupal\Core\Render\HtmlResponse|\PHPUnit\Framework\MockObject\MockObject
+   * @var HtmlResponse|MockObject
    */
   private $response;
 
   /**
    * {@inheritdoc}
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
 
     if (!class_exists(Csp::class)) {
       $this->markTestSkipped('Content Security Policy module is not available.');
     }
 
-    $this->state = $this->getMockBuilder(StateInterface::class)
-      ->getMock();
+    $this->state = $this->createMock(StateInterface::class);
 
-    $this->response = $this->getMockBuilder(HtmlResponse::class)
-      ->disableOriginalConstructor()
-      ->getMock();
+    $this->response = $this->createMock(HtmlResponse::class);
   }
 
   /**
@@ -66,7 +65,7 @@ class CspSubscriberTest extends UnitTestCase {
    * @covers ::onCspPolicyAlter
    */
   public function testNoDirectives() {
-    /** @var \Drupal\Core\Config\ConfigFactoryInterface|\PHPUnit_Framework_MockObject_MockObject $configFactory */
+    /** @var ConfigFactoryInterface|MockObject $configFactory */
     $configFactory = $this->getConfigFactoryStub([
       'system.performance' => [
         'css.preprocess' => FALSE,
@@ -96,7 +95,7 @@ class CspSubscriberTest extends UnitTestCase {
    * @covers ::onCspPolicyAlter
    */
   public function testStyleNotNeeded() {
-    /** @var \Drupal\Core\Config\ConfigFactoryInterface|\PHPUnit_Framework_MockObject_MockObject $configFactory */
+    /** @var ConfigFactoryInterface|MockObject $configFactory */
     $configFactory = $this->getConfigFactoryStub([
       'system.performance' => [
         'css.preprocess' => TRUE,
@@ -140,7 +139,7 @@ class CspSubscriberTest extends UnitTestCase {
    * @covers ::onCspPolicyAlter
    */
   public function testStyleNoPreprocess() {
-    /** @var \Drupal\Core\Config\ConfigFactoryInterface|\PHPUnit_Framework_MockObject_MockObject $configFactory */
+    /** @var ConfigFactoryInterface|MockObject $configFactory */
     $configFactory = $this->getConfigFactoryStub([
       'system.performance' => [
         'css.preprocess' => FALSE,
@@ -184,7 +183,7 @@ class CspSubscriberTest extends UnitTestCase {
    * @covers ::onCspPolicyAlter
    */
   public function testStyleMaintenance() {
-    /** @var \Drupal\Core\Config\ConfigFactoryInterface|\PHPUnit_Framework_MockObject_MockObject $configFactory */
+    /** @var ConfigFactoryInterface|MockObject $configFactory */
     $configFactory = $this->getConfigFactoryStub([
       'system.performance' => [
         'css.preprocess' => TRUE,
@@ -228,7 +227,7 @@ class CspSubscriberTest extends UnitTestCase {
    * @covers ::onCspPolicyAlter
    */
   public function testStyleElemFallback() {
-    /** @var \Drupal\Core\Config\ConfigFactoryInterface|\PHPUnit_Framework_MockObject_MockObject $configFactory */
+    /** @var ConfigFactoryInterface|MockObject $configFactory */
     $configFactory = $this->getConfigFactoryStub([
       'system.performance' => [
         'css.preprocess' => FALSE,
@@ -263,7 +262,7 @@ class CspSubscriberTest extends UnitTestCase {
    * @covers ::onCspPolicyAlter
    */
   public function testStyleDefaultFallback() {
-    /** @var \Drupal\Core\Config\ConfigFactoryInterface|\PHPUnit_Framework_MockObject_MockObject $configFactory */
+    /** @var ConfigFactoryInterface|MockObject $configFactory */
     $configFactory = $this->getConfigFactoryStub([
       'system.performance' => [
         'css.preprocess' => FALSE,
