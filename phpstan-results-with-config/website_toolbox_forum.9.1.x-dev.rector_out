modules/contrib/website_toolbox_forum/src/Form/WebsitetoolboxSync.php
modules/contrib/website_toolbox_forum/website_toolbox_forum.api.inc
modules/contrib/website_toolbox_forum/website_toolbox_forum.install
modules/contrib/website_toolbox_forum/website_toolbox_forum.module

1 file with changes
===================

1) modules/contrib/website_toolbox_forum/website_toolbox_forum.module:0

    ---------- begin diff ----------
@@ @@
 <?php    
+use Drupal\Core\Entity\EntityInterface;
+use Drupal\user\Entity\User;
+use function Drupal\website_toolbox_forum\getForumAuthtoken;
+use function Drupal\website_toolbox_forum\setCookieOnLogin;
+use function Drupal\website_toolbox_forum\saveAuthToken;
+use function Drupal\website_toolbox_forum\getUserid;
+use function Drupal\website_toolbox_forum\sendApiRequest;
+use function Drupal\website_toolbox_forum\unsetLoginSession;
+use function Drupal\website_toolbox_forum\resetCookieOnLogout;
 use Drupal\Core\Routing\RouteMatchInterface;
 \Drupal::moduleHandler()->loadInclude('website_toolbox_forum', 'api.inc');  
 function website_toolbox_forum_help($route_name, RouteMatchInterface $route_match) {
@@ @@
       'mail' => $email,
       'externalUserid' => $userId
   );   
-  $getAuthDetails = Drupal\website_toolbox_forum\getForumAuthtoken($userData, "login");
-  Drupal\website_toolbox_forum\setCookieOnLogin($getAuthDetails, "");
-  Drupal\website_toolbox_forum\saveAuthToken($getAuthDetails['authtoken'], $getAuthDetails['forumUserid']);
+  $getAuthDetails = getForumAuthtoken($userData, "login");
+  setCookieOnLogin($getAuthDetails, "");
+  saveAuthToken($getAuthDetails['authtoken'], $getAuthDetails['forumUserid']);
   drupal_static_reset();
   drupal_flush_all_caches();
 }
@@ @@
             $redirec_url = removeParam($redirec_url,"authtoken");
             $redirec_url = removeParam($redirec_url,"wtlogin");
             $redirec_url = urldecode($redirec_url);
-            
+
             //Setting redirection URL based on frontend or backend logout
             //$word defined to look for string wp-admin in redirect_url 
             $word="wp-admin";
@@ @@
         }
     }*/
 }
-function website_toolbox_forum_user_insert(Drupal\Core\Entity\EntityInterface $entity){
+function website_toolbox_forum_user_insert(EntityInterface $entity){
     $username = $_POST['name'];
     $email    = $_POST['mail'];
     $pass     = $_POST['pass'];
@@ @@
         'pass' => $pass,
         'externalUserid' => $userId
     );        
-    $user = \Drupal\user\Entity\User::load($entity->id());
+    $user = User::load($entity->id());
     if(!$user->user_picture->isEmpty()){
-      $avatarUrl = file_create_url($user->user_picture->entity->getFileUri());
+      $avatarUrl = \Drupal::service('file_url_generator')->generateAbsoluteString($user->user_picture->entity->getFileUri());
     }
     $forumsApiKey = \Drupal::config('node.settings')->get('forum_api_key') ;
     $forumUrl     = \Drupal::config('node.settings')->get('forum_url'); 
@@ @@
     $URL          = $forumUrl . "/register/create_account/";
     $request = \Drupal::httpClient()->post($URL, ['verify' => true,'form_params' => ['apikey' => $forumsApiKey,'member' => $username,'email' => $email,'externalUserid' => $userId,"avatarUrl" => $avatarUrl,]])->getBody()->getContents();      
     if (!$request) {
-        drupal_set_message($result->error);
+        \Drupal::messenger()->addStatus($result->error);
         die();
     }
     /*$getAuthDetails = Drupal\website_toolbox_forum\getForumAuthtoken($userData, "register");
@@ @@
     drupal_static_reset();
     drupal_flush_all_caches();      
 }
-function website_toolbox_forum_user_presave( Drupal\Core\Entity\EntityInterface $entity){
+function website_toolbox_forum_user_presave( EntityInterface $entity){
     if($entity->original){
-        $user = \Drupal\user\Entity\User::load($entity->id());
+        $user = User::load($entity->id());
         $_SESSION['oldUserEmail'] = $user->getEmail();
     }
 }
-function website_toolbox_forum_user_update(Drupal\Core\Entity\EntityInterface $entity){
+function website_toolbox_forum_user_update(EntityInterface $entity){
   $emailToVerify  = $_SESSION['oldUserEmail'];
-  $userId     = Drupal\website_toolbox_forum\getUserid($emailToVerify);
+  $userId     = getUserid($emailToVerify);
   $userName = $entity->getAccountName();
   $externalUserid = $entity->id();
-  $user = \Drupal\user\Entity\User::load($entity->id());
+  $user = User::load($entity->id());
   if(!$user->user_picture->isEmpty()){
-    $avatarUrl = file_create_url($user->user_picture->entity->getFileUri());
+    $avatarUrl = \Drupal::service('file_url_generator')->generateAbsoluteString($user->user_picture->entity->getFileUri());
   }
   $email = $entity->getEmail();
   $userDetails = array("email" => $email,
@@ @@
           "externalUserid" => $externalUserid,
           "name" => $userName);
           $url =  "/users/$userId";
-   Drupal\website_toolbox_forum\sendApiRequest('POST',$url,$userDetails); 
+   sendApiRequest('POST',$url,$userDetails); 
 }
-function website_toolbox_forum_user_delete( Drupal\Core\Entity\EntityInterface $entity){
+function website_toolbox_forum_user_delete( EntityInterface $entity){
     $username     = $entity->getAccountName();
     $forumsApiKey = \Drupal::config('node.settings')->get('forum_api_key'); ;
     $forumUrl     = \Drupal::config('node.settings')->get('forum_url'); 
@@ @@
         $logoutAuthUrl = $forumUrl . "/register/logout?authtoken=" . $_COOKIE['forumLogoutToken'];
         $logoutAuthUrl = preg_replace('#^https?:#i', '', $logoutAuthUrl);
         $page_bottom['contentImg'] = ['#markup' => '<img src="' . $logoutAuthUrl . '" border="0" width="0" height="0" alt="">'];
-        Drupal\website_toolbox_forum\unsetLoginSession();
-        Drupal\website_toolbox_forum\resetCookieOnLogout();
+        unsetLoginSession();
+        resetCookieOnLogout();
     }  
     if ($userId != 0 && (isset($_COOKIE['forumLogoutToken']) || isset($_SESSION['forumLoginAuthToken']))) { 
         $loginAuthUrl = $forumUrl . "/register/dologin?authtoken=" . $_COOKIE['forumLogoutToken'];
@@ @@
         'mail' => $email,
         'externalUserid' => $userId
     );   
-    $getAuthDetails = Drupal\website_toolbox_forum\getForumAuthtoken($userData, "login");
-    Drupal\website_toolbox_forum\setCookieOnLogin($getAuthDetails, "");
-    Drupal\website_toolbox_forum\saveAuthToken($getAuthDetails['authtoken'], $getAuthDetails['forumUserid']);
+    $getAuthDetails = getForumAuthtoken($userData, "login");
+    setCookieOnLogin($getAuthDetails, "");
+    saveAuthToken($getAuthDetails['authtoken'], $getAuthDetails['forumUserid']);
 }
-?>
+?>
    ----------- end diff -----------

Applied rules:
 * DrupalSetMessageRector
 * FileCreateUrlRector
 * ArgumentRemoverRector


 [OK] 1 file has been changed by Rector                                         

