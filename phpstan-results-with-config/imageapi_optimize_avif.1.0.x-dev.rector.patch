diff --git a/modules/imageapi_optimize_avif_responsive/imageapi_optimize_avif_responsive.module b/modules/imageapi_optimize_avif_responsive/imageapi_optimize_avif_responsive.module
index 0d14d65..1cda2cf 100644
--- a/modules/imageapi_optimize_avif_responsive/imageapi_optimize_avif_responsive.module
+++ b/modules/imageapi_optimize_avif_responsive/imageapi_optimize_avif_responsive.module
@@ -49,8 +49,8 @@ function imageapi_optimize_avif_responsive_preprocess_responsive_image(&$variabl
         // If AVIF processor exits on pipeline, build another map for jpg => avif paths.
         if ($pipeline_avif_map[$image_style->getPipeline()]) {
           $image_uri = $image_style->buildUri($variables['uri']);
-          $image_url = file_create_url($image_uri);
-          $image_relative_path = file_url_transform_relative($image_url);
+          $image_url = \Drupal::service('file_url_generator')->generateAbsoluteString($image_uri);
+          $image_relative_path = \Drupal::service('file_url_generator')->transformRelative($image_url);
 
           $image_relative_path_file = explode('?', $image_relative_path)[0];
           $avif_relative_path = str_replace($image_relative_path_file,
diff --git a/src/Entity/ImageAPIOptimizeAvifPipeline.php b/src/Entity/ImageAPIOptimizeAvifPipeline.php
index d4a95e9..39974ae 100644
--- a/src/Entity/ImageAPIOptimizeAvifPipeline.php
+++ b/src/Entity/ImageAPIOptimizeAvifPipeline.php
@@ -15,7 +15,7 @@ use Drupal\Core\File\FileSystemInterface;
  *
  * @package Drupal\imageapi_optimize_avif\Entity
  *
- * @param \Drupal\Core\File\FileSystemInterface $filesystem
+ * @param FileSystemInterface $filesystem
  */
 class ImageAPIOptimizeAvifPipeline extends ImageAPIOptimizePipeline {
 
