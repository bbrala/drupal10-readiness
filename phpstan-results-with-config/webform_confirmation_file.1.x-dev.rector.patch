diff --git a/src/Plugin/WebformHandler/ConfirmationFileWebformHandler.php b/src/Plugin/WebformHandler/ConfirmationFileWebformHandler.php
index 933c796..480d75a 100644
--- a/src/Plugin/WebformHandler/ConfirmationFileWebformHandler.php
+++ b/src/Plugin/WebformHandler/ConfirmationFileWebformHandler.php
@@ -2,6 +2,8 @@
 
 namespace Drupal\webform_confirmation_file\Plugin\WebformHandler;
 
+use Symfony\Component\Mime\MimeTypesInterface;
+use Drupal\webform\WebformTokenManagerInterface;
 use Drupal\Component\Utility\UrlHelper;
 use Drupal\Core\Form\FormStateInterface;
 use Drupal\webform\Plugin\WebformHandlerBase;
@@ -27,14 +29,14 @@ class ConfirmationFileWebformHandler extends WebformHandlerBase {
   /**
    * The MIME type guesser.
    *
-   * @var \Symfony\Component\HttpFoundation\File\MimeType\MimeTypeGuesserInterface
+   * @var MimeTypesInterface
    */
   protected $mimeTypeGuesser;
 
   /**
    * The token manager.
    *
-   * @var \Drupal\webform\WebformTokenManagerInterface
+   * @var WebformTokenManagerInterface
    */
   protected $tokenManager;
 
@@ -202,7 +204,7 @@ class ConfirmationFileWebformHandler extends WebformHandlerBase {
     else {
       try {
         $url = $this->configuration['url'];
-        $url = file_create_url($url) ?: $url;
+        $url = \Drupal::service('file_url_generator')->generateAbsoluteString($url) ?: $url;
         if (strpos($url, '/') === 0) {
           $url = \Drupal::request()->getSchemeAndHttpHost() . $url;
         }
diff --git a/tests/src/Functional/WebformConfirmationFileTest.php b/tests/src/Functional/WebformConfirmationFileTest.php
index ac1fd99..9f0692d 100644
--- a/tests/src/Functional/WebformConfirmationFileTest.php
+++ b/tests/src/Functional/WebformConfirmationFileTest.php
@@ -27,12 +27,14 @@ class WebformConfirmationFileTest extends BrowserTestBase {
    * Test confirmation file handler.
    */
   public function testConfirmationFileHandler() {
+    $this->drupalGet('/webform/test_confirmation_file_content');
     // Check content source.
-    $this->drupalPostForm('/webform/test_confirmation_file_content', [], t('Submit'));
+    $this->submitForm([], t('Submit'));
     $this->assertSession()->responseContains('<?xml version="1.0"?>');
+    $this->drupalGet('/webform/test_confirmation_file_url');
 
     // Check URI source.
-    $this->drupalPostForm('/webform/test_confirmation_file_url', [], t('Submit'));
+    $this->submitForm([], t('Submit'));
     $this->assertSession()->responseContains('<?xml version="1.0"?>');
 
   }
