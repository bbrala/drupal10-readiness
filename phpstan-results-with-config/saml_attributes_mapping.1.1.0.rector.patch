diff --git a/saml_attributes_mapping.module b/saml_attributes_mapping.module
index 19ded12..3af2488 100644
--- a/saml_attributes_mapping.module
+++ b/saml_attributes_mapping.module
@@ -30,12 +30,12 @@ function saml_attributes_mapping_help($route_name) {
  * after a user logged in through SimpleSAMLphp. This can be used to add
  * map additional SAML attributes to Drupal user profile fields.
  *
- * @param \Drupal\user\UserInterface $account
+ * @param UserInterface $account
  *   The Drupal account that can be altered.
  * @param array $attributes
  *   The SimpleSAMLphp attributes for this user.
  *
- * @return \Drupal\user\UserInterface|bool
+ * @return UserInterface|bool
  *   The altered Drupal account or FALSE if nothing was changed.
  */
 function saml_attributes_mapping_simplesamlphp_auth_user_attributes(UserInterface $account, array $attributes) {
@@ -127,7 +127,7 @@ function saml_attributes_mapping_simplesamlphp_auth_user_attributes(UserInterfac
 
             try {
               $data = (string) \Drupal::httpClient()->get($url)->getBody();
-              $user_image = file_save_data($data, $uri, FILE_EXISTS_REPLACE);
+              $user_image = \Drupal::service('file.repository')->writeData($data, $uri, FileSystemInterface::EXISTS_REPLACE);
               if ($user_image && $user_image->id()) {
                 $filed_values = [
                   'target_id' => $user_image->id(),
diff --git a/src/Controller/SamlAttributesMappingController.php b/src/Controller/SamlAttributesMappingController.php
index f0d8925..4fafe84 100644
--- a/src/Controller/SamlAttributesMappingController.php
+++ b/src/Controller/SamlAttributesMappingController.php
@@ -15,7 +15,7 @@ class SamlAttributesMappingController extends ControllerBase {
   /**
    * Used to get field names for user entity.
    *
-   * @var \Drupal\Core\Entity\EntityFieldManagerInterface
+   * @var EntityFieldManagerInterface
    */
   protected $entityFieldManager;
 
diff --git a/src/Form/AttributesMappingForm.php b/src/Form/AttributesMappingForm.php
index 4eaa301..ab28dff 100644
--- a/src/Form/AttributesMappingForm.php
+++ b/src/Form/AttributesMappingForm.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\saml_attributes_mapping\Form;
 
+use Drupal\Component\Render\FormattableMarkup;
 use Drupal\Core\Form\ConfigFormBase;
 use Drupal\Core\Form\FormStateInterface;
 use Drupal\Core\Url;
@@ -89,7 +90,7 @@ class AttributesMappingForm extends ConfigFormBase {
       if (count($attributes) === 1) {
         $add_item = Url::fromRoute('saml_attributes_mapping.settings_attributes');
         $message = $this->t('There are no SAML attributes configured yet.');
-        $form['mapping']['#empty'] = SafeMarkup::format($message . ' ' . $this->l($this->t('Add an item'), $add_item), []);
+        $form['mapping']['#empty'] = new FormattableMarkup($message . ' ' . $this->l($this->t('Add an item'), $add_item), []);
         unset($form['actions']);
       }
       else {
