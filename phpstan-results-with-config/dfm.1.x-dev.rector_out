modules/contrib/dfm/dfm.api.php
modules/contrib/dfm/dfm.install
modules/contrib/dfm/dfm.module
modules/contrib/dfm/src/Controller/DfmController.php
modules/contrib/dfm/src/Dfm.php
modules/contrib/dfm/src/DfmDrupal.php
modules/contrib/dfm/src/DfmFileField.php
modules/contrib/dfm/src/DfmProfileListBuilder.php
modules/contrib/dfm/src/Entity/DfmProfile.php
modules/contrib/dfm/src/EventSubscriber/DfmSubscriber.php
modules/contrib/dfm/src/Form/DfmProfileDeleteForm.php
modules/contrib/dfm/src/Form/DfmProfileForm.php
modules/contrib/dfm/src/Form/DfmSettingsForm.php
modules/contrib/dfm/src/Plugin/BUEditorPlugin/DfmBUEditor.php
modules/contrib/dfm/src/Plugin/CKEditorPlugin/DfmCKEditor.php
modules/contrib/dfm/src/Plugin/CKEditorPlugin/DfmCKEditorClassicImage.php
modules/contrib/dfm/src/Plugin/CKEditorPlugin/DfmCKEditorClassicLink.php

7 files with changes
====================

1) modules/contrib/dfm/src/Plugin/CKEditorPlugin/DfmCKEditorClassicLink.php:18

    ---------- begin diff ----------
@@ @@
    * {@inheritdoc}
    */
   public function getFile() {
-    return drupal_get_path('module', 'dfm') . '/js/dfm.ckeditor.classic_link.js';
+    return \Drupal::service('extension.list.module')->getPath('dfm') . '/js/dfm.ckeditor.classic_link.js';
   }

   /**
    ----------- end diff -----------

Applied rules:
 * DrupalGetPathRector
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


2) modules/contrib/dfm/src/Plugin/CKEditorPlugin/DfmCKEditorClassicImage.php:18

    ---------- begin diff ----------
@@ @@
    * {@inheritdoc}
    */
   public function getFile() {
-    return drupal_get_path('module', 'dfm') . '/js/dfm.ckeditor.classic_image.js';
+    return \Drupal::service('extension.list.module')->getPath('dfm') . '/js/dfm.ckeditor.classic_image.js';
   }

   /**
    ----------- end diff -----------

Applied rules:
 * DrupalGetPathRector
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


3) modules/contrib/dfm/src/Plugin/CKEditorPlugin/DfmCKEditor.php:18

    ---------- begin diff ----------
@@ @@
    * {@inheritdoc}
    */
   public function getFile() {
-    return drupal_get_path('module', 'dfm') . '/js/dfm.ckeditor.js';
+    return \Drupal::service('extension.list.module')->getPath('dfm') . '/js/dfm.ckeditor.js';
   }

   /**
@@ @@
    * {@inheritdoc}
    */
   public function getButtons() {
-    $path = drupal_get_path('module', 'dfm') . '/css/images';
+    $path = \Drupal::service('extension.list.module')->getPath('dfm') . '/css/images';
     return [
       'dfm_image' => [
         'label' => t('Insert images using Drupella File Manager'),
    ----------- end diff -----------

Applied rules:
 * DrupalGetPathRector
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


4) modules/contrib/dfm/src/EventSubscriber/DfmSubscriber.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\dfm\EventSubscriber;

+use Symfony\Component\HttpKernel\Event\RequestEvent;
 use Symfony\Component\HttpKernel\KernelEvents;
-use Symfony\Component\HttpKernel\Event\GetResponseEvent;
 use Symfony\Component\EventDispatcher\EventSubscriberInterface;
 use Drupal\dfm\Dfm;

@@ @@
   /**
    * Performs operations before the request is processed.
    */
-  public function requestInit(GetResponseEvent $event) {
+  public function requestInit(RequestEvent $event) {
     // Allow image derivatives temporarily.
     $request = $event->getRequest();
     $itok = $request->query->get('dfm_itok');
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * RenameClassRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector


5) modules/contrib/dfm/src/DfmDrupal.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\dfm;

+use Drupal\Core\Cache\Cache;
 use Drupal\Component\Utility\Html;
 use Drupal\Core\Site\Settings;
 use Drupal\Core\Database\Database;
@@ @@
     $jspath = $jsdir . '/dfm.' . $lang . '.js';
     // Translation file was created before. Just add it to page.
     if (file_exists($jspath)) {
-      if ($jsurl = file_create_url($jspath)) {
+      if ($jsurl = \Drupal::service('file_url_generator')->generateAbsoluteString($jspath)) {
         $dfm->addJs($jsurl);
       }
       return;
@@ @@
         $jspath = $jsdir . '/dfm.' . $dfm->getConf('lang') . '.js';
         if (@file_put_contents($jspath, 'dfm.extend(dfm.i18n, {' . implode(',', $lines) . '});')) {
           $fs->chmod($jspath);
-          if ($jsurl = file_create_url($jspath)) {
+          if ($jsurl = \Drupal::service('file_url_generator')->generateAbsoluteString($jspath)) {
             $dfm->addJs($jsurl);
           }
         }
@@ @@
     try {
       // Update body of nodes/blocks
       if ($dfm->getConf('fixBodyOnMove')) {
-        if ($url = file_create_url($filepath)) {
-          if ($newurl = file_create_url($newpath)) {
+        if ($url = \Drupal::service('file_url_generator')->generateAbsoluteString($filepath)) {
+          if ($newurl = \Drupal::service('file_url_generator')->generateAbsoluteString($newpath)) {
             // Fix Absolute urls
             static::fixFileMove($url, $newurl, $isdir);
             // Fix relative urls.
@@ @@
           $tags[$i] = "$type:$id";
         }
         \Drupal::cache('entity')->invalidateMultiple($cids);
-        \Drupal\Core\Cache\Cache::invalidateTags($tags);
+        Cache::invalidateTags($tags);
       }
     }
   }

 }
    ----------- end diff -----------

Applied rules:
 * FileCreateUrlRector
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector


6) modules/contrib/dfm/src/Dfm.php:127

    ---------- begin diff ----------
@@ @@
     $conf['rootDirPath'] = $conf['scheme'] . '://';
     $conf['rootDirUrl'] = preg_replace('@/(?:%2E|\.)$@i', '', file_create_url($conf['rootDirPath'] . '.'));
     if (empty($conf['absUrls'])) {
-      $conf['rootDirUrl'] = file_url_transform_relative($conf['rootDirUrl']);
+      $conf['rootDirUrl'] = \Drupal::service('file_url_generator')->transformRelative($conf['rootDirUrl']);
     }
     $conf['scriptDirPath'] = static::scriptPath();
     $conf['baseUrl'] = base_path();
@@ @@
   public static function scriptPath($subpath = NULL) {
     static $libpath;
     if (!isset($libpath)) {
-      $libpath = drupal_get_path('module', 'dfm') . '/library';
+      $libpath = \Drupal::service('extension.list.module')->getPath('dfm') . '/library';
       if (!file_exists($libpath)) {
         $libpath = DrupalKernel::findSitePath(\Drupal::request()) . '/libraries/dfm_lite';
         if (!file_exists($libpath)) {
    ----------- end diff -----------

Applied rules:
 * DrupalGetPathRector
 * FileUrlTransformRelativeRector
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector


7) modules/contrib/dfm/dfm.api.php:28

    ---------- begin diff ----------
@@ @@
  *
  * @param array $conf
  *   An array of configuration parameters including enabled folders.
- * @param \Drupal\Core\Session\AccountProxyInterface $user
+ * @param AccountProxyInterface $user
  *   Drupal user(usually the logged in user) who will use the configuration.
  */
 function hook_dfm_conf_alter(array &$conf, AccountProxyInterface $user) {
@@ @@
  */
 function hook_preprocess_dfm_page(array &$page) {
   // Define always included js/css
-  $path = base_path() . drupal_get_path('module', 'my');
+  $path = base_path() . \Drupal::service('extension.list.module')->getPath('my');
   $query_string = $page['qs'];
   $page['jsUrls']['my_js'] = $path . '/js/my.dfm.js' . $query_string;
   $page['cssUrls']['my_css'] = $path . '/css/my.dfm.css' . $query_string;
    ----------- end diff -----------

Applied rules:
 * DrupalGetPathRector
 * ArgumentRemoverRector


 [ERROR] Could not process                                                      
         "modules/contrib/dfm/src/Plugin/BUEditorPlugin/DfmBUEditor.php" file, due
         to:                                                                    
         "Analyze error: "Class Drupal\bueditor\BUEditorPluginBase not found.". 
         Include your files in "$rectorConfig->autoloadPaths([...]);" or        
         "$rectorConfig->bootstrapFiles([...]);" in "rector.php" config.        
         See https://github.com/rectorphp/rector#configuration".                

