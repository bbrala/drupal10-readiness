diff --git a/image_resize_filter.module b/image_resize_filter.module
index 27bbc26..65bf5f2 100644
--- a/image_resize_filter.module
+++ b/image_resize_filter.module
@@ -1,5 +1,6 @@
 <?php
 
+use Drupal\Core\StreamWrapper\StreamWrapperManager;
 /**
  * @file
  * Contains image_resize_filter.module.
@@ -134,7 +135,7 @@ function image_resize_filter_get_images(array $settings, $text) {
       $lang_codes = '';
 
       // Convert to a public file system URI.
-      /** @var \Drupal\Core\StreamWrapper\StreamWrapperManager $stream_wrapper_manager **/
+      /** @var StreamWrapperManager $stream_wrapper_manager **/
       $stream_wrapper_manager = \Drupal::service('stream_wrapper_manager');
       $public_wrapper = $stream_wrapper_manager->getViaScheme('public');
       $directory_path = $public_wrapper->getDirectoryPath() . '/';
@@ -320,7 +321,7 @@ function image_resize_filter_pathinfo($uri) {
  *   Settings for the input filter.
  */
 function image_resize_filter_image_tag($image = NULL, $settings = NULL) {
-  $src = file_create_url($image['destination']);
+  $src = \Drupal::service('file_url_generator')->generateAbsoluteString($image['destination']);
 
   // Strip the http:// from the path if the original did not include it.
   if (!preg_match('/^http[s]?:\/\/' . preg_quote($_SERVER['HTTP_HOST']) . '/', $image['original'])) {
diff --git a/src/Plugin/Filter/FilterImageResize.php b/src/Plugin/Filter/FilterImageResize.php
index a3d28cc..b2ddf13 100644
--- a/src/Plugin/Filter/FilterImageResize.php
+++ b/src/Plugin/Filter/FilterImageResize.php
@@ -2,6 +2,8 @@
 
 namespace Drupal\image_resize_filter\Plugin\Filter;
 
+use Drupal\Core\Config\ImmutableConfig;
+use Drupal\Core\Entity\EntityRepositoryInterface;
 use Drupal\Core\Config\Config;
 use Drupal\Core\File\FileSystemInterface;
 use Drupal\Core\Image\ImageFactory;
@@ -33,26 +35,26 @@ class FilterImageResize extends FilterBase implements ContainerFactoryPluginInte
   /**
    * ImageFactory instance.
    *
-   * @var \Drupal\Core\Image\ImageFactory
+   * @var ImageFactory
    */
   protected $imageFactory;
 
   /**
-   * @var \Drupal\Core\Config\ImmutableConfig
+   * @var ImmutableConfig
    */
   protected $systemFileConfig;
 
   /**
    * The stream wrapper manager.
    *
-   * @var \Drupal\Core\StreamWrapper\StreamWrapperManagerInterface
+   * @var StreamWrapperManagerInterface
    */
   protected $streamWrapperManager;
 
   /**
    * The file system.
    *
-   * @var \Drupal\Core\File\FileSystemInterface
+   * @var FileSystemInterface
    */
   protected $fileSystem;
 
@@ -61,15 +63,15 @@ class FilterImageResize extends FilterBase implements ContainerFactoryPluginInte
    * @param array $configuration
    * @param string $plugin_id
    * @param mixed $plugin_definition
-   * @param \Drupal\Core\Entity\EntityRepositoryInterface $entity_repository
+   * @param EntityRepositoryInterface $entity_repository
    *   The entity Repository.
-   * @param \Drupal\Core\Image\ImageFactory $image_factory
+   * @param ImageFactory $image_factory
    *   Image Factory.
-   * @param \Drupal\Core\Config\Config $system_file_config
+   * @param Config $system_file_config
    *   The system file configuration.
-   * @param \Drupal\Core\StreamWrapper\StreamWrapperManagerInterface $stream_wrapper_manager
+   * @param StreamWrapperManagerInterface $stream_wrapper_manager
    *   The stream wrapper manager.
-   * @param \Drupal\Core\File\FileSystemInterface $file_system
+   * @param FileSystemInterface $file_system
    *   The file system.
    */
   public function __construct(
@@ -141,7 +143,7 @@ class FilterImageResize extends FilterBase implements ContainerFactoryPluginInte
           $image['destination'] = $this->systemFileConfig->get('default_scheme') . '://' . $local_file_path;
         }
         else {
-          $image['destination'] = file_default_scheme() . '://' . $local_file_path;
+          $image['destination'] = \Drupal::config('system.file')->get('default_scheme') . '://' . $local_file_path;
         }
       }
       // Destination and local path are the same if we're just adding attributes.
@@ -155,7 +157,7 @@ class FilterImageResize extends FilterBase implements ContainerFactoryPluginInte
           $local_file_dir = $this->streamWrapperManager->getTarget($path_info['dirname']);
         }
         else {
-          $local_file_dir = file_uri_target($path_info['dirname']);
+          $local_file_dir = \Drupal::service('stream_wrapper_manager')->getTarget($path_info['dirname']);
         }
         $local_file_path = 'resize/' . ($local_file_dir ? $local_file_dir . '/' : '') . $path_info['filename'] . '-' . $image['expected_size']['width'] . 'x' . $image['expected_size']['height'] . '.' . $path_info['extension'];
         $image['destination'] = $path_info['scheme'] . '://' . $local_file_path;
