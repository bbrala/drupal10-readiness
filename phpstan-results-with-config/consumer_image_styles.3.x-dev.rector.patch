diff --git a/src/ImageStylesProvider.php b/src/ImageStylesProvider.php
index fc005c3..229eeda 100644
--- a/src/ImageStylesProvider.php
+++ b/src/ImageStylesProvider.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\consumer_image_styles;
 
+use Drupal\image\Entity\ImageStyle;
 use Drupal\Component\Plugin\Exception\PluginException;
 use Drupal\consumers\Entity\Consumer;
 use Drupal\Core\Entity\EntityInterface;
@@ -22,14 +23,14 @@ class ImageStylesProvider {
   /**
    * The entity type manager.
    *
-   * @var \Drupal\Core\Entity\EntityTypeManagerInterface
+   * @var EntityTypeManagerInterface
    */
   private $entityTypeManager;
 
   /**
    * The image factory.
    *
-   * @var \Drupal\Core\Image\ImageFactory
+   * @var ImageFactory
    */
   private $imageFactory;
 
@@ -41,10 +42,10 @@ class ImageStylesProvider {
   /**
    * Load the image styles for a given consumer.
    *
-   * @param \Drupal\consumers\Entity\Consumer $consumer
+   * @param Consumer $consumer
    *   Consumer entity to load image styles for.
    *
-   * @return \Drupal\image\Entity\ImageStyle[]
+   * @return ImageStyle[]
    *   List of image styles keyed by image style id.
    */
   public function loadStyles(Consumer $consumer) {
@@ -71,7 +72,7 @@ class ImageStylesProvider {
    *
    * @param string $uri
    *   The file URI.
-   * @param \Drupal\image\ImageStyleInterface $image_style
+   * @param ImageStyleInterface $image_style
    *   The image style to apply.
    *
    * @return array
@@ -81,7 +82,7 @@ class ImageStylesProvider {
    */
   public function buildDerivativeLink($uri, ImageStyleInterface $image_style) {
     return [
-      'href' => file_create_url($image_style->buildUrl($uri)),
+      'href' => \Drupal::service('file_url_generator')->generateAbsoluteString($image_style->buildUrl($uri)),
       'meta' => [
         'rel' => [static::DERIVATIVE_LINK_REL],
       ],
@@ -91,7 +92,7 @@ class ImageStylesProvider {
   /**
    * Checks if an entity is an image.
    *
-   * @param \Drupal\Core\Entity\EntityInterface $entity
+   * @param EntityInterface $entity
    *   The entity.
    *
    * @return bool
diff --git a/src/Normalizer/LinkCollectionNormalizer.php b/src/Normalizer/LinkCollectionNormalizer.php
index f9d4c29..54ec313 100644
--- a/src/Normalizer/LinkCollectionNormalizer.php
+++ b/src/Normalizer/LinkCollectionNormalizer.php
@@ -23,44 +23,44 @@ use Symfony\Component\Serializer\Normalizer\NormalizerInterface;
 class LinkCollectionNormalizer implements NormalizerInterface {
 
   /**
-   * @var \Drupal\consumers\Negotiator
+   * @var Negotiator
    */
   protected $consumerNegotiator;
 
   /**
-   * @var \Drupal\consumer_image_styles\ImageStylesProvider
+   * @var ImageStylesProvider
    */
   protected $imageStylesProvider;
 
   /**
-   * @var \Drupal\Core\Image\ImageFactory
+   * @var ImageFactory
    */
   protected $imageFactory;
 
   /**
-   * @var \Symfony\Component\Serializer\Normalizer\NormalizerInterface
+   * @var NormalizerInterface
    */
   protected $inner;
 
   /**
    * The request stack.
    *
-   * @var \Symfony\Component\HttpFoundation\RequestStack
+   * @var RequestStack
    */
   protected $requestStack;
 
   /**
    * Constructs a LinkCollectionNormalizer object.
    *
-   * @param \Symfony\Component\Serializer\Normalizer\NormalizerInterface $inner
+   * @param NormalizerInterface $inner
    *   The decorated service.
-   * @param \Drupal\consumers\Negotiator $consumer_negotiator
+   * @param Negotiator $consumer_negotiator
    *   The consumer negotiator.
    * @param \Drupal\consumer_image_styles\ImageStylesProvider
    *   Image styles utility.
-   * @param \Drupal\Core\Image\ImageFactory $image_factory
+   * @param ImageFactory $image_factory
    *   The image factory.
-   * @param \Symfony\Component\HttpFoundation\RequestStack $request_stack
+   * @param RequestStack $request_stack
    *   The request stack.
    */
   public function __construct(NormalizerInterface $inner, Negotiator $consumer_negotiator, ImageStylesProvider $imageStylesProvider, ImageFactory $image_factory, RequestStack $request_stack) {
@@ -92,10 +92,10 @@ class LinkCollectionNormalizer implements NormalizerInterface {
   }
 
   /**
-   * @param \Drupal\jsonapi\JsonApiResource\ResourceObject $resource_object
+   * @param ResourceObject $resource_object
    * @param \Drupal\consumers\Entity\Consumer
    *
-   * @return \Drupal\jsonapi\JsonApiResource\LinkCollection
+   * @return LinkCollection
    *   The variant links.
    */
   protected function buildVariantLinks(ResourceObject $resource_object, Consumer $consumer) {
@@ -104,7 +104,7 @@ class LinkCollectionNormalizer implements NormalizerInterface {
     // Generate derivatives only for the found ones.
     $image_styles = $this->imageStylesProvider->loadStyles($consumer);
     return array_reduce($image_styles, function (LinkCollection $decorated, ImageStyleInterface $image_style) use ($uri) {
-      $variant_link = new Link(CacheableMetadata::createFromObject($image_style), Url::fromUri(file_create_url($image_style->buildUrl($uri))), [ImageStylesProvider::DERIVATIVE_LINK_REL]);
+      $variant_link = new Link(CacheableMetadata::createFromObject($image_style), \Drupal::service('file_url_generator')->generate($image_style->buildUrl($uri)), [ImageStylesProvider::DERIVATIVE_LINK_REL]);
       return $decorated->withLink($image_style->id(), $variant_link);
     }, (new LinkCollection([]))->withContext($resource_object));
   }
@@ -112,7 +112,7 @@ class LinkCollectionNormalizer implements NormalizerInterface {
   /**
    * Whether this decorator applies to the current data.
    *
-   * @param \Drupal\jsonapi\JsonApiResource\LinkCollection $link_collection
+   * @param LinkCollection $link_collection
    *   The link collection to be normalized.
    *
    * @return bool
@@ -134,7 +134,7 @@ class LinkCollectionNormalizer implements NormalizerInterface {
   /**
    * Gets the current consumer.
    *
-   * @return \Drupal\consumers\Entity\Consumer
+   * @return Consumer
    *   The current consumer or NULL if one cannot be negotiated.
    */
   protected function getConsumer() {
@@ -149,12 +149,12 @@ class LinkCollectionNormalizer implements NormalizerInterface {
   /**
    * Adds the derivative link relation type to the normalized link collection.
    *
-   * @param \Drupal\jsonapi\Normalizer\Value\CacheableNormalization $cacheable_normalization
+   * @param CacheableNormalization $cacheable_normalization
    *   The cacheable normalization to which link relations need to be added.
-   * @param \Drupal\jsonapi\JsonApiResource\LinkCollection $link_collection
+   * @param LinkCollection $link_collection
    *   The un-normalized link collection.
    *
-   * @return \Drupal\jsonapi\Normalizer\Value\CacheableNormalization
+   * @return CacheableNormalization
    *   The links normalization with meta.rel added.
    */
   protected static function addLinkRels(CacheableNormalization $cacheable_normalization, LinkCollection $link_collection) {
diff --git a/src/Plugin/jsonapi/FieldEnhancer/ImageStyles.php b/src/Plugin/jsonapi/FieldEnhancer/ImageStyles.php
index e72a82e..5c74995 100644
--- a/src/Plugin/jsonapi/FieldEnhancer/ImageStyles.php
+++ b/src/Plugin/jsonapi/FieldEnhancer/ImageStyles.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\consumer_image_styles\Plugin\jsonapi\FieldEnhancer;
 
+use Drupal\file\Entity\File;
 use Drupal\Component\Plugin\Exception\InvalidPluginDefinitionException;
 use Drupal\consumer_image_styles\ImageStylesProvider;
 use Drupal\Core\Entity\EntityTypeManagerInterface;
@@ -26,12 +27,12 @@ use Symfony\Component\DependencyInjection\ContainerInterface;
 class ImageStyles extends ResourceFieldEnhancerBase implements ContainerFactoryPluginInterface {
 
   /**
-   * @var \Drupal\consumer_image_styles\ImageStylesProvider
+   * @var ImageStylesProvider
    */
   protected $imageStylesProvider;
 
   /**
-   * @var \Drupal\Core\Entity\EntityTypeManagerInterface
+   * @var EntityTypeManagerInterface
    */
   protected $entityTypeManager;
 
@@ -100,7 +101,7 @@ class ImageStyles extends ResourceFieldEnhancerBase implements ContainerFactoryP
     if (!$entity || !$this->imageStylesProvider->entityIsImage($entity)) {
       return $data;
     }
-    /** @var \Drupal\file\Entity\File $entity */
+    /** @var File $entity */
     // If the entity is not viewable.
     $access = $entity->access('view', NULL, TRUE);
     if (!$access->isAllowed()) {
diff --git a/tests/src/Functional/ConsumerImageSylesFunctionalTest.php b/tests/src/Functional/ConsumerImageSylesFunctionalTest.php
index 743b2e7..6492a7b 100644
--- a/tests/src/Functional/ConsumerImageSylesFunctionalTest.php
+++ b/tests/src/Functional/ConsumerImageSylesFunctionalTest.php
@@ -2,6 +2,10 @@
 
 namespace Drupal\Tests\consumer_image_styles\Functional;
 
+use Drupal\user\Entity\User;
+use Drupal\node\Entity\NodeType;
+use Drupal\node\Entity\Node;
+use Drupal\Core\Entity\EntityStorageException;
 use Drupal\Component\Serialization\Json;
 use Drupal\Component\Utility\NestedArray;
 use Drupal\consumer_image_styles\ImageStylesProvider;
@@ -36,7 +40,7 @@ class ConsumerImageSylesFunctionalTest extends BrowserTestBase {
   ];
 
   /**
-   * @var \Drupal\user\Entity\User
+   * @var User
    */
   protected $user;
 
@@ -50,29 +54,29 @@ class ConsumerImageSylesFunctionalTest extends BrowserTestBase {
   /**
    * The content type to attach the fields to test.
    *
-   * @var \Drupal\node\Entity\NodeType
+   * @var NodeType
    */
   protected $contentType;
 
   /**
-   * @var \Drupal\node\Entity\Node[]
+   * @var Node[]
    */
   protected $nodes = [];
 
   /**
-   * @var \Drupal\file\Entity\File[]
+   * @var File[]
    */
   protected $files = [];
 
   /**
-   * @var \Drupal\consumers\Entity\Consumer
+   * @var Consumer
    */
   protected $consumer;
 
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
     $this->contentType = $this->createContentType();
     $this->imageFieldName = $this->getRandomGenerator()->word(8);
@@ -88,7 +92,7 @@ class ConsumerImageSylesFunctionalTest extends BrowserTestBase {
    * @param int $num_nodes
    *   Number of articles to create.
    *
-   * @throws \Drupal\Core\Entity\EntityStorageException
+   * @throws EntityStorageException
    */
   protected function createDefaultContent($num_nodes) {
     $random = $this->getRandomGenerator();
