diff --git a/modules/imageapi_optimize_avif_webp_responsive/imageapi_optimize_avif_webp_responsive.module b/modules/imageapi_optimize_avif_webp_responsive/imageapi_optimize_avif_webp_responsive.module
index e3b56fa..adadac2 100644
--- a/modules/imageapi_optimize_avif_webp_responsive/imageapi_optimize_avif_webp_responsive.module
+++ b/modules/imageapi_optimize_avif_webp_responsive/imageapi_optimize_avif_webp_responsive.module
@@ -61,8 +61,8 @@ function imageapi_optimize_avif_webp_responsive_preprocess_responsive_image(&$va
         if ($pipeline_avif_webp_map[$image_style->getPipeline()]) {
           $image_uri = $image_style->buildUri($variables['uri']);
 
-          $image_url = file_create_url($image_uri);
-          $image_relative_path = file_url_transform_relative($image_url);
+          $image_url = \Drupal::service('file_url_generator')->generateAbsoluteString($image_uri);
+          $image_relative_path = \Drupal::service('file_url_generator')->transformRelative($image_url);
 
           $image_relative_path_file = explode('?', $image_relative_path)[0];
 
