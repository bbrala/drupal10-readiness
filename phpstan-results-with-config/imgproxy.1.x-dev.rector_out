modules/contrib/imgproxy/imgproxy.module
modules/contrib/imgproxy/src/Form/ImgProxySettingsForm.php
modules/contrib/imgproxy/src/ImgProxy.php
modules/contrib/imgproxy/src/Imgproxy/Gravity.php
modules/contrib/imgproxy/src/Imgproxy/ImgProxyUrl.php
modules/contrib/imgproxy/src/Imgproxy/ResizeType.php
modules/contrib/imgproxy/src/Imgproxy/Watermark.php
modules/contrib/imgproxy/src/Imgproxy/WatermarkPosition.php
modules/contrib/imgproxy/src/Twig/TwigExtension.php
modules/contrib/imgproxy/src/ValidString.php
modules/contrib/imgproxy/tests/src/Unit/UrlTests.php

6 files with changes
====================

1) modules/contrib/imgproxy/tests/src/Unit/UrlTests.php:86

    ---------- begin diff ----------
@@ @@
       ->setKey($key)
       ->setSalt($salt)
       ->setImageUrl($imgUrl);
-    self::assertContains('/' . $signature . '/', $url->toString());
+    self::assertStringContainsString('/' . $signature . '/', $url->toString());
   }

   /**
@@ @@

     self::assertStringStartsWith($endpoint, $result);
     self::assertStringEndsWith($encodedUrl, $result);
-    self::assertContains('/w:100/', $result);
-    self::assertContains('/h:200/', $result);
-    self::assertContains('/el:1/', $result);
-    self::assertContains('/ex:1/', $result);
-    self::assertContains('/bg:aabbcc/', $result);
-    self::assertContains('/bl:0.5/', $result);
-    self::assertContains('/sh:0.4/', $result);
-    self::assertContains('/rt:crop/', $result);
-    self::assertContains('/g:ce/', $result);
-    self::assertContains('/dpr:2/', $result);
-    self::assertContains('/f:jpg/', $result);
-    self::assertContains('/q:25/', $result);
-    self::assertContains('/wm:0.5:nowe:12:13:0.1/', $result);
-    self::assertContains('/cb:hbz/', $result);
+    self::assertStringContainsString('/w:100/', $result);
+    self::assertStringContainsString('/h:200/', $result);
+    self::assertStringContainsString('/el:1/', $result);
+    self::assertStringContainsString('/ex:1/', $result);
+    self::assertStringContainsString('/bg:aabbcc/', $result);
+    self::assertStringContainsString('/bl:0.5/', $result);
+    self::assertStringContainsString('/sh:0.4/', $result);
+    self::assertStringContainsString('/rt:crop/', $result);
+    self::assertStringContainsString('/g:ce/', $result);
+    self::assertStringContainsString('/dpr:2/', $result);
+    self::assertStringContainsString('/f:jpg/', $result);
+    self::assertStringContainsString('/q:25/', $result);
+    self::assertStringContainsString('/wm:0.5:nowe:12:13:0.1/', $result);
+    self::assertStringContainsString('/cb:hbz/', $result);

   }
    ----------- end diff -----------

Applied rules:
 * ExceptionAnnotationRector
 * RemoveDataProviderTestPrefixRector
 * AssertEqualsParameterToSpecificMethodsTypeRector
 * SpecificAssertContainsRector
 * ArgumentRemoverRector
 * RenameAnnotationRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


2) modules/contrib/imgproxy/src/Twig/TwigExtension.php:15

    ---------- begin diff ----------
@@ @@
   /**
    * Imgproxy service.
    *
-   * @var \Drupal\imgproxy\ImgProxy
+   * @var ImgProxy
    */
   protected $service;

@@ @@
   /**
    * TwigExtension constructor.
    *
-   * @param \Drupal\imgproxy\ImgProxy $imgProxy
+   * @param ImgProxy $imgProxy
    *   Imgproxy service injection.
    */
   public function __construct(ImgProxy $imgProxy) {
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


3) modules/contrib/imgproxy/src/Imgproxy/Watermark.php:34

    ---------- begin diff ----------
@@ @@
   /**
    * Watermark position.
    *
-   * @var \Drupal\imgproxy\Imgproxy\WatermarkPosition
+   * @var WatermarkPosition
    */
   private $position;

@@ @@
   /**
    * Setter for the position field.
    *
-   * @param \Drupal\imgproxy\Imgproxy\WatermarkPosition $position
+   * @param WatermarkPosition $position
    *   New value.
    *
    * @return self
@@ @@
    *
    * @param float $opacity
    *   Opacity.
-   * @param \Drupal\imgproxy\Imgproxy\WatermarkPosition|null $position
+   * @param WatermarkPosition|null $position
    *   Watermark position.
    * @param float $x
    *   X offset.
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector


4) modules/contrib/imgproxy/src/Imgproxy/ImgProxyUrl.php:64

    ---------- begin diff ----------
@@ @@
   /**
    * Resize type.
    *
-   * @var \Drupal\imgproxy\Imgproxy\ResizeType|null
+   * @var ResizeType|null
    */
   private $resize;

@@ @@
   /**
    * Gravity direction on resizing.
    *
-   * @var \Drupal\imgproxy\Imgproxy\Gravity|null
+   * @var Gravity|null
    */
   private $gravity;

@@ @@
   /**
    * Watermark information.
    *
-   * @var \Drupal\imgproxy\Imgproxy\Watermark|null
+   * @var Watermark|null
    */
   private $watermark;

@@ @@
   /**
    * Setter for the resize field.
    *
-   * @param \Drupal\imgproxy\Imgproxy\ResizeType|null $type
+   * @param ResizeType|null $type
    *   New resize type.
    *
    * @return self
@@ @@
   /**
    * Setter for the gravity field.
    *
-   * @param \Drupal\imgproxy\Imgproxy\Gravity|null $gravity
+   * @param Gravity|null $gravity
    *   New value.
    *
    * @return self
@@ @@
   /**
    * Setter for the watermark field.
    *
-   * @param \Drupal\imgproxy\Imgproxy\Watermark|null $watermark
+   * @param Watermark|null $watermark
    *   New value.
    *
    * @return self
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector


5) modules/contrib/imgproxy/src/ImgProxy.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\imgproxy;

+use Drupal\Core\Config\ImmutableConfig;
 use Drupal\Core\Config\ConfigFactoryInterface;
 use Drupal\Core\Url;
 use Drupal\imgproxy\Imgproxy\Gravity;
@@ @@
   /**
    * Drupal config.
    *
-   * @var \Drupal\Core\Config\ImmutableConfig
+   * @var ImmutableConfig
    */
   protected $config;

@@ @@
   /**
    * ImgProxy constructor.
    *
-   * @param \Drupal\Core\Config\ConfigFactoryInterface $config
+   * @param ConfigFactoryInterface $config
    *   Config factory injection.
    */
   public function __construct(ConfigFactoryInterface $config) {
@@ @@
   /**
    * Creates imgproxy url for given data.
    *
-   * @param string|\Drupal\Core\Url $url
+   * @param string|Url $url
    *   Source image url. Must be accessible from imgproxy server.
    * @param array $settings
    *   Processing settings. The following keys are accepted:
@@ @@
     }
     $url = $this->config->get('local')
       ? str_replace(['public:', 'private:'], 'local:/', $url)
-      : file_create_url($url);
+      : \Drupal::service('file_url_generator')->generateAbsoluteString($url);
     $instance = (new ImgProxyUrl())
       ->setImageUrl($url)
       ->setEndpoint($this->config->get('endpoint'))
    ----------- end diff -----------

Applied rules:
 * FileCreateUrlRector
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector


6) modules/contrib/imgproxy/imgproxy.module:0

    ---------- begin diff ----------
@@ @@
 <?php

+use Drupal\imgproxy\ImgProxy;
 /**
  * @file
  * Module hooks and functions.
@@ @@
     '#attributes' => $variables['attributes'],
     '#style_name' => $variables['style_name'],
   ];
-  /** @var \Drupal\imgproxy\ImgProxy $imgproxy */
+  /** @var ImgProxy $imgproxy */
   $imgproxy = \Drupal::service('imgproxy');
   $url = $imgproxy->getUrl($variables['uri'], $variables['options']);
   $variables['image']['#uri'] = $url;
@@ @@
     $variables['image']['#title'] = $variables['title'];
   }
   if (!empty($variables['uri'])) {
-    $variables['attributes']['src'] = file_url_transform_relative(
-      file_create_url($variables['uri'])
-    );
+    $variables['attributes']['src'] = \Drupal::service('file_url_generator')->generateString($variables['uri']);
   }
 }
    ----------- end diff -----------

Applied rules:
 * FileUrlTransformRelativeRector
 * ArgumentRemoverRector


 [OK] 6 files have been changed by Rector                                       

