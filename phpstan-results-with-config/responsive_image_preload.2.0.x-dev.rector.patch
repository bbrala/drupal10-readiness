diff --git a/responsive_image_preload.module b/responsive_image_preload.module
index 5f43538..2d93ef3 100644
--- a/responsive_image_preload.module
+++ b/responsive_image_preload.module
@@ -1,5 +1,7 @@
 <?php
 
+use Drupal\responsive_image_preload\ThirdPartySettings;
+use Drupal\responsive_image_preload\FieldPreprocessor;
 /**
  * @file
  * Allows content editors to configure preloaded responsive images.
@@ -14,7 +16,7 @@ use Drupal\Core\Form\FormStateInterface;
  */
 function responsive_image_preload_field_formatter_third_party_settings_form(FormatterInterface $plugin, FieldDefinitionInterface $field_definition, $view_mode, array $form, FormStateInterface $form_state) {
 
-  /** @var \Drupal\responsive_image_preload\ThirdPartySettings $third_party_settings */
+  /** @var ThirdPartySettings $third_party_settings */
   $third_party_settings = \Drupal::service('responsive_image_preload.third_party_settings');
 
   return $third_party_settings->settingsForm($plugin);
@@ -25,7 +27,7 @@ function responsive_image_preload_field_formatter_third_party_settings_form(Form
  */
 function responsive_image_preload_field_formatter_settings_summary_alter(array &$summary, array $context) {
 
-  /** @var \Drupal\responsive_image_preload\ThirdPartySettings $third_party_settings */
+  /** @var ThirdPartySettings $third_party_settings */
   $third_party_settings = \Drupal::service('responsive_image_preload.third_party_settings');
 
   $third_party_settings->settingsSummaryAlter($summary, $context);
@@ -36,7 +38,7 @@ function responsive_image_preload_field_formatter_settings_summary_alter(array &
  */
 function responsive_image_preload_preprocess_field(array &$variables) {
 
-  /** @var \Drupal\responsive_image_preload\FieldPreprocessor $field_preprocessor */
+  /** @var FieldPreprocessor $field_preprocessor */
   $field_preprocessor = \Drupal::service('responsive_image_preload.field_preprocessor');
 
   $field_preprocessor->preprocessField($variables);
diff --git a/src/FieldPreprocessor.php b/src/FieldPreprocessor.php
index 06d06cd..f4fb5db 100644
--- a/src/FieldPreprocessor.php
+++ b/src/FieldPreprocessor.php
@@ -2,6 +2,8 @@
 
 namespace Drupal\responsive_image_preload;
 
+use Drupal\Core\Entity\FieldableEntityInterface;
+use Drupal\Core\Entity\Display\EntityViewDisplayInterface;
 use Drupal\Core\Entity\EntityTypeManagerInterface;
 
 /**
@@ -14,23 +16,23 @@ class FieldPreprocessor {
   /**
    * The preload generator service.
    *
-   * @var \Drupal\responsive_image_preload\PreloadGeneratorInterface
+   * @var PreloadGeneratorInterface
    */
   protected $preloadGenerator;
 
   /**
    * The entity type manager service.
    *
-   * @var \Drupal\Core\Entity\EntityTypeManagerInterface
+   * @var EntityTypeManagerInterface
    */
   protected $entityTypeManager;
 
   /**
    * Creates a field preprocessor service instance.
    *
-   * @param \Drupal\responsive_image_preload\PreloadGeneratorInterface $preload_generator
+   * @param PreloadGeneratorInterface $preload_generator
    *   The preload generator service.
-   * @param \Drupal\Core\Entity\EntityTypeManagerInterface $entity_type_manager
+   * @param EntityTypeManagerInterface $entity_type_manager
    *   The entity type manager service.
    */
   public function __construct(PreloadGeneratorInterface $preload_generator, EntityTypeManagerInterface $entity_type_manager) {
@@ -46,12 +48,12 @@ class FieldPreprocessor {
    */
   public function preprocessField(array &$variables) {
     if ($variables['element']['#formatter'] === 'responsive_image') {
-      /** @var \Drupal\Core\Entity\FieldableEntityInterface $entity */
+      /** @var FieldableEntityInterface $entity */
       $entity = $variables['element']['#object'];
       $view_mode = $variables['element']['#view_mode'];
       $field_name = $variables['element']['#field_name'];
 
-      /** @var \Drupal\Core\Entity\Display\EntityViewDisplayInterface $display */
+      /** @var EntityViewDisplayInterface $display */
       $display = current($this->entityTypeManager->getStorage('entity_view_display')
         ->loadByProperties([
           'id' => $entity->getEntityTypeId() . '.' . $entity->bundle() . '.' . $view_mode,
diff --git a/src/PreloadGenerator.php b/src/PreloadGenerator.php
index cca917f..1b9916b 100644
--- a/src/PreloadGenerator.php
+++ b/src/PreloadGenerator.php
@@ -2,6 +2,9 @@
 
 namespace Drupal\responsive_image_preload;
 
+use Drupal\Component\Plugin\Exception\InvalidPluginDefinitionException;
+use Drupal\Component\Plugin\Exception\PluginNotFoundException;
+use Drupal\image\ImageStyleInterface;
 use Drupal\breakpoint\BreakpointManagerInterface;
 use Drupal\Core\Entity\EntityTypeManagerInterface;
 use Drupal\Core\Extension\ModuleHandlerInterface;
@@ -20,41 +23,41 @@ class PreloadGenerator implements PreloadGeneratorInterface {
   /**
    * The breakpoint manager service.
    *
-   * @var \Drupal\breakpoint\BreakpointManagerInterface
+   * @var BreakpointManagerInterface
    */
   protected $breakpointManager;
 
   /**
    * The entity type manager service.
    *
-   * @var \Drupal\Core\Entity\EntityTypeManagerInterface
+   * @var EntityTypeManagerInterface
    */
   protected $entityTypeManager;
 
   /**
    * The image factory service.
    *
-   * @var \Drupal\Core\Image\ImageFactory
+   * @var ImageFactory
    */
   protected $imageFactory;
 
   /**
    * The module handler service.
    *
-   * @var \Drupal\Core\Extension\ModuleHandlerInterface
+   * @var ModuleHandlerInterface
    */
   protected $moduleHandler;
 
   /**
    * Creates a preload generator service instance.
    *
-   * @param \Drupal\breakpoint\BreakpointManagerInterface $breakpoint_manager
+   * @param BreakpointManagerInterface $breakpoint_manager
    *   The breakpoint manager service.
-   * @param \Drupal\Core\Entity\EntityTypeManagerInterface $entity_type_manager
+   * @param EntityTypeManagerInterface $entity_type_manager
    *   The entity type manager service.
-   * @param \Drupal\Core\Image\ImageFactory $image_factory
+   * @param ImageFactory $image_factory
    *   The image factory service.
-   * @param \Drupal\Core\Extension\ModuleHandlerInterface $module_handler
+   * @param ModuleHandlerInterface $module_handler
    *   The module handler service.
    */
   public function __construct(BreakpointManagerInterface $breakpoint_manager, EntityTypeManagerInterface $entity_type_manager, ImageFactory $image_factory, ModuleHandlerInterface $module_handler) {
@@ -73,10 +76,10 @@ class PreloadGenerator implements PreloadGeneratorInterface {
     $preloads = [];
     foreach (Element::children($elements) as $delta) {
 
-      /** @var \Drupal\file\FileInterface $file */
+      /** @var FileInterface $file */
       $file = $elements[$delta]['#item']->entity;
 
-      /** @var \Drupal\responsive_image\ResponsiveImageStyleInterface $responsive_image_style */
+      /** @var ResponsiveImageStyleInterface $responsive_image_style */
       $responsive_image_style = $responsive_image_style_storage->load($elements[$delta]['#responsive_image_style_id']);
 
       $preloads[] = $this->generatePreloadsForDelta($file, $responsive_image_style);
@@ -89,17 +92,17 @@ class PreloadGenerator implements PreloadGeneratorInterface {
   /**
    * Generates preloads for the provided image file and responsive image style.
    *
-   * @param \Drupal\file\FileInterface $file
+   * @param FileInterface $file
    *   The image file to generate preloads for.
-   * @param \Drupal\responsive_image\ResponsiveImageStyleInterface $responsive_image_style
+   * @param ResponsiveImageStyleInterface $responsive_image_style
    *   The responsive image style to generate preloads for.
    *
    * @return array
    *   An array of preloads built from the image derivatives.
    *
-   * @throws \Drupal\Component\Plugin\Exception\InvalidPluginDefinitionException
+   * @throws InvalidPluginDefinitionException
    *   This should never happen under normal circumstances.
-   * @throws \Drupal\Component\Plugin\Exception\PluginNotFoundException
+   * @throws PluginNotFoundException
    *   This should never happen under normal circumstances.
    */
   protected function generatePreloadsForDelta(FileInterface $file, ResponsiveImageStyleInterface $responsive_image_style) {
@@ -129,9 +132,9 @@ class PreloadGenerator implements PreloadGeneratorInterface {
                 );
                 $imagesizes[] = explode(',', $image_style_mapping['image_mapping']['sizes']);
 
-                /** @var \Drupal\image\ImageStyleInterface $image_style */
+                /** @var ImageStyleInterface $image_style */
                 $image_style = $image_style_storage->load($image_style_name);
-                $image_url = file_url_transform_relative(file_create_url($image_style->buildUrl($file->getFileUri())));
+                $image_url = \Drupal::service('file_url_generator')->generateString($image_style->buildUrl($file->getFileUri()));
 
                 if ($this->moduleHandler->moduleExists('webp')) {
                   $image_url = preg_replace('/\.(png|jpg|jpeg)(\\?.*?)?(,| |$)/i', '.webp\\2\\3', $image_url);
@@ -143,9 +146,9 @@ class PreloadGenerator implements PreloadGeneratorInterface {
 
             case 'image_style':
               $image_style_name = $image_style_mapping['image_mapping'];
-              /** @var \Drupal\image\ImageStyleInterface $image_style */
+              /** @var ImageStyleInterface $image_style */
               $image_style = $image_style_storage->load($image_style_name);
-              $image_url = file_url_transform_relative(file_create_url($image_style->buildUrl($file->getFileUri())));
+              $image_url = \Drupal::service('file_url_generator')->generateString($image_style->buildUrl($file->getFileUri()));
 
               if ($this->moduleHandler->moduleExists('webp')) {
                 $image_url = preg_replace('/\.(png|jpg|jpeg)(\\?.*?)?(,| |$)/i', '.webp\\2\\3', $image_url);
diff --git a/src/PreloadGeneratorInterface.php b/src/PreloadGeneratorInterface.php
index 7466d1e..c94657c 100644
--- a/src/PreloadGeneratorInterface.php
+++ b/src/PreloadGeneratorInterface.php
@@ -2,6 +2,8 @@
 
 namespace Drupal\responsive_image_preload;
 
+use Drupal\Component\Plugin\Exception\InvalidPluginDefinitionException;
+use Drupal\Component\Plugin\Exception\PluginNotFoundException;
 /**
  * A service that is capable of generating a set of responsive image preloads.
  */
@@ -16,9 +18,9 @@ interface PreloadGeneratorInterface {
    * @return array
    *   A set of preloads.
    *
-   * @throws \Drupal\Component\Plugin\Exception\InvalidPluginDefinitionException
+   * @throws InvalidPluginDefinitionException
    *   This should never happen under normal circumstances.
-   * @throws \Drupal\Component\Plugin\Exception\PluginNotFoundException
+   * @throws PluginNotFoundException
    *   This should never happen under normal circumstances.
    */
   public function generatePreloads(array $elements);
diff --git a/src/ThirdPartySettings.php b/src/ThirdPartySettings.php
index 8f490e3..fa03641 100644
--- a/src/ThirdPartySettings.php
+++ b/src/ThirdPartySettings.php
@@ -17,7 +17,7 @@ class ThirdPartySettings {
   /**
    * Generates the third party settings form elements.
    *
-   * @param \Drupal\Core\Field\FormatterInterface $plugin
+   * @param FormatterInterface $plugin
    *   The formatter to generate a form for.
    *
    * @return array
diff --git a/tests/src/Functional/ResponsiveImagePreloadBrowserTestBase.php b/tests/src/Functional/ResponsiveImagePreloadBrowserTestBase.php
index e603483..c4885e8 100644
--- a/tests/src/Functional/ResponsiveImagePreloadBrowserTestBase.php
+++ b/tests/src/Functional/ResponsiveImagePreloadBrowserTestBase.php
@@ -2,6 +2,11 @@
 
 namespace Drupal\Tests\responsive_image_preload\Functional;
 
+use Drupal\field\FieldStorageConfigInterface;
+use Drupal\field\FieldConfigInterface;
+use Drupal\Core\Entity\Display\EntityViewDisplayInterface;
+use Drupal\Core\Entity\EntityInterface;
+use Drupal\Core\Entity\EntityStorageException;
 use Drupal\Core\Entity\Entity\EntityViewDisplay;
 use Drupal\entity_test\Entity\EntityTest;
 use Drupal\field\Entity\FieldConfig;
@@ -33,40 +38,40 @@ abstract class ResponsiveImagePreloadBrowserTestBase extends BrowserTestBase {
   /**
    * The storage configuration for the test field.
    *
-   * @var \Drupal\field\FieldStorageConfigInterface
+   * @var FieldStorageConfigInterface
    */
   protected $fieldStorage;
 
   /**
    * The configuration for the test field.
    *
-   * @var \Drupal\field\FieldConfigInterface
+   * @var FieldConfigInterface
    */
   protected $field;
 
   /**
    * The view display configuration for the test entity.
    *
-   * @var \Drupal\Core\Entity\Display\EntityViewDisplayInterface
+   * @var EntityViewDisplayInterface
    */
   protected $entityViewDisplay;
 
   /**
    * A test entity instance.
    *
-   * @var \Drupal\Core\Entity\EntityInterface
+   * @var EntityInterface
    */
   protected $entity;
 
   /**
    * {@inheritdoc}
    *
-   * @throws \Drupal\Core\Entity\EntityStorageException
+   * @throws EntityStorageException
    *   This should never happen under normal circumstances.
    *
    * @noinspection PhpHierarchyChecksInspection
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
     $this->fieldStorage = FieldStorageConfig::create([
@@ -105,14 +110,11 @@ abstract class ResponsiveImagePreloadBrowserTestBase extends BrowserTestBase {
     $this->entityViewDisplay->save();
 
     $fixture_path = implode(DIRECTORY_SEPARATOR, [
-      drupal_get_path('module', 'responsive_image_preload_test'),
+      \Drupal::service('extension.list.module')->getPath('responsive_image_preload_test'),
       'fixtures',
       'test.jpg',
     ]);
-    $file = file_save_data(
-      file_get_contents($fixture_path),
-      'public://test.jpg'
-    );
+    $file = \Drupal::service('file.repository')->writeData(file_get_contents($fixture_path), 'public://test.jpg');
 
     $this->entity = EntityTest::create([
       'image' => [
@@ -131,7 +133,7 @@ abstract class ResponsiveImagePreloadBrowserTestBase extends BrowserTestBase {
    * @param bool $generate_preload
    *   TRUE if preloading should be enabled, otherwise FALSE.
    *
-   * @throws \Drupal\Core\Entity\EntityStorageException
+   * @throws EntityStorageException
    *   This should never happen under normal circumstances.
    */
   protected function setFormatterSettings($responsive_image_style, $generate_preload) {
diff --git a/tests/src/Functional/ResponsiveImagePreloadTest.php b/tests/src/Functional/ResponsiveImagePreloadTest.php
index cf67039..42b01b9 100644
--- a/tests/src/Functional/ResponsiveImagePreloadTest.php
+++ b/tests/src/Functional/ResponsiveImagePreloadTest.php
@@ -2,6 +2,8 @@
 
 namespace Drupal\Tests\responsive_image_preload\Functional;
 
+use Drupal\Core\Entity\EntityStorageException;
+use Drupal\Core\Entity\EntityMalformedException;
 /**
  * Contains test cases for complex responsive image style configurations.
  *
@@ -12,9 +14,9 @@ class ResponsiveImagePreloadTest extends ResponsiveImagePreloadBrowserTestBase {
   /**
    * Tests that correct preloads are generated in a variety of configurations.
    *
-   * @throws \Drupal\Core\Entity\EntityStorageException
+   * @throws EntityStorageException
    *   This should never happen under normal circumstances.
-   * @throws \Drupal\Core\Entity\EntityMalformedException
+   * @throws EntityMalformedException
    *   This should never happen under normal circumstances.
    */
   public function testResponsiveImagePreload() {
diff --git a/tests/src/Functional/ResponsiveImagePreloadWebpTest.php b/tests/src/Functional/ResponsiveImagePreloadWebpTest.php
index 860a619..bc72d7f 100644
--- a/tests/src/Functional/ResponsiveImagePreloadWebpTest.php
+++ b/tests/src/Functional/ResponsiveImagePreloadWebpTest.php
@@ -2,6 +2,8 @@
 
 namespace Drupal\Tests\responsive_image_preload\Functional;
 
+use Drupal\Core\Entity\EntityStorageException;
+use Drupal\Core\Entity\EntityMalformedException;
 /**
  * Contains test cases for complex responsive image style configurations.
  *
@@ -32,9 +34,9 @@ class ResponsiveImagePreloadWebpTest extends ResponsiveImagePreloadBrowserTestBa
   /**
    * Tests that correct preloads are generated in a variety of configurations.
    *
-   * @throws \Drupal\Core\Entity\EntityStorageException
+   * @throws EntityStorageException
    *   This should never happen under normal circumstances.
-   * @throws \Drupal\Core\Entity\EntityMalformedException
+   * @throws EntityMalformedException
    *   This should never happen under normal circumstances.
    */
   public function testResponsiveImageWebpPreload() {
diff --git a/tests/src/Unit/FieldPreprocessorTest.php b/tests/src/Unit/FieldPreprocessorTest.php
index b4b6682..153e703 100644
--- a/tests/src/Unit/FieldPreprocessorTest.php
+++ b/tests/src/Unit/FieldPreprocessorTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\responsive_image_preload\Unit;
 
+use PHPUnit\Framework\MockObject\MockObject;
 use Drupal\Core\Entity\Display\EntityViewDisplayInterface;
 use Drupal\Core\Entity\EntityStorageInterface;
 use Drupal\Core\Entity\EntityTypeManagerInterface;
@@ -20,33 +21,31 @@ class FieldPreprocessorTest extends UnitTestCase {
   /**
    * The subject under test.
    *
-   * @var \Drupal\responsive_image_preload\FieldPreprocessor
+   * @var FieldPreprocessor
    */
   protected $instance;
 
   /**
    * The mocked display settings.
    *
-   * @var \Drupal\Core\Entity\Display\EntityViewDisplayInterface|\PHPUnit\Framework\MockObject\MockObject
+   * @var EntityViewDisplayInterface|MockObject
    */
   protected $display;
 
   /**
    * The mocked display storage.
    *
-   * @var \Drupal\Core\Entity\EntityStorageInterface|\PHPUnit\Framework\MockObject\MockObject
+   * @var EntityStorageInterface|MockObject
    */
   protected $storage;
 
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
 
-    $preload_generator = $this->getMockBuilder(PreloadGeneratorInterface::class)
-      ->disableOriginalConstructor()
-      ->getMock();
+    $preload_generator = $this->createMock(PreloadGeneratorInterface::class);
 
     $preload_generator
       ->method('generatePreloads')
@@ -54,13 +53,9 @@ class FieldPreprocessorTest extends UnitTestCase {
         'test-preload-key' => ['test-preload-data'],
       ]);
 
-    $this->display = $this->getMockBuilder(EntityViewDisplayInterface::class)
-      ->disableOriginalConstructor()
-      ->getMock();
+    $this->display = $this->createMock(EntityViewDisplayInterface::class);
 
-    $this->storage = $this->getMockBuilder(EntityStorageInterface::class)
-      ->disableOriginalConstructor()
-      ->getMock();
+    $this->storage = $this->createMock(EntityStorageInterface::class);
 
     $this->storage->method('loadByProperties')
       ->willReturnCallback(function ($properties) {
@@ -76,9 +71,7 @@ class FieldPreprocessorTest extends UnitTestCase {
         return $name === 'entity_test.test.test' ? NULL : $this->display;
       });
 
-    $entity_type_manager = $this->getMockBuilder(EntityTypeManagerInterface::class)
-      ->disableOriginalConstructor()
-      ->getMock();
+    $entity_type_manager = $this->createMock(EntityTypeManagerInterface::class);
 
     $entity_type_manager->method('getStorage')
       ->willReturn($this->storage);
@@ -111,13 +104,11 @@ class FieldPreprocessorTest extends UnitTestCase {
    * @param string $bundle
    *   The bundle of the entity.
    *
-   * @return \Drupal\Core\Entity\FieldableEntityInterface|\PHPUnit\Framework\MockObject\MockObject
+   * @return FieldableEntityInterface|MockObject
    *   A mocked entity instance.
    */
   protected function getMockEntity($bundle = 'test') {
-    $entity = $this->getMockBuilder(FieldableEntityInterface::class)
-      ->disableOriginalConstructor()
-      ->getMock();
+    $entity = $this->createMock(FieldableEntityInterface::class);
 
     $entity->method('getEntityTypeId')
       ->willReturn('test');
diff --git a/tests/src/Unit/ThirdPartySettingsTest.php b/tests/src/Unit/ThirdPartySettingsTest.php
index 09f3f18..5a570b5 100644
--- a/tests/src/Unit/ThirdPartySettingsTest.php
+++ b/tests/src/Unit/ThirdPartySettingsTest.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\responsive_image_preload\Unit;
 
+use PHPUnit\Framework\MockObject\MockObject;
 use Drupal\Core\Field\FormatterInterface;
 use Drupal\responsive_image_preload\ThirdPartySettings;
 use Drupal\Tests\UnitTestCase;
@@ -16,14 +17,14 @@ class ThirdPartySettingsTest extends UnitTestCase {
   /**
    * The subject under test.
    *
-   * @var \Drupal\responsive_image_preload\ThirdPartySettings
+   * @var ThirdPartySettings
    */
   protected $instance;
 
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
     $this->instance = new ThirdPartySettings();
     $this->instance->setStringTranslation($this->getStringTranslationStub());
@@ -37,13 +38,11 @@ class ThirdPartySettingsTest extends UnitTestCase {
    * @param bool $generate_preloads
    *   Should preloads be enabled?
    *
-   * @return \Drupal\Core\Field\FormatterInterface|\PHPUnit\Framework\MockObject\MockObject
+   * @return FormatterInterface|MockObject
    *   A mocked plugin instance.
    */
   protected function getMockPlugin($id, $generate_preloads = FALSE) {
-    $plugin = $this->getMockBuilder(FormatterInterface::class)
-      ->disableOriginalConstructor()
-      ->getMock();
+    $plugin = $this->createMock(FormatterInterface::class);
 
     $plugin
       ->method('getPluginId')
