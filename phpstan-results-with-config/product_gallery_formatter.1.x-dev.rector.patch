diff --git a/product_gallery_formatter.info.yml b/product_gallery_formatter.info.yml
index 727bd4b..d0240ea 100644
--- a/product_gallery_formatter.info.yml
+++ b/product_gallery_formatter.info.yml
@@ -1,8 +1,7 @@
 name: Product Gallery Formatter
 type: module
 description: Product gallery formatter for products images with zoom effect.
-core: 8.x
-core_version_requirement: ^8 || ^9
+core_version_requirement: ^9.3 || ^10
 dependencies:
   - image
 package: Other
diff --git a/product_gallery_formatter.module b/product_gallery_formatter.module
index b4d82e5..900d920 100644
--- a/product_gallery_formatter.module
+++ b/product_gallery_formatter.module
@@ -1,4 +1,6 @@
 <?php
+use Drupal\Core\Form\FormStateInterface;
+use Drupal\Core\Url;
 use Drupal\Component\Utility\SafeMarkup;
 use Drupal\Core\Render\Element;
 use Drupal\Core\Template\Attribute;
@@ -69,15 +71,16 @@ function template_preprocess_product_image_list(&$variables) {
 /**
  * Implements hook_form_alter().
  */
-function product_gallery_formatter_form_alter(&$form, \Drupal\Core\Form\FormStateInterface $form_state, $form_id){
+function product_gallery_formatter_form_alter(&$form, FormStateInterface $form_state, $form_id){
 	if($form_id == 'commerce_line_item_product_variation_add_to_cart_form') {
 		$pre = $form['#markup'];
 		// Retrieve an array which contains the path pieces.
 		$path = \Drupal::service('path.current')->getPath();
-		$params = \Drupal\Core\Url::fromUserInput($path)->getRouteParameters();
+		$params = Url::fromUserInput($path)->getRouteParameters();
 		//$product = \Drupal\commerce_product\Entity\Product::load($params['commerce_product']);
-
-		    $query = db_select('commerce_product_variation_field_data', 'v');
+						// TODO: Drupal Rector Notice: Please delete the following comment after you've made any necessary changes.
+						// You will need to use `\Drupal\core\Database\Database::getConnection()` if you do not yet have access to the container here.
+						$query = \Drupal::database()->select('commerce_product_variation_field_data', 'v');
 			$query->addField('v', 'sku');
 			$query->addField('v', 'price__amount');
 			$query->condition('v.product_id', $params['commerce_product']);
@@ -95,7 +98,9 @@ function product_gallery_formatter_form_alter(&$form, \Drupal\Core\Form\FormStat
 }
 
 function _get_sku($product_id) {
-	$query = db_select('commerce_product_variation_field_data', 'v');
+	// TODO: Drupal Rector Notice: Please delete the following comment after you've made any necessary changes.
+	// You will need to use `\Drupal\core\Database\Database::getConnection()` if you do not yet have access to the container here.
+	$query = \Drupal::database()->select('commerce_product_variation_field_data', 'v');
 	$query->addField('v', 'sku');
 	$query->addField('v', 'price__amount');
 	$query->condition('v.product_id', $product_id);
diff --git a/src/Plugin/Field/FieldFormatter/ProductGalleryFormatter.php b/src/Plugin/Field/FieldFormatter/ProductGalleryFormatter.php
index 7f6ad23..01717c8 100644
--- a/src/Plugin/Field/FieldFormatter/ProductGalleryFormatter.php
+++ b/src/Plugin/Field/FieldFormatter/ProductGalleryFormatter.php
@@ -103,7 +103,7 @@ class ProductGalleryFormatter extends ImageFormatter {
       '#type' => 'inline_template',
       '#template' => '<a href="{{ path }}"><img src="{{ path }}" /></a>',
       '#context' => [
-        'path' => $style ? $style->buildUrl($uri) : file_create_url($uri)
+        'path' => $style ? $style->buildUrl($uri) : \Drupal::service('file_url_generator')->generateAbsoluteString($uri)
       ]
     ];
   }
