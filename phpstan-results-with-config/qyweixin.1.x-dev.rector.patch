diff --git a/qyweixin.info.yml b/qyweixin.info.yml
index d648557..8b72179 100644
--- a/qyweixin.info.yml
+++ b/qyweixin.info.yml
@@ -2,7 +2,6 @@ name: 'Common Interface of Qiye Weixin'
 type: module
 description: 'Allow interact with Tencent Qiye Weixin platform'
 package: Weixin
-core: '8.x'
-core_version_requirement: ^8 || ^9
+core_version_requirement: ^9.3 || ^10
 configure: qyweixin.admin
 version: '8.x-0.1'
diff --git a/qyweixin.module b/qyweixin.module
index 40ca2f6..0b0fbb8 100644
--- a/qyweixin.module
+++ b/qyweixin.module
@@ -9,7 +9,7 @@ use Drupal\qyweixin\CorpBase;
 /**
  * Implements hook_ENTITY_TYPE_insert for user entity type.
  */
-function qyweixin_user_insert(Drupal\user\UserInterface $user) {
+function qyweixin_user_insert(UserInterface $user) {
 	if(!Drupal::config('qyweixin.general')->get('autosync')) return;
 	try {
 		$u=new stdClass();
@@ -36,7 +36,7 @@ function qyweixin_user_insert(Drupal\user\UserInterface $user) {
 /**
  * Implements hook_ENTITY_TYPE_update for user entity type.
  */
-function qyweixin_user_update(Drupal\user\UserInterface $user) {
+function qyweixin_user_update(UserInterface $user) {
 	if(!Drupal::config('qyweixin.general')->get('autosync')) return;
 	try {
 		$u=new stdClass();
@@ -64,7 +64,7 @@ function qyweixin_user_update(Drupal\user\UserInterface $user) {
 /**
  * Implements hook_ENTITY_TYPE_delete for user entity type.
  */
-function qyweixin_user_delete(Drupal\user\UserInterface $user) {
+function qyweixin_user_delete(UserInterface $user) {
 	if(!Drupal::config('qyweixin.general')->get('autosync')) return;
 	try {
 		CorpBase::userDelete($user->id());
@@ -82,7 +82,7 @@ function qyweixin_user_delete(Drupal\user\UserInterface $user) {
 /**
  * Implements hook_ENTITY_TYPE_presave for user_role entity type.
  */
-function qyweixin_user_role_presave(Drupal\user\RoleInterface $role) {
+function qyweixin_user_role_presave(RoleInterface $role) {
 	$departmentid=$role->getThirdPartySetting('qyweixin','departmentid');
 	if(empty($departmentid)) {
 		$max_department_id=Drupal::state()->get('qyweixin.max_department_id', 1)+1;
@@ -94,7 +94,7 @@ function qyweixin_user_role_presave(Drupal\user\RoleInterface $role) {
 /**
  * Implements hook_ENTITY_TYPE_insert for user_role entity type.
  */
-function qyweixin_user_role_insert(Drupal\user\RoleInterface $role) {
+function qyweixin_user_role_insert(RoleInterface $role) {
 	if(!Drupal::config('qyweixin.general')->get('autosync')) return;
 	try {
 		$r=new stdClass();
@@ -118,7 +118,7 @@ function qyweixin_user_role_insert(Drupal\user\RoleInterface $role) {
 /**
  * Implements hook_ENTITY_TYPE_update for user_role entity type.
  */
-function qyweixin_user_role_update(Drupal\user\RoleInterface $role) {
+function qyweixin_user_role_update(RoleInterface $role) {
 	if(!Drupal::config('qyweixin.general')->get('autosync')) return;
 	try {
 		$r=new stdClass();
@@ -142,7 +142,7 @@ function qyweixin_user_role_update(Drupal\user\RoleInterface $role) {
 /**
  * Implements hook_ENTITY_TYPE_predelete for user_role entity type.
  */
-function qyweixin_user_role_predelete(Drupal\user\RoleInterface $role) {
+function qyweixin_user_role_predelete(RoleInterface $role) {
 	if(!Drupal::config('qyweixin.general')->get('autosync')) return;
 	try {
 		// First lets remove the role from related users
diff --git a/src/CorpBase.php b/src/CorpBase.php
index 024671f..9d7d3cf 100644
--- a/src/CorpBase.php
+++ b/src/CorpBase.php
@@ -7,6 +7,8 @@
 
 namespace Drupal\qyweixin;
 
+use Drupal\Core\File\FileSystemInterface;
+use Drupal\Core\File\FileSystem;
 use Drupal\file\FileInterface;
 use Drupal\qyweixin\lib\WXBizMsgCrypt;
 
@@ -879,7 +881,7 @@ class CorpBase {
 	 *   Exception could be thrown if error occurs. The caller should take care of the exception.
 	 *
 	 */
-	public static function mediaGet($media_id, $destination = NULL, $managed = FALSE, $replace = \Drupal\Core\File\FileSystemInterface::EXISTS_RENAME) {
+	public static function mediaGet($media_id, $destination = NULL, $managed = FALSE, $replace = FileSystemInterface::EXISTS_RENAME) {
 		$file=FALSE;
 		try {
 			$access_token=self::getAccessToken();
@@ -893,18 +895,18 @@ class CorpBase {
 			$parsed_url = parse_url($url);
 			if (!isset($destination)) {
 				$header=explode('"',$response->getHeader('Content-disposition'));
-				$path = file_build_uri(\Drupal\Core\File\FileSystem::basename($header[1]));
+				$path = \Drupal::service('stream_wrapper_manager')->normalizeUri(\Drupal::config('system.file')->get('default_scheme') . ('://' . FileSystem::basename($header[1])));
 			}
 			else {
-				if (is_dir(\Drupal\Core\File\FileSystem::realpath($destination))) {
+				if (is_dir(FileSystem::realpath($destination))) {
 					// Prevent URIs with triple slashes when glueing parts together.
-					$path = str_replace('///', '//', "$destination/") . \Drupal\Core\File\FileSystem::drupal_basename($parsed_url['path']);
+					$path = str_replace('///', '//', "$destination/") . FileSystem::drupal_basename($parsed_url['path']);
 				}
 				else {
 					$path = $destination;
 				}
 			}
-			$file = $managed ? file_save_data($data, $path, $replace) : \Drupal\Core\File\FileSystemInterface::saveData($data, $path, $replace);
+			$file = $managed ? \Drupal::service('file.repository')->writeData($data, $path, $replace) : FileSystemInterface::saveData($data, $path, $replace);
 		} catch (\Exception $e) {
 			throw new \Exception($e->getMessage(), $e->getCode());
 		} finally {
diff --git a/src/Form/SettingsForm.php b/src/Form/SettingsForm.php
index 36d95a1..91757c6 100644
--- a/src/Form/SettingsForm.php
+++ b/src/Form/SettingsForm.php
@@ -7,6 +7,7 @@
 
 namespace Drupal\qyweixin\Form;
 
+use Drupal\Core\Url;
 use Drupal\Core\Form\ConfigFormBase;
 use Drupal\Core\Form\FormState;
 use Drupal\Core\Form\FormStateInterface;
@@ -88,7 +89,7 @@ class SettingsForm extends ConfigFormBase {
 			);
 			if($config->get('agent.'.$agent->agentid.'.enabled')) {
 				$routename=sprintf('qyweixin.%s.%s.%s', $config->get('corpid'), $config->get('agent.'.$agent->agentid.'.entryclass'), $agent->agentid);
-				$url=\Drupal\Core\Url::fromRoute($routename)->setAbsolute(TRUE);
+				$url=Url::fromRoute($routename)->setAbsolute(TRUE);
 				$form['agents'][$agent->agentid]['callbackurl']=array(
 					'#type'=>'markup',
 					'#markup' => t('This callback url of this agent is <code>@url</code> currently.', ['@url'=>$url->toString()]),
diff --git a/src/MessageBase.php b/src/MessageBase.php
index dbd5609..caad667 100644
--- a/src/MessageBase.php
+++ b/src/MessageBase.php
@@ -6,6 +6,7 @@
  */
 
 namespace Drupal\qyweixin;
+use Drupal\Component\Utility\Html;
 use Drupal\qyweixin\MessageInterface;
 
 /**
@@ -27,7 +28,7 @@ class MessageBase implements MessageInterface {
 	}
 	
 	public function setContent($content='') {
-		$this->content=\Drupal\Component\Utility\Html::decodeEntities((string)$content);
+		$this->content=Html::decodeEntities((string)$content);
 		return $this;
 	}
 	
@@ -49,7 +50,7 @@ class MessageBase implements MessageInterface {
 
 	public function setToUser($user, $isOpenID=FALSE) {
 		if(is_array($user)) $this->toUser=implode('|',$user);
-		else if($isOpenID) $this->toUser=\Drupal\qyweixin\CorpBase::userConvertToUserid($user);
+		else if($isOpenID) $this->toUser=CorpBase::userConvertToUserid($user);
 		else $this->toUser=$user;
 		return $this;
 	}
diff --git a/src/Plugin/Mail/QyWeixinMail.php b/src/Plugin/Mail/QyWeixinMail.php
index 83b381d..1e46e83 100644
--- a/src/Plugin/Mail/QyWeixinMail.php
+++ b/src/Plugin/Mail/QyWeixinMail.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\qyweixin\Plugin\Mail;
 
+use Drupal\user\UserInterface;
 use Drupal\Core\Mail\MailFormatHelper;
 use Drupal\Core\Mail\MailInterface;
 use Drupal\qyweixin\CorpBase;
@@ -55,7 +56,7 @@ class QyWeixinMail implements MailInterface {
 		if(filter_var($message['to'], FILTER_VALIDATE_EMAIL)) {
 			$message['to']=user_load_by_mail($message['to']);
 		}
-		if($message['to'] instanceOf \Drupal\user\UserInterface) {
+		if($message['to'] instanceOf UserInterface) {
 			$message['to']=$user->getUsername();
 		}
 		if(is_string($message['to'])) {
diff --git a/src/QyWeixinAgentManager.php b/src/QyWeixinAgentManager.php
index 4cd58af..f653474 100644
--- a/src/QyWeixinAgentManager.php
+++ b/src/QyWeixinAgentManager.php
@@ -18,16 +18,16 @@ use Drupal\Core\Plugin\DefaultPluginManager;
 class QyWeixinAgentManager extends DefaultPluginManager {
 
 	/**
-	* Constructs a new QyWeixinAgentManager.
-	*
-	* @param \Traversable $namespaces
-	*   An object that implements \Traversable which contains the root paths
-	*   keyed by the corresponding namespace to look for plugin implementations.
-	* @param \Drupal\Core\Cache\CacheBackendInterface $cache_backend
-	*   Cache backend instance to use.
-	* @param \Drupal\Core\Extension\ModuleHandlerInterface $module_handler
-	*   The module handler.
-	*/
+	 * Constructs a new QyWeixinAgentManager.
+	 *
+	 * @param \Traversable $namespaces
+	 *   An object that implements \Traversable which contains the root paths
+	 *   keyed by the corresponding namespace to look for plugin implementations.
+	 * @param CacheBackendInterface $cache_backend
+	 *   Cache backend instance to use.
+	 * @param ModuleHandlerInterface $module_handler
+	 *   The module handler.
+	 */
 	public function __construct(\Traversable $namespaces, CacheBackendInterface $cache_backend, ModuleHandlerInterface $module_handler) {
 		parent::__construct('Plugin/QyWeixinAgent', $namespaces, $module_handler, 'Drupal\qyweixin\AgentInterface', 'Drupal\qyweixin\Annotation\QyWeixinAgent');
 
diff --git a/src/Routing/AgentsRoutes.php b/src/Routing/AgentsRoutes.php
index ede673e..033594d 100644
--- a/src/Routing/AgentsRoutes.php
+++ b/src/Routing/AgentsRoutes.php
@@ -11,11 +11,11 @@ use Symfony\Component\Routing\RouteCollection;
 class AgentsRoutes {
 
 	/**
-	* Returns an array of route objects.
-	*
-	* @return \Symfony\Component\Routing\Route[]
-	*   An array of route objects.
-	*/
+	 * Returns an array of route objects.
+	 *
+	 * @return Route[]
+	 *   An array of route objects.
+	 */
 	public function routes() {
 		$routes = new RouteCollection();
 		$agents=\Drupal::config('qyweixin.general')->get('agent');
