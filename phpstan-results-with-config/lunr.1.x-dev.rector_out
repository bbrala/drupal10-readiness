modules/contrib/lunr/lunr.api.php
modules/contrib/lunr/lunr.module
modules/contrib/lunr/modules/lunr_facet_example/lunr_facet_example.module
modules/contrib/lunr/scripts/request.php
modules/contrib/lunr/scripts/search_settings.php
modules/contrib/lunr/src/Controller/LunrSearchController.php
modules/contrib/lunr/src/Controller/LunrSearchIndexController.php
modules/contrib/lunr/src/Entity/LunrSearch.php
modules/contrib/lunr/src/EventSubscriber/RouteSubscriber.php
modules/contrib/lunr/src/EventSubscriber/TomePathSubscriber.php
modules/contrib/lunr/src/Form/LunrSearchEditForm.php
modules/contrib/lunr/src/LunrSearchInterface.php
modules/contrib/lunr/src/LunrSearchListBuilder.php
modules/contrib/lunr/src/LunrServiceProvider.php
modules/contrib/lunr/src/Plugin/Block/LunrSearchBlock.php
modules/contrib/lunr/src/Plugin/views/display/LunrSearchIndex.php
modules/contrib/lunr/src/Plugin/views/row/LunrSearchIndexRow.php
modules/contrib/lunr/src/Plugin/views/style/LunrSearchIndexJson.php
modules/contrib/lunr/tests/scripts/create_articles.php
modules/contrib/lunr/tests/src/FunctionalJavascript/LunrSearchTest.php

13 files with changes
=====================

1) modules/contrib/lunr/tests/src/FunctionalJavascript/LunrSearchTest.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\Tests\lunr\FunctionalJavascript;

+use Drupal\content_translation\ContentTranslationManagerInterface;
 use Drupal\Core\Url;
 use Drupal\FunctionalJavascriptTests\WebDriverTestBase;
 use Drupal\language\Entity\ConfigurableLanguage;
@@ @@
   /**
    * {@inheritdoc}
    */
-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
     $user = $this->drupalCreateUser(['administer lunr search']);
     $this->drupalLogin($user);
@@ @@
       'fr' => 'french',
     ])->save();

-    /** @var \Drupal\content_translation\ContentTranslationManagerInterface $content_translation_manager */
+    /** @var ContentTranslationManagerInterface $content_translation_manager */
     $content_translation_manager = $this->container->get('content_translation.manager');
     $content_translation_manager->setEnabled('node', 'article', TRUE);
     drupal_flush_all_caches();
    ----------- end diff -----------

Applied rules:
 * ExceptionAnnotationRector
 * RemoveDataProviderTestPrefixRector
 * ArgumentRemoverRector
 * RenameAnnotationRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * AddReturnTypeDeclarationRector
 * ChangeMethodVisibilityRector


2) modules/contrib/lunr/src/Plugin/views/style/LunrSearchIndexJson.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\lunr\Plugin\views\style;

+use Symfony\Component\Serializer\Serializer;
 use Drupal\Core\Cache\Cache;
 use Drupal\Core\Cache\CacheableDependencyInterface;
 use Drupal\views\Plugin\views\style\StylePluginBase;
@@ @@
   /**
    * The serializer which serializes the views result.
    *
-   * @var \Symfony\Component\Serializer\Serializer
+   * @var Serializer
    */
   protected $serializer;
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


3) modules/contrib/lunr/src/Plugin/views/display/LunrSearchIndex.php:59

    ---------- begin diff ----------
@@ @@
   /**
    * The renderer.
    *
-   * @var \Drupal\Core\Render\RendererInterface
+   * @var RendererInterface
    */
   protected $renderer;

@@ @@
    *   The plugin_id for the plugin instance.
    * @param mixed $plugin_definition
    *   The plugin implementation definition.
-   * @param \Drupal\Core\Routing\RouteProviderInterface $route_provider
+   * @param RouteProviderInterface $route_provider
    *   The route provider.
-   * @param \Drupal\Core\State\StateInterface $state
+   * @param StateInterface $state
    *   The state key value store.
-   * @param \Drupal\Core\Render\RendererInterface $renderer
+   * @param RendererInterface $renderer
    *   The renderer.
    */
   public function __construct(array $configuration, $plugin_id, $plugin_definition, RouteProviderInterface $route_provider, StateInterface $state, RendererInterface $renderer) {
@@ @@
     $response = new CacheableResponse('', 200);
     $build['#response'] = $response;

-    /** @var \Drupal\Core\Render\RendererInterface $renderer */
+    /** @var RendererInterface $renderer */
     $renderer = \Drupal::service('renderer');

     $output = (string) $renderer->renderRoot($build);
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


4) modules/contrib/lunr/src/Plugin/Block/LunrSearchBlock.php:26

    ---------- begin diff ----------
@@ @@
   /**
    * The entity type manager.
    *
-   * @var \Drupal\Core\Entity\EntityTypeManagerInterface
+   * @var EntityTypeManagerInterface
    */
   protected $entityTypeManager;

@@ @@
    *   The plugin_id for the plugin instance.
    * @param mixed $plugin_definition
    *   The plugin implementation definition.
-   * @param \Drupal\Core\Entity\EntityTypeManagerInterface $entity_type_manager
+   * @param EntityTypeManagerInterface $entity_type_manager
    *   The entity type manager.
    */
   public function __construct(array $configuration, $plugin_id, $plugin_definition, EntityTypeManagerInterface $entity_type_manager) {
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


5) modules/contrib/lunr/src/LunrSearchListBuilder.php:20

    ---------- begin diff ----------
@@ @@
   /**
    * The view entity storage.
    *
-   * @var \Drupal\Core\Entity\EntityStorageInterface
+   * @var EntityStorageInterface
    */
   protected $viewStorage;

@@ @@
   /**
    * The module handler.
    *
-   * @var \Drupal\Core\Extension\ModuleHandlerInterface
+   * @var ModuleHandlerInterface
    */
   protected $moduleHandler;

@@ @@
   /**
    * Constructs a new EntityListBuilder object.
    *
-   * @param \Drupal\Core\Entity\EntityTypeInterface $entity_type
+   * @param EntityTypeInterface $entity_type
    *   The entity type definition.
-   * @param \Drupal\Core\Entity\EntityStorageInterface $storage
+   * @param EntityStorageInterface $storage
    *   The entity storage class.
-   * @param \Drupal\Core\Entity\EntityStorageInterface $view_storage
+   * @param EntityStorageInterface $view_storage
    *   The view entity storage.
-   * @param \Drupal\Core\Extension\ModuleHandlerInterface $module_handler
+   * @param ModuleHandlerInterface $module_handler
    *   The module handler.
    */
   public function __construct(EntityTypeInterface $entity_type, EntityStorageInterface $storage, EntityStorageInterface $view_storage, ModuleHandlerInterface $module_handler) {
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


6) modules/contrib/lunr/src/LunrSearchInterface.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\lunr;

+use Drupal\views\ViewExecutable;
 use Drupal\Core\Config\Entity\ConfigEntityInterface;

 /**
@@ @@
   /**
    * Gets the view used by this search, using the correct display.
    *
-   * @return \Drupal\views\ViewExecutable
+   * @return ViewExecutable
    *   The view.
    */
   public function getView();
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector


7) modules/contrib/lunr/src/Form/LunrSearchEditForm.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\lunr\Form;

+use Drupal\lunr\LunrSearchInterface;
 use Drupal\Component\Utility\UrlHelper;
 use Drupal\Core\Entity\EntityForm;
 use Drupal\Core\Form\FormStateInterface;
@@ @@
   /**
    * The Lunr search being edited/created.
    *
-   * @var \Drupal\lunr\LunrSearchInterface
+   * @var LunrSearchInterface
    */
   protected $entity;

@@ @@
   /**
    * The route builder.
    *
-   * @var \Drupal\Core\Routing\RouteBuilderInterface
+   * @var RouteBuilderInterface
    */
   protected $routeBuilder;

@@ @@
   /**
    * The path validator.
    *
-   * @var \Drupal\Core\Path\PathValidatorInterface
+   * @var PathValidatorInterface
    */
   protected $pathValidator;

@@ @@
   /**
    * LunrSearchEditForm constructor.
    *
-   * @param \Drupal\Core\Routing\RouteBuilderInterface $route_builder
+   * @param RouteBuilderInterface $route_builder
    *   The route builder.
-   * @param \Drupal\Core\Path\PathValidatorInterface $path_validator
+   * @param PathValidatorInterface $path_validator
    *   The path validator.
    */
   public function __construct(RouteBuilderInterface $route_builder, PathValidatorInterface $path_validator) {
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


8) modules/contrib/lunr/src/EventSubscriber/TomePathSubscriber.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\lunr\EventSubscriber;

+use Drupal\Core\Entity\EntityStorageInterface;
+use Drupal\lunr\LunrSearchInterface;
 use Drupal\Core\Entity\EntityTypeManagerInterface;
 use Drupal\Core\File\FileSystemInterface;
 use Drupal\tome_static\Event\CollectPathsEvent;
@@ @@
   /**
    * The Lunr search entity storage.
    *
-   * @var \Drupal\Core\Entity\EntityStorageInterface
+   * @var EntityStorageInterface
    */
   protected $lunrSearchStorage;

@@ @@
   /**
    * The file system.
    *
-   * @var \Drupal\Core\File\FileSystemInterface
+   * @var FileSystemInterface
    */
   protected $fileSystem;

@@ @@
   /**
    * Constructs the EntityPathSubscriber object.
    *
-   * @param \Drupal\Core\Entity\EntityTypeManagerInterface $entity_type_manager
+   * @param EntityTypeManagerInterface $entity_type_manager
    *   The entity type manager.
-   * @param \Drupal\Core\File\FileSystemInterface $file_system
+   * @param FileSystemInterface $file_system
    *   The file system.
    */
   public function __construct(EntityTypeManagerInterface $entity_type_manager, FileSystemInterface $file_system) {
@@ @@
    *   The collect paths event.
    */
   public function collectPaths(CollectPathsEvent $event) {
-    /** @var \Drupal\lunr\LunrSearchInterface $search */
+    /** @var LunrSearchInterface $search */
     foreach ($this->lunrSearchStorage->loadMultiple() as $search) {
       $directory = dirname($search->getBaseIndexPath());
       if (!file_exists($directory)) {
@@ @@
         $event->addPath(file_create_url($filename), ['language_processed' => 'language_processed']);
       }
     }
-    $event->addPath(drupal_get_path('module', 'lunr') . '/js/search.worker.js', ['language_processed' => 'language_processed']);
-    $event->addPath(drupal_get_path('module', 'lunr') . '/js/vendor/lunr/lunr.min.js', ['language_processed' => 'language_processed']);
+    $event->addPath(\Drupal::service('extension.list.module')->getPath('lunr') . '/js/search.worker.js', ['language_processed' => 'language_processed']);
+    $event->addPath(\Drupal::service('extension.list.module')->getPath('lunr') . '/js/vendor/lunr/lunr.min.js', ['language_processed' => 'language_processed']);
   }

   /**
    ----------- end diff -----------

Applied rules:
 * DrupalGetPathRector
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector


9) modules/contrib/lunr/src/EventSubscriber/RouteSubscriber.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\lunr\EventSubscriber;

+use Drupal\lunr\LunrSearchInterface;
 use Drupal\Core\Entity\EntityTypeManagerInterface;
 use Drupal\Core\Routing\RouteBuildEvent;
 use Drupal\Core\Routing\RoutingEvents;
@@ @@
   /**
    * The entity type manager.
    *
-   * @var \Drupal\Core\Entity\EntityTypeManagerInterface
+   * @var EntityTypeManagerInterface
    */
   protected $entityTypeManager;

@@ @@
   /**
    * RouteSubscriber constructor.
    *
-   * @param \Drupal\Core\Entity\EntityTypeManagerInterface $entity_type_manager
+   * @param EntityTypeManagerInterface $entity_type_manager
    *   The entity type manager.
    */
   public function __construct(EntityTypeManagerInterface $entity_type_manager) {
@@ @@
   /**
    * Provides routes for Lunr searches.
    *
-   * @param \Drupal\Core\Routing\RouteBuildEvent $event
+   * @param RouteBuildEvent $event
    *   The route build event.
    */
   public function onDynamicRoutes(RouteBuildEvent $event) {
@@ @@
       '_permission' => 'access content',
       '_custom_access' => 'Drupal\lunr\Controller\LunrSearchController::access',
     ];
-    /** @var \Drupal\lunr\LunrSearchInterface $lunr_search */
+    /** @var LunrSearchInterface $lunr_search */
     foreach ($this->entityTypeManager->getStorage('lunr_search')->loadMultiple() as $lunr_search) {
       $collection->add('lunr_search.' . $lunr_search->id(), new Route($lunr_search->getPath(), [
         'lunr_search' => $lunr_search->id(),
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector


10) modules/contrib/lunr/src/Entity/LunrSearch.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\lunr\Entity;

+use Drupal\views\ViewEntityInterface;
+use Drupal\Core\Entity\EntityStorageInterface;
 use Drupal\Core\Cache\Cache;
 use Drupal\Core\Config\Entity\ConfigEntityBase;
 use Drupal\Core\Url;
@@ @@
    * {@inheritdoc}
    */
   public function getView() {
-    /** @var \Drupal\views\ViewEntityInterface $view */
+    /** @var ViewEntityInterface $view */
     if ($this->getViewId() && $this->getViewDisplayId() && $view = $this->viewStorage()->load($this->getViewId())) {
       $executable = $view->getExecutable();
       if (!$executable->setDisplay($this->getViewDisplayId())) {
@@ @@
   /**
    * Wraps the view storage.
    *
-   * @return \Drupal\Core\Entity\EntityStorageInterface
+   * @return EntityStorageInterface
    *   The view storage.
    */
   protected function viewStorage() {
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


11) modules/contrib/lunr/src/Controller/LunrSearchIndexController.php:18

    ---------- begin diff ----------
@@ @@
   /**
    * The file system.
    *
-   * @var \Drupal\Core\File\FileSystemInterface
+   * @var FileSystemInterface
    */
   protected $fileSystem;

@@ @@
   /**
    * Constructs a LunrSearchIndexController object.
    *
-   * @param \Drupal\Core\File\FileSystemInterface $fileSystem
+   * @param FileSystemInterface $fileSystem
    *   The file system.
    */
   public function __construct(FileSystemInterface $fileSystem) {
@@ @@
   /**
    * Provides a page to trigger the indexing process.
    *
-   * @param \Drupal\lunr\LunrSearchInterface $lunr_search
+   * @param LunrSearchInterface $lunr_search
    *   The Lunr search entity.
    *
    * @return array
@@ @@
   /**
    * Provides an upload route for index pages.
    *
-   * @param \Drupal\lunr\LunrSearchInterface $lunr_search
+   * @param LunrSearchInterface $lunr_search
    *   The Lunr search entity.
    * @param string $page
    *   The page number.
-   * @param \Symfony\Component\HttpFoundation\Request $request
+   * @param Request $request
    *   The current request.
    *
-   * @return \Symfony\Component\HttpFoundation\Response
+   * @return Response
    *   The response.
    */
   public function uploadPage(LunrSearchInterface $lunr_search, $page, Request $request) {
@@ @@
   /**
    * Provides an upload route for when the index is complete.
    *
-   * @param \Drupal\lunr\LunrSearchInterface $lunr_search
+   * @param LunrSearchInterface $lunr_search
    *   The Lunr search entity.
-   * @param \Symfony\Component\HttpFoundation\Request $request
+   * @param Request $request
    *   The current request.
    *
-   * @return \Symfony\Component\HttpFoundation\Response
+   * @return Response
    *   The response.
    */
   public function upload(LunrSearchInterface $lunr_search, Request $request) {
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


12) modules/contrib/lunr/src/Controller/LunrSearchController.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\lunr\Controller;

+use Drupal\Core\Access\AccessResultInterface;
 use Drupal\Component\Utility\Html;
 use Drupal\Core\Access\AccessResult;
 use Drupal\Core\Cache\CacheableMetadata;
@@ @@
   /**
    * Title callback for the search form.
    *
-   * @param \Drupal\lunr\LunrSearchInterface $lunr_search
+   * @param LunrSearchInterface $lunr_search
    *   The Lunr search entity.
    *
    * @return array
@@ @@

     $build['#attached']['library'][] = 'lunr/search';
     $build['#attached']['drupalSettings']['lunr']['searchSettings'][$lunr_search->id()] = [
-      'indexPath' => file_url_transform_relative(file_create_url($lunr_search->getIndexPath()) . '?v=' . $lunr_search->getLastIndexTime()),
-      'documentPathPattern' => file_url_transform_relative(file_create_url($lunr_search->getDocumentPathPattern()) . '?v=' . $lunr_search->getLastIndexTime()),
+      'indexPath' => \Drupal::service('file_url_generator')->transformRelative(\Drupal::service('file_url_generator')->generateAbsoluteString($lunr_search->getIndexPath()) . '?v=' . $lunr_search->getLastIndexTime()),
+      'documentPathPattern' => \Drupal::service('file_url_generator')->transformRelative(\Drupal::service('file_url_generator')->generateAbsoluteString($lunr_search->getDocumentPathPattern()) . '?v=' . $lunr_search->getLastIndexTime()),
       'displayField' => $lunr_search->getDisplayField(),
       'resultsPerPage' => $lunr_search->getResultsPerPage(),
       'id' => $lunr_search->id(),
     ];
     $suffix = '?' . \Drupal::state()->get('system.css_js_query_string', '0');
-    $build['#attached']['drupalSettings']['lunr']['workerPath'] = base_path() . drupal_get_path('module', 'lunr') . '/js/search.worker.js' . $suffix;
-    $build['#attached']['drupalSettings']['lunr']['lunrPath'] = base_path() . drupal_get_path('module', 'lunr') . '/js/vendor/lunr/lunr.min.js' . $suffix;
+    $build['#attached']['drupalSettings']['lunr']['workerPath'] = base_path() . \Drupal::service('extension.list.module')->getPath('lunr') . '/js/search.worker.js' . $suffix;
+    $build['#attached']['drupalSettings']['lunr']['lunrPath'] = base_path() . \Drupal::service('extension.list.module')->getPath('lunr') . '/js/vendor/lunr/lunr.min.js' . $suffix;

     CacheableMetadata::createFromObject($lunr_search)->applyTo($build);

@@ @@
   /**
    * Title callback for the search form.
    *
-   * @param \Drupal\lunr\LunrSearchInterface $lunr_search
+   * @param LunrSearchInterface $lunr_search
    *   The Lunr search entity.
    *
    * @return string
@@ @@
   /**
    * Determines access for the search page.
    *
-   * @param \Drupal\lunr\LunrSearchInterface $lunr_search
+   * @param LunrSearchInterface $lunr_search
    *   The Lunr search entity.
    *
-   * @return \Drupal\Core\Access\AccessResultInterface
+   * @return AccessResultInterface
    *   The access result.
    */
   public function access(LunrSearchInterface $lunr_search) {
    ----------- end diff -----------

Applied rules:
 * DrupalGetPathRector
 * FileCreateUrlRector
 * FileUrlTransformRelativeRector
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


13) modules/contrib/lunr/lunr.api.php:10

    ---------- begin diff ----------
@@ @@
  * @addtogroup hooks
  * @{
  */
-
 /**
  * Alters a Lunr search page.
  *
  * @param array $build
  *   The Lunr search page build.
- * @param \Drupal\lunr\LunrSearchInterface $lunr_search
+ * @param LunrSearchInterface $lunr_search
  *   The Lunr search entity.
  */
 function hook_lunr_search_page_alter(array &$build, LunrSearchInterface $lunr_search) {
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector


 [OK] 13 files have been changed by Rector                                      

