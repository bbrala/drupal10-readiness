modules/contrib/subrequests/src/Blueprint/BlueprintManager.php
modules/contrib/subrequests/src/Controller/FrontController.php
modules/contrib/subrequests/src/JsonPathReplacer.php
modules/contrib/subrequests/src/Normalizer/JsonBlueprintDenormalizer.php
modules/contrib/subrequests/src/Normalizer/JsonSubrequestDenormalizer.php
modules/contrib/subrequests/src/Normalizer/MultiresponseJsonNormalizer.php
modules/contrib/subrequests/src/Normalizer/MultiresponseNormalizer.php
modules/contrib/subrequests/src/Subrequest.php
modules/contrib/subrequests/src/SubrequestsManager.php
modules/contrib/subrequests/src/SubrequestsTree.php
modules/contrib/subrequests/tests/src/Unit/Blueprint/BlueprintManagerTest.php
modules/contrib/subrequests/tests/src/Unit/JsonPathReplacerTest.php
modules/contrib/subrequests/tests/src/Unit/Normalizer/JsonBlueprintDenormalizerTest.php
modules/contrib/subrequests/tests/src/Unit/Normalizer/JsonSubrequestDenormalizerTest.php
modules/contrib/subrequests/tests/src/Unit/Normalizer/MultiresponseJsonNormalizerTest.php
modules/contrib/subrequests/tests/src/Unit/Normalizer/MultiresponseNormalizerTest.php
modules/contrib/subrequests/tests/src/Unit/SubrequestsManagerTest.php
modules/contrib/subrequests/tests/src/Unit/SubrequestsTreeTest.php

14 files with changes
=====================

1) modules/contrib/subrequests/tests/src/Unit/SubrequestsManagerTest.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\Tests\subrequests\Unit;

+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\subrequests\JsonPathReplacer;
 use Drupal\subrequests\Normalizer\JsonSubrequestDenormalizer;
 use Drupal\subrequests\Subrequest;
@@ @@
  */
 class SubrequestsManagerTest extends UnitTestCase {

+  use ProphecyTrait;
   /**
-   * @var \Drupal\subrequests\SubrequestsManager
+   * @var SubrequestsManager
    */
   protected $sut;

-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
     $http_kernel = $this->prophesize(HttpKernelInterface::class);
     $http_kernel
    ----------- end diff -----------

Applied rules:
 * ExceptionAnnotationRector
 * AddProphecyTraitRector
 * RemoveDataProviderTestPrefixRector
 * ArgumentRemoverRector
 * RenameAnnotationRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddReturnTypeDeclarationRector
 * ChangeMethodVisibilityRector


2) modules/contrib/subrequests/tests/src/Unit/Normalizer/MultiresponseNormalizerTest.php:12

    ---------- begin diff ----------
@@ @@
 class MultiresponseNormalizerTest extends UnitTestCase {

   /**
-   * @var \Drupal\subrequests\Normalizer\MultiresponseNormalizer
+   * @var MultiresponseNormalizer
    */
   protected $sut;

-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
     $this->sut = new MultiresponseNormalizer();
   }
@@ @@
     $delimiter = substr($parts['boundary'], 1, strlen($parts['boundary']) - 2);
     $this->assertStringStartsWith('--' . $delimiter, $actual['content']);
     $this->assertStringEndsWith('--' . $delimiter . '--', $actual['content']);
-    $this->assertRegExp("/\r\nFoo!\r\n/", $actual['content']);
-    $this->assertRegExp("/\r\nBar\r\n/", $actual['content']);
+    $this->assertMatchesRegularExpression("/\r\nFoo!\r\n/", $actual['content']);
+    $this->assertMatchesRegularExpression("/\r\nBar\r\n/", $actual['content']);
   }

 }
    ----------- end diff -----------

Applied rules:
 * ExceptionAnnotationRector
 * RemoveDataProviderTestPrefixRector
 * ArgumentRemoverRector
 * RenameAnnotationRector
 * PseudoNamespaceToNamespaceRector
 * RenameMethodRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * AddReturnTypeDeclarationRector
 * ChangeMethodVisibilityRector


3) modules/contrib/subrequests/tests/src/Unit/Normalizer/MultiresponseJsonNormalizerTest.php:13

    ---------- begin diff ----------
@@ @@
 class MultiresponseJsonNormalizerTest extends UnitTestCase {

   /**
-   * @var \Drupal\subrequests\Normalizer\MultiresponseJsonNormalizer
+   * @var MultiresponseJsonNormalizer
    */
   protected $sut;

-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
     $this->sut = new MultiresponseJsonNormalizer();
   }
    ----------- end diff -----------

Applied rules:
 * ExceptionAnnotationRector
 * RemoveDataProviderTestPrefixRector
 * ArgumentRemoverRector
 * RenameAnnotationRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * AddReturnTypeDeclarationRector
 * ChangeMethodVisibilityRector


4) modules/contrib/subrequests/tests/src/Unit/Normalizer/JsonSubrequestDenormalizerTest.php:15

    ---------- begin diff ----------
@@ @@
 class JsonSubrequestDenormalizerTest extends UnitTestCase {

   /**
-   * @var \Drupal\subrequests\Normalizer\JsonSubrequestDenormalizer
+   * @var JsonSubrequestDenormalizer
    */
   protected $sut;

-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
     $this->sut = new JsonSubrequestDenormalizer();
   }
    ----------- end diff -----------

Applied rules:
 * ExceptionAnnotationRector
 * RemoveDataProviderTestPrefixRector
 * AssertEqualsParameterToSpecificMethodsTypeRector
 * ArgumentRemoverRector
 * RenameAnnotationRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * AddReturnTypeDeclarationRector
 * ChangeMethodVisibilityRector


5) modules/contrib/subrequests/tests/src/Unit/Normalizer/JsonBlueprintDenormalizerTest.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\Tests\subrequests\Normalizer;

+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\subrequests\Normalizer\JsonBlueprintDenormalizer;
 use Drupal\subrequests\Subrequest;
 use Drupal\subrequests\SubrequestsTree;
@@ @@
  */
 class JsonBlueprintDenormalizerTest extends UnitTestCase {

+  use ProphecyTrait;
   /**
-   * @var \Drupal\subrequests\Normalizer\JsonBlueprintDenormalizer
+   * @var JsonBlueprintDenormalizer
    */
   protected $sut;

-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
     $logger = $this->prophesize(LoggerInterface::class);
     $this->sut = new JsonBlueprintDenormalizer($logger->reveal());
    ----------- end diff -----------

Applied rules:
 * ExceptionAnnotationRector
 * AddProphecyTraitRector
 * RemoveDataProviderTestPrefixRector
 * AssertEqualsParameterToSpecificMethodsTypeRector
 * ArgumentRemoverRector
 * RenameAnnotationRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * AddReturnTypeDeclarationRector
 * ChangeMethodVisibilityRector


6) modules/contrib/subrequests/tests/src/Unit/JsonPathReplacerTest.php:13

    ---------- begin diff ----------
@@ @@
 class JsonPathReplacerTest extends UnitTestCase {

   /**
-   * @var \Drupal\subrequests\JsonPathReplacer
+   * @var JsonPathReplacer
    */
   protected $sut;

-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
     $this->sut = new JsonPathReplacer();
   }
@@ @@

     $actual = $this->sut->replaceBatch($batch, $responses);

-    $this->assertInternalType('int', $actual[0]->body['You are number']);
-    $this->assertInternalType('string', $actual[0]->body['Where am I']);
-    $this->assertInternalType('boolean', $actual[0]->body['World of number two']);
-    $this->assertInternalType('string', $actual[0]->body['Question']);
-    $this->assertInternalType('float', $actual[0]->body['Michael']);
+    $this->assertIsInt($actual[0]->body['You are number']);
+    $this->assertIsString($actual[0]->body['Where am I']);
+    $this->assertIsBool($actual[0]->body['World of number two']);
+    $this->assertIsString($actual[0]->body['Question']);
+    $this->assertIsFloat($actual[0]->body['Michael']);
   }

 }
    ----------- end diff -----------

Applied rules:
 * ExceptionAnnotationRector
 * RemoveDataProviderTestPrefixRector
 * AssertEqualsParameterToSpecificMethodsTypeRector
 * SpecificAssertInternalTypeRector
 * ArgumentRemoverRector
 * RenameAnnotationRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddReturnTypeDeclarationRector
 * ChangeMethodVisibilityRector


7) modules/contrib/subrequests/tests/src/Unit/Blueprint/BlueprintManagerTest.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\Tests\subrequests\Unit\Blueprint;

+use Prophecy\PhpUnit\ProphecyTrait;
 use Drupal\Core\Cache\CacheableResponse;
 use Drupal\subrequests\Blueprint\BlueprintManager;
 use Drupal\subrequests\Normalizer\JsonBlueprintDenormalizer;
@@ @@
  */
 class BlueprintManagerTest extends UnitTestCase {

+  use ProphecyTrait;
   /**
-   * @var \Drupal\subrequests\Blueprint\BlueprintManager
+   * @var BlueprintManager
    */
   protected $sut;

-  protected function setUp() {
+  protected function setUp(): void {
     parent::setUp();
     $denormalizer = $this->prophesize(JsonBlueprintDenormalizer::class);
     $denormalizer->denormalize(Argument::type('array'), SubrequestsTree::class, 'json', [])
    ----------- end diff -----------

Applied rules:
 * ExceptionAnnotationRector
 * AddProphecyTraitRector
 * RemoveDataProviderTestPrefixRector
 * ArgumentRemoverRector
 * RenameAnnotationRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddReturnTypeDeclarationRector
 * ChangeMethodVisibilityRector


8) modules/contrib/subrequests/src/SubrequestsTree.php:11

    ---------- begin diff ----------
@@ @@
   /**
    * The master request.
    *
-   * @var \Symfony\Component\HttpFoundation\Request
+   * @var Request
    */
   protected $masterRequest;

@@ @@
   /**
    * Adds a sequence of subrequests to the stack.
    *
-   * @param \Drupal\subrequests\Subrequest[] $subrequests
+   * @param Subrequest[] $subrequests
    */
   public function stack($subrequests) {
     // Make sure we only push Subrequest objects.
@@ @@
   /**
    * Gets the lowest level.
    *
-   * @return \Drupal\subrequests\Subrequest[]
+   * @return Subrequest[]
    *   The subrequests in the level.
    */
   public function getLowestLevel() {
@@ @@
   }

   /**
-   * Gets the master request.
-   *
-   * @return \Symfony\Component\HttpFoundation\Request $request
-   *   The request.
-   */
+  * Gets the master request.
+  *
+   * @return Request $request
+    The request.
+  */
   public function getMasterRequest() {
     return $this->masterRequest;
   }
@@ @@
   /**
    * Sets the master request.
    *
-   * @param \Symfony\Component\HttpFoundation\Request $request
+   * @param Request $request
    *   The request.
    */
   public function setMasterRequest(Request $request) {
@@ @@
   /**
    * Gets all the subrequest IDs.
    *
-   * @return \Drupal\subrequests\Subrequest[]
+   * @return Subrequest[]
    *   All the subrequests in all levels.
    */
   public function allIds() {
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


9) modules/contrib/subrequests/src/SubrequestsManager.php:11

    ---------- begin diff ----------
@@ @@
   /**
    * The kernel.
    *
-   * @var \Symfony\Component\HttpKernel\HttpKernelInterface
+   * @var HttpKernelInterface
    */
   protected $httpKernel;

@@ @@
   /**
    * The serializer.
    *
-   * @var \Symfony\Component\HttpKernel\HttpKernelInterface
+   * @var HttpKernelInterface
    */
   protected $serializer;

@@ @@
   /**
    * The path replacer.
    *
-   * @var \Drupal\subrequests\JsonPathReplacer
+   * @var JsonPathReplacer
    */
   protected $replacer;

@@ @@
   }

   /**
-   * Processes all the Subrequests until produce a collection of responses.
-   *
-   * @param \Drupal\subrequests\SubrequestsTree $tree
-   *   The request tree that contains the requesting structure.
-   * @param int $_sequence
-   *   (internal) The current index in the sequential chain.
-   * @param \Symfony\Component\HttpFoundation\Response[] $_responses
-   *   (internal) The list of responses accumulated so far.
-   *
-   * @return \Symfony\Component\HttpFoundation\Response[]
-   *   An array of responses when everything has been resolved.
-   */
+    * Processes all the Subrequests until produce a collection of responses.
+    *
+    * @param SubrequestsTree $tree
+    *   The request tree that contains the requesting structure.
+    * @param int $_sequence
+    *   (internal) The current index in the sequential chain.
+    * @param Response[] $_responses
+    *   (internal) The list of responses accumulated so far.
+    *
+    * @return Response[]
+    *   An array of responses when everything has been resolved.
+    */
    protected function processBatchesSequence($tree, $_sequence = 0, array $_responses = []) {
      $batch = $tree[$_sequence];
      // Perform all the necessary replacements for the elements in the batch.
@@ @@
      $results = array_map(function (Subrequest $subrequest) use ($tree) {
        $master_request = $tree->getMasterRequest();
        // Create a Symfony Request object based on the Subrequest.
-       /** @var \Symfony\Component\HttpFoundation\Request $request */
+       /** @var Request $request */
        $request = $this->serializer->denormalize(
          $subrequest,
          Request::class,
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector


10) modules/contrib/subrequests/src/Normalizer/JsonSubrequestDenormalizer.php:26

    ---------- begin diff ----------
@@ @@
    * @return object
    */
   public function denormalize($data, $class, $format = NULL, array $context = []) {
-    /** @var \Drupal\subrequests\Subrequest $data */
+    /** @var Subrequest $data */
     $path = parse_url($data->uri, PHP_URL_PATH);
     $query = parse_url($data->uri, PHP_URL_QUERY) ?: [];
     if (isset($query) && !is_array($query)) {
@@ @@
       $query = $_query;
     }

-    /** @var \Symfony\Component\HttpFoundation\Request $master_request */
+    /** @var Request $master_request */
     $master_request = $context['master_request'];

     $request = Request::create(
@@ @@
   /**
    * Adds the decoded username and password headers for Basic Auth.
    *
-   * @param \Symfony\Component\HttpFoundation\Request $request
+   * @param Request $request
    *   The request to fix.
    */
   protected static function fixBasicAuth(Request $request) {
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector


11) modules/contrib/subrequests/src/Normalizer/JsonBlueprintDenormalizer.php:20

    ---------- begin diff ----------
@@ @@
 class JsonBlueprintDenormalizer implements DenormalizerInterface, SerializerAwareInterface {

   /**
-   * @var \Symfony\Component\Serializer\Serializer
+   * @var Serializer
    */
   protected $serializer;

@@ @@
   /**
    * The Subrequests logger channel.
    *
-   * @var \Psr\Log\LoggerInterface
+   * @var LoggerInterface
    */
   protected $logger;

@@ @@
    *
    * This property will only be set if the validator library is available.
    *
-   * @var \JsonSchema\Validator|null
+   * @var Validator|null
    */
   protected $validator;

@@ @@
    * executed. All the IDs in the same position in the sequence can be executed
    * in parallel.
    *
-   * @param \Drupal\subrequests\Subrequest[] $parsed
+   * @param Subrequest[] $parsed
    *   The parsed requests.
    *
    * @return SubrequestsTree
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector


12) modules/contrib/subrequests/src/JsonPathReplacer.php:11

    ---------- begin diff ----------
@@ @@
   /**
    * Performs the JSON Path replacements in the whole batch.
    *
-   * @param \Drupal\subrequests\Subrequest[] $batch
+   * @param Subrequest[] $batch
    *   The subrequests that contain replacement tokens.
-   * @param \Symfony\Component\HttpFoundation\Response[] $responses
+   * @param Response[] $responses
    *   The accumulated responses from previous requests.
    *
-   * @return \Drupal\subrequests\Subrequest[]
+   * @return Subrequest[]
    *   An array of subrequests. Note that one input subrequest can generate N
    *   output subrequests. This is because JSON path expressinos can return
    *   multiple values.
@@ @@
    * Searches for JSONPath tokens in the request and replaces it with the values
    * from previous responses.
    *
-   * @param \Drupal\subrequests\Subrequest $subrequest
+   * @param Subrequest $subrequest
    *   The list of requests that can contain tokens.
-   * @param \Symfony\Component\HttpFoundation\Response[] $pool
+   * @param Response[] $pool
    *   The pool of responses that can content the values to replace.
    *
    * @returns \Drupal\subrequests\Subrequest[]
@@ @@
    *
    * @param array $token_replacements
    *   Holds the info to replace text.
-   * @param \Drupal\subrequests\Subrequest $tokenized_subrequest
+   * @param Subrequest $tokenized_subrequest
    *   The original copy of the subrequest.
    * @param string $token_location
    *   Either 'body' or 'uri'.
@@ @@
    * a response for the initial request, given a particular subject for a
    * particular JSONPath replacement.
    *
-   * @param \Drupal\subrequests\Subrequest $subrequest
+   * @param Subrequest $subrequest
    *   The subrequest that contains the tokens.
    * @param string $token_location
    *   Indicates if we are dealing with body or URI replacements.
@@ @@
    *
    * Removes all the derived indicators and the surrounding angles.
    *
-   * @param \Symfony\Component\HttpFoundation\Response $response
+   * @param Response $response
    *   The response to extract the Content ID from.
    *
    * @returns string
@@ @@
    *
    * @param array $match
    *   The structured replacement token.
-   * @param \Symfony\Component\HttpFoundation\Response $subject
+   * @param Response $subject
    *   The response object the token refers to.
    * @param array $token_replacements
    *   The accumulated replacements. Adds items onto the array.
@@ @@
    * @param array $to_replace
    *   The replacement candidates.
    *
-   * @throws \Symfony\Component\HttpKernel\Exception\BadRequestHttpException
+   * @throws BadRequestHttpException
    *   When the replacements are not valid.
    */
   protected function validateJsonPathReplacements($to_replace) {
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector


13) modules/contrib/subrequests/src/Controller/FrontController.php:16

    ---------- begin diff ----------
@@ @@
 class FrontController extends ControllerBase {

   /**
-   * @var \Drupal\subrequests\Blueprint\BlueprintManager
+   * @var BlueprintManager
    */
   protected $blueprintManager;

   /**
-   * @var \Drupal\subrequests\SubrequestsManager
+   * @var SubrequestsManager
    */
   protected $subrequestsManager;
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


14) modules/contrib/subrequests/src/Blueprint/BlueprintManager.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\subrequests\Blueprint;

+use Symfony\Component\Serializer\SerializerInterface;
 use Drupal\Core\Cache\CacheableResponse;
 use Drupal\Core\Cache\CacheableResponseInterface;
 use Drupal\subrequests\SubrequestsTree;
@@ @@
   /**
    * The deserializer.
    *
-   * @var \Symfony\Component\Serializer\SerializerInterface
+   * @var SerializerInterface
    */
   protected $serializer;

@@ @@
    * @param string $input
    *   The input from the user.
    *
-   * @return \Drupal\subrequests\SubrequestsTree
+   * @return SubrequestsTree
    */
   public function parse($input, Request $request) {
-    /** @var \Drupal\subrequests\SubrequestsTree $output */
+    /** @var SubrequestsTree $output */
     $output = $this->serializer
       ->deserialize($input, SubrequestsTree::class, 'json');
     $output->setMasterRequest($request);
@@ @@
   }

   /**
-   * @param \Symfony\Component\HttpFoundation\Response[] $responses
+   * @param Response[] $responses
    *   The responses to combine.
    * @param string $format
    *   The format to combine the responses on. Default is multipart/related.
    *
-   * @return \Symfony\Component\HttpFoundation\Response
+   * @return Response
    *   The combined response with a 207.
    */
   public function combineResponses(array $responses, $format) {
@@ @@
    * Checks if all responses have the same Content-Type header. If they do, then
    * it returns that one. If not, it defaults to 'application/json'.
    *
-   * @param \Symfony\Component\HttpFoundation\Response[] $responses
+   * @param Response[] $responses
    *   The responses.
    *
    * @return string
@@ @@
    *
    * @param string $name
    *   The header name to forward.
-   * @param \Symfony\Component\HttpFoundation\Request $from
+   * @param Request $from
    *   The request to copy headers from.
-   * @param \Drupal\subrequests\SubrequestsTree $tree
+   * @param SubrequestsTree $tree
    *   The target request to copy headers to.
    */
   protected function forwardHeader($name, Request $from, SubrequestsTree $tree) {
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector


 [OK] 14 files have been changed by Rector                                      

