modules/contrib/filebrowser/filebrowser.install
modules/contrib/filebrowser/filebrowser.module
modules/contrib/filebrowser/filebrowser.theme.inc
modules/contrib/filebrowser/modules/src/EventSubscriber/MetadataEventSubscriber.php
modules/contrib/filebrowser/modules/src/EventSubscriber/MetadataInfoEventSubscriber.php
modules/contrib/filebrowser/src/Access/FilebrowserAccessCheck.php
modules/contrib/filebrowser/src/Breadcrumb/BreadcrumbBuilder.php
modules/contrib/filebrowser/src/Controller/DefaultController.php
modules/contrib/filebrowser/src/Element/FilebrowserManagedFile.php
modules/contrib/filebrowser/src/Entity/FilebrowserMetadataEntity.php
modules/contrib/filebrowser/src/Entity/FilebrowserMetadataEntityAccessControlHandler.php
modules/contrib/filebrowser/src/Entity/FilebrowserMetadataEntityInterface.php
modules/contrib/filebrowser/src/EventSubscriber/MetadataEventSubscriber.php
modules/contrib/filebrowser/src/EventSubscriber/MetadataInfoEventSubscriber.php
modules/contrib/filebrowser/src/EventSubscriber/UserActionsEventSubscriber.php
modules/contrib/filebrowser/src/Events/MetadataEvent.php
modules/contrib/filebrowser/src/Events/MetadataInfo.php
modules/contrib/filebrowser/src/Events/UserActionsEvent.php
modules/contrib/filebrowser/src/File/DisplayFile.php
modules/contrib/filebrowser/src/File/DisplayFileList.php
modules/contrib/filebrowser/src/Filebrowser.php
modules/contrib/filebrowser/src/FilebrowserManager.php
modules/contrib/filebrowser/src/FilebrowserPermissions.php
modules/contrib/filebrowser/src/FilebrowserUninstallValidator.php
modules/contrib/filebrowser/src/Form/ActionForm.php
modules/contrib/filebrowser/src/Form/DeleteForm.php
modules/contrib/filebrowser/src/Form/DescriptionForm.php
modules/contrib/filebrowser/src/Form/FilebrowserConfigForm.php
modules/contrib/filebrowser/src/Form/FolderForm.php
modules/contrib/filebrowser/src/Form/GridActionForm.php
modules/contrib/filebrowser/src/Form/InlineDescriptionForm.php
modules/contrib/filebrowser/src/Form/RenameForm.php
modules/contrib/filebrowser/src/Form/UploadForm.php
modules/contrib/filebrowser/src/Grid/Grid.php
modules/contrib/filebrowser/src/Presentation.php
modules/contrib/filebrowser/src/ServerFileList.php
modules/contrib/filebrowser/src/Services/Common.php
modules/contrib/filebrowser/src/Services/FilebrowserStorage.php
modules/contrib/filebrowser/src/Services/FilebrowserValidator.php
modules/contrib/filebrowser/src/Services/FormHelper.php
modules/contrib/filebrowser/src/Statistics.php

20 files with changes
=====================

1) modules/contrib/filebrowser/src/Services/FilebrowserStorage.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\filebrowser\Services;

+use Drupal\Core\Database\StatementInterface;
 use Drupal\Core\Database\Connection;

 class FilebrowserStorage {
@@ @@
   /**
    * Database Service Object.
    *
-   * @var \Drupal\Core\Database\Connection
+   * @var Connection
    */
   protected $connection;

@@ @@
   /**
    * Constructs a BookOutlineStorage object.
    *
-   * @param \Drupal\Core\Database\Connection $connection
+   * @param Connection $connection
    */
   public function __construct(Connection $connection) {
     $this->connection = $connection;
@@ @@
    * @param mixed $key_value
    * @param string $field_name Field who's value to change
    * @param mixed $value New value
-   * @return \Drupal\Core\Database\StatementInterface|int|null
+   * @return StatementInterface|int|null
    */
   public function updateContentField($key, $key_value, $field_name, $value) {
     return
@@ @@
   }

   /**
-   * @param array $data   [$fid] => $description
-   * @return \Drupal\Core\Database\StatementInterface|int|null
-   */
+     * @param array $data   [$fid] => $description
+     * @return StatementInterface|int|null
+     */
     public function storeDescriptionMultiple($data) {
       //var_dump($data);
       $query = "UPDATE {filebrowser_content} SET description = :description WHERE fid = :fid";
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector


2) modules/contrib/filebrowser/src/Services/Common.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\filebrowser\Services;

+use Drupal\filebrowser\Filebrowser;
 use Drupal\Core\Controller\ControllerBase;
 use Drupal\Core\Link;
 use Drupal\Core\Routing\RouteMatchInterface;
@@ @@

   /**
    * Common constructor.
-   * @param \Drupal\filebrowser\Services\FilebrowserStorage $storage
+   * @param FilebrowserStorage $storage
    */
   public function __construct(FilebrowserStorage $storage) {
     $this->storage = $storage;
@@ @@
    * @return array
    */
   public function userAllowedActions($node) {
-    /** @var \Drupal\filebrowser\Filebrowser $filebrowser */
+    /** @var Filebrowser $filebrowser */
     $actions = [];
     $account = \Drupal::currentUser();
     $filebrowser = $node->filebrowser;
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


3) modules/contrib/filebrowser/src/ServerFileList.php:32

    ---------- begin diff ----------
@@ @@

   /**
    * ServerFileList constructor.
-   * @param \Drupal\node\NodeInterface $node
+   * @param NodeInterface $node
    * @param string $relative_path
    */
   public function __construct(NodeInterface $node, $relative_path) {
@@ @@

     foreach ($files as $key => $file) {

-      $file->url = file_create_url($file->uri);
+      $file->url = \Drupal::service('file_url_generator')->generateAbsoluteString($file->uri);
       // Complete the required file data

       $file->mimetype = $guessor->guess($file->filename);
    ----------- end diff -----------

Applied rules:
 * FileCreateUrlRector
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector


4) modules/contrib/filebrowser/src/Presentation.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\filebrowser;

+use Drupal\Core\Image\Image;
+use Drupal\Core\StringTranslation\TranslatableMarkup;
 use Drupal\Core\Controller\ControllerBase;
 use Drupal\Core\Utility\TableSort;
 use Drupal\filebrowser\Entity\FilebrowserMetadataEntity;
@@ @@
 class Presentation extends ControllerBase{

   /**
-   * @var \Drupal\filebrowser\Filebrowser;
+   * @var Filebrowser ;
    */
   protected $filebrowser;

@@ @@
   protected $fsFileList;

   /**
-   * @var \Drupal\node\NodeInterface
+   * @var NodeInterface
    */
   protected $node;

   /**
-   * @var \Drupal\filebrowser\Services\Common $common
+   * @var Common $common
    */
   protected $common;

@@ @@
    * @param array $list
    */
   public function __construct(NodeInterface $node, array $list) {
-    /** @var \Drupal\filebrowser\Filebrowser $filebrowser */
+    /** @var Filebrowser $filebrowser */
     $this->common = \Drupal::service('filebrowser.common');
     $this->node = $node;
     $this->filebrowser = $node->filebrowser;
@@ @@

   public function iconView() {
     /**
-     * @var \Drupal\Core\Image\Image $thumbnail
-     * @var \Drupal\filebrowser\Grid\Grid  $grid_table
+     * @var Image $thumbnail
+     * @var Grid $grid_table
      * @var DisplayFile $data
      */
     $list_data = $this->dbFileList['data'];
@@ @@
         // ##### ICON COLUMN #####
         $visible_columns[Common::ICON] = true;
         $icon = $this->common->iconGenerate($file->fileData->type, $file->fileData->mimetype, 24, 24);
-        $unsorted_rows[$file_name][Common::ICON] = render($icon);
+        $unsorted_rows[$file_name][Common::ICON] = \Drupal::service('renderer')->render($icon);
       }

       // ##### NAME COLUMN - we will always set the name column
       // fixme: delete not needed
-      $unsorted_rows[$file_name][Common::NAME] = render($file->link);
+      $unsorted_rows[$file_name][Common::NAME] = \Drupal::service('renderer')->render($file->link);
       $visible_columns[Common::NAME] = true;

       // ##### SET OTHER METADATA
@@ @@
             $render = [];
             $render['#theme'] = $theme;
             $render['#data'] = $content;
-            $unsorted_rows[$file_name][$name] = render($render);
+            $unsorted_rows[$file_name][$name] = \Drupal::service('renderer')->render($render);
           }
         }
       }
@@ @@

   private function buildHeader(&$header, &$unsorted_rows, $visible_columns, $column_names, $default_sort, $sort_order) {
     /**
-     * @var \Drupal\Core\StringTranslation\TranslatableMarkup  $specs
+     * @var TranslatableMarkup $specs
      */
-
     foreach ($column_names as $column_name => $column_spec) {
       if (isset($visible_columns[$column_name]) && $visible_columns[$column_name]) {
         if ($column_name == Common::ICON) {
    ----------- end diff -----------

Applied rules:
 * RenderRector
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


5) modules/contrib/filebrowser/src/Form/UploadForm.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\filebrowser\Form;

+use Drupal\filebrowser\Services\Common;
 use Drupal\Core\Form\FormBase;
 use Drupal\Core\Form\FormStateInterface;
 use Drupal\Core\Cache\Cache;
@@ @@
   protected $nid;

   /**
-   * @var \Drupal\filebrowser\Services\Common
+   * @var Common
    */
   protected $common;
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


6) modules/contrib/filebrowser/src/Form/RenameForm.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\filebrowser\Form;

+use Drupal\node\NodeInterface;
+use Drupal\filebrowser\Filebrowser;
+use Drupal\filebrowser\Services\FilebrowserStorage;
+use Drupal\filebrowser\Services\Common;
+use Drupal\filebrowser\Services\FilebrowserValidator;
 use Drupal\Core\Cache\Cache;
 use Drupal\Core\Form\ConfirmFormBase;
 use Drupal\Core\Form\FormStateInterface;
@@ @@
   /**
    * The node holding the dir-listing.
    *
-   * @var \Drupal\node\NodeInterface
+   * @var NodeInterface
    */
   protected $node;

@@ @@
   /**
    * Filebrowser object holds specific data
    *
-   * @var \Drupal\filebrowser\Filebrowser
+   * @var Filebrowser
    */
   protected $filebrowser;

   /**
-   * @var \Drupal\filebrowser\Services\FilebrowserStorage
+   * @var FilebrowserStorage
    */
   protected $storage;

@@ @@
   protected $oldNames;

   /**
-   * @var \Drupal\filebrowser\Services\Common
+   * @var Common
    */
   public $common;

@@ @@
   }

   public function buildForm(array $form, FormStateInterface $form_state, $nid = null, $query_fid = null, $fids_str = null, $ajax = null) {
-    /** @var \Drupal\filebrowser\Services\FilebrowserValidator $validate */
+    /** @var FilebrowserValidator $validate */
     $this->common = \Drupal::service('filebrowser.common');
     $this->storage = \Drupal::service('filebrowser.storage');
     $this->node = Node::load($nid);
@@ @@
     $file->uri = $uri;
     $file->filename = \Drupal::service('file_system')->basename($uri);
     $file->name = pathinfo($file->filename, PATHINFO_FILENAME);
-    $file->url = file_create_url($file->uri);
+    $file->url = \Drupal::service('file_url_generator')->generateAbsoluteString($file->uri);
   }

 }
    ----------- end diff -----------

Applied rules:
 * FileCreateUrlRector
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


7) modules/contrib/filebrowser/src/Form/GridActionForm.php:61

    ---------- begin diff ----------
@@ @@
   /**
    * {@inheritdoc}
    */
-
   /**
-   * @var \Drupal\filebrowser\Services\Common
+   * @var Common
    */
   protected $common;

@@ @@
         }
         else {
           $form['container'][$row_name][$col_name][$content['content']['file']->fid] = [
-            '#markup' => render($content['content']['grid']),
+            '#markup' => \Drupal::service('renderer')->render($content['content']['grid']),
           ];
         }
       }
    ----------- end diff -----------

Applied rules:
 * RenderRector
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


8) modules/contrib/filebrowser/src/Form/FolderForm.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\filebrowser\Form;

+use Drupal\node\NodeInterface;
+use Drupal\filebrowser\Services\Common;
 use Drupal\Core\Cache\Cache;
 use Drupal\Core\File\FileSystemInterface;
 use Drupal\Core\Form\FormBase;
@@ @@
   protected $relativeFid;

   /**
-   * @var \Drupal\node\NodeInterface
+   * @var NodeInterface
    */
   protected $node;

@@ @@
   protected $relativeRoot;

   /**
-   * @var \Drupal\filebrowser\Services\Common
+   * @var Common
    */
   protected $common;
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


9) modules/contrib/filebrowser/src/Form/DescriptionForm.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\filebrowser\Form;

+use Drupal\filebrowser\Services\Common;
+use Drupal\filebrowser\Services\FilebrowserStorage;
 use Drupal\Core\Form\FormBase;
 use Drupal\Core\Form\FormStateInterface;
 use Drupal\filebrowser\Entity\FilebrowserMetadataEntity;
@@ @@
   protected $nid;
   protected $queryFid;
   /**
-   * @var \Drupal\filebrowser\Services\Common
+   * @var Common
    */
   protected $common;

   /**
-   * @var \Drupal\filebrowser\Services\FilebrowserStorage
+   * @var FilebrowserStorage
    */
   protected $storage;
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


10) modules/contrib/filebrowser/src/Form/DeleteForm.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\filebrowser\Form;

+use Drupal\node\NodeInterface;
+use Drupal\filebrowser\Services\Common;
+use Drupal\filebrowser\Services\FilebrowserValidator;
+use Drupal\filebrowser\Filebrowser;
+use Drupal\Core\File\FileSystemInterface;
 use Drupal\Core\Cache\Cache;
 use Drupal\Core\Form\ConfirmFormBase;
 use Drupal\Core\Form\FormStateInterface;
@@ @@
   protected $queryFid;

   /**
-   * @var \Drupal\node\NodeInterface
+   * @var NodeInterface
    */
   protected $node;

   /**
    * Common methods
-   * @var \Drupal\filebrowser\Services\Common
+   * @var Common
    */
   protected $common;

@@ @@
   /**
    * Validator methods
    *
-   * @var \Drupal\filebrowser\Services\FilebrowserValidator
+   * @var FilebrowserValidator
    */
   protected $validator;

@@ @@
   /**
    * Filebrowser object holds specific data
    *
-   * @var \Drupal\filebrowser\Filebrowser
+   * @var Filebrowser
    */
   protected $filebrowser;

@@ @@
   /**
    * The file system.
    *
-   * @var \Drupal\Core\File\FileSystemInterface
+   * @var FileSystemInterface
    */
   protected $fileSystem;
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


11) modules/contrib/filebrowser/src/Form/ActionForm.php:2

    ---------- begin diff ----------
@@ @@

 namespace Drupal\filebrowser\Form;

+use Drupal\filebrowser\Services\Common;
+use Drupal\filebrowser\Services\FormHelper;
 use Drupal\Core\Form\FormBase;
 use Drupal\Core\Form\FormStateInterface;
 use Drupal\node\NodeInterface;
@@ @@
   /**
    * {@inheritdoc}
    */
-
   /**
-   * @var \Drupal\filebrowser\Services\Common
+   * @var Common
    */
   protected $common;

   /**
-   * @var \Drupal\filebrowser\Services\FormHelper
+   * @var FormHelper
    */
   protected $helper;
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


12) modules/contrib/filebrowser/src/FilebrowserUninstallValidator.php:15

    ---------- begin diff ----------
@@ @@
   use StringTranslationTrait;

   /**
-   * @var \Drupal\Core\Entity\EntityTypeManagerInterface
+   * @var EntityTypeManagerInterface
    */
   protected $entityTypeManager;

@@ @@
    *
    * @param \Drupal\Core\Entity\EntityTypeManagerInterface EntityTypeManager
    *   The entity query factory.
-   * @param \Drupal\Core\StringTranslation\TranslationInterface $string_translation
+   * @param TranslationInterface $string_translation
    *   The string translation service.
    */
-
   public function __construct(EntityTypeManagerInterface $entity_type_manager, TranslationInterface $string_translation) {
     $this->entityQuery = $entity_type_manager->getStorage('node')->getQuery();
     $this->stringTranslation = $string_translation;
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector


13) modules/contrib/filebrowser/src/FilebrowserManager.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\filebrowser;

+use Drupal\Core\Database\Connection;
+use Drupal\node\NodeInterface;
 use Drupal\Core\Ajax\AjaxResponse;
 use Drupal\Core\Controller\ControllerBase;
 use Drupal\Core\Form\FormStateInterface;
@@ @@
 class FilebrowserManager extends ControllerBase {

   /**
-   * @var \Drupal\filebrowser\Services\FilebrowserStorage
+   * @var FilebrowserStorage
    */
   public $storage;

   /**
-   * @var \Drupal\filebrowser\Services\FilebrowserValidator
+   * @var FilebrowserValidator
    */
   public $validator;

   /**
-   * @var \Drupal\filebrowser\Services\Common
+   * @var Common
    */
   public $common;

@@ @@
   public $user;

   /**
-   * @var \Drupal\filebrowser\Filebrowser
+   * @var Filebrowser
    */
   protected $filebrowser;

   /**
    * FilebrowserManager constructor.
-   * @param \Drupal\filebrowser\Services\FilebrowserStorage $storage
-   * @param \Drupal\filebrowser\Services\FilebrowserValidator $validator
+   * @param FilebrowserStorage $storage
+   * @param FilebrowserValidator $validator
    * @param \Drupal\Core\Session\AccountInterface
-   * @param \Drupal\filebrowser\Services\Common $common
+   * @param Common $common
    */
   public function __construct(FilebrowserStorage $storage, FilebrowserValidator $validator, AccountInterface $user, Common
   $common) {
@@ @@
    * @return array
    */
   public function addFormExtraFields(&$form, $form_state, $node = null, $isConfigForm = false) {
-    /** @var \Drupal\filebrowser\Filebrowser $nodeValues */
-
+    /** @var Filebrowser $nodeValues */
     $config = \Drupal::config('filebrowser.settings');
     $config = $config->get('filebrowser');
     $dispatcher = \Drupal::service('event_dispatcher');
@@ @@


   public function updateFilebrowser(Filebrowser $filebrowser, $mode) {
-    /** @var \Drupal\Core\Database\Connection $connection */
-
+    /** @var Connection $connection */
     if (empty($filebrowser->nid)) {
       \Drupal::messenger()->addError($this->t('No filebrowser data available in node - remove exit'));
       exit();
@@ @@
   public static function validateFolderPath($element, FormStateInterface $form_state) {

     $folder_path = $form_state->getValue('filebrowser')['folder_path'];
-    /** @var \Drupal\Core\StreamWrapper\StreamWrapperManager $stream_wrapper_manager */
+    /** @var StreamWrapperManager $stream_wrapper_manager */
     $stream_wrapper_manager = \Drupal::service('stream_wrapper_manager');
     $scheme = $stream_wrapper_manager::getScheme($folder_path);
     $error = false;
@@ @@
    * @param FormStateInterface $form_state
    * @return AjaxResponse
    */
-//  public function validateFolderPathAjax(array &$form, FormStateInterface $form_state) {
-//    $result = $this->checkFolderPath($form, $form_state);
-//    $response = new AjaxResponse();
-//    if ($result['error']) {
-//      $css = ['border' => '1px solid green'];
-//      $message = $this->t('Folder uri OK.');
-//    }
-//    else {
-//      $css = ['border' => '1px solid red'];
-//      $message = $this->$result['error_msg'];
-//    }
-//    $response->addCommand(new CssCommand('#edit-filebrowser-folder-path', $css));
-//    $response->addCommand(new HtmlCommand('.folder-path-valid-message', $message));
-//    return $response;
-//  }
-//
-//  public function checkFolderPath($form, FormStateInterface $form_state) {
-//    // @todo Replace deprecated code once the method is uncommented.
-//    $folder_path = $form_state->getValue('filebrowser')['folder_path'];
-//    $file_service = \Drupal::service('file_system');
-//    $scheme = $file_service->uriScheme($folder_path);
-//    $error = false;
-//    $message = '';
-//
-//    // Scheme is valid?
-//    if (!$scheme || !$file_service->validScheme($scheme)) {
-//      $message = $this->t('The scheme: %scheme in your uri is not valid.', ['%scheme' => $scheme]);
-//      $error = true;
-//     // $form_state->setError($element, $message);
-//    }
-//    // is directory name contains illegal characters?
-//    //todo:check
-//    if (strpbrk($folder_path, "\\/?%*:|\"<>") === TRUE) {
-//      $message = $this->t('This @name contains illegal characters.', ['name => $folder_path']);
-//      $error = true;
-//     // $form_state->setError($element, $message);
-//    }
-//
-//    if (!$error) {
-//      // name is safe, create the folder if it doesn't exists.
-//      if (!file_exists($folder_path)) {
-//        if (\Drupal::service('file_system')->mkdir($folder_path, NULL, TRUE, NULL)) {
-//          drupal_set_message($this->t('Folder location @uri created.', ['@uri' => $folder_path]));
-//        }
-//        else {
-//          $error = true;
-//          $message = $this->t('@url does not exist and Filebrowser can not create it.', ['@url' => $folder_path]);
-//      //    $form_state->setError($element, $message );
-//        }
-//      }
-//    }
-//    return [
-//      'error' => $error,
-//      'error_msg' => $message,
-//    ];
-//  }
-
+  //  public function validateFolderPathAjax(array &$form, FormStateInterface $form_state) {
+  //    $result = $this->checkFolderPath($form, $form_state);
+  //    $response = new AjaxResponse();
+  //    if ($result['error']) {
+  //      $css = ['border' => '1px solid green'];
+  //      $message = $this->t('Folder uri OK.');
+  //    }
+  //    else {
+  //      $css = ['border' => '1px solid red'];
+  //      $message = $this->$result['error_msg'];
+  //    }
+  //    $response->addCommand(new CssCommand('#edit-filebrowser-folder-path', $css));
+  //    $response->addCommand(new HtmlCommand('.folder-path-valid-message', $message));
+  //    return $response;
+  //  }
+  //
+  //  public function checkFolderPath($form, FormStateInterface $form_state) {
+  //    // @todo Replace deprecated code once the method is uncommented.
+  //    $folder_path = $form_state->getValue('filebrowser')['folder_path'];
+  //    $file_service = \Drupal::service('file_system');
+  //    $scheme = $file_service->uriScheme($folder_path);
+  //    $error = false;
+  //    $message = '';
+  //
+  //    // Scheme is valid?
+  //    if (!$scheme || !$file_service->validScheme($scheme)) {
+  //      $message = $this->t('The scheme: %scheme in your uri is not valid.', ['%scheme' => $scheme]);
+  //      $error = true;
+  //     // $form_state->setError($element, $message);
+  //    }
+  //    // is directory name contains illegal characters?
+  //    //todo:check
+  //    if (strpbrk($folder_path, "\\/?%*:|\"<>") === TRUE) {
+  //      $message = $this->t('This @name contains illegal characters.', ['name => $folder_path']);
+  //      $error = true;
+  //     // $form_state->setError($element, $message);
+  //    }
+  //
+  //    if (!$error) {
+  //      // name is safe, create the folder if it doesn't exists.
+  //      if (!file_exists($folder_path)) {
+  //        if (\Drupal::service('file_system')->mkdir($folder_path, NULL, TRUE, NULL)) {
+  //          drupal_set_message($this->t('Folder location @uri created.', ['@uri' => $folder_path]));
+  //        }
+  //        else {
+  //          $error = true;
+  //          $message = $this->t('@url does not exist and Filebrowser can not create it.', ['@url' => $folder_path]);
+  //      //    $form_state->setError($element, $message );
+  //        }
+  //      }
+  //    }
+  //    return [
+  //      'error' => $error,
+  //      'error_msg' => $message,
+  //    ];
+  //  }
   /**
-   * @param \Drupal\node\NodeInterface $node
+   * @param NodeInterface $node
    * @param array $display_list
    * @return null
    */
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


14) modules/contrib/filebrowser/src/File/DisplayFileList.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\filebrowser\File;

+use Drupal\filebrowser\Services\Common;
+use Drupal\filebrowser\Services\FilebrowserValidator;
+use Drupal\filebrowser\Services\FilebrowserStorage;
+use Drupal\Core\Session\AccountInterface;
+use Drupal\filebrowser\Filebrowser;
 use Drupal\Core\Controller\ControllerBase;
 use Drupal\Core\Link;
 use Drupal\filebrowser\Events\MetadataEvent;
@@ @@
    */
   protected $files;
   /**
-   * @var \Drupal\node\NodeInterface
+   * @var NodeInterface
    */
   protected $node;

@@ @@
   protected $serverFileList;

   /**
-   * @var \Drupal\filebrowser\Services\Common
+   * @var Common
    */
   protected $common;


   /**
-   * @var \Drupal\filebrowser\Services\FilebrowserValidator
+   * @var FilebrowserValidator
    */
   protected $validator;

   /**
-   * @var \Drupal\filebrowser\Services\FilebrowserStorage
+   * @var FilebrowserStorage
    */
   protected $storage;

   /**
-   * @var \Drupal\Core\Session\AccountInterface $user
+   * @var AccountInterface $user
    */
   protected $user;

   /**
-   * @var \Drupal\filebrowser\Filebrowser
+   * @var Filebrowser
    */
   protected $filebrowser;

@@ @@
   /**
    * Need this function to build the "Go-up" and Navigate-to-folder links in the icon view
    * todo: solve this better by integrating with makeLink()
-   * @param \Drupal\filebrowser\File\DisplayFile $file
+   * @param DisplayFile $file
    * @param null|int $fid
    */
   protected function makeAnchor(DisplayFile $file, $fid = null) {
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


15) modules/contrib/filebrowser/src/File/DisplayFile.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\filebrowser\File;

+use Drupal\Core\Link;
 use Drupal\Core\Controller\ControllerBase;

 class DisplayFile extends ControllerBase {
@@ @@
    */
   public $timestamp; // 1467989263
   /**
-   * @var \Drupal\Core\Link
+   * @var Link
    */
   public $link; // Drupal\Core\GeneratedLink Object
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


16) modules/contrib/filebrowser/src/Entity/FilebrowserMetadataEntityAccessControlHandler.php:17

    ---------- begin diff ----------
@@ @@
    * {@inheritdoc}
    */
   protected function checkAccess(EntityInterface $entity, $operation, AccountInterface $account) {
-    /** @var \Drupal\filebrowser\Entity\FilebrowserMetadataEntityInterface $entity */
+    /** @var FilebrowserMetadataEntityInterface $entity */
     switch ($operation) {
       case 'view':
         if (!$entity->isPublished()) {
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


17) modules/contrib/filebrowser/src/Controller/DefaultController.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\filebrowser\Controller;

+use Drupal\Core\Render\HtmlResponse;
 use Drupal\Core\Ajax\AfterCommand;
 use Drupal\Core\Ajax\AjaxResponse;
 use Drupal\Core\Ajax\AlertCommand;
@@ @@
 class DefaultController extends ControllerBase {

   /**
-   * @var \Drupal\filebrowser\FilebrowserManager $filebrowserManager
+   * @var FilebrowserManager $filebrowserManager
    */
   protected $filebrowserManager;
   /**
-   * @var \Drupal\filebrowser\Services\FilebrowserValidator
+   * @var FilebrowserValidator
    */
   protected $validator;

   /**
-   * @var \Drupal\filebrowser\Services\Common
+   * @var Common
    */
   protected $common;

@@ @@
    * route: filebrowser.page_download
    * path: filebrowser/download/{fid}
    * @param int $fid Id of the file selected in the download link
-   * @return \Symfony\Component\HttpFoundation\RedirectResponse
+   * @return RedirectResponse
    */
   public function pageDownload($fid) {
     /* @var NodeInterface $node **/
@@ @@
     // todo:
     // RedirectResponse needs a relative path so we will convert the full url into a relative path
     // This is done here, but should be moved to a better place in Common
-    $file_path = file_url_transform_relative($file_data->url);
+    $file_path = \Drupal::service('file_url_generator')->transformRelative($file_data->url);
     if ($filebrowser->downloadManager == 'public' && StreamWrapperManager::getScheme($file_data->uri) == 'public') {
       $response = new RedirectResponse($file_path);
       return $response;
@@ @@
    * @param string|null $fids A string containing the field id's of the files
    * to be processed.
    *
-   * @return \Drupal\Core\Ajax\AjaxResponse|\Drupal\Core\Render\HtmlResponse
+   * @return AjaxResponse|HtmlResponse
    */
   public function actionFormSubmitAction($nid, $query_fid, $op, $method, $fids = NULL) {
     // $op == archive does not use a form
    ----------- end diff -----------

Applied rules:
 * FileUrlTransformRelativeRector
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


18) modules/contrib/filebrowser/src/Breadcrumb/BreadcrumbBuilder.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\filebrowser\Breadcrumb;

+use Drupal\node\NodeInterface;
 use Drupal\Core\Breadcrumb\BreadcrumbBuilderInterface;
 use Drupal\Core\Routing\RouteMatchInterface;
 use Drupal\Core\Breadcrumb\Breadcrumb;
@@ @@
   protected $common;

   /**
-   * @var \Drupal\node\NodeInterface
-   *
+   * @var NodeInterface
    */
   protected $node;

@@ @@
    * @inheritdoc
    */
   public function build(RouteMatchInterface $route_match) {
-    /** @var \Drupal\node\NodeInterface $node */
+    /** @var NodeInterface $node */
     $breadcrumb = new Breadcrumb();
     $this->node =  $this->common->getNodeFromPath();
     $title = $this->node->getTitle();
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector


19) modules/contrib/filebrowser/src/Access/FilebrowserAccessCheck.php:15

    ---------- begin diff ----------
@@ @@
   /**
    * A custom access check.
    *
-   * @param \Drupal\Core\Session\AccountInterface $account
+   * @param AccountInterface $account
    *   Run access checks for this account.
    * @param RouteMatchInterface $route_match
    * @return AccessResult
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector


20) modules/contrib/filebrowser/filebrowser.module:0

    ---------- begin diff ----------
@@ @@
 <?php
+use Drupal\node\Entity\Node;
+use Drupal\filebrowser\FilebrowserManager;
+use Drupal\Core\Cache\Cache;
+use Drupal\filebrowser\File\DisplayFileList;
+use Drupal\filebrowser\Statistics;
 /* This file is part of "filebrowser".
  *    Copyright 2016, YagoSoft
  *    Author : Joop Sint Jago
@@ @@
  * @param FormStateInterface $form_state
  * @param $form_id
  */
-function filebrowser_form_node_form_alter(&$form, \Drupal\Core\Form\FormStateInterface $form_state, $form_id) {
+function filebrowser_form_node_form_alter(&$form, FormStateInterface $form_state, $form_id) {
   /** @var NodeInterface $node */
   $node = $form_state->getFormObject()->getEntity();
   if ($node->bundle() == 'dir_listing') {
@@ @@
  * @inheritdoc
  */
 function filebrowser_node_load($nodes) {
-  /** @var \Drupal\node\Entity\Node $node */
+  /** @var Node $node */
   foreach ($nodes as $nid => $node) {
     if ($node->bundle() == 'dir_listing') {
       $node->filebrowser = new Filebrowser($nid);
@@ @@

 /**
  * Implements hook_ENTITY_TYPE_insert().
- * @param Drupal\node\NodeInterface $node
+ * @param NodeInterface $node
  */
 function filebrowser_node_insert(NodeInterface $node) {
   if ($node->bundle() == 'dir_listing') {
@@ @@

 /**
  * Implements hook_ENTITY_TYPE_update() for node entities.
- * @var Drupal\node\NodeInterface $node
+ * @var NodeInterface $node
  */
 function filebrowser_node_update(NodeInterface $node) {
-  /** @var \Drupal\filebrowser\FilebrowserManager $manager */
+  /** @var FilebrowserManager $manager */
   if ($node->bundle() == 'dir_listing') {
     $node->filebrowser->nid = $node->id();
     $manager = \Drupal::service('filebrowser.manager');
@@ @@
     //print_r($node->filebrowser);
     $manager->updateFilebrowser($node->filebrowser, 'edit');
     // invalidate the cache for this node
-    \Drupal\Core\Cache\Cache::invalidateTags(['filebrowser:node:' . $node->id()]);
+    Cache::invalidateTags(['filebrowser:node:' . $node->id()]);
   }
 }

@@ @@
  */
 function filebrowser_node_view(array &$build, NodeInterface $node, EntityViewDisplayInterface $display, $view_mode) {
   /** @var \Drupal\filebrowser\FilebrowserManager $manager */
-  /** @var \Drupal\filebrowser\Filebrowser $filebrowser*/
+  /** @var Filebrowser $filebrowser*/
   if ($view_mode == 'full' && $node->bundle() == 'dir_listing') {
     $manager = \Drupal::service('filebrowser.manager');
     // get the argument $fid from query
     $fid = \Drupal::request()->query->get('fid');

-    $list = new \Drupal\filebrowser\File\DisplayFileList($node, $fid);
+    $list = new DisplayFileList($node, $fid);
     $display_list = $list->get();

     // Show file listing content part
@@ @@

     // Show the statistics of this listing
     if ($display->getComponent('filebrowser_statistics')) {
-      $statistics = new \Drupal\filebrowser\Statistics($display_list);
+      $statistics = new Statistics($display_list);
       $build['filebrowser_statistics'] = $statistics->get();
     }
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector


 [OK] 20 files have been changed by Rector                                      

