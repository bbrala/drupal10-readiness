modules/contrib/consumer_image_styles/consumer_image_styles.module
modules/contrib/consumer_image_styles/src/ConsumerImageStylesServiceProvider.php
modules/contrib/consumer_image_styles/src/ImageStylesProvider.php
modules/contrib/consumer_image_styles/src/ImageStylesProviderInterface.php
modules/contrib/consumer_image_styles/src/Normalizer/LinkCollectionNormalizer.php
modules/contrib/consumer_image_styles/src/Plugin/jsonapi/FieldEnhancer/ImageStyles.php
modules/contrib/consumer_image_styles/tests/src/Functional/ConsumerImageSylesFunctionalTest.php

5 files with changes
====================

1) modules/contrib/consumer_image_styles/tests/src/Functional/ConsumerImageSylesFunctionalTest.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\Tests\consumer_image_styles\Functional;

+use Drupal\user\Entity\User;
+use Drupal\node\Entity\NodeType;
+use Drupal\node\Entity\Node;
+use Drupal\Core\Entity\EntityStorageException;
 use Drupal\Component\Serialization\Json;
 use Drupal\Component\Utility\NestedArray;
 use Drupal\consumer_image_styles\ImageStylesProvider;
@@ @@
   protected $defaultTheme = 'stark';

   /**
-   * @var \Drupal\user\Entity\User
+   * @var User
    */
   protected $user;

@@ @@
   /**
    * The content type to attach the fields to test.
    *
-   * @var \Drupal\node\Entity\NodeType
+   * @var NodeType
    */
   protected $contentType;

   /**
-   * @var \Drupal\node\Entity\Node[]
+   * @var Node[]
    */
   protected $nodes = [];

   /**
-   * @var \Drupal\file\Entity\File[]
+   * @var File[]
    */
   protected $files = [];

   /**
-   * @var \Drupal\consumers\Entity\Consumer
+   * @var Consumer
    */
   protected $consumer;

@@ @@
    * @param int $num_nodes
    *   Number of articles to create.
    *
-   * @throws \Drupal\Core\Entity\EntityStorageException
+   * @throws EntityStorageException
    */
   protected function createDefaultContent($num_nodes) {
     $random = $this->getRandomGenerator();
    ----------- end diff -----------

Applied rules:
 * ExceptionAnnotationRector
 * RemoveDataProviderTestPrefixRector
 * AssertEqualsParameterToSpecificMethodsTypeRector
 * ArgumentRemoverRector
 * RenameAnnotationRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * AddReturnTypeDeclarationRector
 * ChangeMethodVisibilityRector


2) modules/contrib/consumer_image_styles/src/Plugin/jsonapi/FieldEnhancer/ImageStyles.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\consumer_image_styles\Plugin\jsonapi\FieldEnhancer;

+use Drupal\Core\Entity\EntityInterface;
+use Drupal\file\FileInterface;
+use Drupal\file\Entity\File;
 use Drupal\Component\Plugin\Exception\InvalidPluginDefinitionException;
 use Drupal\consumer_image_styles\ImageStylesProviderInterface;
 use Drupal\Core\Cache\CacheableMetadata;
@@ @@
 class ImageStyles extends ResourceFieldEnhancerBase implements ContainerFactoryPluginInterface {

   /**
-   * @var \Drupal\consumer_image_styles\ImageStylesProviderInterface
+   * @var ImageStylesProviderInterface
    */
   protected $imageStylesProvider;

   /**
-   * @var \Drupal\Core\Entity\EntityTypeManagerInterface
+   * @var EntityTypeManagerInterface
    */
   protected $entityTypeManager;

@@ @@
     catch (InvalidPluginDefinitionException $e) {
       $image_styles = [];
     }
-    /** @var \Drupal\Core\Entity\EntityInterface $entity */
+    /** @var EntityInterface $entity */
     $uuid_key = $this->entityTypeManager->getDefinition('file')->getKey('uuid');
     $entities = $this->entityTypeManager
       ->getStorage('file')
       ->loadByProperties([$uuid_key => $data['id']]);
-    /** @var \Drupal\file\FileInterface $entity */
+    /** @var FileInterface $entity */
     $entity = reset($entities);
     // If the entity cannot be loaded or it's not an image, do not enhance it.
     if (!$entity || !$this->imageStylesProvider->entityIsImage($entity)) {
       return $data;
     }
-    /** @var \Drupal\Core\Cache\CacheableMetadata $cacheableMetadata */
+    /** @var CacheableMetadata $cacheableMetadata */
     $cacheableMetadata = $context->offsetGet(CacheableNormalizerInterface::SERIALIZATION_CONTEXT_CACHEABILITY)
       ->merge(CacheableMetadata::createFromObject($entity));
-    /** @var \Drupal\file\Entity\File $entity */
+    /** @var File $entity */
     // If the entity is not viewable.
     $access = $entity->access('view', NULL, TRUE);
     if (!$access->isAllowed()) {
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector
 * ChangeMethodVisibilityRector


3) modules/contrib/consumer_image_styles/src/Normalizer/LinkCollectionNormalizer.php:23

    ---------- begin diff ----------
@@ @@
 class LinkCollectionNormalizer implements NormalizerInterface {

   /**
-   * @var \Drupal\consumers\Negotiator
+   * @var Negotiator
    */
   protected $consumerNegotiator;

   /**
-   * @var \Drupal\consumer_image_styles\ImageStylesProviderInterface
+   * @var ImageStylesProviderInterface
    */
   protected $imageStylesProvider;

   /**
-   * @var \Drupal\Core\Image\ImageFactory
+   * @var ImageFactory
    */
   protected $imageFactory;

   /**
-   * @var \Symfony\Component\Serializer\Normalizer\NormalizerInterface
+   * @var NormalizerInterface
    */
   protected $inner;

@@ @@
   /**
    * The request stack.
    *
-   * @var \Symfony\Component\HttpFoundation\RequestStack
+   * @var RequestStack
    */
   protected $requestStack;

@@ @@
   /**
    * Constructs a LinkCollectionNormalizer object.
    *
-   * @param \Symfony\Component\Serializer\Normalizer\NormalizerInterface $inner
+   * @param NormalizerInterface $inner
    *   The decorated service.
-   * @param \Drupal\consumers\Negotiator $consumer_negotiator
+   * @param Negotiator $consumer_negotiator
    *   The consumer negotiator.
    * @param \Drupal\consumer_image_styles\ImageStylesProviderInterface
    *   Image styles utility.
-   * @param \Drupal\Core\Image\ImageFactory $image_factory
+   * @param ImageFactory $image_factory
    *   The image factory.
-   * @param \Symfony\Component\HttpFoundation\RequestStack $request_stack
+   * @param RequestStack $request_stack
    *   The request stack.
    */
   public function __construct(NormalizerInterface $inner, Negotiator $consumer_negotiator, ImageStylesProviderInterface $imageStylesProvider, ImageFactory $image_factory, RequestStack $request_stack) {
@@ @@
   }

   /**
-   * @param \Drupal\jsonapi\JsonApiResource\ResourceObject $resource_object
+   * @param ResourceObject $resource_object
    * @param \Drupal\consumers\Entity\Consumer
    *
-   * @return \Drupal\jsonapi\JsonApiResource\LinkCollection
+   * @return LinkCollection
    *   The variant links.
    */
   protected function buildVariantLinks(ResourceObject $resource_object, Consumer $consumer) {
@@ @@
       $image_style->transformDimensions($dimensions, $uri);
       $variant_link = new Link(
         CacheableMetadata::createFromObject($image_style),
-        Url::fromUri(file_create_url($image_style->buildUrl($uri))),
+        \Drupal::service('file_url_generator')->generate($image_style->buildUrl($uri)),
         ImageStylesProvider::DERIVATIVE_LINK_REL,
         // Target attributes can only be strings, but dimensions are links.
         array_map(function (?int $dimension): string {
@@ @@
   /**
    * Whether this decorator applies to the current data.
    *
-   * @param \Drupal\jsonapi\JsonApiResource\LinkCollection $link_collection
+   * @param LinkCollection $link_collection
    *   The link collection to be normalized.
    *
    * @return bool
@@ @@
   /**
    * Gets the current consumer.
    *
-   * @return \Drupal\consumers\Entity\Consumer
+   * @return Consumer
    *   The current consumer or NULL if one cannot be negotiated.
    */
   protected function getConsumer() {
@@ @@
   /**
    * Adds the derivative link relation type to the normalized link collection.
    *
-   * @param \Drupal\jsonapi\Normalizer\Value\CacheableNormalization $cacheable_normalization
+   * @param CacheableNormalization $cacheable_normalization
    *   The cacheable normalization to which link relations need to be added.
-   * @param \Drupal\jsonapi\JsonApiResource\LinkCollection $link_collection
+   * @param LinkCollection $link_collection
    *   The un-normalized link collection.
    *
-   * @return \Drupal\jsonapi\Normalizer\Value\CacheableNormalization
+   * @return CacheableNormalization
    *   The links normalization with meta.rel added.
    */
   protected static function addLinkRels(CacheableNormalization $cacheable_normalization, LinkCollection $link_collection) {
    ----------- end diff -----------

Applied rules:
 * FromUriRector
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector


4) modules/contrib/consumer_image_styles/src/ImageStylesProviderInterface.php:1

    ---------- begin diff ----------
@@ @@

 namespace Drupal\consumer_image_styles;

+use Drupal\image\Entity\ImageStyle;
 use Drupal\consumers\Entity\Consumer;
 use Drupal\Core\Cache\CacheableMetadata;
 use Drupal\Core\Entity\EntityInterface;
@@ @@
   /**
    * Load the image styles for a given consumer.
    *
-   * @param \Drupal\consumers\Entity\Consumer $consumer
+   * @param Consumer $consumer
    *   Consumer entity to load image styles for.
    *
-   * @return \Drupal\image\Entity\ImageStyle[]
+   * @return ImageStyle[]
    *   List of image styles keyed by image style id.
    */
   public function loadStyles(Consumer $consumer);
@@ @@
    *
    * @param string $uri
    *   The file URI.
-   * @param \Drupal\image\ImageStyleInterface $image_style
+   * @param ImageStyleInterface $image_style
    *   The image style to apply.
-   * @param \Drupal\Core\Cache\CacheableMetadata $cacheable_metadata
+   * @param CacheableMetadata $cacheable_metadata
    *   Cacheable metadata for the normalization.
    *
    * @return array
@@ @@
   /**
    * Checks if an entity is an image.
    *
-   * @param \Drupal\Core\Entity\EntityInterface $entity
+   * @param EntityInterface $entity
    *   The entity.
    *
    * @return bool
    ----------- end diff -----------

Applied rules:
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector


5) modules/contrib/consumer_image_styles/src/ImageStylesProvider.php:28

    ---------- begin diff ----------
@@ @@
   /**
    * The entity type manager.
    *
-   * @var \Drupal\Core\Entity\EntityTypeManagerInterface
+   * @var EntityTypeManagerInterface
    */
   private $entityTypeManager;

@@ @@
   /**
    * The image factory.
    *
-   * @var \Drupal\Core\Image\ImageFactory
+   * @var ImageFactory
    */
   private $imageFactory;

@@ @@
   /**
    * Stream Wrapper Manager.
    *
-   * @var \Drupal\Core\StreamWrapper\StreamWrapperManagerInterface
+   * @var StreamWrapperManagerInterface
    */
   private StreamWrapperManagerInterface $streamWrapperManager;

@@ @@
   /**
    * Constructor.
    *
-   * @param \Drupal\Core\Entity\EntityTypeManagerInterface $entity_type_manager
+   * @param EntityTypeManagerInterface $entity_type_manager
    *   Entity type manager.
-   * @param \Drupal\Core\Image\ImageFactory $image_factory
+   * @param ImageFactory $image_factory
    *   Image factory.
-   * @param \Drupal\Core\StreamWrapper\StreamWrapperManagerInterface $stream_wrapper_manager
+   * @param StreamWrapperManagerInterface $stream_wrapper_manager
    *   Stream wrapper manager.
    */
   public function __construct(
@@ @@
     }
     $cacheable_metadata->addCacheableDependency($image_style);
     $info = [
-      'href' => file_create_url($image_style->buildUrl($uri)),
+      'href' => \Drupal::service('file_url_generator')->generateAbsoluteString($image_style->buildUrl($uri)),
       'title' => $this->t('Image Style: @name', ['@name' => $image_style->label()]),
       'meta' => ['rel' => static::DERIVATIVE_LINK_REL],
       // This is json:api 1.1 compatible.
    ----------- end diff -----------

Applied rules:
 * FileCreateUrlRector
 * ArgumentRemoverRector
 * PseudoNamespaceToNamespaceRector
 * WrapReturnRector
 * AddParamTypeDeclarationRector


 [OK] 5 files have been changed by Rector                                       

