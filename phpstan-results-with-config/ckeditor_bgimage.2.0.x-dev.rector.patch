diff --git a/ckeditor_bgimage.admin.inc b/ckeditor_bgimage.admin.inc
index d06f447..c724cc8 100644
--- a/ckeditor_bgimage.admin.inc
+++ b/ckeditor_bgimage.admin.inc
@@ -12,7 +12,7 @@ use Drupal\Component\Utility\Environment;
 /**
  * Subform constructor to configure the text editor's file upload settings.
  *
- * @param \Drupal\editor\Entity\Editor $editor
+ * @param Editor $editor
  *   The text editor entity that is being edited.
  *
  * @return array
diff --git a/src/Form/EditorFileDialog.php b/src/Form/EditorFileDialog.php
index a8ee9e5..b26f874 100644
--- a/src/Form/EditorFileDialog.php
+++ b/src/Form/EditorFileDialog.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\ckeditor_bgimage\Form;
 
+use Drupal\file\FileInterface;
 use Drupal\Core\Form\FormBase;
 use Drupal\Core\Ajax\HtmlCommand;
 use Drupal\Core\Ajax\AjaxResponse;
@@ -23,14 +24,14 @@ class EditorFileDialog extends FormBase implements BaseFormIdInterface {
   /**
    * The file storage service.
    *
-   * @var \Drupal\Core\Entity\EntityStorageInterface
+   * @var EntityStorageInterface
    */
   protected $fileStorage;
 
   /**
    * Constructs a form object for image dialog.
    *
-   * @param \Drupal\Core\Entity\EntityStorageInterface $file_storage
+   * @param EntityStorageInterface $file_storage
    *   The file storage service.
    */
   public function __construct(EntityStorageInterface $file_storage) {
@@ -187,10 +188,10 @@ class EditorFileDialog extends FormBase implements BaseFormIdInterface {
     $fid = $form_state->getValue(['fid', 0]);
 
     if (!empty($fid)) {
-      /** @var \Drupal\file\FileInterface */
+      /** @var FileInterface */
       $file = $this->fileStorage->load($fid);
-      $file_url = file_create_url($file->getFileUri());
-      $file_url = file_url_transform_relative($file_url);
+      $file_url = \Drupal::service('file_url_generator')->generateAbsoluteString($file->getFileUri());
+      $file_url = \Drupal::service('file_url_generator')->transformRelative($file_url);
       $form_state->setValue(['attributes', 'image'], $file_url);
     }
 
diff --git a/src/Plugin/CKEditorPlugin/Bgimage.php b/src/Plugin/CKEditorPlugin/Bgimage.php
index 59bbef5..41e986c 100644
--- a/src/Plugin/CKEditorPlugin/Bgimage.php
+++ b/src/Plugin/CKEditorPlugin/Bgimage.php
@@ -21,7 +21,7 @@ class Bgimage extends CKEditorPluginBase implements CKEditorPluginConfigurableIn
    * {@inheritdoc}
    */
   public function getFile() {
-    if ($module_path = drupal_get_path('module', 'ckeditor_bgimage')) {
+    if ($module_path = \Drupal::service('extension.list.module')->getPath('ckeditor_bgimage')) {
       return $module_path . '/src/js/bgimage/plugin.js';
     }
   }
@@ -52,7 +52,7 @@ class Bgimage extends CKEditorPluginBase implements CKEditorPluginConfigurableIn
     return [
       'bgimage' => [
         'label' => $this->t('Background Image'),
-        'image' => drupal_get_path('module', 'ckeditor_bgimage') . '/src/js/bgimage/icons/background.png',
+        'image' => \Drupal::service('extension.list.module')->getPath('ckeditor_bgimage') . '/src/js/bgimage/icons/background.png',
       ],
     ];
   }
